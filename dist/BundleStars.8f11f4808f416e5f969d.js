"use strict";
(self["webpackChunktelegram_t"] = self["webpackChunktelegram_t"] || []).push([["BundleStars"],{

/***/ "./src/assets/icons/GoldStar.svg":
/*!***************************************!*\
  !*** ./src/assets/icons/GoldStar.svg ***!
  \***************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "GoldStar.fb6812e915ddfe27f504.svg";

/***/ }),

/***/ "./src/assets/stars-bg.png":
/*!*********************************!*\
  !*** ./src/assets/stars-bg.png ***!
  \*********************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "stars-bg.dee4c4b73c7d21c2ec73.png";

/***/ }),

/***/ "./src/bundles/stars.ts":
/*!******************************!*\
  !*** ./src/bundles/stars.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AboutStarGiftModal: () => (/* reexport safe */ _components_modals_gift_AboutStarGiftModal__WEBPACK_IMPORTED_MODULE_20__["default"]),
/* harmony export */   ChatRefundModal: () => (/* reexport safe */ _components_modals_stars_chatRefund_ChatRefundModal__WEBPACK_IMPORTED_MODULE_26__["default"]),
/* harmony export */   GiftAuctionAcquiredModal: () => (/* reexport safe */ _components_modals_gift_auction_GiftAuctionAcquiredModal__WEBPACK_IMPORTED_MODULE_17__["default"]),
/* harmony export */   GiftAuctionBidModal: () => (/* reexport safe */ _components_modals_gift_auction_GiftAuctionBidModal__WEBPACK_IMPORTED_MODULE_15__["default"]),
/* harmony export */   GiftAuctionChangeRecipientModal: () => (/* reexport safe */ _components_modals_gift_auction_GiftAuctionChangeRecipientModal__WEBPACK_IMPORTED_MODULE_18__["default"]),
/* harmony export */   GiftAuctionInfoModal: () => (/* reexport safe */ _components_modals_gift_auction_GiftAuctionInfoModal__WEBPACK_IMPORTED_MODULE_16__["default"]),
/* harmony export */   GiftAuctionModal: () => (/* reexport safe */ _components_modals_gift_auction_GiftAuctionModal__WEBPACK_IMPORTED_MODULE_14__["default"]),
/* harmony export */   GiftDescriptionRemoveModal: () => (/* reexport safe */ _components_modals_gift_message_GiftDescriptionRemoveModal__WEBPACK_IMPORTED_MODULE_25__["default"]),
/* harmony export */   GiftInfoModal: () => (/* reexport safe */ _components_modals_gift_info_GiftInfoModal__WEBPACK_IMPORTED_MODULE_9__["default"]),
/* harmony export */   GiftInfoValueModal: () => (/* reexport safe */ _components_modals_gift_value_GiftInfoValueModal__WEBPACK_IMPORTED_MODULE_10__["default"]),
/* harmony export */   GiftLockedModal: () => (/* reexport safe */ _components_modals_gift_locked_GiftLockedModal__WEBPACK_IMPORTED_MODULE_11__["default"]),
/* harmony export */   GiftModal: () => (/* reexport safe */ _components_modals_gift_GiftModal__WEBPACK_IMPORTED_MODULE_7__["default"]),
/* harmony export */   GiftRecipientPicker: () => (/* reexport safe */ _components_modals_gift_recipient_GiftRecipientPicker__WEBPACK_IMPORTED_MODULE_8__["default"]),
/* harmony export */   GiftResalePriceComposerModal: () => (/* reexport safe */ _components_modals_gift_resale_GiftResalePriceComposerModal__WEBPACK_IMPORTED_MODULE_12__["default"]),
/* harmony export */   GiftStatusInfoModal: () => (/* reexport safe */ _components_modals_gift_status_GiftStatusInfoModal__WEBPACK_IMPORTED_MODULE_21__["default"]),
/* harmony export */   GiftTransferConfirmModal: () => (/* reexport safe */ _components_modals_gift_transfer_GiftTransferConfirmModal__WEBPACK_IMPORTED_MODULE_24__["default"]),
/* harmony export */   GiftTransferModal: () => (/* reexport safe */ _components_modals_gift_transfer_GiftTransferModal__WEBPACK_IMPORTED_MODULE_23__["default"]),
/* harmony export */   GiftUpgradeModal: () => (/* reexport safe */ _components_modals_gift_upgrade_GiftUpgradeModal__WEBPACK_IMPORTED_MODULE_13__["default"]),
/* harmony export */   GiftWithdrawModal: () => (/* reexport safe */ _components_modals_gift_withdraw_GiftWithdrawModal__WEBPACK_IMPORTED_MODULE_22__["default"]),
/* harmony export */   PaidReactionModal: () => (/* reexport safe */ _components_modals_paidReaction_PaidReactionModal__WEBPACK_IMPORTED_MODULE_6__["default"]),
/* harmony export */   PriceConfirmModal: () => (/* reexport safe */ _components_modals_priceConfirm_PriceConfirmModal__WEBPACK_IMPORTED_MODULE_27__["default"]),
/* harmony export */   StarGiftPriceDecreaseInfoModal: () => (/* reexport safe */ _components_modals_gift_StarGiftPriceDecreaseInfoModal__WEBPACK_IMPORTED_MODULE_19__["default"]),
/* harmony export */   StarPaymentModal: () => (/* reexport safe */ _components_modals_stars_StarsPaymentModal__WEBPACK_IMPORTED_MODULE_3__["default"]),
/* harmony export */   StarsBalanceModal: () => (/* reexport safe */ _components_modals_stars_StarsBalanceModal__WEBPACK_IMPORTED_MODULE_2__["default"]),
/* harmony export */   StarsGiftModal: () => (/* reexport safe */ _components_modals_stars_gift_StarsGiftModal__WEBPACK_IMPORTED_MODULE_0__["default"]),
/* harmony export */   StarsGiftingPickerModal: () => (/* reexport safe */ _components_main_premium_StarsGiftingPickerModal__WEBPACK_IMPORTED_MODULE_1__["default"]),
/* harmony export */   StarsSubscriptionModal: () => (/* reexport safe */ _components_modals_stars_subscription_StarsSubscriptionModal__WEBPACK_IMPORTED_MODULE_5__["default"]),
/* harmony export */   StarsTransactionInfoModal: () => (/* reexport safe */ _components_modals_stars_transaction_StarsTransactionModal__WEBPACK_IMPORTED_MODULE_4__["default"])
/* harmony export */ });
/* harmony import */ var _components_modals_stars_gift_StarsGiftModal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../components/modals/stars/gift/StarsGiftModal */ "./src/components/modals/stars/gift/StarsGiftModal.tsx");
/* harmony import */ var _components_main_premium_StarsGiftingPickerModal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/main/premium/StarsGiftingPickerModal */ "./src/components/main/premium/StarsGiftingPickerModal.tsx");
/* harmony import */ var _components_modals_stars_StarsBalanceModal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../components/modals/stars/StarsBalanceModal */ "./src/components/modals/stars/StarsBalanceModal.tsx");
/* harmony import */ var _components_modals_stars_StarsPaymentModal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../components/modals/stars/StarsPaymentModal */ "./src/components/modals/stars/StarsPaymentModal.tsx");
/* harmony import */ var _components_modals_stars_transaction_StarsTransactionModal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../components/modals/stars/transaction/StarsTransactionModal */ "./src/components/modals/stars/transaction/StarsTransactionModal.tsx");
/* harmony import */ var _components_modals_stars_subscription_StarsSubscriptionModal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../components/modals/stars/subscription/StarsSubscriptionModal */ "./src/components/modals/stars/subscription/StarsSubscriptionModal.tsx");
/* harmony import */ var _components_modals_paidReaction_PaidReactionModal__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../components/modals/paidReaction/PaidReactionModal */ "./src/components/modals/paidReaction/PaidReactionModal.tsx");
/* harmony import */ var _components_modals_gift_GiftModal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../components/modals/gift/GiftModal */ "./src/components/modals/gift/GiftModal.tsx");
/* harmony import */ var _components_modals_gift_recipient_GiftRecipientPicker__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../components/modals/gift/recipient/GiftRecipientPicker */ "./src/components/modals/gift/recipient/GiftRecipientPicker.tsx");
/* harmony import */ var _components_modals_gift_info_GiftInfoModal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../components/modals/gift/info/GiftInfoModal */ "./src/components/modals/gift/info/GiftInfoModal.tsx");
/* harmony import */ var _components_modals_gift_value_GiftInfoValueModal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../components/modals/gift/value/GiftInfoValueModal */ "./src/components/modals/gift/value/GiftInfoValueModal.tsx");
/* harmony import */ var _components_modals_gift_locked_GiftLockedModal__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../components/modals/gift/locked/GiftLockedModal */ "./src/components/modals/gift/locked/GiftLockedModal.tsx");
/* harmony import */ var _components_modals_gift_resale_GiftResalePriceComposerModal__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../components/modals/gift/resale/GiftResalePriceComposerModal */ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.tsx");
/* harmony import */ var _components_modals_gift_upgrade_GiftUpgradeModal__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../components/modals/gift/upgrade/GiftUpgradeModal */ "./src/components/modals/gift/upgrade/GiftUpgradeModal.tsx");
/* harmony import */ var _components_modals_gift_auction_GiftAuctionModal__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../components/modals/gift/auction/GiftAuctionModal */ "./src/components/modals/gift/auction/GiftAuctionModal.tsx");
/* harmony import */ var _components_modals_gift_auction_GiftAuctionBidModal__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../components/modals/gift/auction/GiftAuctionBidModal */ "./src/components/modals/gift/auction/GiftAuctionBidModal.tsx");
/* harmony import */ var _components_modals_gift_auction_GiftAuctionInfoModal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../components/modals/gift/auction/GiftAuctionInfoModal */ "./src/components/modals/gift/auction/GiftAuctionInfoModal.tsx");
/* harmony import */ var _components_modals_gift_auction_GiftAuctionAcquiredModal__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../components/modals/gift/auction/GiftAuctionAcquiredModal */ "./src/components/modals/gift/auction/GiftAuctionAcquiredModal.tsx");
/* harmony import */ var _components_modals_gift_auction_GiftAuctionChangeRecipientModal__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../components/modals/gift/auction/GiftAuctionChangeRecipientModal */ "./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.tsx");
/* harmony import */ var _components_modals_gift_StarGiftPriceDecreaseInfoModal__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../components/modals/gift/StarGiftPriceDecreaseInfoModal */ "./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.tsx");
/* harmony import */ var _components_modals_gift_AboutStarGiftModal__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../components/modals/gift/AboutStarGiftModal */ "./src/components/modals/gift/AboutStarGiftModal.tsx");
/* harmony import */ var _components_modals_gift_status_GiftStatusInfoModal__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../components/modals/gift/status/GiftStatusInfoModal */ "./src/components/modals/gift/status/GiftStatusInfoModal.tsx");
/* harmony import */ var _components_modals_gift_withdraw_GiftWithdrawModal__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../components/modals/gift/withdraw/GiftWithdrawModal */ "./src/components/modals/gift/withdraw/GiftWithdrawModal.tsx");
/* harmony import */ var _components_modals_gift_transfer_GiftTransferModal__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../components/modals/gift/transfer/GiftTransferModal */ "./src/components/modals/gift/transfer/GiftTransferModal.tsx");
/* harmony import */ var _components_modals_gift_transfer_GiftTransferConfirmModal__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../components/modals/gift/transfer/GiftTransferConfirmModal */ "./src/components/modals/gift/transfer/GiftTransferConfirmModal.tsx");
/* harmony import */ var _components_modals_gift_message_GiftDescriptionRemoveModal__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../components/modals/gift/message/GiftDescriptionRemoveModal */ "./src/components/modals/gift/message/GiftDescriptionRemoveModal.tsx");
/* harmony import */ var _components_modals_stars_chatRefund_ChatRefundModal__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../components/modals/stars/chatRefund/ChatRefundModal */ "./src/components/modals/stars/chatRefund/ChatRefundModal.tsx");
/* harmony import */ var _components_modals_priceConfirm_PriceConfirmModal__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../components/modals/priceConfirm/PriceConfirmModal */ "./src/components/modals/priceConfirm/PriceConfirmModal.tsx");
/* eslint-disable @stylistic/max-len */






























/***/ }),

/***/ "./src/components/common/gift/GiftMenuItems.tsx":
/*!******************************************************!*\
  !*** ./src/components/common/gift/GiftMenuItems.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GiftMenuItems = ({
  peerId,
  canManage,
  gift: typeGift,
  currentUserEmojiStatus,
  collectibleEmojiStatuses
}) => {
  const {
    showNotification,
    openChatWithDraft,
    openGiftTransferModal,
    openGiftResalePriceComposerModal,
    openGiftStatusInfoModal,
    setEmojiStatus,
    toggleSavedGiftPinned,
    changeGiftVisibility,
    updateStarGiftPrice,
    closeGiftInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isSavedGift = typeGift && 'gift' in typeGift;
  const savedGift = isSavedGift ? typeGift : undefined;
  const gift = isSavedGift ? typeGift.gift : typeGift;
  const starGiftUniqueSlug = gift?.type === 'starGiftUnique' ? gift.slug : undefined;
  const starGiftUniqueLink = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUniqueSlug) return undefined;
    return `${_config__WEBPACK_IMPORTED_MODULE_2__.TME_LINK_PREFIX}nft/${starGiftUniqueSlug}`;
  }, [starGiftUniqueSlug]);
  const userCollectibleStatus = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUniqueSlug) return undefined;
    return collectibleEmojiStatuses?.find(status => status.type === 'collectible' && status.slug === starGiftUniqueSlug);
  }, [starGiftUniqueSlug, collectibleEmojiStatuses]);
  const currenUniqueEmojiStatusSlug = currentUserEmojiStatus?.type === 'collectible' ? currentUserEmojiStatus.slug : undefined;
  const isGiftUnique = gift && gift.type === 'starGiftUnique';
  const canTakeOff = isGiftUnique && currenUniqueEmojiStatusSlug === gift.slug;
  const canWear = userCollectibleStatus && !canTakeOff;
  const giftResalePrice = isGiftUnique ? gift.resellPrice : undefined;
  const hasPinOptions = canManage && savedGift && !savedGift.isUnsaved && isGiftUnique;
  const handleTriggerVisibility = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    const {
      inputGift,
      isUnsaved
    } = savedGift;
    changeGiftVisibility({
      gift: inputGift,
      shouldUnsave: !isUnsaved
    });
  });
  const handleCopyLink = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!starGiftUniqueLink) return;
    (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyTextToClipboard)(starGiftUniqueLink);
    showNotification({
      message: lang('LinkCopied')
    });
  });
  const handleLinkShare = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!starGiftUniqueLink) return;
    openChatWithDraft({
      text: {
        text: starGiftUniqueLink
      }
    });
  });
  const handleTransfer = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || savedGift?.gift.type !== 'starGiftUnique') return;
    if (savedGift.canTransferAt && savedGift.canTransferAt > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()) {
      showNotification({
        message: {
          key: 'NotificationGiftCanTransferAt',
          variables: {
            date: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateAtTime)(oldLang, savedGift.canTransferAt * 1000)
          }
        }
      });
      return;
    }
    openGiftTransferModal({
      gift: savedGift
    });
  });
  const handleSell = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift) return;
    if (savedGift.canResellAt && savedGift.canResellAt > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()) {
      showNotification({
        message: {
          key: 'NotificationGiftCanResellAt',
          variables: {
            date: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateAtTime)(oldLang, savedGift.canResellAt * 1000)
          }
        }
      });
      return;
    }
    openGiftResalePriceComposerModal({
      peerId,
      gift: savedGift
    });
  });
  const handleUnsell = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || savedGift.gift.type !== 'starGiftUnique' || !savedGift.inputGift) return;
    closeGiftInfoModal();
    updateStarGiftPrice({
      gift: savedGift.inputGift,
      price: {
        currency: _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE,
        amount: 0,
        nanos: 0
      }
    });
    showNotification({
      icon: 'unlist-outline',
      message: {
        key: 'NotificationGiftIsUnlist',
        variables: {
          gift: lang('GiftUnique', {
            title: savedGift.gift.title,
            number: savedGift.gift.number
          })
        }
      }
    });
  });
  const handleWear = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (gift?.type !== 'starGiftUnique' || !userCollectibleStatus) return;
    openGiftStatusInfoModal({
      emojiStatus: userCollectibleStatus
    });
  });
  const handleTakeOff = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (canTakeOff) {
      setEmojiStatus({
        emojiStatus: {
          type: 'regular',
          documentId: _config__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_STATUS_ICON_ID
        }
      });
    }
  });
  const handleTogglePin = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    toggleSavedGiftPinned({
      peerId,
      gift: savedGift
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment, {
    children: [hasPinOptions && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: savedGift.isPinned ? 'unpin' : 'pin',
      onClick: handleTogglePin,
      children: lang(savedGift.isPinned ? 'ChatListUnpinFromTop' : 'ChatListPinToTop')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "link-badge",
      onClick: handleCopyLink,
      children: lang('CopyLink')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "forward",
      onClick: handleLinkShare,
      children: lang('Share')
    }), canManage && isGiftUnique && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "diamond",
      onClick: handleTransfer,
      children: lang('GiftInfoTransfer')
    }), canManage && isGiftUnique && !giftResalePrice && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "sell-outline",
      onClick: handleSell,
      children: lang('Sell')
    }), canManage && isGiftUnique && Boolean(giftResalePrice) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "unlist-outline",
      onClick: handleUnsell,
      children: lang('GiftInfoUnlist')
    }), canManage && savedGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: savedGift.isUnsaved ? 'eye-outline' : 'eye-crossed-outline',
      onClick: handleTriggerVisibility,
      children: lang(savedGift.isUnsaved ? 'GiftActionShow' : 'GiftActionHide')
    }), canWear && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "crown-wear-outline",
      onClick: handleWear,
      children: lang('GiftInfoWear')
    }), canTakeOff && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "crown-take-off-outline",
      onClick: handleTakeOff,
      children: lang('GiftInfoTakeOff')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftMenuItems));

/***/ }),

/***/ "./src/components/common/gift/GiftTransferPreview.module.scss":
/*!********************************************************************!*\
  !*** ./src/components/common/gift/GiftTransferPreview.module.scss ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Ef0cKSqQ","giftPreview":"IvuNzslN","backdrop":"dNukis4X","arrow":"oufsMLLF"});

/***/ }),

/***/ "./src/components/common/gift/GiftTransferPreview.tsx":
/*!************************************************************!*\
  !*** ./src/components/common/gift/GiftTransferPreview.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _helpers_gifts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./GiftTransferPreview.module.scss */ "./src/components/common/gift/GiftTransferPreview.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const AVATAR_SIZE = 4 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.REM;
const GIFT_STICKER_SIZE = 3 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.REM;
const GiftTransferPreview = ({
  peer,
  gift
}) => {
  const giftAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_1__.getGiftAttributes)(gift);
  }, [gift]);
  if (!giftAttributes) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
    className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
      className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].giftPreview,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_6__["default"], {
        className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].backdrop,
        backgroundColors: [giftAttributes.backdrop.centerColor, giftAttributes.backdrop.edgeColor],
        patternIcon: giftAttributes.pattern?.sticker,
        ringsCount: 1,
        ovalFactor: 1,
        patternSize: 12
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_3__["default"], {
        className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].sticker,
        size: GIFT_STICKER_SIZE,
        sticker: giftAttributes.model?.sticker
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_icons_Icon__WEBPACK_IMPORTED_MODULE_5__["default"], {
      name: "next",
      className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].arrow
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_4__["default"], {
      peer: peer,
      size: AVATAR_SIZE,
      className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].avatar
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftTransferPreview));

/***/ }),

/***/ "./src/components/common/helpers/giftOriginalInfo.tsx":
/*!************************************************************!*\
  !*** ./src/components/common/helpers/giftOriginalInfo.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   renderGiftOriginalInfo: () => (/* binding */ renderGiftOriginalInfo)
/* harmony export */ });
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





function renderGiftOriginalInfo({
  originalDetails,
  recipient,
  sender,
  onOpenChat,
  lang
}) {
  const {
    recipientId,
    senderId,
    date,
    message
  } = originalDetails;
  const formattedDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.formatDateTimeToString)(date * 1000, lang.code, true);
  const recipientLink = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_3__["default"], {
    onClick: () => onOpenChat(recipientId),
    isPrimary: true,
    children: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_0__.getPeerTitle)(lang, recipient)
  });
  if (!sender || senderId === recipientId) {
    return message ? lang('GiftInfoPeerOriginalInfoText', {
      peer: recipientLink,
      text: (0,_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__.renderTextWithEntities)(message),
      date: formattedDate
    }, {
      withNodes: true
    }) : lang('GiftInfoPeerOriginalInfo', {
      peer: recipientLink,
      date: formattedDate
    }, {
      withNodes: true
    });
  }
  const senderLink = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_3__["default"], {
    onClick: () => onOpenChat(sender.id),
    isPrimary: true,
    children: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_0__.getPeerTitle)(lang, sender)
  });
  return message ? lang('GiftInfoPeerOriginalInfoTextSender', {
    peer: recipientLink,
    sender: senderLink,
    text: (0,_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__.renderTextWithEntities)(message),
    date: formattedDate
  }, {
    withNodes: true
  }) : lang('GiftInfoPeerOriginalInfoSender', {
    peer: recipientLink,
    date: formattedDate,
    sender: senderLink
  }, {
    withNodes: true
  });
}

/***/ }),

/***/ "./src/components/main/premium/StarsGiftingPickerModal.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/main/premium/StarsGiftingPickerModal.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"s3k01dTm","transition":"BNA0_b5j","main":"Oadi16vt","filter":"z84KbvhX","title":"Jnsrau29","buttons":"NnVyYB32","picker":"cuI2eDIY","avatars":"ILtw_aNL","center":"eIfMzHv5","description":"FlNJWZ5P","premiumFeatures":"xIv0Yaur","options":"eNJRXn6P","button":"KDNKXBp5"});

/***/ }),

/***/ "./src/components/main/premium/StarsGiftingPickerModal.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/main/premium/StarsGiftingPickerModal.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/pickers/PickerModal */ "./src/components/common/pickers/PickerModal.tsx");
/* harmony import */ var _StarsGiftingPickerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./StarsGiftingPickerModal.module.scss */ "./src/components/main/premium/StarsGiftingPickerModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const StarsGiftingPickerModal = ({
  isOpen,
  currentUserId,
  activeListIds,
  archivedListIds,
  userIds
}) => {
  const {
    closeStarsGiftingPickerModal,
    openStarsGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [searchQuery, setSearchQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const displayedUserIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    const combinedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...(userIds || []), ...(activeListIds || []), ...(archivedListIds || [])]);
    const filteredUserIds = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.filterPeersByQuery)({
      ids: combinedIds,
      query: searchQuery,
      type: 'user'
    });
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__["default"])(filteredUserIds.filter(id => {
      const user = usersById[id];
      if (!user) {
        return false;
      }
      return !user.isSupport && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserBot)(user) && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isDeletedUser)(user) && id !== currentUserId && id !== _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID;
    }));
  }, [currentUserId, searchQuery, userIds, activeListIds, archivedListIds]);
  const handleSelectedUserIdsChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(newSelectedId => {
    if (newSelectedId?.length) {
      openStarsGiftModal({
        forUserId: newSelectedId
      });
      closeStarsGiftingPickerModal();
    }
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_10__["default"], {
    className: _StarsGiftingPickerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root,
    isOpen: isOpen,
    onClose: closeStarsGiftingPickerModal,
    title: oldLang('GiftStarsTitle'),
    hasCloseButton: true,
    shouldAdaptToSearch: true,
    withFixedHeight: true,
    confirmButtonText: oldLang('Continue'),
    onEnter: closeStarsGiftingPickerModal,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _StarsGiftingPickerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].picker,
      itemIds: displayedUserIds,
      filterValue: searchQuery,
      filterPlaceholder: oldLang('Search'),
      onFilterChange: setSearchQuery,
      isSearchable: true,
      withDefaultPadding: true,
      withStatus: true,
      onSelectedIdChange: handleSelectedUserIdsChange
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chats: {
      listIds
    },
    currentUserId
  } = global;
  return {
    userIds: global.contactList?.userIds,
    activeListIds: listIds.active,
    archivedListIds: listIds.archived,
    currentUserId
  };
})(StarsGiftingPickerModal)));

/***/ }),

/***/ "./src/components/modals/gift/AboutStarGiftModal.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/AboutStarGiftModal.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"kSwGxZvD","content":"rGPBNoZR","videoPreviewWrapper":"e4SGnYtk","sparkles":"wYp9XwdI","title":"CMt0et4C","subtitle":"exd4nt_X","footer":"hx2wl4Ar","understoodIcon":"qegJKhEH"});

/***/ }),

/***/ "./src/components/modals/gift/AboutStarGiftModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/gift/AboutStarGiftModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_Sparkles__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/Sparkles */ "./src/components/common/Sparkles.tsx");
/* harmony import */ var _main_premium_previews_PremiumFeaturePreviewVideo__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../main/premium/previews/PremiumFeaturePreviewVideo */ "./src/components/main/premium/previews/PremiumFeaturePreviewVideo.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableAboutModal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/TableAboutModal */ "./src/components/modals/common/TableAboutModal.tsx");
/* harmony import */ var _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./AboutStarGiftModal.module.scss */ "./src/components/modals/gift/AboutStarGiftModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const AboutStarGiftModal = ({
  modal
}) => {
  const {
    closeAboutStarGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_2__["default"])(modal);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    closeAboutStarGiftModal();
  });
  const header = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div", {
      className: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div", {
        className: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].videoPreviewWrapper,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_common_Sparkles__WEBPACK_IMPORTED_MODULE_5__["default"], {
          preset: "progress",
          className: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].sparkles
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_main_premium_previews_PremiumFeaturePreviewVideo__WEBPACK_IMPORTED_MODULE_6__["default"], {
          videoId: renderingModal?.videoId,
          videoThumbnail: renderingModal?.videoThumbnail,
          isActive: isOpen,
          isDown: true
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div", {
        className: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].title,
        children: lang('StarGiftInfoTitle')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div", {
        className: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].subtitle,
        children: lang('StarGiftInfoSubtitle')
      })]
    });
  }, [lang, renderingModal, isOpen]);
  const footer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div", {
      className: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].footer,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
        iconName: "understood",
        iconClassName: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].understoodIcon,
        onClick: handleClose,
        children: lang('ButtonUnderstood')
      })
    });
  }, [lang, isOpen, handleClose]);
  const listItemData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return [['diamond', lang('StarGiftInfoUniqueTitle'), lang('StarGiftInfoUniqueSubtitle')], ['auction', lang('StarGiftInfoTradableTitle'), lang('StarGiftInfoTradableSubtitle')], ['crown-wear-outline', lang('StarGiftInfoWearableTitle'), lang('StarGiftInfoWearableSubtitle')]];
  }, [lang]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_common_TableAboutModal__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isOpen: isOpen,
    contentClassName: _AboutStarGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].content,
    header: header,
    listItemData: listItemData,
    footer: footer,
    hasBackdrop: Boolean(renderingModal?.videoId),
    absoluteCloseButtonColor: "translucent-white",
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AboutStarGiftModal));

/***/ }),

/***/ "./src/components/modals/gift/GiftComposer.module.scss":
/*!*************************************************************!*\
  !*** ./src/components/modals/gift/GiftComposer.module.scss ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"jKOG0It6","header":"A_fX4EXY","spacer":"ATowWJ60","title":"gDNtv9oz","balance-container":"eAKZVhOT","balanceContainer":"eAKZVhOT","balance-caption":"vbwprYel","balanceCaption":"vbwprYel","star-balance":"lXuIlbVK","starBalance":"lXuIlbVK","balance":"dIEx_Iqi","optionsSection":"Y68CEIKn","checkboxTitle":"H4taXei_","actionMessageView":"CB1mxsgp","messageInput":"o5r2IPoA","limited":"mWzLu0c0","footer":"jxWZSvet","switcher":"zZUpGRSI","switcherStarIcon":"zAee80Dv","bottomDescription":"j4s8T1dQ","description":"nTPAv1ci","main-button":"IDuhjrne","mainButton":"IDuhjrne","buttonSubtitle":"pB6hqcvA","star":"Q4NlMT0o","background":"ZORVRSG3","customBgImage":"Eny_G3JI","customBgColor":"TkJZPU2u","withTransition":"soDpW2YR","blurred":"M6k91TdM","withRightColumn":"FBcNO8hj"});

/***/ }),

/***/ "./src/components/modals/gift/GiftComposer.tsx":
/*!*****************************************************!*\
  !*** ./src/components/modals/gift/GiftComposer.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_dates_units__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/dates/units */ "./src/util/dates/units.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useCustomBackground */ "./src/hooks/useCustomBackground.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_PremiumProgress__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PremiumProgress */ "./src/components/common/PremiumProgress.tsx");
/* harmony import */ var _middle_message_ActionMessage__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../middle/message/ActionMessage */ "./src/components/middle/message/ActionMessage.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _ui_TextArea__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/TextArea */ "./src/components/ui/TextArea.tsx");
/* harmony import */ var _ui_TextTimer__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/TextTimer */ "./src/components/ui/TextTimer.tsx");
/* harmony import */ var _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./GiftComposer.module.scss */ "./src/components/modals/gift/GiftComposer.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

























const LIMIT_DISPLAY_THRESHOLD = 50;
const TEXT_TIMER_THRESHOLD = 48 * _util_dates_units__WEBPACK_IMPORTED_MODULE_8__.HOUR;
function GiftComposer({
  gift,
  giftByStars,
  peerId,
  peer,
  captionLimit,
  theme,
  isBackgroundBlurred,
  patternColor,
  backgroundColor,
  customBackground,
  currentUserId,
  isPaymentFormLoading,
  starBalance,
  paidMessagesStars,
  areUniqueStarGiftsDisallowed,
  shouldDisallowLimitedStarGifts,
  giftAuction
}) {
  const {
    sendStarGift,
    sendPremiumGiftByStars,
    openInvoice,
    openGiftUpgradeModal,
    openStarsBalanceModal,
    openGiftAuctionBidModal,
    openGiftAuctionInfoModal,
    openGiftAuctionChangeRecipientModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [giftMessage, setGiftMessage] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [shouldHideName, setShouldHideName] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPayForUpgrade, setShouldPayForUpgrade] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPayByStars, setShouldPayByStars] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const customBackgroundValue = (0,_hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_12__["default"])(theme, customBackground);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldDisallowLimitedStarGifts) {
      setShouldPayForUpgrade(true);
    }
  }, [shouldDisallowLimitedStarGifts, shouldPayForUpgrade]);
  const isStarGift = 'id' in gift && gift.type === 'starGift';
  const isPremiumGift = 'months' in gift;
  const hasPremiumByStars = giftByStars && 'amount' in giftByStars;
  const isPeerUser = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(peer);
  const isSelf = peerId === currentUserId;
  const localMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isPremiumGift) {
      const currentGift = shouldPayByStars && hasPremiumByStars ? giftByStars : gift;
      return {
        id: -1,
        chatId: '0',
        isOutgoing: false,
        senderId: currentUserId,
        date: Math.floor(Date.now() / 1000),
        content: {
          action: {
            mediaType: 'action',
            type: 'giftPremium',
            amount: currentGift.amount,
            currency: currentGift.currency,
            days: gift.months * 30,
            message: giftMessage ? {
              text: giftMessage
            } : undefined
          }
        }
      };
    }
    if (isStarGift) {
      return {
        id: -1,
        chatId: '0',
        isOutgoing: false,
        senderId: currentUserId,
        date: Math.floor(Date.now() / 1000),
        content: {
          action: {
            mediaType: 'action',
            type: 'starGift',
            message: giftMessage?.length ? {
              text: giftMessage
            } : undefined,
            isNameHidden: shouldHideName || undefined,
            starsToConvert: gift.starsToConvert,
            canUpgrade: shouldPayForUpgrade || undefined,
            alreadyPaidUpgradeStars: shouldPayForUpgrade ? gift.upgradeStars : undefined,
            gift,
            peerId,
            fromId: currentUserId
          }
        }
      };
    }
    return undefined;
  }, [currentUserId, gift, giftMessage, isStarGift, shouldHideName, shouldPayForUpgrade, peerId, shouldPayByStars, hasPremiumByStars, giftByStars, isPremiumGift]);
  const handleGiftMessageChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(e => {
    setGiftMessage(e.target.value);
  });
  const handleShouldHideNameChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    setShouldHideName(!shouldHideName);
  });
  const handleShouldPayForUpgradeChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    setShouldPayForUpgrade(!shouldPayForUpgrade);
  });
  const toggleShouldPayByStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (hasPremiumByStars) setShouldPayByStars(!shouldPayByStars);
  });
  const handleOpenUpgradePreview = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!isStarGift) return;
    openGiftUpgradeModal({
      giftId: gift.id,
      peerId
    });
  });
  const handleGetMoreStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openStarsBalanceModal({});
  });
  const handleLearnMoreClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!giftAuction) return;
    openGiftAuctionInfoModal({
      auctionGiftId: giftAuction.gift.id
    });
  });
  const handleMainButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (giftAuction) {
      const existingBidPeerId = giftAuction.userState.bidPeerId;
      if (existingBidPeerId && existingBidPeerId !== peerId) {
        openGiftAuctionChangeRecipientModal({
          auctionGiftId: giftAuction.gift.id,
          oldPeerId: existingBidPeerId,
          newPeerId: peerId,
          message: giftMessage || undefined,
          shouldHideName: shouldHideName || undefined
        });
        return;
      }
      openGiftAuctionBidModal({
        auctionGiftId: giftAuction.gift.id,
        peerId,
        message: giftMessage || undefined,
        shouldHideName: shouldHideName || undefined
      });
      return;
    }
    if (isStarGift) {
      sendStarGift({
        peerId,
        shouldHideName,
        gift,
        message: giftMessage ? {
          text: giftMessage
        } : undefined,
        shouldUpgrade: shouldPayForUpgrade
      });
      return;
    }
    if (shouldPayByStars && hasPremiumByStars) {
      sendPremiumGiftByStars({
        userId: peerId,
        months: giftByStars.months,
        amount: giftByStars.amount,
        message: giftMessage ? {
          text: giftMessage
        } : undefined
      });
      return;
    }
    if (isPremiumGift) {
      openInvoice({
        type: 'giftcode',
        userIds: [peerId],
        currency: gift.currency,
        amount: gift.amount,
        option: gift,
        message: giftMessage ? {
          text: giftMessage
        } : undefined
      });
    }
  });
  const canUseStarsPayment = hasPremiumByStars && starBalance && starBalance.amount > giftByStars.amount;
  function renderOptionsSection() {
    const symbolsLeft = captionLimit ? captionLimit - giftMessage.length : undefined;
    const title = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, peer);
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].optionsSection,
      children: [!paidMessagesStars && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_TextArea__WEBPACK_IMPORTED_MODULE_21__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].messageInput,
        onChange: handleGiftMessageChange,
        value: giftMessage,
        label: lang('GiftMessagePlaceholder'),
        maxLength: captionLimit,
        maxLengthIndicator: symbolsLeft && symbolsLeft < LIMIT_DISPLAY_THRESHOLD ? symbolsLeft.toString() : undefined
      }), canUseStarsPayment && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].switcher,
        narrow: true,
        ripple: true,
        onClick: toggleShouldPayByStars,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("span", {
          children: lang('GiftPremiumPayWithStars', {
            stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_10__.formatStarsAsIcon)(lang, giftByStars.amount, {
              className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].switcherStarIcon
            })
          }, {
            withNodes: true
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_20__["default"], {
          checked: shouldPayByStars,
          onChange: toggleShouldPayByStars,
          label: lang('GiftPremiumPayWithStarsAcc')
        })]
      }), hasPremiumByStars && starBalance && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].description,
        children: lang('GiftPremiumDescriptionYourBalance', {
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_10__.formatStarsAsIcon)(lang, starBalance.amount, {
            className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].switcherStarIcon
          }),
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_18__["default"], {
            isPrimary: true,
            onClick: handleGetMoreStars,
            children: lang('GetMoreStarsLinkText')
          })
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), isStarGift && Boolean(gift.upgradeStars) && !areUniqueStarGiftsDisallowed && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].switcher,
        narrow: true,
        ripple: true,
        onClick: handleShouldPayForUpgradeChange,
        disabled: shouldDisallowLimitedStarGifts,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("span", {
          children: lang('GiftMakeUnique', {
            stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_10__.formatStarsAsIcon)(lang, gift.upgradeStars, {
              className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].switcherStarIcon
            })
          }, {
            withNodes: true
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_20__["default"], {
          checked: shouldPayForUpgrade,
          onChange: handleShouldPayForUpgradeChange,
          label: lang('GiftMakeUniqueAcc')
        })]
      }), isStarGift && Boolean(gift.upgradeStars) && !areUniqueStarGiftsDisallowed && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].description,
        children: isPeerUser ? lang('GiftMakeUniqueDescription', {
          user: title,
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_18__["default"], {
            isPrimary: true,
            onClick: handleOpenUpgradePreview,
            children: lang('GiftMakeUniqueLink')
          })
        }, {
          withNodes: true
        }) : lang('GiftMakeUniqueDescriptionChannel', {
          peer: title,
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_18__["default"], {
            isPrimary: true,
            onClick: handleOpenUpgradePreview,
            children: lang('GiftMakeUniqueLink')
          })
        }, {
          withNodes: true
        })
      }), isStarGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].switcher,
        narrow: true,
        ripple: true,
        onClick: handleShouldHideNameChange,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("span", {
          children: lang('GiftHideMyName')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_20__["default"], {
          checked: shouldHideName,
          onChange: handleShouldHideNameChange,
          label: lang('GiftHideMyName')
        })]
      }), isStarGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].description,
        children: isSelf ? lang('GiftHideNameDescriptionSelf') : isPeerUser ? lang('GiftHideNameDescription', {
          receiver: title
        }) : lang('GiftHideNameDescriptionChannel')
      })]
    });
  }
  function renderFooter() {
    const amount = shouldPayByStars && hasPremiumByStars ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_10__.formatStarsAsIcon)(lang, giftByStars.amount, {
      asFont: true
    }) : isStarGift ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_10__.formatStarsAsIcon)(lang, gift.stars + (shouldPayForUpgrade ? gift.upgradeStars : 0), {
      asFont: true
    }) : isPremiumGift ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_9__.formatCurrency)(lang, gift.amount, gift.currency) : undefined;
    const giftsPerRound = giftAuction?.gift.giftsPerRound;
    const auctionEndDate = giftAuction?.state.endDate;
    const auctionTimeLeft = auctionEndDate ? auctionEndDate - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_11__.getServerTime)() : undefined;
    const shouldUseTextTimer = auctionTimeLeft !== undefined && auctionTimeLeft > 0 && auctionTimeLeft < TEXT_TIMER_THRESHOLD;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].footer,
      children: [isStarGift && Boolean(gift.availabilityRemains) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_PremiumProgress__WEBPACK_IMPORTED_MODULE_15__["default"], {
        isPrimary: true,
        progress: gift.availabilityRemains / gift.availabilityTotal,
        rightText: lang('GiftSoldCount', {
          count: gift.availabilityTotal - gift.availabilityRemains
        }),
        leftText: lang('GiftLeftCount', {
          count: gift.availabilityRemains
        }),
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].limited
      }), giftAuction && Boolean(giftsPerRound) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bottomDescription,
        children: lang('GiftAuctionDescription', {
          count: giftsPerRound,
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_18__["default"], {
            isPrimary: true,
            onClick: handleLearnMoreClick,
            children: lang('GiftAuctionLearnMore')
          })
        }, {
          pluralValue: giftsPerRound,
          withNodes: true
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].mainButton,
        size: auctionTimeLeft ? undefined : 'smaller',
        onClick: handleMainButtonClick,
        isLoading: isPaymentFormLoading,
        noForcedUpperCase: true,
        children: giftAuction ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
            children: lang('GiftAuctionPlaceBid')
          }), auctionTimeLeft !== undefined && auctionTimeLeft > 0 && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
            className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].buttonSubtitle,
            children: lang('GiftAuctionTimeLeft', {
              time: shouldUseTextTimer ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_TextTimer__WEBPACK_IMPORTED_MODULE_22__["default"], {
                endsAt: auctionEndDate
              }) : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatCountdown)(lang, auctionTimeLeft)
            }, {
              withNodes: true
            })
          })]
        }) : lang('GiftSend', {
          amount
        }, {
          withNodes: true
        })
      })]
    });
  }
  const bgClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].background, _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].withTransition, customBackground && _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].customBgImage, backgroundColor && _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].customBgColor, customBackground && isBackgroundBlurred && _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].blurred);
  if (!isStarGift && !isPremiumGift || !localMessage) return;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].root, 'custom-scroll'),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].actionMessageView, 'MessageList')
      // @ts-ignore -- FIXME: Find a way to disable interactions but keep a11y
      ,
      inert: true,
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_6__["default"])(`--pattern-color: ${patternColor}`, backgroundColor && `--theme-background-color: ${backgroundColor}`),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: bgClassName,
        style: customBackgroundValue ? `--custom-background: ${customBackgroundValue}` : undefined
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_middle_message_ActionMessage__WEBPACK_IMPORTED_MODULE_16__["default"], {
        message: localMessage,
        threadId: _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
        appearanceOrder: 0
      }, isStarGift ? gift.id : isPremiumGift ? gift.months : undefined)]
    }), renderOptionsSection(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].spacer
    }), renderFooter()]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId,
  gift
}) => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global);
  const {
    stars
  } = global;
  const {
    isBlurred: isBackgroundBlurred,
    patternColor,
    background: customBackground,
    backgroundColor
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThemeValues)(global, theme) || {};
  const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId);
  const paidMessagesStars = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerPaidMessagesStars)(global, peerId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserFullInfo)(global, peerId);
  const currentUserId = global.currentUserId;
  const isGiftForSelf = currentUserId === peerId;
  const areUniqueStarGiftsDisallowed = !isGiftForSelf && userFullInfo?.disallowedGifts?.shouldDisallowUniqueStarGifts;
  const shouldDisallowLimitedStarGifts = !isGiftForSelf && userFullInfo?.disallowedGifts?.shouldDisallowLimitedStarGifts;
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const auctionGiftId = 'id' in gift && gift.type === 'starGift' && gift.isAuction ? gift.id : undefined;
  const giftAuction = auctionGiftId ? global.giftAuctionByGiftId?.[auctionGiftId] : undefined;
  return {
    starBalance: stars?.balance,
    peer,
    theme,
    isBackgroundBlurred,
    patternColor,
    customBackground,
    backgroundColor,
    captionLimit: global.appConfig.starGiftMaxMessageLength,
    currentUserId: global.currentUserId,
    isPaymentFormLoading: tabState.isPaymentFormLoading,
    paidMessagesStars,
    areUniqueStarGiftsDisallowed,
    shouldDisallowLimitedStarGifts,
    giftAuction
  };
})(GiftComposer)));

/***/ }),

/***/ "./src/components/modals/gift/GiftItem.module.scss":
/*!*********************************************************!*\
  !*** ./src/components/modals/gift/GiftItem.module.scss ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"container":"G1mBmzxs","noClickable":"pcLi3lcD","starGift":"f5ArEO1S","monthsDescription":"rn9aWFNA","description":"q4_ydkAx","buy":"a8no5WH0","transferBadge":"nqN62arv","star":"DvJLTVFU","auction":"WqBCC4Ce","premiumRequired":"NBYIITte","amount":"sbo2dMcH","starsPriceBlock":"QB5SI7ta","starsPriceIcon":"jgnEfoeM","radialPattern":"Nkotr8Q4","stickerWrapper":"rUSoeQXb","lockIcon":"kwuipwV7"});

/***/ }),

/***/ "./src/components/modals/gift/GiftItemPremium.tsx":
/*!********************************************************!*\
  !*** ./src/components/modals/gift/GiftItemPremium.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/gift/GiftRibbon */ "./src/components/common/gift/GiftRibbon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GiftItem.module.scss */ "./src/components/modals/gift/GiftItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GIFT_STICKER_SIZE = 86;
function GiftItemPremium({
  sticker,
  canPlayAnimatedEmojis,
  baseMonthAmount,
  option,
  optionByStars,
  onClick
}) {
  const {
    months,
    amount,
    currency
  } = option;
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    onClick(option);
  });
  const perMonth = Math.floor(amount / months);
  const discount = baseMonthAmount && baseMonthAmount > perMonth ? Math.ceil(100 - perMonth / (baseMonthAmount / 100)) : undefined;
  function renderMonths() {
    const caption = months === 12 ? lang('Years', {
      count: 1
    }, {
      pluralValue: 1
    }) : lang('Months', {
      count: months
    }, {
      pluralValue: months
    });
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].monthsDescription,
      children: caption
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].container,
    tabIndex: 0,
    role: "button",
    onClick: handleGiftClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__["default"], {
      sticker: sticker,
      play: canPlayAnimatedEmojis,
      noLoop: true,
      nonInteractive: true,
      size: GIFT_STICKER_SIZE
    }), renderMonths(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].description,
      children: lang('PremiumGiftDescription')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].buy,
      color: "adaptive",
      nonInteractive: true,
      size: "tiny",
      pill: true,
      fluid: true,
      children: (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(amount, currency)
    }), optionByStars && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].starsPriceBlock,
      children: lang('GiftPremiumStarsPrice', {
        stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, optionByStars.amount, {
          className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].starsPriceIcon
        })
      }, {
        withNodes: true,
        withMarkdown: true
      })
    }), Boolean(discount) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__["default"], {
      color: "purple",
      text: lang('GiftDiscount', {
        percent: discount
      })
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  option
}) => {
  const sticker = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectGiftStickerForDuration)(global, option.months);
  const canPlayAnimatedEmojis = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCanPlayAnimatedEmojis)(global);
  return {
    sticker,
    canPlayAnimatedEmojis
  };
})(GiftItemPremium)));

/***/ }),

/***/ "./src/components/modals/gift/GiftItemStar.tsx":
/*!*****************************************************!*\
  !*** ./src/components/modals/gift/GiftItemStar.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment.ts */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_useFlag_ts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag.ts */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/gift/GiftRibbon */ "./src/components/common/gift/GiftRibbon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./GiftItem.module.scss */ "./src/components/modals/gift/GiftItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");








;











const GIFT_STICKER_SIZE = 90;
function GiftItemStar({
  gift,
  isResale,
  isCurrentUserPremium,
  withTransferBadge,
  hideBadge,
  noClickable,
  observeIntersection,
  onClick
}) {
  const {
    openGiftInfoModal,
    openPremiumModal,
    showNotification,
    checkCanSendGift,
    openGiftAuctionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const stickerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  function getPriceAmount(amounts) {
    if (!amounts) return {
      amount: 0,
      currency: _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE
    };
    if (gift.type === 'starGiftUnique' && gift.resaleTonOnly) {
      const tonAmount = amounts.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE);
      if (tonAmount) return tonAmount;
    }
    const starsAmount = amounts.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE);
    return starsAmount;
  }
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const [isVisible, setIsVisible] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isHover, markHover, unmarkHover] = (0,_hooks_useFlag_ts__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const sticker = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__.getStickerFromGift)(gift);
  const isGiftUnique = gift.type === 'starGiftUnique';
  const uniqueGift = isGiftUnique ? gift : undefined;
  const regularGift = !isGiftUnique ? gift : undefined;
  const priceInfo = !isGiftUnique ? {
    amount: regularGift?.stars || 0,
    currency: _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE
  } : getPriceAmount(uniqueGift?.resellPrice);
  const priceCurrency = priceInfo?.currency || _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE;
  const resellMinStars = regularGift?.resellMinStars;
  const formattedPrice = !isGiftUnique && isResale && resellMinStars ? lang.number(resellMinStars) + '+' : priceInfo?.amount || 0;
  const isLimited = !isGiftUnique && Boolean(regularGift?.isLimited);
  const isSoldOut = !isGiftUnique && Boolean(regularGift?.isSoldOut);
  const isAuction = !isGiftUnique && !isResale && Boolean(regularGift?.isAuction);
  const isPremiumRequired = Boolean(gift?.requirePremium);
  const isUserLimitReached = Boolean(regularGift?.limitedPerUser && !regularGift?.perUserRemains);
  const perUserTotal = regularGift?.perUserTotal;
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (isAuction) {
      openGiftAuctionModal({
        gift
      });
      return;
    }
    if (isSoldOut && !isResale) {
      openGiftInfoModal({
        gift
      });
      return;
    }
    if (isUserLimitReached) {
      showNotification({
        message: lang('NotificationGiftsLimit2', {
          count: perUserTotal
        }, {
          pluralValue: perUserTotal,
          withMarkdown: true,
          withNodes: true
        })
      });
      return;
    }
    if (isPremiumRequired && !isCurrentUserPremium) {
      openPremiumModal({
        gift
      });
      return;
    }
    if (isLocked) {
      checkCanSendGift({
        gift,
        onSuccess: () => onClick?.(gift, isResale ? 'resell' : 'original')
      });
      return;
    }
    onClick?.(gift, isResale ? 'resell' : 'original');
  });
  const radialPatternBackdrop = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const {
      backdrop,
      pattern
    } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__.getGiftAttributes)(gift) || {};
    if (!backdrop || !pattern) {
      return undefined;
    }
    const backdropColors = [backdrop.centerColor, backdrop.edgeColor];
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__["default"], {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternIcon: pattern.sticker,
      ringsCount: 1,
      ovalFactor: 1
    });
  }, [gift]);
  const giftNumber = isGiftUnique ? gift.number : 0;
  const isLocked = Boolean(gift.type === 'starGift' && gift.lockedUntilDate);
  const giftRibbon = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isGiftUnique) {
      const {
        backdrop
      } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__.getGiftAttributes)(gift) || {};
      if (!backdrop) {
        return undefined;
      }
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        color: [backdrop.centerColor, backdrop.edgeColor],
        text: lang('GiftSavedNumber', {
          number: giftNumber
        })
      });
    }
    if (isResale) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        color: "green",
        text: lang('GiftRibbonResale')
      });
    }
    if (isSoldOut) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        color: "red",
        text: lang('GiftSoldOut')
      });
    }
    if (isAuction) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        color: "orange",
        text: lang('GiftRibbonAuction')
      });
    }
    if (isPremiumRequired) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        color: "orange",
        text: lang('GiftRibbonPremium')
      });
    }
    if (isLimited) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        color: "blue",
        text: lang('GiftLimited')
      });
    }
    return undefined;
  }, [isGiftUnique, isResale, gift, isSoldOut, isLimited, lang, giftNumber, isPremiumRequired, isAuction]);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__.useOnIntersect)(ref, observeIntersection, entry => {
    const visible = entry.isIntersecting;
    setIsVisible(visible);
  });
  const badgeContent = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (withTransferBadge) {
      return lang('GiftTransferTitle');
    }
    if (isAuction) {
      return lang('GiftAuctionJoin');
    }
    if (priceCurrency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE) {
      return (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_6__.formatTonAsIcon)(lang, formattedPrice || 0, {
        shouldConvertFromNanos: true,
        className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].star
      });
    }
    return (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_6__.formatStarsAsIcon)(lang, formattedPrice || 0, {
      asFont: true,
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].star
    });
  }, [withTransferBadge, priceCurrency, formattedPrice, isAuction, lang]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('interactive-gift', _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].container, _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].starGift, 'starGiftItem', isPremiumRequired && _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].premiumRequired, isAuction && _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].auction, noClickable && _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].noClickable),
    tabIndex: noClickable ? undefined : 0,
    role: noClickable ? undefined : 'button',
    onClick: noClickable ? undefined : handleGiftClick,
    onMouseEnter: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV && !noClickable ? markHover : undefined,
    onMouseLeave: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV && !noClickable ? unmarkHover : undefined,
    children: [radialPatternBackdrop, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
      ref: stickerRef,
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].stickerWrapper,
      style: `width: ${GIFT_STICKER_SIZE}px; height: ${GIFT_STICKER_SIZE}px`,
      children: sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_StickerView__WEBPACK_IMPORTED_MODULE_15__["default"], {
        observeIntersectionForPlaying: observeIntersection,
        observeIntersectionForLoading: observeIntersection,
        containerRef: stickerRef,
        sticker: sticker,
        size: GIFT_STICKER_SIZE,
        shouldLoop: isHover,
        shouldPreloadPreview: true
      })
    }), !hideBadge && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].buy, withTransferBadge && _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].transferBadge),
      nonInteractive: true,
      size: "tiny",
      color: isGiftUnique ? 'bluredStarsBadge' : 'stars',
      withSparkleEffect: isVisible && !withTransferBadge,
      pill: true,
      fluid: true,
      children: badgeContent
    }), giftRibbon, isLocked && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_7__["default"], {
      name: "lock-badge",
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].lockIcon
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global);
  return {
    isCurrentUserPremium
  };
})(GiftItemStar)));

/***/ }),

/***/ "./src/components/modals/gift/GiftModal.module.scss":
/*!**********************************************************!*\
  !*** ./src/components/modals/gift/GiftModal.module.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"tJK1W0pJ","transition":"pP8TxefR","content":"o3V1HqbL","resaleScreenRoot":"Vce_TsJO","main":"cVXqeu9P","giftSection":"v4eKefwN","section":"EqfarEYb","resaleStarGiftsContainer":"RSFcSNGL","starGiftsContainer":"OQX3GZl5","premiumGiftsGallery":"n40m3BK2","header":"iqqoyRgW","noBorder":"cuvdjW2y","resaleHeader":"cJRBgg9B","resaleHeaderContentContainer":"OXYQmfGK","headerSlide":"BTWhJUQB","headerText":"lLRmbpIu","hiddenHeader":"XgGzn1cQ","resaleHeaderText":"bp_KPx8I","commonHeaderText":"ybZo03if","resaleHeaderDescription":"XefHUFm1","closeButton":"r_Y5uG1T","balance":"soqAknia","avatars":"N_7tYJKr","avatar":"_3hY4vIep","logoBackground":"ieK4TzSb","center":"Ey5gX40t","description":"ZioU5h_k","starGiftsDescription":"gFgzS8pV","boostIcon":"Qi2YR6Dz","optionBottom":"RTbClMKE","secondaryInfo":"g0R9GSNq","footer":"J3Gju3bv","starGiftsTransition":"kB6IyXqS","notFoundGiftsRoot":"UqnRlJ1n","notFoundGiftsDescription":"g0VbwIG_","notFoundGiftsLink":"j2zPEQr8"});

/***/ }),

/***/ "./src/components/modals/gift/GiftModal.tsx":
/*!**************************************************!*\
  !*** ./src/components/modals/gift/GiftModal.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_InteractiveSparkles__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/InteractiveSparkles */ "./src/components/common/InteractiveSparkles.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../stars/BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _GiftComposer__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./GiftComposer */ "./src/components/modals/gift/GiftComposer.tsx");
/* harmony import */ var _GiftItemPremium__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./GiftItemPremium */ "./src/components/modals/gift/GiftItemPremium.tsx");
/* harmony import */ var _GiftItemStar__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./GiftItemStar */ "./src/components/modals/gift/GiftItemStar.tsx");
/* harmony import */ var _GiftModalResaleScreen__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./GiftModalResaleScreen */ "./src/components/modals/gift/GiftModalResaleScreen.tsx");
/* harmony import */ var _GiftResaleFilters__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./GiftResaleFilters */ "./src/components/modals/gift/GiftResaleFilters.tsx");
/* harmony import */ var _StarGiftCategoryList__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./StarGiftCategoryList */ "./src/components/modals/gift/StarGiftCategoryList.tsx");
/* harmony import */ var _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./GiftModal.module.scss */ "./src/components/modals/gift/GiftModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
































const AVATAR_SIZE = 100;
const INTERSECTION_THROTTLE = 200;
const SCROLL_THROTTLE = 200;
const AVATAR_SPARKLES_CENTER_SHIFT = [0, -50];
const CATEGORY_LIST_STICKY_TOP = 3.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.REM;
const runThrottledForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_7__.throttle)(cb => cb(), SCROLL_THROTTLE, true);
const GiftModal = ({
  modal,
  starGiftsById,
  starGiftIdsByCategory,
  myUniqueGiftsById,
  myUniqueGiftIds,
  starBalance,
  peer,
  isSelf,
  disallowedGifts,
  resaleGiftsCount,
  areResaleGiftsLoading,
  selectedResaleGift,
  tabId
}) => {
  const {
    closeGiftModal,
    openGiftInfoModal,
    resetResaleGifts,
    loadResaleGifts,
    openGiftInMarket,
    closeResaleGiftsMarket,
    loadMyUniqueGifts,
    openGiftTransferConfirmModal,
    setGiftModalSelectedGift
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const dialogRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const giftHeaderRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const categoryListRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const scrollerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__["default"])(modal);
  const user = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerUser)(peer) ? peer : undefined;
  const chat = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerChat)(peer) ? peer : undefined;
  const selectedGift = renderingModal?.selectedGift;
  const [shouldShowMainScreenHeader, setShouldShowMainScreenHeader] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isMainScreenHeaderForStarGifts, setIsMainScreenHeaderForStarGifts] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isGiftScreenHeaderForStarGifts, setIsGiftScreenHeaderForStarGifts] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [selectedCategory, setSelectedCategory] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('all');
  const [isCategoryListPinned, pinCategoryList, unpinCategoryList] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__["default"])(false);
  const triggerSparklesRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const areAllGiftsDisallowed = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!disallowedGifts) {
      return undefined;
    }
    const {
      shouldDisallowPremiumGifts,
      ...disallowedGiftTypes
    } = disallowedGifts;
    return !isSelf && Object.values(disallowedGiftTypes).every(Boolean);
  }, [isSelf, disallowedGifts]);
  const areUnlimitedStarGiftsDisallowed = !isSelf && disallowedGifts?.shouldDisallowUnlimitedStarGifts;
  const areLimitedStarGiftsDisallowed = !isSelf && disallowedGifts?.shouldDisallowLimitedStarGifts;
  const areUniqueStarGiftsDisallowed = !isSelf && disallowedGifts?.shouldDisallowUniqueStarGifts;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const allGifts = renderingModal?.gifts;
  const filteredGifts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return allGifts?.sort((prevGift, gift) => prevGift.months - gift.months).filter(gift => gift.users === 1 && gift.currency !== _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE);
  }, [allGifts]);
  const giftsByStars = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const mapGifts = new Map();
    if (!filteredGifts) return mapGifts;
    filteredGifts.forEach(gift => {
      const giftByStars = allGifts?.find(starsGift => starsGift.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE && starsGift.months === gift.months);
      if (giftByStars) {
        mapGifts.set(gift, giftByStars);
      }
    });
    return mapGifts;
  }, [allGifts, filteredGifts]);
  const baseGift = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return filteredGifts?.reduce((prev, gift) => prev.amount < gift.amount ? prev : gift);
  }, [filteredGifts]);
  const {
    observe: observeIntersection
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_11__.useIntersectionObserver)({
    rootRef: scrollerRef,
    throttleMs: INTERSECTION_THROTTLE,
    isDisabled: !isOpen
  });
  const isResaleScreen = Boolean(selectedResaleGift) && !selectedGift;
  const isGiftScreen = Boolean(selectedGift);
  const shouldShowHeader = isResaleScreen || isGiftScreen || shouldShowMainScreenHeader;
  const isHeaderForStarGifts = isGiftScreen ? isGiftScreenHeaderForStarGifts : isMainScreenHeaderForStarGifts;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (selectedResaleGift) {
      const giftId = 'regularGiftId' in selectedResaleGift ? selectedResaleGift.regularGiftId : selectedResaleGift.id;
      loadResaleGifts({
        giftId
      });
    }
  }, [selectedResaleGift]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setShouldShowMainScreenHeader(false);
      setGiftModalSelectedGift({
        gift: undefined
      });
      setSelectedCategory('all');
    }
  }, [isOpen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setIsGiftScreenHeaderForStarGifts(Boolean(selectedGift && 'id' in selectedGift));
  }, [selectedGift]);
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    if (isGiftScreen) return;
    const currentTarget = e.currentTarget;
    runThrottledForScroll(() => {
      const {
        scrollTop
      } = currentTarget;
      setShouldShowMainScreenHeader(scrollTop > 150);
      if (transitionRef.current && giftHeaderRef.current) {
        const {
          top: headerTop
        } = giftHeaderRef.current.getBoundingClientRect();
        const {
          top: transitionTop
        } = transitionRef.current.getBoundingClientRect();
        setIsMainScreenHeaderForStarGifts(headerTop - transitionTop <= 0);
      }
      if (categoryListRef.current && scrollerRef.current) {
        const {
          top: listTop
        } = categoryListRef.current.getBoundingClientRect();
        const {
          top: scrollerTop
        } = scrollerRef.current.getBoundingClientRect();
        const isPinned = listTop - scrollerTop <= CATEGORY_LIST_STICKY_TOP;
        if (isPinned) {
          pinCategoryList();
        } else {
          unpinCategoryList();
        }
      }
    });
  });
  const giftPremiumDescription = lang('GiftPremiumDescription', {
    user: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(user),
    link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_17__["default"], {
      text: lang('GiftPremiumDescriptionLinkCaption'),
      url: lang('GiftPremiumDescriptionLink')
    })
  }, {
    withNodes: true
  });
  const starGiftDescription = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (chat) {
      return lang('StarGiftDescriptionChannel', {
        peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, chat)
      }, {
        withNodes: true,
        withMarkdown: true
      });
    }
    if (isSelf) {
      return lang('StarGiftDescriptionSelf', undefined, {
        withNodes: true,
        renderTextFilters: ['br']
      });
    }
    if (selectedCategory === 'collectible') {
      return lang('StarGiftDescriptionCollectibles');
    }
    return lang('StarGiftDescription', {
      user: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(user)
    }, {
      withNodes: true,
      withMarkdown: true
    });
  }, [chat, isSelf, selectedCategory, user, lang]);
  function renderGiftPremiumHeader() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("h2", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].headerText, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].center),
      children: lang('GiftPremiumHeader')
    });
  }
  function renderGiftPremiumDescription() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("p", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].description, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].center),
      children: giftPremiumDescription
    });
  }
  function renderStarGiftsHeader() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("h2", {
      ref: giftHeaderRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].headerText, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].center),
      children: lang(isSelf ? 'StarsGiftHeaderSelf' : 'StarsGiftHeader')
    });
  }
  function renderStarGiftsDescription() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("p", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].description, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].starGiftsDescription, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].center),
      children: starGiftDescription
    });
  }
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])((gift, target) => {
    if (target === 'resell') {
      if (!('id' in gift)) {
        return;
      }
      if (isResaleScreen) {
        openGiftInfoModal({
          gift,
          recipientId: renderingModal?.forPeerId
        });
        return;
      }
      openGiftInMarket({
        gift,
        tabId
      });
      return;
    }
    setGiftModalSelectedGift({
      gift
    });
  });
  const handleMyGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(gift => {
    if (gift.type === 'starGift' || !myUniqueGiftsById || !peer?.id) return;
    const savedGift = myUniqueGiftsById[gift.id];
    openGiftTransferConfirmModal({
      gift: savedGift,
      recipientId: peer.id
    });
  });
  const handleLoadMore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (selectedCategory === 'myUnique') {
      loadMyUniqueGifts();
    }
  });
  function renderStarGifts() {
    if (selectedCategory === 'myUnique') {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].starGiftsContainer,
        items: myUniqueGiftIds,
        onLoadMore: handleLoadMore,
        scrollContainerClosest: `.${_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].main}`,
        itemSelector: ".starGiftItem",
        children: myUniqueGiftsById && myUniqueGiftIds?.map(giftId => {
          const savedGift = myUniqueGiftsById[giftId];
          if (!savedGift) return undefined;
          return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_25__["default"], {
            gift: savedGift.gift,
            observeIntersection: observeIntersection,
            onClick: handleMyGiftClick,
            withTransferBadge: true
          }, giftId);
        })
      });
    }
    const filteredGiftIds = starGiftIdsByCategory?.[selectedCategory]?.filter(giftId => {
      const gift = starGiftsById?.[giftId];
      if (!gift) return false;
      const {
        isLimited,
        availabilityResale
      } = gift;
      if (areLimitedStarGiftsDisallowed && isLimited) {
        return !areUniqueStarGiftsDisallowed ? availabilityResale : false;
      }
      if (areUnlimitedStarGiftsDisallowed && !isLimited) return false;
      return true;
    });
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].starGiftsContainer,
      children: starGiftsById && filteredGiftIds?.flatMap(giftId => {
        const gift = starGiftsById[giftId];
        const shouldShowResale = Boolean(gift.availabilityResale) && !areUniqueStarGiftsDisallowed;
        const shouldDuplicateAsResale = shouldShowResale && !gift.isSoldOut && !areLimitedStarGiftsDisallowed;
        const elements = [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_25__["default"], {
          gift: gift,
          observeIntersection: observeIntersection,
          isResale: shouldShowResale && !shouldDuplicateAsResale,
          onClick: handleGiftClick
        }, giftId)];
        if (shouldDuplicateAsResale) {
          elements.push((0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_25__["default"], {
            isResale: true,
            gift: gift,
            observeIntersection: observeIntersection,
            onClick: handleGiftClick
          }, `resale_${giftId}`));
        }
        return elements;
      })
    });
  }
  function renderPremiumGifts() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].premiumGiftsGallery,
      children: filteredGifts?.map(gift => {
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftItemPremium__WEBPACK_IMPORTED_MODULE_24__["default"], {
          option: gift,
          optionByStars: giftsByStars.get(gift),
          baseMonthAmount: baseGift ? Math.floor(baseGift.amount / baseGift.months) : undefined,
          onClick: handleGiftClick
        });
      })
    });
  }
  const onCategoryChanged = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(category => {
    setSelectedCategory(category);
  });
  const handleCloseModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    setGiftModalSelectedGift({
      gift: undefined
    });
    resetResaleGifts();
    closeGiftModal();
  });
  const handleCloseButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (isResaleScreen) {
      closeResaleGiftsMarket({
        tabId
      });
      return;
    }
    if (isGiftScreen) {
      setGiftModalSelectedGift({
        gift: undefined
      });
      return;
    }
    handleCloseModal();
  });
  const handleAvatarMouseMove = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    triggerSparklesRef.current?.();
  });
  const handleRequestAnimation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(animate => {
    triggerSparklesRef.current = animate;
  });
  function renderMainScreen() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
      ref: scrollerRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].main, 'custom-scroll'),
      onScroll: handleScroll,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].avatars,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_15__["default"], {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].avatar,
          size: AVATAR_SIZE,
          peer: peer,
          onMouseMove: handleAvatarMouseMove
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_common_InteractiveSparkles__WEBPACK_IMPORTED_MODULE_16__["default"], {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].logoBackground,
          color: "gold",
          centerShift: AVATAR_SPARKLES_CENTER_SHIFT,
          onRequestAnimation: handleRequestAnimation
        })]
      }), !isSelf && !chat && !disallowedGifts?.shouldDisallowPremiumGifts && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.Fragment, {
        children: [renderGiftPremiumHeader(), renderGiftPremiumDescription(), renderPremiumGifts()]
      }), !areAllGiftsDisallowed && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.Fragment, {
        children: [renderStarGiftsHeader(), renderStarGiftsDescription(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_StarGiftCategoryList__WEBPACK_IMPORTED_MODULE_28__["default"], {
          ref: categoryListRef,
          areUniqueStarGiftsDisallowed: areUniqueStarGiftsDisallowed,
          areLimitedStarGiftsDisallowed: areLimitedStarGiftsDisallowed,
          isSelf: isSelf,
          hasMyUnique: Boolean(myUniqueGiftIds?.length),
          isPinned: isCategoryListPinned,
          onCategoryChanged: onCategoryChanged
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
          name: "zoomFade",
          activeKey: getCategoryKey(selectedCategory),
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].starGiftsTransition,
          children: renderStarGifts()
        })]
      })]
    });
  }
  const isBackButton = isGiftScreen || isResaleScreen;
  const buttonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('animated-close-icon', isBackButton && 'state-back');
  function renderHeader() {
    if (!shouldShowHeader) return undefined;
    if (isResaleScreen) {
      const isFirstLoading = areResaleGiftsLoading && !resaleGiftsCount;
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].resaleHeaderContentContainer,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("h2", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].resaleHeaderText,
          children: selectedResaleGift.title
        }), isFirstLoading && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].resaleHeaderDescription,
          children: lang('Loading')
        }), !isFirstLoading && resaleGiftsCount !== undefined && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].resaleHeaderDescription,
          children: lang('HeaderDescriptionResaleGifts', {
            count: resaleGiftsCount
          }, {
            withNodes: true,
            withMarkdown: true,
            pluralValue: resaleGiftsCount
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftResaleFilters__WEBPACK_IMPORTED_MODULE_27__["default"], {
          dialogRef: dialogRef
        })]
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("h2", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].commonHeaderText,
      children: lang(isHeaderForStarGifts ? isSelf ? 'StarsGiftHeaderSelf' : 'StarsGiftHeader' : 'GiftPremiumHeader')
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_20__["default"], {
    dialogRef: dialogRef,
    onClose: handleCloseModal,
    isOpen: isOpen,
    isSlim: true,
    contentClassName: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].content,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].modalDialog, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].root),
    isLowStackPriority: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].closeButton,
      round: true,
      color: "translucent",
      size: "tiny",
      onClick: handleCloseButtonClick,
      ariaLabel: isBackButton ? oldLang('Common.Back') : oldLang('Common.Close'),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
        className: buttonClassName
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_22__["default"], {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].balance,
      balance: starBalance,
      withAddButton: true
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].header, isResaleScreen && _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].resaleHeader, !shouldShowHeader && _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].hiddenHeader, isCategoryListPinned && _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].noBorder),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
        name: "slideVerticalFade",
        activeKey: !shouldShowHeader ? 0 : isResaleScreen ? 1 : isHeaderForStarGifts ? 2 : 3,
        slideClassName: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].headerSlide,
        children: renderHeader()
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
      ref: transitionRef,
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].transition,
      name: "pushSlide",
      activeKey: isGiftScreen ? 1 : isResaleScreen ? 2 : 0,
      children: [!isGiftScreen && !isResaleScreen && renderMainScreen(), isResaleScreen && selectedResaleGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftModalResaleScreen__WEBPACK_IMPORTED_MODULE_26__["default"], {
        onGiftClick: handleGiftClick
      }), isGiftScreen && renderingModal?.forPeerId && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_GiftComposer__WEBPACK_IMPORTED_MODULE_23__["default"], {
        gift: selectedGift,
        giftByStars: giftsByStars.get(selectedGift),
        peerId: renderingModal.forPeerId
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const {
    starGifts,
    stars,
    currentUserId
  } = global;
  const peer = modal?.forPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPeer)(global, modal.forPeerId) : undefined;
  const isSelf = Boolean(currentUserId && modal?.forPeerId === currentUserId);
  const userFullInfo = peer ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUserFullInfo)(global, peer?.id) : undefined;
  const {
    resaleGifts
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const resaleGiftsCount = resaleGifts.count;
  const areResaleGiftsLoading = resaleGifts.isLoading !== false;
  const selectedResaleGift = modal?.selectedResaleGift;
  return {
    boostPerSentGift: global.appConfig.boostsPerSentGift,
    starGiftsById: starGifts?.byId,
    starGiftIdsByCategory: starGifts?.idsByCategory,
    myUniqueGiftsById: global.myUniqueGifts?.byId,
    myUniqueGiftIds: global.myUniqueGifts?.ids,
    starBalance: stars?.balance,
    peer,
    isSelf,
    disallowedGifts: userFullInfo?.disallowedGifts,
    resaleGiftsCount,
    areResaleGiftsLoading,
    selectedResaleGift,
    tabId: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global).id
  };
})(GiftModal)));
function getCategoryKey(category) {
  if (category === 'all') return 0;
  if (category === 'myUnique') return 1;
  return 2;
}

/***/ }),

/***/ "./src/components/modals/gift/GiftModalResaleScreen.tsx":
/*!**************************************************************!*\
  !*** ./src/components/modals/gift/GiftModalResaleScreen.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _limits__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../limits */ "./src/limits.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _GiftItemStar__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./GiftItemStar */ "./src/components/modals/gift/GiftItemStar.tsx");
/* harmony import */ var _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./GiftModal.module.scss */ "./src/components/modals/gift/GiftModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

















const INTERSECTION_THROTTLE = 200;
const GiftModalResaleScreen = ({
  resellGifts,
  gift,
  filter,
  areGiftsAllLoaded,
  areGiftsLoading,
  updateIteration,
  onGiftClick
}) => {
  const {
    loadResaleGifts,
    updateResaleGiftsFilter
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const scrollerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const resellGiftsIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return resellGifts?.map(g => g.id);
  }, [resellGifts]);
  const hasFilter = Boolean(filter?.modelAttributes?.length || filter?.patternAttributes?.length || filter?.backdropAttributes?.length);
  const handleLoadMoreResellGifts = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (gift) {
      const giftId = 'regularGiftId' in gift ? gift.regularGiftId : gift.id;
      loadResaleGifts({
        giftId
      });
    }
  });
  const isGiftsEmpty = Boolean(!resellGifts || resellGifts.length === 0);
  const [viewportIds, onLoadMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_6__["default"])(handleLoadMoreResellGifts, resellGiftsIds, !gift, _limits__WEBPACK_IMPORTED_MODULE_4__.RESALE_GIFTS_LIMIT);
  const {
    observe
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: scrollerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  const handleResetGiftsFilter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        modelAttributes: [],
        backdropAttributes: [],
        patternAttributes: []
      }
    });
  });
  function renderNothingFoundGiftsWithFilter() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].notFoundGiftsRoot,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_10__["default"], {
        size: 160,
        tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_5__.LOCAL_TGS_URLS.SearchingDuck,
        nonInteractive: true,
        noLoop: true
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].notFoundGiftsDescription,
        children: lang('ResellGiftsNoFound')
      }), hasFilter && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].notFoundGiftsLink,
        onClick: handleResetGiftsFilter,
        children: lang('ResellGiftsClearFilters')
      })]
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
    ref: scrollerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].resaleScreenRoot, 'custom-scroll'),
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_13__["default"], {
      name: "zoomFade",
      activeKey: updateIteration,
      children: [isGiftsEmpty && areGiftsAllLoaded && renderNothingFoundGiftsWithFilter(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_11__["default"], {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].resaleStarGiftsContainer),
        items: viewportIds,
        onLoadMore: onLoadMore,
        itemSelector: ".starGiftItem",
        noFastList: true,
        preloadBackwards: _limits__WEBPACK_IMPORTED_MODULE_4__.RESALE_GIFTS_LIMIT,
        scrollContainerClosest: `.${_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].resaleScreenRoot}`,
        children: resellGifts?.map(g => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_14__["default"], {
          gift: g,
          observeIntersection: observe,
          isResale: true,
          onClick: onGiftClick
        }, g.id))
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    starGifts
  } = global;
  const {
    resaleGifts
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const gift = resaleGifts?.giftId ? starGifts?.byId[resaleGifts.giftId] : undefined;
  const filter = resaleGifts.filter;
  const areGiftsAllLoaded = resaleGifts.isAllLoaded;
  const areGiftsLoading = resaleGifts.isLoading;
  const updateIteration = resaleGifts.updateIteration;
  return {
    resellGifts: resaleGifts.gifts,
    gift,
    filter,
    areGiftsAllLoaded,
    areGiftsLoading,
    updateIteration
  };
})(GiftModalResaleScreen)));

/***/ }),

/***/ "./src/components/modals/gift/GiftResaleFilters.module.scss":
/*!******************************************************************!*\
  !*** ./src/components/modals/gift/GiftResaleFilters.module.scss ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"_VgmQnUg","buttonsContainer":"IDlp6U6g","itemIcon":"yuctLnuR","sticker":"VT562JS0","backdropAttributeMenuItemText":"D50wFfRL","menuItemStickerText":"THcGWXSA","menuItemText":"L6EVE2Ux","backdrop":"A29QNxKb","menuItemIcon":"GL4rVsev","item":"qiYcBOYc","menuContentContainer":"EDsBn29z","menu":"ISaNdBwd","left":"e4Kkh_MR","right":"Kz_nCGC3"});

/***/ }),

/***/ "./src/components/modals/gift/GiftResaleFilters.tsx":
/*!**********************************************************!*\
  !*** ./src/components/modals/gift/GiftResaleFilters.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ResaleGiftMenuAttributeSticker__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ResaleGiftMenuAttributeSticker */ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.tsx");
/* harmony import */ var _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./GiftResaleFilters.module.scss */ "./src/components/modals/gift/GiftResaleFilters.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
















const GiftResaleFilters = ({
  attributes,
  counters,
  filter,
  dialogRef
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    updateResaleGiftsFilter
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [searchModelQuery, setSearchModelQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [searchBackdropQuery, setSearchBackdropQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [searchPatternQuery, setSearchPatternQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const filteredAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const map = {
      model: [],
      pattern: [],
      backdrop: []
    };
    for (const counter of counters ?? []) {
      const {
        attribute
      } = counter;
      if (!counter.count) {
        continue;
      }
      const found = attributes?.find(attr => {
        if (attr.type === 'backdrop' && attribute.type === 'backdrop') {
          return attr.backdropId === attribute.backdropId;
        }
        if (attr.type === 'model' && attribute.type === 'model') {
          return attr.sticker.id === attribute.documentId;
        }
        if (attr.type === 'pattern' && attribute.type === 'pattern') {
          return attr.sticker.id === attribute.documentId;
        }
        return false;
      });
      if (found?.type === 'backdrop') {
        map.backdrop.push(found);
      }
      if (found?.type === 'model') {
        map.model.push(found);
      }
      if (found?.type === 'pattern') {
        map.pattern.push(found);
      }
    }
    return map;
  }, [attributes, counters]);
  const filteredAndSearchedAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const filterBySearch = (items, query) => {
      if (!query.trim()) return items;
      return items.filter(item => Boolean(item.name?.toLowerCase().includes(query.toLowerCase())));
    };
    return {
      model: filterBySearch(filteredAttributes.model, searchModelQuery),
      pattern: filterBySearch(filteredAttributes.pattern, searchPatternQuery),
      backdrop: filterBySearch(filteredAttributes.backdrop, searchBackdropQuery)
    };
  }, [filteredAttributes, searchModelQuery, searchBackdropQuery, searchPatternQuery]);

  // Sort Menu
  const sortMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isSortContextMenuOpen,
    contextMenuAnchor: sortContextMenuAnchor,
    handleContextMenu: handleSortContextMenu,
    handleContextMenuClose: handleSortContextMenuClose,
    handleContextMenuHide: handleSortContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getSortMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => sortMenuRef.current);

  // Model Menu
  const modelMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isModelContextMenuOpen,
    contextMenuAnchor: modelContextMenuAnchor,
    handleContextMenu: handleModelContextMenu,
    handleContextMenuClose: handleModelContextMenuClose,
    handleContextMenuHide: handleModelContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getModelMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => modelMenuRef.current);

  // Backdrop Menu
  const backdropMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isBackdropContextMenuOpen,
    contextMenuAnchor: backdropContextMenuAnchor,
    handleContextMenu: handleBackdropContextMenu,
    handleContextMenuClose: handleBackdropContextMenuClose,
    handleContextMenuHide: handleBackdropContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getBackdropMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => backdropMenuRef.current);

  // Pattern Menu
  const patternMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isPatternContextMenuOpen,
    contextMenuAnchor: patternContextMenuAnchor,
    handleContextMenu: handlePatternContextMenu,
    handleContextMenuClose: handlePatternContextMenuClose,
    handleContextMenuHide: handlePatternContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getPatternMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => patternMenuRef.current);
  const SortMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const sortType = filter.sortType;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [sortType === 'byDate' && lang('ValueGiftSortByDate'), sortType === 'byNumber' && lang('ValueGiftSortByNumber'), sortType === 'byPrice' && lang('ValueGiftSortByPrice'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const ModelMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const attributesCount = filter?.modelAttributes?.length || 0;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [attributesCount === 0 && lang('GiftAttributeModel'), attributesCount > 0 && lang('GiftAttributeModelPlural', {
        count: attributesCount
      }, {
        pluralValue: attributesCount
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const BackdropMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const attributesCount = filter?.backdropAttributes?.length || 0;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [attributesCount === 0 && lang('GiftAttributeBackdrop'), attributesCount > 0 && lang('GiftAttributeBackdropPlural', {
        count: attributesCount
      }, {
        pluralValue: attributesCount
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const PatternMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const attributesCount = filter?.patternAttributes?.length || 0;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [attributesCount === 0 && lang('GiftAttributeSymbol'), attributesCount > 0 && lang('GiftAttributeSymbolPlural', {
        count: attributesCount
      }, {
        pluralValue: attributesCount
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const handleSortMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(type => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        sortType: type
      }
    });
  });
  const handleSelectedAllModelsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        modelAttributes: []
      }
    });
  });
  const handleSelectedAllPatternsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        patternAttributes: []
      }
    });
  });
  const handleSelectedAllBackdropsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        backdropAttributes: []
      }
    });
  });
  const handleModelMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(attribute => {
    if (!counters) return;
    const modelAttributes = filter.modelAttributes || [];
    const modelAttribute = counters.find(counter => counter.attribute.type === 'model' && counter.attribute.documentId === attribute.sticker.id)?.attribute;
    if (!modelAttribute) return;
    const isActive = modelAttributes.some(item => item.documentId === modelAttribute.documentId);
    const updatedAttributes = isActive ? modelAttributes.filter(item => item.documentId !== modelAttribute.documentId) : [...modelAttributes, modelAttribute];
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        modelAttributes: updatedAttributes
      }
    });
  });
  const handlePatternMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(attribute => {
    if (!counters) return;
    const patternAttributes = filter.patternAttributes || [];
    const patternAttribute = counters.find(counter => counter.attribute.type === 'pattern' && counter.attribute.documentId === attribute.sticker.id)?.attribute;
    if (!patternAttribute) return;
    const isActive = patternAttributes.some(item => item.documentId === patternAttribute.documentId);
    const updatedAttributes = isActive ? patternAttributes.filter(item => item.documentId !== patternAttribute.documentId) : [...patternAttributes, patternAttribute];
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        patternAttributes: updatedAttributes
      }
    });
  });
  const handleBackdropMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(attribute => {
    if (!counters) return;
    const backdropAttributes = filter.backdropAttributes || [];
    const backdropAttribute = counters.find(counter => counter.attribute.type === 'backdrop' && counter.attribute.backdropId === attribute.backdropId)?.attribute;
    if (!backdropAttribute) return;
    const isActive = backdropAttributes.some(item => item.backdropId === backdropAttribute.backdropId);
    const updatedAttributes = isActive ? backdropAttributes.filter(item => item.backdropId !== backdropAttribute.backdropId) : [...backdropAttributes, backdropAttribute];
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        backdropAttributes: updatedAttributes
      }
    });
  });
  function renderSortMenuItems() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "sort-by-price",
        onClick: () => {
          handleSortMenuItemClick('byPrice');
        },
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemText,
          children: lang('GiftSortByPrice')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
          name: filter?.sortType === 'byPrice' ? 'check' : 'placeholder'
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "sort-by-date",
        onClick: () => {
          handleSortMenuItemClick('byDate');
        },
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemText,
          children: lang('GiftSortByDate')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
          name: filter?.sortType === 'byDate' ? 'check' : 'placeholder'
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "sort-by-number",
        onClick: () => {
          handleSortMenuItemClick('byNumber');
        },
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemText,
          children: lang('GiftSortByNumber')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
          name: filter?.sortType === 'byNumber' ? 'check' : 'placeholder'
        })]
      })]
    });
  }
  function renderSortMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isSortContextMenuOpen,
      anchor: sortContextMenuAnchor,
      ref: sortMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].left, 'with-menu-transitions'),
      getMenuElement: getSortMenuElement,
      autoClose: true,
      onClose: handleSortContextMenuClose,
      onCloseAnimationEnd: handleSortContextMenuHide,
      positionX: "left",
      children: renderSortMenuItems()
    });
  }
  const handleSearchModelInputReset = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setSearchModelQuery('');
  }, []);
  const handleSearchBackdropInputReset = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setSearchBackdropQuery('');
  }, []);
  const handleSearchPatternInputReset = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setSearchPatternQuery('');
  }, []);
  const handleSearchInputClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(e => {
    e.stopPropagation();
    e.preventDefault();
  });
  const modelMenuItemsContainerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    observe
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__.useIntersectionObserver)({
    rootRef: modelMenuItemsContainerRef,
    isDisabled: !modelContextMenuAnchor
  });
  function renderModelMenuItems() {
    const models = filteredAndSearchedAttributes.model;
    const selectedAttributes = filter.modelAttributes ?? [];
    const isSelectedAll = selectedAttributes.length === 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuContentContainer,
      ref: modelMenuItemsContainerRef,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__["default"], {
        onClick: handleSearchInputClick,
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].search,
        value: searchModelQuery,
        onChange: setSearchModelQuery,
        onReset: handleSearchModelInputReset,
        placeholder: lang('Search')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "select",
        onClick: handleSelectedAllModelsClick,
        disabled: isSelectedAll,
        children: lang('ContextMenuItemSelectAll')
      }), models.map(model => {
        const isSelected = isSelectedAll || selectedAttributes.some(attr => attr.documentId === model.sticker.id);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
          onClick: () => {
            handleModelMenuItemClick(model);
          },
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ResaleGiftMenuAttributeSticker__WEBPACK_IMPORTED_MODULE_13__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].sticker,
            sticker: model.sticker,
            type: "model",
            observeIntersectionForLoading: observe,
            observeIntersectionForPlaying: observe
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemStickerText,
            children: model.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
            name: isSelected ? 'check' : 'placeholder'
          })]
        }, model.name);
      })]
    });
  }
  function renderModelMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isModelContextMenuOpen,
      anchor: modelContextMenuAnchor,
      ref: modelMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].left, 'with-menu-transitions'),
      getMenuElement: getModelMenuElement,
      autoClose: true,
      onClose: handleModelContextMenuClose,
      onCloseAnimationEnd: handleModelContextMenuHide,
      children: renderModelMenuItems()
    });
  }
  function renderBackdropMenuItems() {
    const backdrops = filteredAndSearchedAttributes.backdrop;
    const selectedAttributes = filter.backdropAttributes ?? [];
    const isSelectedAll = selectedAttributes.length === 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuContentContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__["default"], {
        onClick: handleSearchInputClick,
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].search,
        value: searchBackdropQuery,
        onChange: setSearchBackdropQuery,
        onReset: handleSearchBackdropInputReset,
        placeholder: lang('Search')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "select",
        onClick: handleSelectedAllBackdropsClick,
        disabled: isSelectedAll,
        children: lang('ContextMenuItemSelectAll')
      }), backdrops.map(backdrop => {
        const isSelected = isSelectedAll || selectedAttributes.some(attr => attr.backdropId === backdrop.backdropId);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
          onClick: () => {
            handleBackdropMenuItemClick(backdrop);
          },
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_9__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].backdrop,
            backgroundColors: [backdrop.centerColor, backdrop.edgeColor]
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].backdropAttributeMenuItemText,
            children: backdrop.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
            name: isSelected ? 'check' : 'placeholder'
          })]
        }, backdrop.name);
      })]
    });
  }
  function renderBackdropMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isBackdropContextMenuOpen,
      anchor: backdropContextMenuAnchor,
      ref: backdropMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].right, 'with-menu-transitions'),
      getMenuElement: getBackdropMenuElement,
      autoClose: true,
      onClose: handleBackdropContextMenuClose,
      onCloseAnimationEnd: handleBackdropContextMenuHide,
      positionX: "right",
      children: renderBackdropMenuItems()
    });
  }
  function renderPatternMenuItems() {
    const patterns = filteredAndSearchedAttributes.pattern;
    const selectedAttributes = filter.patternAttributes ?? [];
    const isSelectedAll = selectedAttributes.length === 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuContentContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__["default"], {
        onClick: handleSearchInputClick,
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].search,
        value: searchPatternQuery,
        onChange: setSearchPatternQuery,
        onReset: handleSearchPatternInputReset,
        placeholder: lang('Search')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "select",
        onClick: handleSelectedAllPatternsClick,
        disabled: isSelectedAll,
        children: lang('ContextMenuItemSelectAll')
      }), patterns.map(pattern => {
        const isSelected = isSelectedAll || selectedAttributes.some(attr => attr.documentId === pattern.sticker.id);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
          onClick: () => {
            handlePatternMenuItemClick(pattern);
          },
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ResaleGiftMenuAttributeSticker__WEBPACK_IMPORTED_MODULE_13__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].sticker,
            sticker: pattern.sticker,
            type: "pattern"
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemStickerText,
            children: pattern.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
            name: isSelected ? 'check' : 'placeholder'
          })]
        }, pattern.name);
      })]
    });
  }
  function renderPatternMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isPatternContextMenuOpen,
      anchor: patternContextMenuAnchor,
      ref: patternMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].right, 'with-menu-transitions'),
      getMenuElement: getPatternMenuElement,
      autoClose: true,
      onClose: handlePatternContextMenuClose,
      onCloseAnimationEnd: handlePatternContextMenuHide,
      children: renderPatternMenuItems()
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
    className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].root,
    children: [Boolean(sortContextMenuAnchor) && renderSortMenu(), Boolean(modelContextMenuAnchor) && renderModelMenu(), Boolean(backdropContextMenuAnchor) && renderBackdropMenu(), Boolean(patternContextMenuAnchor) && renderPatternMenu(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].buttonsContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(SortMenuButton, {
        onTrigger: handleSortContextMenu,
        isOpen: isSortContextMenuOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(ModelMenuButton, {
        onTrigger: handleModelContextMenu,
        isOpen: isModelContextMenuOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(BackdropMenuButton, {
        onTrigger: handleBackdropContextMenu,
        isOpen: isBackdropContextMenuOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(PatternMenuButton, {
        onTrigger: handlePatternContextMenu,
        isOpen: isPatternContextMenuOpen
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    resaleGifts
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const attributes = resaleGifts.attributes;
  const counters = resaleGifts.counters;
  const filter = resaleGifts.filter;
  return {
    attributes,
    counters,
    filter
  };
})(GiftResaleFilters)));

/***/ }),

/***/ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.module.scss":
/*!*******************************************************************************!*\
  !*** ./src/components/modals/gift/ResaleGiftMenuAttributeSticker.module.scss ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"KLFLR9ji","thumb":"fCL5rY2D"});

/***/ }),

/***/ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/ResaleGiftMenuAttributeSticker.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/stickers/useDynamicColorListener */ "./src/hooks/stickers/useDynamicColorListener.ts");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ResaleGiftMenuAttributeSticker_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ResaleGiftMenuAttributeSticker.module.scss */ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const ATTRIBUTE_STICKER_SIZE = 1.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const ResaleGiftMenuAttributeSticker = ({
  className,
  type,
  sticker,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  theme
}) => {
  const stickerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const customColor = (0,_hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_5__["default"])(stickerRef, undefined, type !== 'pattern');
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div", {
    ref: stickerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ResaleGiftMenuAttributeSticker_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root, className),
    style: `width: ${ATTRIBUTE_STICKER_SIZE}px; height: ${ATTRIBUTE_STICKER_SIZE}px`,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_common_StickerView__WEBPACK_IMPORTED_MODULE_6__["default"], {
      containerRef: stickerRef,
      sticker: sticker,
      size: ATTRIBUTE_STICKER_SIZE,
      shouldPreloadPreview: true,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      thumbClassName: _ResaleGiftMenuAttributeSticker_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].thumb,
      customColor: customColor
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTheme)(global)
  };
})(ResaleGiftMenuAttributeSticker)));

/***/ }),

/***/ "./src/components/modals/gift/StarGiftCategoryList.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftCategoryList.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"list":"cUjwvN00","pinned":"NhJABU3M","item-selected":"medfcJpd","itemSelected":"medfcJpd","item":"dO7FKYY4","selected-item":"B2lEJk1v","selectedItem":"B2lEJk1v","star":"Pb7AU805"});

/***/ }),

/***/ "./src/components/modals/gift/StarGiftCategoryList.tsx":
/*!*************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftCategoryList.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useHorizontalScroll */ "./src/hooks/useHorizontalScroll.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./StarGiftCategoryList.module.scss */ "./src/components/modals/gift/StarGiftCategoryList.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");







const StarGiftCategoryList = ({
  ref: externalRef,
  idsByCategory,
  onCategoryChanged,
  areUniqueStarGiftsDisallowed,
  areLimitedStarGiftsDisallowed,
  isSelf,
  hasMyUnique,
  isPinned
}) => {
  let ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  if (externalRef) {
    ref = externalRef;
  }
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const hasCollectible = Boolean(idsByCategory?.collectible?.length);
  const [selectedCategory, setSelectedCategory] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('all');
  function handleItemClick(category) {
    setSelectedCategory(category);
    onCategoryChanged(category);
  }
  function renderCategoryName(category) {
    if (category === 'all') return lang('AllGiftsCategory');
    if (category === 'myUnique') return lang('GiftCategoryMyGifts');
    if (category === 'collectible') return lang('GiftCategoryCollectibles');
    return category;
  }
  function renderCategoryItem(category) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].item, selectedCategory === category && _StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].selectedItem),
      onClick: () => handleItemClick(category),
      children: renderCategoryName(category)
    });
  }
  (0,_hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, undefined, true);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].list, isPinned && _StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].pinned, 'no-scrollbar'),
    children: [renderCategoryItem('all'), !areUniqueStarGiftsDisallowed && !isSelf && hasMyUnique && renderCategoryItem('myUnique'), (!areUniqueStarGiftsDisallowed || !areLimitedStarGiftsDisallowed) && hasCollectible && renderCategoryItem('collectible')]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    starGifts
  } = global;
  return {
    idsByCategory: starGifts?.idsByCategory
  };
})(StarGiftCategoryList)));

/***/ }),

/***/ "./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.module.scss":
/*!*******************************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.module.scss ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"ETFjTQkC","headerTitle":"JKYZ8cFl","headerHint":"wHxufgix","starIconContainer":"NEElQBO6","progress":"DJPf4ekd","table":"WuL_UIYd","footerText":"TWuxZcHO","footer":"OXLUuiYb","understoodIcon":"QJryEH9W"});

/***/ }),

/***/ "./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_PremiumProgress__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/PremiumProgress */ "./src/components/common/PremiumProgress.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./StarGiftPriceDecreaseInfoModal.module.scss */ "./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const StarGiftPriceDecreaseInfoModal = ({
  modal
}) => {
  const {
    closeStarGiftPriceDecreaseInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    closeStarGiftPriceDecreaseInfoModal();
  });
  const tableData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!renderingModal) return undefined;
    const {
      prices
    } = renderingModal;
    return prices.map(price => [(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(price.date * 1000, lang.code, true, undefined, true), (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, price.upgradeStars, {
      containerClassName: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].starIconContainer
    })]);
  }, [lang, renderingModal]);
  const footer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
      className: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].footer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("p", {
        className: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].footerText,
        children: lang('UpgradeCostDrops')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
        onClick: handleClose,
        iconName: "understood",
        iconClassName: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].understoodIcon,
        children: lang('ButtonUnderstood')
      })]
    });
  }, [lang, isOpen, handleClose]);
  if (!tableData || !renderingModal) return undefined;
  const {
    currentPrice,
    minPrice,
    maxPrice
  } = renderingModal;
  const progress = maxPrice !== minPrice ? (currentPrice - minPrice) / (maxPrice - minPrice) : 0;
  const header = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
    className: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].header,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_PremiumProgress__WEBPACK_IMPORTED_MODULE_8__["default"], {
      leftText: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, maxPrice),
      rightText: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, minPrice),
      floatingBadgeText: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, currentPrice),
      floatingBadgeIcon: "star",
      progress: progress,
      isInverted: true,
      shouldSkipGradient: true,
      className: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].progress
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("p", {
      className: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].headerTitle,
      children: lang('StarGiftUpgradeCostModalTitle')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("p", {
      className: _StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].headerHint,
      children: lang('StarGiftUpgradeCostHint')
    })]
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isOpen: isOpen,
    onClose: handleClose,
    header: header,
    tableData: tableData,
    tableClassName: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StarGiftPriceDecreaseInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].table, 'custom-scroll'),
    footer: footer
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarGiftPriceDecreaseInfoModal));

/***/ }),

/***/ "./src/components/modals/gift/UniqueGiftHeader.module.scss":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/UniqueGiftHeader.module.scss ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"irv1C8bo","withManageButtons":"QcTw5OSp","sticker":"a1ASgPwu","withBadge":"OFWOLtAH","subtitleBadge":"V7kDVPLm","badge":"PAmbIL6y","radialPattern":"UvhsGZLf","amount":"zTVWZg63","transition":"Tu6_OHoq","transitionSlide":"iUTKLzTN","title":"ECTvfOda","subtitle":"S6JwvHWD"});

/***/ }),

/***/ "./src/components/modals/gift/UniqueGiftHeader.tsx":
/*!*********************************************************!*\
  !*** ./src/components/modals/gift/UniqueGiftHeader.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment.ts */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _common_helpers_mediaDimensions_ts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions.ts */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/animations/useTransitionActiveKey */ "./src/hooks/animations/useTransitionActiveKey.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _UniqueGiftManageButtons__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./UniqueGiftManageButtons */ "./src/components/modals/gift/UniqueGiftManageButtons.tsx");
/* harmony import */ var _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./UniqueGiftHeader.module.scss */ "./src/components/modals/gift/UniqueGiftHeader.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const STICKER_SIZE = 120;
const UniqueGiftHeader = ({
  modelAttribute,
  backdropAttribute,
  patternAttribute,
  title,
  badge,
  subtitle,
  subtitlePeer,
  className,
  resellPrice,
  showManageButtons,
  savedGift
}) => {
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const [isGiftHover, markGiftHover, unmarkGiftHover] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])(false);
  const activeKey = (0,_hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_7__.useTransitionActiveKey)([modelAttribute, backdropAttribute, patternAttribute]);
  const subtitleColor = backdropAttribute?.textColor;
  const radialPatternBackdrop = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const backdropColors = [backdropAttribute.centerColor, backdropAttribute.edgeColor];
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__["default"], {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].radialPattern,
      canvasClassName: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].radialPatternCanvas,
      backgroundColors: backdropColors,
      patternIcon: patternAttribute.sticker,
      yPosition: 7.5 * _common_helpers_mediaDimensions_ts__WEBPACK_IMPORTED_MODULE_6__.REM,
      maxRadius: 0.26,
      patternSize: isMobile ? 14 : 16,
      ovalFactor: 1.2
    });
  }, [backdropAttribute, patternAttribute, isMobile]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].root, 'interactive-gift', showManageButtons && _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].withManageButtons, badge && _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].withBadge, className),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_15__["default"], {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].transition,
      slideClassName: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].transitionSlide),
      activeKey: activeKey,
      direction: 1,
      name: "zoomBounceSemiFade",
      children: [radialPatternBackdrop, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_11__["default"], {
        className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].sticker,
        sticker: modelAttribute.sticker,
        size: STICKER_SIZE,
        noLoop: !isGiftHover,
        onMouseEnter: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? markGiftHover : undefined,
        onMouseLeave: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? unmarkGiftHover : undefined
      })]
    }), Boolean(badge) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].badge,
      children: badge
    }), title && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("h1", {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].title,
      children: title
    }), Boolean(subtitle) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].subtitle, subtitlePeer && _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].subtitleBadge),
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(subtitleColor && `color: ${subtitleColor}`),
      onClick: () => {
        if (subtitlePeer) {
          openChat({
            id: subtitlePeer.id
          });
        }
      },
      children: subtitle
    }), savedGift && showManageButtons && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_UniqueGiftManageButtons__WEBPACK_IMPORTED_MODULE_16__["default"], {
      savedGift: savedGift
    }), resellPrice && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("p", {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].amount,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span", {
        children: (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__.formatStarsTransactionAmount)(lang, resellPrice)
      }), resellPrice.currency === 'XTR' && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        type: "gold",
        size: "middle"
      }), resellPrice.currency === 'TON' && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
        name: "toncoin"
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(UniqueGiftHeader));

/***/ }),

/***/ "./src/components/modals/gift/UniqueGiftManageButtons.module.scss":
/*!************************************************************************!*\
  !*** ./src/components/modals/gift/UniqueGiftManageButtons.module.scss ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"manageButtons":"feHNN0j8","manageButton":"biAUzmLA","text":"hsDNs5hG","icon":"APNjRx1K"});

/***/ }),

/***/ "./src/components/modals/gift/UniqueGiftManageButtons.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/gift/UniqueGiftManageButtons.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./UniqueGiftManageButtons.module.scss */ "./src/components/modals/gift/UniqueGiftManageButtons.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const UniqueGiftManageButtons = ({
  savedGift,
  currentUserEmojiStatus,
  collectibleEmojiStatuses
}) => {
  const {
    openGiftTransferModal,
    openGiftResalePriceComposerModal,
    openGiftStatusInfoModal,
    setEmojiStatus,
    updateStarGiftPrice,
    showNotification,
    closeGiftInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const gift = savedGift?.gift;
  const isGiftUnique = gift?.type === 'starGiftUnique';
  const giftResalePrice = isGiftUnique ? gift.resellPrice : undefined;
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const modal = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global).giftInfoModal;
  const peerId = modal?.peerId;
  const starGiftUniqueSlug = gift?.type === 'starGiftUnique' ? gift.slug : undefined;
  const userCollectibleStatus = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUniqueSlug) return undefined;
    return collectibleEmojiStatuses?.find(status => status.type === 'collectible' && status.slug === starGiftUniqueSlug);
  }, [starGiftUniqueSlug, collectibleEmojiStatuses]);
  const currentUniqueEmojiStatusSlug = currentUserEmojiStatus?.type === 'collectible' ? currentUserEmojiStatus.slug : undefined;
  const canTakeOff = starGiftUniqueSlug !== undefined && currentUniqueEmojiStatusSlug === starGiftUniqueSlug;
  const canWear = Boolean(userCollectibleStatus) && !canTakeOff;
  const handleTransfer = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || savedGift?.gift.type !== 'starGiftUnique') return;
    if (savedGift.canTransferAt && savedGift.canTransferAt > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()) {
      showNotification({
        message: {
          key: 'NotificationGiftCanTransferAt',
          variables: {
            date: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateAtTime)(oldLang, savedGift.canTransferAt * 1000)
          }
        }
      });
      return;
    }
    openGiftTransferModal({
      gift: savedGift
    });
  });
  const handleWear = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (canTakeOff) {
      setEmojiStatus({
        emojiStatus: {
          type: 'regular',
          documentId: _config__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_STATUS_ICON_ID
        }
      });
    } else if (userCollectibleStatus) {
      openGiftStatusInfoModal({
        emojiStatus: userCollectibleStatus
      });
    }
  });
  const handleSell = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || !peerId) return;
    if (savedGift.canResellAt && savedGift.canResellAt > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()) {
      showNotification({
        message: {
          key: 'NotificationGiftCanResellAt',
          variables: {
            date: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateAtTime)(oldLang, savedGift.canResellAt * 1000)
          }
        }
      });
      return;
    }
    openGiftResalePriceComposerModal({
      peerId,
      gift: savedGift
    });
  });
  const handleUnlist = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || savedGift.gift.type !== 'starGiftUnique' || !savedGift.inputGift) return;
    closeGiftInfoModal();
    updateStarGiftPrice({
      gift: savedGift.inputGift,
      price: {
        currency: _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE,
        amount: 0,
        nanos: 0
      }
    });
    showNotification({
      icon: 'unlist-outline',
      message: {
        key: 'NotificationGiftIsUnlist',
        variables: {
          gift: lang('GiftUnique', {
            title: savedGift.gift.title,
            number: savedGift.gift.number
          })
        }
      }
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].manageButtons,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      color: "transparentBlured",
      iconName: "gift-transfer-inline",
      iconAlignment: "top",
      iconClassName: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].icon,
      onClick: handleTransfer,
      ariaLabel: lang('GiftInfoTransfer'),
      noForcedUpperCase: true,
      fluid: true,
      className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].manageButton,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].text,
        children: lang('GiftInfoTransfer')
      })
    }), (canWear || !canTakeOff) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      color: "transparentBlured",
      iconName: canTakeOff ? 'crown-take-off' : 'crown-wear',
      iconAlignment: "top",
      iconClassName: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].icon,
      onClick: canWear || canTakeOff ? handleWear : undefined,
      disabled: !canWear && !canTakeOff,
      ariaLabel: lang(canTakeOff ? 'GiftInfoTakeOff' : 'GiftInfoWear'),
      noForcedUpperCase: true,
      fluid: true,
      className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].manageButton,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].text,
        children: lang(canTakeOff ? 'GiftInfoTakeOff' : 'GiftInfoWear')
      })
    }), !giftResalePrice && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      color: "transparentBlured",
      iconName: "sell",
      iconAlignment: "top",
      iconClassName: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].icon,
      onClick: handleSell,
      ariaLabel: lang('Sell'),
      noForcedUpperCase: true,
      fluid: true,
      className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].manageButton,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].text,
        children: lang('Sell')
      })
    }), Boolean(giftResalePrice) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      color: "transparentBlured",
      iconName: "unlist",
      iconAlignment: "top",
      iconClassName: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].icon,
      onClick: handleUnlist,
      ariaLabel: lang('GiftInfoUnlist'),
      noForcedUpperCase: true,
      fluid: true,
      className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].manageButton,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        className: _UniqueGiftManageButtons_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].text,
        children: lang('GiftInfoUnlist')
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    currentUserId
  } = global;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId) : undefined;
  const currentUserEmojiStatus = currentUser?.emojiStatus;
  const collectibleEmojiStatuses = global.collectibleEmojiStatuses?.statuses;
  return {
    currentUserEmojiStatus,
    collectibleEmojiStatuses
  };
})(UniqueGiftManageButtons)));

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionAcquiredModal.module.scss":
/*!*********************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionAcquiredModal.module.scss ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"Pz3wJVwI","content":"vBYqMeRD","giftsListContainer":"Ly9mKtg2","giftsList":"lla9jO09","giftHeader":"TuVkgxwZ","bidValue":"zdUvUfOO","badge":"btuWuz25","starIcon":"GRggVFef","okButton":"kIsP2W0m"});

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionAcquiredModal.tsx":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionAcquiredModal.tsx ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useScrollNotch__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useScrollNotch */ "./src/hooks/useScrollNotch.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _common_TableInfo__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/TableInfo */ "./src/components/modals/common/TableInfo.tsx");
/* harmony import */ var _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./GiftAuctionAcquiredModal.module.scss */ "./src/components/modals/gift/auction/GiftAuctionAcquiredModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
















const GiftAuctionAcquiredModal = ({
  modal,
  acquiredGifts,
  giftTitle,
  giftSticker
}) => {
  const {
    closeGiftAuctionAcquiredModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal?.giftId);
  const renderingGifts = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(acquiredGifts);
  const renderingGiftTitle = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(giftTitle);
  const renderingGiftSticker = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(giftSticker);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    closeGiftAuctionAcquiredModal();
  });
  const giftItems = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!renderingGifts?.length) return undefined;
    return renderingGifts.map(gift => {
      const header = lang('GiftAuctionBoughtGiftHeader', {
        gift: renderingGiftTitle || lang('StarGift'),
        giftNumber: gift.giftNumber ? lang.number(gift.giftNumber) : '',
        round: lang.number(gift.round)
      });
      const tableData = [[undefined, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("span", {
        className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].giftHeader,
        children: [renderingGiftSticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_9__["default"], {
          className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].giftSticker,
          sticker: renderingGiftSticker,
          size: 20,
          play: false
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("span", {
          children: header
        })]
      })], [lang('GiftAuctionRecipient'), {
        chatId: gift.peerId
      }], [lang('GiftAuctionDate'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(gift.date * 1000, lang.code, true)], [lang('GiftAuctionAcceptedBid'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("span", {
        className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].bidValue,
        children: [(0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, gift.bidAmount, {
          className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].starIcon
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_10__["default"], {
          className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].badge,
          children: lang('GiftAuctionTopPosition', {
            position: gift.position
          })
        })]
      })]];
      return {
        tableData,
        key: `${gift.round}-${gift.giftNumber}`
      };
    });
  }, [renderingGifts, renderingGiftTitle, renderingGiftSticker, lang]);
  const giftsCount = renderingGifts?.length || 0;
  (0,_hooks_useScrollNotch__WEBPACK_IMPORTED_MODULE_8__["default"])({
    containerRef,
    selector: `.${_GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].giftsList}`,
    isBottomNotch: true
  }, [giftItems]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isOpen: isOpen,
    hasCloseButton: true,
    title: lang('GiftAuctionBoughtGiftsTitle', {
      count: giftsCount
    }, {
      pluralValue: giftsCount
    }),
    className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].modal,
    contentClassName: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].content,
    onClose: handleClose,
    isCondensedHeader: true,
    isSlim: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
      className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].giftsListContainer,
      ref: containerRef,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
        className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].giftsList,
        children: giftItems?.map(item => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_TableInfo__WEBPACK_IMPORTED_MODULE_13__["default"], {
          tableData: item.tableData
        }, item.key))
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
      className: _GiftAuctionAcquiredModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].okButton,
      onClick: handleClose,
      children: lang('OK')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    giftAuctionAcquiredModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  return {
    acquiredGifts: giftAuctionAcquiredModal?.acquiredGifts,
    giftTitle: giftAuctionAcquiredModal?.giftTitle,
    giftSticker: giftAuctionAcquiredModal?.giftSticker
  };
})(GiftAuctionAcquiredModal)));

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionBidModal.module.scss":
/*!****************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionBidModal.module.scss ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"content":"FbamIaWM","headerControlPanel":"oKcR_Gxv","slider":"lpcp8Oip","title":"jNHNh7KT","subtitle":"HlVun4XF","infoCards":"K9fWcZP0","infoCard":"QBcr61z8","infoCardValue":"S9vK5Tny","infoCardLabel":"UzCztm_V","separator":"eCFcDThE","winningStatus":"IENM5upL","bidderInfoSlide":"VvFvniw8","winningText":"mHlgX1Lm","winningBadge":"yWQ_64QE","section":"VfdOWkWu","sectionTitle":"aJxJv1Tj","sectionTitleTransition":"I344VxP8","bidderRow":"_6493YZ5","bidderPosition":"bjYqFB3Y","bidderInfo":"MSwHwQYX","bidderName":"StE9kpcQ","topBidderRow":"Q0o2Mlnj","topBidderPosition":"mQa4yF_w","bidderAmount":"jTHhbapk","buttonStar":"eY_4yHis","giftSticker":"ETmmzDXX","customBidInput":"KRqfUs0J","customBidInputIcon":"m1O8A6wT"});

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionBidModal.tsx":
/*!********************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionBidModal.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/animations/useTransitionActiveKey */ "./src/hooks/animations/useTransitionActiveKey.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_InputText__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../ui/InputText */ "./src/components/ui/InputText.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_TextTimer__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../ui/TextTimer */ "./src/components/ui/TextTimer.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _paidReaction_StarSlider__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../paidReaction/StarSlider */ "./src/components/modals/paidReaction/StarSlider.tsx");
/* harmony import */ var _stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../stars/BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./GiftAuctionBidModal.module.scss */ "./src/components/modals/gift/auction/GiftAuctionBidModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

























const DEFAULT_BID_AMOUNT = 50;
const MAX_BID_AMOUNT_STEP = 50000;
const MAX_CUSTOM_BID_AMOUNT = 1000000000;
const BID_ROUNDING_STEP = 10000;
const MIN_SLIDER_PROGRESS = 0.25;
const GIFT_STICKER_SIZE = 24;
const DEFAULT_TOP_BIDDERS_COUNT = 3;
const GiftAuctionBidModal = ({
  modal,
  auctionState,
  starBalance,
  currentUserPeer,
  topBidderIds
}) => {
  const {
    closeGiftAuctionBidModal,
    sendStarGiftAuctionBid,
    loadGiftAuction
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const renderingAuctionState = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(auctionState);
  const renderingTopBidderIds = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(topBidderIds);
  const renderingTopBidderPeers = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!renderingTopBidderIds) return undefined;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return renderingTopBidderIds.map(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, id)).filter(Boolean);
  }, [renderingTopBidderIds]);
  const [topBidder1, topBidder2, topBidder3] = renderingTopBidderPeers || [];
  const topBidder1Key = (0,_hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_5__.useTransitionActiveKey)([topBidder1?.id || '0']);
  const topBidder2Key = (0,_hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_5__.useTransitionActiveKey)([topBidder2?.id || '0']);
  const topBidder3Key = (0,_hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_5__.useTransitionActiveKey)([topBidder3?.id || '0']);
  const giftsPerRound = renderingAuctionState?.gift.giftsPerRound || 0;
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const activeState = renderingAuctionState?.state.type === 'active' ? renderingAuctionState.state : undefined;
  const userState = renderingAuctionState?.userState;
  const [selectedBidAmount, setSelectedBidAmount] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(DEFAULT_BID_AMOUNT);
  const [isCustomBidModalOpen, openCustomBidModal, closeCustomBidModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [customBidValue, setCustomBidValue] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const baseMinBid = activeState?.minBidAmount || DEFAULT_BID_AMOUNT;
  const currentMinBid = userState?.minBidAmount || baseMinBid;
  const sliderMaxValue = Math.ceil(currentMinBid / BID_ROUNDING_STEP) * BID_ROUNDING_STEP + MAX_BID_AMOUNT_STEP;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setSelectedBidAmount(currentMinBid);
  }, [currentMinBid]);
  const nextRoundAt = activeState?.nextRoundAt;
  const bidDifference = userState?.bidAmount ? selectedBidAmount - userState.bidAmount : 0;
  const isAtMaxValue = selectedBidAmount >= sliderMaxValue;
  const sliderSecondaryText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isAtMaxValue) return lang('GiftAuctionTapToBidMore');
    if (bidDifference <= 0) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.Fragment, {
      children: ["+", (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_10__["default"], {
        text: lang.number(bidDifference)
      })]
    });
  }, [bidDifference, isAtMaxValue, lang]);
  const handleAmountChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(value => {
    setSelectedBidAmount(value);
  });
  const handleTimerEnd = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (!modal?.auctionGiftId || !isOpen) return;
    loadGiftAuction({
      giftId: modal.auctionGiftId
    });
  });
  const handleRequestCustomValue = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    openCustomBidModal();
  });
  const handleBadgeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (isAtMaxValue) {
      handleRequestCustomValue();
    }
  });
  const handleCustomBidChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    const value = e.target.value.replace(/\D/g, '');
    const numValue = Number(value);
    if (numValue > MAX_CUSTOM_BID_AMOUNT) return;
    setCustomBidValue(value);
  });
  const handleCustomBidSubmit = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (!renderingAuctionState?.gift.id || !modal) return;
    const resultValue = Number(customBidValue);
    if (resultValue < currentMinBid) return;
    setSelectedBidAmount(resultValue);
    closeCustomBidModal();
    setCustomBidValue('');
    const {
      peerId,
      message,
      shouldHideName
    } = modal;
    const isUpdateBid = Boolean(userState?.bidAmount);
    sendStarGiftAuctionBid({
      giftId: renderingAuctionState.gift.id,
      bidAmount: resultValue,
      peerId,
      message: message ? {
        text: message
      } : undefined,
      shouldHideName,
      isUpdateBid
    });
  });
  const handleSubmit = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (!renderingAuctionState?.gift.id || !modal) return;
    const {
      peerId,
      message,
      shouldHideName
    } = modal;
    const isUpdateBid = Boolean(userState?.bidAmount);
    sendStarGiftAuctionBid({
      giftId: renderingAuctionState.gift.id,
      bidAmount: selectedBidAmount,
      peerId,
      message: message ? {
        text: message
      } : undefined,
      shouldHideName,
      isUpdateBid
    });
  });
  const userPosition = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!selectedBidAmount || !activeState?.bidLevels?.length) return undefined;
    const {
      bidLevels
    } = activeState;
    const userBidDate = userState?.bidDate || Number.MAX_SAFE_INTEGER;
    for (const level of bidLevels) {
      if (level.amount < selectedBidAmount || level.amount === selectedBidAmount && level.date >= userBidDate) {
        return level.pos;
      }
    }
    return bidLevels[bidLevels.length - 1].pos + 1;
  }, [selectedBidAmount, activeState, userState?.bidDate]);
  function renderInfoCards() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCards,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCard,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCardValue,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__["default"], {
            type: "gold",
            size: "adaptive"
          }), lang.number(currentMinBid)]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCardLabel,
          children: lang('GiftAuctionMinimumBid')
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCard,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCardValue,
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_TextTimer__WEBPACK_IMPORTED_MODULE_19__["default"], {
            endsAt: nextRoundAt || 0,
            shouldShowZeroOnEnd: true,
            onEnd: handleTimerEnd
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCardLabel,
          children: lang('GiftAuctionUntilNextRound')
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCard,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCardValue,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_11__["default"], {
            noLoop: false,
            className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giftSticker,
            sticker: renderingAuctionState?.gift.sticker,
            size: GIFT_STICKER_SIZE
          }), lang.number(activeState?.giftsLeft || 0)]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].infoCardLabel,
          children: lang('GiftAuctionLeft')
        })]
      })]
    });
  }
  const isWinning = Boolean(userState?.bidAmount && userPosition && userPosition <= giftsPerRound);
  function renderCurrentBidSectionTitle() {
    const giftTitle = renderingAuctionState?.gift.title || lang('StarGift');
    const nextGiftNum = userPosition && userPosition <= 100 ? (activeState?.lastGiftNum || 0) + userPosition : undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_20__["default"], {
      name: "fade",
      activeKey: isWinning ? 0 : 1,
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionTitleTransition,
      slideClassName: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderInfoSlide,
      children: isWinning ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].winningStatus,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("span", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].winningText,
          children: lang('GiftAuctionYoureWinning')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("span", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].winningBadge,
          children: lang('GiftUnique', {
            title: giftTitle,
            number: nextGiftNum ? lang.number(nextGiftNum) : undefined
          })
        })]
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionTitle,
        children: lang('GiftAuctionYourBidWillBe')
      })
    });
  }
  function renderUserBid() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
      children: [renderCurrentBidSectionTitle(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderRow,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderPosition,
          children: userPosition && userPosition > 100 ? `${userPosition}+` : userPosition || 1
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderInfo,
          children: [currentUserPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_12__["default"], {
            peer: currentUserPeer,
            size: "small"
          }), currentUserPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_13__["default"], {
            peer: currentUserPeer,
            className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderName
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderAmount,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__["default"], {
            type: "gold",
            size: "adaptive"
          }), lang.number(selectedBidAmount)]
        })]
      })]
    });
  }
  function renderTopBidderRow(index, emoji, peer, amount, activeKey) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].topBidderRow,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].topBidderPosition,
        children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__["default"])(emoji, ['emoji'])
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_20__["default"], {
        name: "fade",
        activeKey: activeKey,
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderInfo,
        slideClassName: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderInfoSlide,
        children: peer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_12__["default"], {
            peer: peer,
            size: "small"
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_13__["default"], {
            peer: peer,
            className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderName
          })]
        })
      }), amount !== undefined && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].bidderAmount,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__["default"], {
          type: "gold",
          size: "adaptive"
        }), lang.number(amount)]
      })]
    }, index);
  }
  function renderTopWinners() {
    const topCount = DEFAULT_TOP_BIDDERS_COUNT;
    const bidLevels = activeState?.bidLevels;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionTitle,
        children: lang('GiftAuctionTopWinners', {
          count: topCount
        }, {
          pluralValue: topCount
        })
      }), renderTopBidderRow(0, '', topBidder1, bidLevels?.[0]?.amount, topBidder1Key), renderTopBidderRow(1, '', topBidder2, bidLevels?.[1]?.amount, topBidder2Key), renderTopBidderRow(2, '', topBidder3, bidLevels?.[2]?.amount, topBidder3Key)]
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_18__["default"], {
    isOpen: isOpen,
    hasAbsoluteCloseButton: true,
    isSlim: true,
    contentClassName: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].content,
    onClose: closeGiftAuctionBidModal,
    isLowStackPriority: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].headerControlPanel,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_22__["default"], {
        balance: starBalance,
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].modalBalance,
        withAddButton: true
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_paidReaction_StarSlider__WEBPACK_IMPORTED_MODULE_21__["default"], {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].slider,
      defaultValue: currentMinBid,
      minValue: baseMinBid,
      minAllowedValue: currentMinBid,
      minAllowedProgress: MIN_SLIDER_PROGRESS,
      maxValue: sliderMaxValue,
      floatingBadgeDescription: sliderSecondaryText,
      onChange: handleAmountChange,
      onBadgeClick: handleBadgeClick,
      onCustomValueClick: handleRequestCustomValue,
      shouldUseDynamicColor: true,
      shouldAllowCustomValue: true
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("h3", {
      className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].title,
      children: lang('GiftAuctionPlaceBid')
    }), renderInfoCards(), renderUserBid(), renderTopWinners(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
      noForcedUpperCase: true,
      onClick: handleSubmit,
      children: lang(userState?.bidAmount ? 'GiftAuctionAddToBid' : 'GiftAuctionPlaceBidButton', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsIcon)(lang, userState?.bidAmount ? selectedBidAmount - userState.bidAmount : selectedBidAmount, {
          asFont: true,
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].buttonStar
        })
      }, {
        withNodes: true
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_16__["default"], {
      isOpen: isCustomBidModalOpen,
      title: lang('GiftAuctionCustomBidTitle'),
      confirmLabel: lang('GiftAuctionCustomBidButton'),
      isConfirmDisabled: !customBidValue || Number(customBidValue) < currentMinBid,
      confirmHandler: handleCustomBidSubmit,
      onClose: closeCustomBidModal,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("p", {
        children: lang('GiftAuctionCustomBidDescription', {
          count: renderingAuctionState?.gift.giftsPerRound
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
        className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].customBidInput,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__["default"], {
          type: "gold",
          size: "adaptive",
          className: _GiftAuctionBidModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].customBidInputIcon
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_InputText__WEBPACK_IMPORTED_MODULE_17__["default"], {
          value: customBidValue,
          onChange: handleCustomBidChange,
          placeholder: lang('GiftAuctionCustomBidPlaceholder'),
          inputMode: "numeric",
          teactExperimentControlled: true
        })]
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    stars,
    currentUserId
  } = global;
  const {
    giftAuctionBidModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const auctionGiftId = giftAuctionBidModal?.auctionGiftId;
  const giftAuction = auctionGiftId ? global.giftAuctionByGiftId?.[auctionGiftId] : undefined;
  const currentUserPeer = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, currentUserId) : undefined;
  const topBidderIds = giftAuction?.state.type === 'active' ? giftAuction.state.topBidders : undefined;
  return {
    auctionState: giftAuction,
    starBalance: stars?.balance,
    currentUserPeer,
    topBidderIds
  };
})(GiftAuctionBidModal)));

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.module.scss":
/*!****************************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.module.scss ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"preview":"GiX7PhEa","arrow":"rkG87LNM"});

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.tsx":
/*!********************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.tsx ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _GiftAuctionChangeRecipientModal_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./GiftAuctionChangeRecipientModal.module.scss */ "./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const AVATAR_SIZE = 4 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const GiftAuctionChangeRecipientModal = ({
  modal,
  oldPeer,
  newPeer
}) => {
  const {
    closeGiftAuctionChangeRecipientModal,
    openGiftAuctionBidModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const renderingOldPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(oldPeer);
  const renderingNewPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(newPeer);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const handleConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!renderingModal?.auctionGiftId) return;
    closeGiftAuctionChangeRecipientModal();
    openGiftAuctionBidModal({
      auctionGiftId: renderingModal.auctionGiftId,
      peerId: renderingModal.newPeerId,
      message: renderingModal.message,
      shouldHideName: renderingModal.shouldHideName
    });
  });
  if (!renderingOldPeer || !renderingNewPeer) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isOpen: isOpen,
    title: lang('GiftAuctionChangeRecipientTitle'),
    onClose: closeGiftAuctionChangeRecipientModal,
    confirmLabel: lang('Continue'),
    confirmHandler: handleConfirm,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
      className: _GiftAuctionChangeRecipientModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].preview,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
        peer: renderingOldPeer,
        size: AVATAR_SIZE
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
        name: "next",
        className: _GiftAuctionChangeRecipientModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].arrow
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
        peer: renderingNewPeer,
        size: AVATAR_SIZE
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("p", {
      children: lang('GiftAuctionChangeRecipientDescription', {
        oldPeer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingOldPeer),
        newPeer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingNewPeer)
      }, {
        withNodes: true,
        withMarkdown: true
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const oldPeer = modal?.oldPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, modal.oldPeerId) : undefined;
  const newPeer = modal?.newPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, modal.newPeerId) : undefined;
  return {
    oldPeer,
    newPeer
  };
})(GiftAuctionChangeRecipientModal)));

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionInfoModal.module.scss":
/*!*****************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionInfoModal.module.scss ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"BYvGxmfu","iconWrapper":"X5HEn2ho","icon":"aiSlk9Zw","title":"obG607lY","subtitle":"wKo4cuID","footer":"M_SnCV2j","understoodIcon":"OQCwJP3j"});

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionInfoModal.tsx":
/*!*********************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionInfoModal.tsx ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableAboutModal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/TableAboutModal */ "./src/components/modals/common/TableAboutModal.tsx");
/* harmony import */ var _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./GiftAuctionInfoModal.module.scss */ "./src/components/modals/gift/auction/GiftAuctionInfoModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");










const GiftAuctionInfoModal = ({
  modal,
  giftAuction
}) => {
  const {
    closeGiftAuctionInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const isOpen = Boolean(modal && giftAuction);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    closeGiftAuctionInfoModal();
  });
  const header = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div", {
      className: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div", {
        className: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].iconWrapper,
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_5__["default"], {
          name: "auction-filled",
          className: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].icon
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div", {
        className: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].title,
        children: lang('GiftAuctionInfoTitle')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div", {
        className: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].subtitle,
        children: lang('GiftAuctionInfoSubtitle')
      })]
    });
  }, [lang]);
  const footer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div", {
      className: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].footer,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_6__["default"], {
        iconName: "understood",
        iconClassName: _GiftAuctionInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].understoodIcon,
        onClick: handleClose,
        children: lang('ButtonUnderstood')
      })
    });
  }, [lang, isOpen, handleClose]);
  const listItemData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const count = giftAuction?.gift.giftsPerRound || 0;
    return [['auction-drop', lang('GiftAuctionInfoTopBiddersTitle', {
      count
    }, {
      pluralValue: count
    }), lang('GiftAuctionInfoTopBiddersSubtitle', {
      count
    }, {
      pluralValue: count
    })], ['auction-next-round', lang('GiftAuctionInfoBidCarryoverTitle'), lang('GiftAuctionInfoBidCarryoverSubtitle', {
      count
    })], ['stars-refund', lang('GiftAuctionInfoMissedBiddersTitle'), lang('GiftAuctionInfoMissedBiddersSubtitle')]];
  }, [lang, giftAuction]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_TableAboutModal__WEBPACK_IMPORTED_MODULE_7__["default"], {
    isOpen: isOpen,
    header: header,
    listItemData: listItemData,
    footer: footer,
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    giftAuctionInfoModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const auctionGiftId = giftAuctionInfoModal?.auctionGiftId;
  return {
    giftAuction: auctionGiftId ? global.giftAuctionByGiftId?.[auctionGiftId] : undefined
  };
})(GiftAuctionInfoModal)));

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionModal.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionModal.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"rCVinZx6","modalContent":"MAEILhFp","header":"lTDjKYuV","title":"_tvAimMQ","description":"X88e7g62","finishedBadge":"pC_V4Juh","giftName":"AwBqE6Vc","footer":"kVyu9ZRp","itemsBoughtLink":"GwhTY_Uw","itemsBoughtSticker":"H4JSQGvw","footerButton":"QgTA5Tm_","buttonSubtitle":"XV66UlTa","starIcon":"Ui25Ac3P","learnMoreLink":"xv_0WTej"});

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionModal.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionModal.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_dates_units__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/dates/units */ "./src/util/dates/units.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_TextTimer__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../ui/TextTimer */ "./src/components/ui/TextTimer.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _GiftItemStar__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../GiftItemStar */ "./src/components/modals/gift/GiftItemStar.tsx");
/* harmony import */ var _UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./GiftAuctionModal.module.scss */ "./src/components/modals/gift/auction/GiftAuctionModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
























const TEXT_TIMER_THRESHOLD = 48 * _util_dates_units__WEBPACK_IMPORTED_MODULE_6__.HOUR;
const PREVIEW_UPDATE_INTERVAL = 3000;
const GiftAuctionModal = ({
  modal,
  auctionState
}) => {
  const {
    closeGiftAuctionModal,
    setGiftModalSelectedGift,
    openGiftAuctionInfoModal,
    openGiftAuctionAcquiredModal,
    openAboutStarGiftModal,
    showNotification,
    openChatWithDraft,
    openUrl,
    openGiftInMarket
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__["default"])(modal);
  const renderingAuctionState = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__["default"])(auctionState);
  const gift = renderingAuctionState?.gift;
  const state = renderingAuctionState?.state;
  const userState = renderingAuctionState?.userState;
  const isFinished = state?.type === 'finished';
  const [previewAttributes, setPreviewAttributes] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const shouldUseUniqueHeader = Boolean(gift && state && previewAttributes);
  const uniqueHeaderRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const updatePreviewAttributes = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!renderingModal?.sampleAttributes) return;
    setPreviewAttributes((0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__.getRandomGiftPreviewAttributes)(renderingModal.sampleAttributes, previewAttributes));
  });
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_10__["default"])(updatePreviewAttributes, isOpen ? PREVIEW_UPDATE_INTERVAL : undefined, true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen) {
      if (renderingModal?.sampleAttributes) {
        updatePreviewAttributes();
      } else {
        setPreviewAttributes(undefined);
      }
    }
  }, [isOpen, renderingModal?.sampleAttributes]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const attributes = renderingModal?.sampleAttributes;
    if (!attributes) return;
    (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__.preloadGiftAttributeStickers)(attributes);
  }, [renderingModal?.sampleAttributes]);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => closeGiftAuctionModal());
  const handleLearnMoreClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!gift) return;
    openGiftAuctionInfoModal({
      auctionGiftId: gift.id
    });
  });
  const handleLearnMoreAboutGiftsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    openAboutStarGiftModal({});
  });
  const handleItemsBoughtClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!gift) return;
    const giftSticker = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__.getStickerFromGift)(gift);
    openGiftAuctionAcquiredModal({
      giftId: gift.id,
      giftTitle: gift.title,
      giftSticker
    });
  });
  const handleJoinClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!gift) return;
    closeGiftAuctionModal({
      shouldKeepAuction: true
    });
    setGiftModalSelectedGift({
      gift
    });
  });
  const auctionLink = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!gift?.auctionSlug) return undefined;
    return `${_config__WEBPACK_IMPORTED_MODULE_2__.TME_LINK_PREFIX}auction/${gift.auctionSlug}`;
  }, [gift]);
  const handleCopyLink = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!auctionLink) return;
    (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_4__.copyTextToClipboard)(auctionLink);
    showNotification({
      message: lang('LinkCopied')
    });
  });
  const handleShareLink = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!auctionLink) return;
    openChatWithDraft({
      text: {
        text: auctionLink
      }
    });
  });
  const handleOpenFragment = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (state?.type === 'finished' && state.fragmentListedUrl) {
      openUrl({
        url: state.fragmentListedUrl
      });
    }
  });
  const handleOpenTelegramMarket = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!gift) return;
    handleClose();
    openGiftInMarket({
      gift
    });
  });
  const uniqueHeader = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!shouldUseUniqueHeader) {
      return undefined;
    }
    const giftTitle = gift.title || lang('StarGift');
    const badge = isFinished ? lang('GiftAuctionEnded') : lang('GiftAuctionInfoTitle');
    const subtitle = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].learnMoreLink,
      isPrimary: true,
      onClick: handleLearnMoreAboutGiftsClick,
      children: lang('GiftAuctionLearnMoreAboutGifts')
    });
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("div", {
      ref: uniqueHeaderRef,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_21__["default"], {
        modelAttribute: previewAttributes.model,
        backdropAttribute: previewAttributes.backdrop,
        patternAttribute: previewAttributes.pattern,
        title: giftTitle,
        badge: badge,
        subtitle: subtitle
      })
    });
  }, [shouldUseUniqueHeader, gift, isFinished, lang, previewAttributes, handleLearnMoreAboutGiftsClick]);
  const regularHeader = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!gift || !state || shouldUseUniqueHeader) {
      return undefined;
    }
    const giftTitle = gift.title || lang('StarGift');
    const giftsPerRound = gift.giftsPerRound || 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div", {
      className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_20__["default"], {
        gift: gift,
        hideBadge: true,
        noClickable: true
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("h1", {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].title,
        children: giftTitle
      }), isFinished ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("span", {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].finishedBadge,
        children: lang('GiftAuctionEnded')
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("p", {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].description,
        children: lang('GiftAuctionTopBidders', {
          count: giftsPerRound,
          gift: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("span", {
            className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].giftName,
            children: giftTitle
          }),
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_16__["default"], {
            isPrimary: true,
            onClick: handleLearnMoreClick,
            children: lang('GiftAuctionLearnMore')
          })
        }, {
          pluralValue: giftsPerRound,
          withNodes: true,
          withMarkdown: true
        })
      })]
    });
  }, [gift, state, shouldUseUniqueHeader, isFinished, lang, handleLearnMoreClick]);
  const header = uniqueHeader || regularHeader;
  const modalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!gift || !state || !userState) {
      return undefined;
    }
    const tableData = [];
    tableData.push([lang('GiftAuctionStarted'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatDateTimeToString)(state.startDate * 1000, lang.code, true)]);
    tableData.push([lang('GiftAuctionEnds'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatDateTimeToString)(state.endDate * 1000, lang.code, true)]);
    if (gift.availabilityTotal) {
      tableData.push([lang('GiftInfoAvailability'), lang('GiftInfoAvailabilityValue', {
        count: gift.availabilityRemains || 0,
        total: lang.number(gift.availabilityTotal)
      }, {
        pluralValue: gift.availabilityRemains || 0
      })]);
    }
    if (state.type === 'active') {
      tableData.push([lang('GiftAuctionCurrentRound'), lang('GiftAuctionRoundValue', {
        current: lang.number(state.currentRound),
        total: lang.number(state.totalRounds)
      })]);
    }
    if (isFinished) {
      tableData.push([lang('GiftAuctionAveragePrice'), (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatStarsAsIcon)(lang, state.averagePrice, {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].starIcon
      })]);
    }
    const acquiredCount = userState.acquiredCount;
    const giftSticker = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__.getStickerFromGift)(gift);
    const auctionTimeLeft = state.endDate - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_8__.getServerTime)();
    const shouldUseTextTimer = auctionTimeLeft > 0 && auctionTimeLeft < TEXT_TIMER_THRESHOLD;
    const canBuyOnFragment = state.type === 'finished' && Boolean(state.fragmentListedUrl && state.fragmentListedCount);
    const canBuyOnTelegram = state.type === 'finished' && Boolean(state.listedCount);
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div", {
      className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].footer,
      children: [acquiredCount > 0 && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].itemsBoughtLink,
        isPrimary: true,
        onClick: handleItemsBoughtClick,
        children: lang('GiftAuctionItemsBought', {
          count: acquiredCount,
          gift: giftSticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
            className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].itemsBoughtSticker,
            sticker: giftSticker,
            size: 20,
            play: false
          })
        }, {
          pluralValue: acquiredCount,
          withNodes: true
        })
      }), canBuyOnFragment && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].itemsBoughtLink,
        isPrimary: true,
        onClick: handleOpenFragment,
        children: lang('GiftAuctionForSaleOnFragment', {
          count: giftSticker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment, {
            children: [lang.number(state.fragmentListedCount), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
              className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].itemsBoughtSticker,
              sticker: giftSticker,
              size: 20,
              play: false
            })]
          }) : lang.number(state.fragmentListedCount)
        }, {
          withNodes: true
        })
      }), canBuyOnTelegram && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].itemsBoughtLink,
        isPrimary: true,
        onClick: handleOpenTelegramMarket,
        children: lang('GiftAuctionForSaleOnTelegram', {
          count: giftSticker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment, {
            children: [lang.number(state.listedCount), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
              className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].itemsBoughtSticker,
              sticker: giftSticker,
              size: 20,
              play: false
            })]
          }) : lang.number(state.listedCount)
        }, {
          withNodes: true
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
        noForcedUpperCase: true,
        className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].footerButton,
        onClick: isFinished ? handleClose : handleJoinClick,
        children: isFinished ? lang('OK') : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div", {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("div", {
            children: lang('GiftAuctionJoin')
          }), auctionTimeLeft > 0 && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("div", {
            className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].buttonSubtitle,
            children: lang('GiftAuctionTimeLeft', {
              time: shouldUseTextTimer ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_TextTimer__WEBPACK_IMPORTED_MODULE_18__["default"], {
                endsAt: state.endDate
              }) : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatCountdown)(lang, auctionTimeLeft)
            }, {
              withNodes: true
            })
          })]
        })
      })]
    });
    return {
      tableData,
      footer
    };
  }, [gift, state, userState, isFinished, lang, handleJoinClick, handleItemsBoughtClick, handleClose, handleOpenFragment, handleOpenTelegramMarket]);
  const moreMenuItems = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!shouldUseUniqueHeader) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
        icon: "info",
        onClick: handleLearnMoreClick,
        children: lang('GiftAuctionLearnMoreMenuItem')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
        icon: "link-badge",
        onClick: handleCopyLink,
        children: lang('CopyLink')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
        icon: "forward",
        onClick: handleShareLink,
        children: lang('Share')
      })]
    });
  }, [shouldUseUniqueHeader, lang, handleLearnMoreClick, handleCopyLink, handleShareLink]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_19__["default"], {
    isOpen: isOpen,
    header: header,
    footer: modalData?.footer,
    tableData: modalData?.tableData,
    className: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].modal,
    contentClassName: _GiftAuctionModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].modalContent,
    closeButtonColor: shouldUseUniqueHeader ? 'translucent-white' : undefined,
    moreMenuItems: moreMenuItems,
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    giftAuctionModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const auctionGiftId = giftAuctionModal?.auctionGiftId;
  return {
    auctionState: auctionGiftId ? global.giftAuctionByGiftId?.[auctionGiftId] : undefined
  };
})(GiftAuctionModal)));

/***/ }),

/***/ "./src/components/modals/gift/info/GiftInfoModal.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/info/GiftInfoModal.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"nnublcCk","checkBox":"fjE0wGvw","checkBoxDescription":"tepUTe4z","upgradeIcon":"lgyInH5K","descriptionConfirm":"BJh2Tufh","titleConfirm":"gA102W1G","header":"p7FTs7_p","title":"pIbzzTir","description":"CCPfr26t","warningDescription":"eEsRJVa1","modalContent":"o9rFZ6By","moreMenuButton":"EMwExRMy","closeButton":"jQv0ZSEW","giftResalePriceContainer":"BN8gf5y6","starAmountIcon":"_5guecUe","giftResalePriceStar":"H_q8o2vY","headerButton":"WA0INleU","left":"aOhTHZlf","right":"rJOB1u5Q","footer":"bho0GTYt","footerDescription":"VUylTszM","footerHint":"mxS8kDnA","buyButton":"i1MmnrPG","unknown":"zDauXmpS","giftValue":"w_E4LkUj","uniqueValue":"uAjIRJva","uniqueAttribute":"OJQnkf17","attributeName":"dq7wCHJb","uniqueGift":"I6o_pGAm","modalHeader":"ie9tImaj","modalCloseButton":"p38RBGdC","ownerAddress":"DavMRg4Q","copyIcon":"SLX5tX8C","messageContainer":"oW5T3mkV","removeMessageButton":"TrW2LVm5"});

/***/ }),

/***/ "./src/components/modals/gift/info/GiftInfoModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/gift/info/GiftInfoModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_helpers_users__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/helpers/users */ "./src/global/helpers/users.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_giftOriginalInfo__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../common/helpers/giftOriginalInfo */ "./src/components/common/helpers/giftOriginalInfo.tsx");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _common_gift_GiftMenuItems__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../common/gift/GiftMenuItems */ "./src/components/common/gift/GiftMenuItems.tsx");
/* harmony import */ var _common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../../common/gift/GiftTransferPreview */ "./src/components/common/gift/GiftTransferPreview.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./GiftInfoModal.module.scss */ "./src/components/modals/gift/info/GiftInfoModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






































const STICKER_SIZE = 120;
const GiftInfoModal = ({
  modal,
  fromPeer,
  targetPeer,
  releasedByPeer,
  currentUserId,
  starGiftMaxConvertPeriod,
  hasAdminRights,
  currentUserEmojiStatus,
  collectibleEmojiStatuses,
  tonExplorerUrl,
  currentUser,
  recipientPeer
}) => {
  const {
    closeGiftInfoModal,
    changeGiftVisibility,
    convertGiftToStars,
    openChatWithInfo,
    focusMessage,
    openGiftUpgradeModal,
    showNotification,
    buyStarGift,
    closeGiftModal,
    openGiftInfoValueModal,
    updateResaleGiftsFilter,
    openGiftInMarket,
    openGiftDescriptionRemoveModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isConvertConfirmOpen, openConvertConfirm, closeConvertConfirm] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_20__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const [isConfirmModalOpen, setIsConfirmModalOpen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPayInTon, setShouldPayInTon] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const uniqueGiftHeaderRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const handleSymbolClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!gift || !giftAttributes?.pattern) return;
    openGiftInMarket({
      gift
    });
    updateResaleGiftsFilter({
      filter: {
        sortType: 'byDate',
        modelAttributes: [],
        backdropAttributes: [],
        patternAttributes: [{
          type: 'pattern',
          documentId: giftAttributes.pattern.sticker.id
        }]
      }
    });
  });
  const handleBackdropClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!gift || !giftAttributes?.backdrop) return;
    openGiftInMarket({
      gift
    });
    updateResaleGiftsFilter({
      filter: {
        sortType: 'byDate',
        modelAttributes: [],
        backdropAttributes: [{
          type: 'backdrop',
          backdropId: giftAttributes.backdrop.backdropId
        }],
        patternAttributes: []
      }
    });
  });
  const handleModelClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!gift || !giftAttributes?.model) return;
    openGiftInMarket({
      gift
    });
    updateResaleGiftsFilter({
      filter: {
        sortType: 'byDate',
        modelAttributes: [{
          type: 'model',
          documentId: giftAttributes.model.sticker.id
        }],
        backdropAttributes: [],
        patternAttributes: []
      }
    });
  });
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_18__["default"])(modal);
  const renderingFromPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_18__["default"])(fromPeer);
  const renderingTargetPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_18__["default"])(targetPeer);
  const isTargetChat = renderingTargetPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerChat)(renderingTargetPeer);
  const {
    gift: typeGift
  } = renderingModal || {};
  const isSavedGift = typeGift && 'gift' in typeGift;
  const savedGift = isSavedGift ? typeGift : undefined;
  const isSender = savedGift?.fromId === currentUserId;
  const canConvertDifference = savedGift && starGiftMaxConvertPeriod && savedGift.date + starGiftMaxConvertPeriod - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_13__.getServerTime)() || 0;
  const conversionLeft = Math.ceil(canConvertDifference / 60 / 60 / 24);
  const gift = isSavedGift ? typeGift.gift : typeGift;
  const giftSticker = gift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_16__.getStickerFromGift)(gift);
  const hasConvertOption = canConvertDifference > 0 && Boolean(savedGift?.starsToConvert);
  const isGiftUnique = gift && gift.type === 'starGiftUnique';
  const uniqueGift = isGiftUnique ? gift : undefined;
  const giftSubtitle = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!gift || gift.type !== 'starGiftUnique') return undefined;
    if (releasedByPeer) {
      const releasedByUsername = `@${(0,_global_helpers_users__WEBPACK_IMPORTED_MODULE_5__.getMainUsername)(releasedByPeer)}`;
      const ownerTitle = releasedByUsername || (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, releasedByPeer);
      const fallbackText = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerUser)(releasedByPeer) ? lang('ActionFallbackUser') : lang('ActionFallbackChannel');
      return lang('GiftInfoCollectibleBy', {
        number: gift.number,
        owner: ownerTitle || fallbackText
      }, {
        withNodes: true,
        withMarkdown: true
      });
    }
    return lang('GiftInfoCollectible', {
      number: gift.number
    });
  }, [gift, releasedByPeer, lang]);
  const starGiftUniqueSlug = gift?.type === 'starGiftUnique' ? gift.slug : undefined;
  const selfCollectibleStatus = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUniqueSlug) return undefined;
    return collectibleEmojiStatuses?.find(status => status.type === 'collectible' && status.slug === starGiftUniqueSlug);
  }, [starGiftUniqueSlug, collectibleEmojiStatuses]);
  const isSelfUnique = Boolean(selfCollectibleStatus);
  const canFocusUpgrade = Boolean(savedGift?.upgradeMsgId);
  const canManage = !canFocusUpgrade && savedGift?.inputGift && (isTargetChat ? hasAdminRights : gift?.type === 'starGift' ? renderingTargetPeer?.id === currentUserId : gift?.ownerId === currentUserId || isSelfUnique);
  function getResalePrice(isInTon) {
    if (!isGiftUnique) return undefined;
    const amounts = gift.resellPrice;
    if (!amounts) return undefined;
    if (gift?.resaleTonOnly || isInTon) {
      return amounts.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE);
    }
    return amounts.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE);
  }
  const resellPrice = getResalePrice();
  const confirmPrice = getResalePrice(shouldPayInTon);
  const resellPriceInStars = resellPrice?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE && isGiftUnique ? gift.resellPrice?.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE) : undefined;
  const canBuyGift = !isSelfUnique && gift?.type === 'starGiftUnique' && gift.ownerId !== currentUserId && Boolean(resellPrice);
  const giftOwnerTitle = (() => {
    if (!isGiftUnique) return undefined;
    const {
      ownerName,
      ownerId
    } = gift;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(); // Peer titles do not need to be reactive
    const owner = ownerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, ownerId) : undefined;
    return owner ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, owner) : ownerName;
  })();
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    closeGiftInfoModal();
  });
  const handleFocusUpgraded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    const giftChat = isSender ? renderingTargetPeer : renderingFromPeer;
    if (!savedGift?.upgradeMsgId || !giftChat) return;
    const {
      upgradeMsgId
    } = savedGift;
    focusMessage({
      chatId: giftChat.id,
      messageId: upgradeMsgId
    });
    handleClose();
  });
  const handleTriggerVisibility = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    const {
      inputGift,
      isUnsaved
    } = savedGift;
    changeGiftVisibility({
      gift: inputGift,
      shouldUnsave: !isUnsaved
    });
    handleClose();
  });
  const handleConvertToStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    const {
      inputGift
    } = savedGift;
    convertGiftToStars({
      gift: inputGift
    });
    closeConvertConfirm();
    handleClose();
  });
  const handleRemoveMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!savedGift?.inputGift || !savedGift.dropOriginalDetailsStars || !gift || !giftAttributes) return;
    const {
      originalDetails
    } = giftAttributes;
    if (!originalDetails) return;
    openGiftDescriptionRemoveModal({
      gift: savedGift,
      price: savedGift.dropOriginalDetailsStars,
      details: originalDetails
    });
  });
  const handleOpenUpgradeModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!savedGift) return;
    const giftOwnerId = renderingTargetPeer?.id;
    openGiftUpgradeModal({
      giftId: savedGift.gift.id,
      gift: savedGift,
      peerId: giftOwnerId
    });
  });
  const handleBuyGift = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (gift?.type !== 'starGiftUnique' || !getResalePrice()) return;
    setIsConfirmModalOpen(true);
  });
  const closeConfirmModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    setIsConfirmModalOpen(false);
  });
  const handleConfirmBuyGift = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    const peer = recipientPeer || currentUser;
    const price = getResalePrice(shouldPayInTon);
    if (!peer || !price || gift?.type !== 'starGiftUnique') return;
    closeConfirmModal();
    closeGiftModal();
    buyStarGift({
      peerId: peer.id,
      slug: gift.slug,
      price
    });
  });
  const handleOpenValueModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!gift || gift.type !== 'starGiftUnique') return;
    openGiftInfoValueModal({
      gift
    });
  });
  const giftAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return gift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_16__.getGiftAttributes)(gift);
  }, [gift]);
  const renderFooterButton = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (canBuyGift) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].buyButton,
        onClick: handleBuyGift,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          children: lang('ButtonBuyGift', {
            stars: resellPrice?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatTonAsIcon)(lang, resellPrice.amount, {
              shouldConvertFromNanos: true
            }) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsIcon)(lang, resellPrice?.amount, {
              asFont: true
            })
          }, {
            withNodes: true
          })
        }), resellPrice?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE && Boolean(resellPriceInStars) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].footerHint,
          children: lang('GiftBuyEqualsTo', {
            stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsIcon)(lang, resellPriceInStars.amount, {
              asFont: true
            })
          }, {
            withNodes: true
          })
        })]
      });
    }
    if (canFocusUpgrade) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
        onClick: handleFocusUpgraded,
        children: lang('GiftInfoViewUpgraded')
      });
    }
    if (canManage && savedGift?.alreadyPaidUpgradeStars && !savedGift.upgradeMsgId) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
        isShiny: true,
        onClick: handleOpenUpgradeModal,
        iconName: "arrow-down-circle",
        iconClassName: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].upgradeIcon,
        iconAlignment: "end",
        children: lang('GiftInfoUpgradeForFree')
      });
    }
    if (canManage && savedGift?.canUpgrade && !savedGift.upgradeMsgId) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
        isShiny: true,
        onClick: handleOpenUpgradeModal,
        iconName: "arrow-down-circle",
        iconClassName: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].upgradeIcon,
        iconAlignment: "end",
        children: lang('GiftInfoUpgrade')
      });
    }
    if (savedGift?.prepaidUpgradeHash) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
        isShiny: true,
        onClick: handleOpenUpgradeModal,
        iconName: "arrow-down-circle",
        iconClassName: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].upgradeIcon,
        iconAlignment: "end",
        children: lang('GiftAnUpgradeButton')
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
      onClick: handleClose,
      children: lang('OK')
    });
  });
  const saleDateInfo = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!gift) return undefined;
    let text = '';
    if (gift.type === 'starGift') {
      if (gift.firstSaleDate) {
        text += `${lang('GiftInfoFirstSale')} ${(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateTimeToString)(gift.firstSaleDate * 1000, lang.code, true)}`;
      }
      if (gift.lastSaleDate) {
        text += '\n';
        text += `${lang('GiftInfoLastSale')} ${(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateTimeToString)(gift.lastSaleDate * 1000, lang.code, true)}`;
      }
    }
    return text;
  }, [gift, lang]);
  const modalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!typeGift || !gift) {
      return undefined;
    }
    const {
      fromId,
      isNameHidden,
      starsToConvert,
      isUnsaved,
      isConverted,
      upgradeMsgId
    } = savedGift || {};
    const canConvert = hasConvertOption && Boolean(starsToConvert);
    const isVisibleForMe = isNameHidden && renderingTargetPeer;
    const isWarningDescription = savedGift?.isRefunded || !savedGift && gift?.type === 'starGift';
    const description = (() => {
      if (!savedGift) return lang('GiftInfoSoldOutDescription');
      if (isTargetChat) return undefined;
      if (savedGift.isRefunded) return lang('GiftInfoDescriptionRefunded');
      if (savedGift.upgradeMsgId) return lang('GiftInfoDescriptionUpgraded');
      if (canManage && savedGift.canUpgrade && savedGift.alreadyPaidUpgradeStars && !savedGift.upgradeMsgId) {
        return lang('GiftInfoDescriptionUpgrade2');
      }
      if (savedGift.canUpgrade && canManage) {
        return canManage ? lang('GiftInfoDescriptionFreeUpgrade') : lang('GiftInfoPeerDescriptionFreeUpgradeOut', {
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, renderingTargetPeer)
        });
      }
      if (!canManage && !isSender) return undefined;
      if (isConverted && canConvert) {
        return canManage ? lang('GiftInfoDescriptionConverted', {
          amount: starsToConvert
        }, {
          pluralValue: starsToConvert,
          withNodes: true,
          withMarkdown: true
        }) : lang('GiftInfoPeerDescriptionOutConverted', {
          amount: starsToConvert,
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, renderingTargetPeer)
        }, {
          pluralValue: starsToConvert,
          withNodes: true,
          withMarkdown: true
        });
      }
      if (savedGift.canUpgrade && canManage) {
        if (canConvert) {
          return lang('GiftInfoDescriptionUpgrade', {
            amount: starsToConvert
          }, {
            pluralValue: starsToConvert,
            withNodes: true,
            withMarkdown: true
          });
        }
        return lang('GiftInfoDescriptionUpgradeRegular');
      }
      if (canManage) {
        if (canConvert) {
          return lang('GiftInfoDescription', {
            amount: starsToConvert
          }, {
            withNodes: true,
            withMarkdown: true,
            pluralValue: starsToConvert
          });
        }
        return lang('GiftInfoDescriptionRegular');
      }
      if (canConvert) {
        return lang('GiftInfoPeerDescriptionOut', {
          amount: starsToConvert,
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, renderingTargetPeer)
        }, {
          withNodes: true,
          withMarkdown: true,
          pluralValue: starsToConvert
        });
      }
      return lang('GiftInfoPeerDescriptionOutRegular', {
        peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, renderingTargetPeer)
      });
    })();
    function getTitle() {
      if (isGiftUnique) return gift.title;
      if (!savedGift) return lang('GiftInfoSoldOutTitle');
      return canManage ? lang('GiftInfoReceived') : lang('GiftInfoTitle');
    }
    const uniqueGiftModalHeader = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("div", {
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].modalHeader,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].closeButton,
        round: true,
        color: "translucent-white",
        size: "tiny",
        iconName: "close",
        ariaLabel: lang('Close'),
        onClick: handleClose
      }), Boolean(resellPrice?.amount) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].giftResalePriceContainer,
        children: resellPrice.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatTonAsIcon)(lang, resellPrice.amount, {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].giftResalePriceStar,
          shouldConvertFromNanos: true
        }) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsIcon)(lang, resellPrice.amount, {
          asFont: true,
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].giftResalePriceStar
        })
      })]
    });
    const uniqueGiftHeader = isGiftUnique && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
      ref: uniqueGiftHeaderRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].header, _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].uniqueGift),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_35__["default"], {
        backdropAttribute: giftAttributes.backdrop,
        patternAttribute: giftAttributes.pattern,
        modelAttribute: giftAttributes.model,
        title: gift.title,
        subtitle: giftSubtitle,
        subtitlePeer: releasedByPeer,
        showManageButtons: canManage,
        savedGift: savedGift
      })
    });
    const regularHeader = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("div", {
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_23__["default"], {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].giftSticker,
        sticker: giftSticker,
        size: STICKER_SIZE
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("h1", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].title,
        children: getTitle()
      }), Boolean(description) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("p", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].description, isWarningDescription && _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].warningDescription),
        children: description
      })]
    });
    const tableData = [];
    if (gift.type === 'starGift') {
      const hasFrom = fromId || isNameHidden;
      if (hasFrom) {
        tableData.push([lang('GiftInfoFrom'), !fromId ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_24__["default"], {
            size: "small",
            peer: _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_12__.CUSTOM_PEER_HIDDEN
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("span", {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].unknown,
            children: oldLang(_util_objects_customPeer__WEBPACK_IMPORTED_MODULE_12__.CUSTOM_PEER_HIDDEN.titleKey)
          })]
        }) : {
          chatId: fromId
        }]);
      }
      if (savedGift?.date) {
        tableData.push([lang('GiftInfoDate'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("span", {
          title: saleDateInfo,
          children: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateTimeToString)(savedGift.date * 1000, lang.code, true)
        })]);
      }
      if (gift.firstSaleDate && !savedGift) {
        tableData.push([lang('GiftInfoFirstSale'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateTimeToString)(gift.firstSaleDate * 1000, lang.code, true)]);
      }
      if (gift.lastSaleDate && !savedGift) {
        tableData.push([lang('GiftInfoLastSale'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateTimeToString)(gift.lastSaleDate * 1000, lang.code, true)]);
      }
      const starsValue = gift.stars + (savedGift?.alreadyPaidUpgradeStars || 0);
      tableData.push([lang('GiftInfoValue'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].giftValue,
        children: [(0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsIcon)(lang, starsValue, {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].starAmountIcon
        }), canManage && hasConvertOption && Boolean(starsToConvert) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_25__["default"], {
          onClick: openConvertConfirm,
          children: lang('GiftInfoConvert', {
            amount: starsToConvert
          }, {
            pluralValue: starsToConvert
          })
        })]
      })]);
      if (gift.availabilityTotal) {
        tableData.push([lang('GiftInfoAvailability'), lang('GiftInfoAvailabilityValue', {
          count: gift.availabilityRemains || 0,
          total: gift.availabilityTotal
        }, {
          pluralValue: gift.availabilityRemains || 0
        })]);
      }
      if (gift.upgradeStars && !upgradeMsgId) {
        tableData.push([lang('GiftInfoStatus'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].giftValue,
          children: lang('GiftInfoStatusNonUnique')
        })]);
      }
      if (savedGift?.message) {
        tableData.push([undefined, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_17__.renderTextWithEntities)(savedGift.message)]);
      }
    }
    if (isGiftUnique) {
      const {
        ownerName,
        ownerAddress,
        ownerId
      } = gift;
      const ownerPeer = ownerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), ownerId) : undefined;
      const {
        model,
        backdrop,
        pattern,
        originalDetails
      } = giftAttributes || {};
      if (ownerAddress) {
        tableData.push([lang('GiftInfoOwner'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].ownerAddress,
          onClick: () => {
            (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_8__.copyTextToClipboard)(ownerAddress);
            showNotification({
              message: {
                key: 'WalletAddressCopied'
              },
              icon: 'copy'
            });
          },
          children: [ownerAddress, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].copyIcon,
            name: "copy"
          })]
        })]);
      } else if (ownerPeer || ownerName) {
        tableData.push([lang('GiftInfoOwner'), ownerId ? {
          chatId: ownerId,
          withEmojiStatus: true
        } : ownerName || '']);
      }
      if (model) {
        tableData.push([lang('GiftAttributeModel'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].uniqueAttribute,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("span", {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].attributeName,
            onClick: handleModelClick,
            children: model.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_25__["default"], {
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_14__.formatPercent)(model.rarityPercent)
          })]
        })]);
      }
      if (backdrop) {
        tableData.push([lang('GiftAttributeBackdrop'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].uniqueAttribute,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("span", {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].attributeName,
            onClick: handleBackdropClick,
            children: backdrop.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_25__["default"], {
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_14__.formatPercent)(backdrop.rarityPercent)
          })]
        })]);
      }
      if (pattern) {
        tableData.push([lang('GiftAttributeSymbol'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].uniqueAttribute,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("span", {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].attributeName,
            onClick: handleSymbolClick,
            children: pattern.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_25__["default"], {
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_14__.formatPercent)(pattern.rarityPercent)
          })]
        })]);
      }
      tableData.push([lang('GiftInfoAvailability'), lang('GiftInfoIssued', {
        issued: gift.issuedCount,
        total: gift.totalCount
      })]);
      if (gift.valueAmount && gift.valueCurrency) {
        tableData.push([lang('GiftInfoValue'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].uniqueValue,
          children: ["~", ' ', (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_10__.formatCurrencyAsString)(gift.valueAmount, gift.valueCurrency, lang.code), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_25__["default"], {
            onClick: handleOpenValueModal,
            children: lang('GiftInfoValueLinkMore')
          })]
        })]);
      }
      if (originalDetails) {
        const {
          recipientId,
          senderId
        } = originalDetails;
        const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(); // Peer titles do not need to be reactive

        const openChat = id => {
          openChatWithInfo({
            id
          });
          closeGiftInfoModal();
        };
        const recipient = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, recipientId);
        const sender = senderId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, senderId) : undefined;
        const text = (0,_common_helpers_giftOriginalInfo__WEBPACK_IMPORTED_MODULE_15__.renderGiftOriginalInfo)({
          originalDetails,
          recipient,
          sender,
          onOpenChat: openChat,
          lang
        });
        tableData.push([undefined, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("div", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].messageContainer,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
            children: text
          }), Boolean(savedGift?.dropOriginalDetailsStars) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_30__["default"], {
            round: true,
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].removeMessageButton,
            size: "smaller",
            color: "translucent",
            ariaLabel: "Delete original details",
            onClick: handleRemoveMessage,
            iconName: "delete"
          })]
        })]);
      }
    }
    const tonLink = tonExplorerUrl && isGiftUnique && gift.giftAddress && `${tonExplorerUrl}${gift.giftAddress}`;
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("div", {
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].footer,
      children: [(canManage || tonLink || canBuyGift) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].footerDescription,
        children: [tonLink && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          children: lang('GiftInfoTonText', {
            link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_29__["default"], {
              url: tonLink,
              shouldSkipModal: true,
              text: lang('GiftInfoTonLinkText')
            })
          }, {
            withNodes: true
          })
        }), canManage && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          children: lang(`GiftInfo${isTargetChat ? 'Channel' : ''}${isUnsaved ? 'Hidden' : 'Saved'}`, {
            link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_33__["default"], {
              isPrimary: true,
              onClick: handleTriggerVisibility,
              children: lang(`GiftInfoSaved${isUnsaved ? 'Show' : 'Hide'}`)
            })
          }, {
            withNodes: true
          })
        }), !canBuyGift && isVisibleForMe && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          children: lang('GiftInfoSenderHidden')
        }), canBuyGift && giftOwnerTitle && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          children: lang('GiftInfoBuyGift', {
            user: giftOwnerTitle
          }, {
            withNodes: true
          })
        })]
      }), renderFooterButton()]
    });
    return {
      modalHeader: isGiftUnique ? uniqueGiftModalHeader : undefined,
      header: isGiftUnique ? uniqueGiftHeader : regularHeader,
      tableData,
      footer
    };
  }, [typeGift, savedGift, renderingTargetPeer, giftSticker, lang, canManage, hasConvertOption, isSender, oldLang, tonExplorerUrl, gift, giftAttributes, renderFooterButton, isTargetChat, isGiftUnique, saleDateInfo, canBuyGift, giftOwnerTitle, resellPrice, giftSubtitle, releasedByPeer, handleSymbolClick, handleBackdropClick, handleModelClick]);
  const moreMenuItems = typeGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_gift_GiftMenuItems__WEBPACK_IMPORTED_MODULE_26__["default"], {
    peerId: renderingModal.peerId,
    gift: typeGift,
    canManage: canManage,
    collectibleEmojiStatuses: collectibleEmojiStatuses,
    currentUserEmojiStatus: currentUserEmojiStatus
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.Fragment, {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_34__["default"], {
      isOpen: isOpen,
      modalHeader: modalData?.modalHeader,
      header: modalData?.header,
      hasBackdrop: isGiftUnique,
      tableData: modalData?.tableData,
      footer: modalData?.footer,
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].modal,
      contentClassName: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].modalContent,
      closeButtonColor: isGiftUnique ? 'translucent-white' : undefined,
      moreMenuItems: moreMenuItems,
      onClose: handleClose,
      withBalanceBar: Boolean(canBuyGift),
      currencyInBalanceBar: confirmPrice?.currency,
      isLowStackPriority: true
    }), uniqueGift && currentUser && Boolean(confirmPrice) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_32__["default"], {
      isOpen: isConfirmModalOpen,
      noDefaultTitle: true,
      onClose: closeConfirmModal,
      confirmLabel: lang('ButtonBuyGift', {
        stars: confirmPrice?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatTonAsIcon)(lang, confirmPrice.amount, {
          shouldConvertFromNanos: true
        }) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsIcon)(lang, confirmPrice.amount, {
          asFont: true
        })
      }, {
        withNodes: true
      }),
      confirmHandler: handleConfirmBuyGift,
      children: [uniqueGift.resaleTonOnly && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].descriptionConfirm,
        children: lang('ConfirmBuyGiftForTonDescription')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_27__["default"], {
        peer: recipientPeer || currentUser,
        gift: uniqueGift
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].titleConfirm,
        children: lang('TitleConfirmPayment')
      }), !recipientPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("p", {
        children: lang('GiftBuyConfirmDescription', {
          gift: lang('GiftUnique', {
            title: uniqueGift.title,
            number: uniqueGift.number
          }),
          stars: confirmPrice?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatTonAsText)(lang, confirmPrice.amount, true) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)(lang, confirmPrice.amount)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), recipientPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("p", {
        children: lang('GiftBuyForPeerConfirmDescription', {
          gift: lang('GiftUnique', {
            title: uniqueGift.title,
            number: uniqueGift.number
          }),
          stars: confirmPrice?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatTonAsText)(lang, confirmPrice.amount, true) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)(lang, confirmPrice.amount),
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, recipientPeer)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), !uniqueGift.resaleTonOnly && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_31__["default"], {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].checkBox,
          label: lang('LabelPayInTON'),
          checked: shouldPayInTon,
          onCheck: setShouldPayInTon
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_36__["default"].checkBoxDescription,
          children: lang('DescriptionPayInTON')
        })]
      })]
    }), savedGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_32__["default"], {
      isOpen: isConvertConfirmOpen,
      onClose: closeConvertConfirm,
      confirmHandler: handleConvertToStars,
      title: lang('GiftInfoConvertTitle'),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
        children: lang('GiftInfoPeerConvertDescription', {
          amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)(lang, savedGift.starsToConvert),
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, renderingFromPeer)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), hasConvertOption && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
        children: lang('GiftInfoConvertDescriptionPeriod', {
          count: conversionLeft
        }, {
          withNodes: true,
          withMarkdown: true,
          pluralValue: conversionLeft
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_37__.jsx)("div", {
        children: lang('GiftInfoConvertDescription2')
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const typeGift = modal?.gift;
  const isSavedGift = typeGift && 'gift' in typeGift;
  const currentUserId = global.currentUserId;
  const fromId = isSavedGift && typeGift.fromId;
  const fromPeer = fromId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, fromId) : undefined;
  const targetPeer = modal?.peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, modal.peerId) : undefined;
  const chat = targetPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerChat)(targetPeer) ? targetPeer : undefined;
  const hasAdminRights = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getHasAdminRight)(chat, 'postMessages');
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, currentUserId);
  const recipientPeer = modal?.recipientId && currentUserId !== modal.recipientId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, modal.recipientId) : undefined;
  const currentUserEmojiStatus = currentUser?.emojiStatus;
  const collectibleEmojiStatuses = global.collectibleEmojiStatuses?.statuses;
  const gift = isSavedGift ? typeGift.gift : typeGift;
  const releasedByPeerId = gift?.type === 'starGiftUnique' && gift.releasedByPeerId;
  const releasedByPeer = releasedByPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, releasedByPeerId) : undefined;
  return {
    fromPeer,
    targetPeer,
    releasedByPeer,
    currentUserId,
    starGiftMaxConvertPeriod: global.appConfig.starGiftMaxConvertPeriod,
    tonExplorerUrl: global.appConfig.tonExplorerUrl,
    hasAdminRights,
    currentUserEmojiStatus,
    collectibleEmojiStatuses,
    currentUser,
    recipientPeer
  };
})(GiftInfoModal)));

/***/ }),

/***/ "./src/components/modals/gift/locked/GiftLockedModal.module.scss":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/locked/GiftLockedModal.module.scss ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"AqB1qB8W","message":"pA8Bz4TW"});

/***/ }),

/***/ "./src/components/modals/gift/locked/GiftLockedModal.tsx":
/*!***************************************************************!*\
  !*** ./src/components/modals/gift/locked/GiftLockedModal.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GiftLockedModal_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./GiftLockedModal.module.scss */ "./src/components/modals/gift/locked/GiftLockedModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const GiftLockedModal = ({
  modal
}) => {
  const {
    closeLockedGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    closeLockedGiftModal();
  });
  const getMessageText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!modal) return '';
    if (modal.untilDate) {
      const timeRemaining = modal.untilDate ? modal.untilDate - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)() : 0;
      return lang('GiftLockedMessage', {
        relativeDate: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatShortDuration)(lang, timeRemaining)
      }, {
        withNodes: true,
        withMarkdown: true
      });
    }
    if (modal.reason) {
      return (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_4__.renderTextWithEntities)(modal.reason);
    }
    return lang('TitleGiftLocked');
  }, [modal, lang]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isOpen: Boolean(modal),
    className: "narrow",
    onClose: handleClose,
    title: lang('TitleGiftLocked'),
    headerClassName: _GiftLockedModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].header,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("p", {
      className: _GiftLockedModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].message,
      children: getMessageText()
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
      onClick: handleClose,
      children: lang('OK')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftLockedModal));

/***/ }),

/***/ "./src/components/modals/gift/message/GiftDescriptionRemoveModal.module.scss":
/*!***********************************************************************************!*\
  !*** ./src/components/modals/gift/message/GiftDescriptionRemoveModal.module.scss ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"confirmText":"LVOpBXUW","giftDescription":"FA1_yVBY"});

/***/ }),

/***/ "./src/components/modals/gift/message/GiftDescriptionRemoveModal.tsx":
/*!***************************************************************************!*\
  !*** ./src/components/modals/gift/message/GiftDescriptionRemoveModal.tsx ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _common_helpers_giftOriginalInfo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/helpers/giftOriginalInfo */ "./src/components/common/helpers/giftOriginalInfo.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _GiftDescriptionRemoveModal_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./GiftDescriptionRemoveModal.module.scss */ "./src/components/modals/gift/message/GiftDescriptionRemoveModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const GiftDescriptionRemoveModal = ({
  modal,
  senderPeer,
  recipientPeer
}) => {
  const {
    closeGiftDescriptionRemoveModal,
    removeGiftDescription,
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const renderingSenderPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(senderPeer);
  const renderingRecipientPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(recipientPeer);
  const openChatHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(id => {
    closeGiftDescriptionRemoveModal();
    openChat({
      id
    });
  });
  const handleConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!renderingModal?.gift.inputGift || !renderingModal.price) return;
    removeGiftDescription({
      gift: renderingModal.gift.inputGift,
      price: renderingModal.price
    });
  });
  if (!renderingModal || !renderingRecipientPeer) return undefined;
  const {
    price,
    details
  } = renderingModal;
  const description = (0,_common_helpers_giftOriginalInfo__WEBPACK_IMPORTED_MODULE_4__.renderGiftOriginalInfo)({
    originalDetails: details,
    recipient: renderingRecipientPeer,
    sender: renderingSenderPeer,
    onOpenChat: openChatHandler,
    lang
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isOpen: isOpen,
    title: lang('RemoveGiftDescriptionTitle'),
    onClose: closeGiftDescriptionRemoveModal,
    confirmLabel: lang('RemoveGiftDescriptionButton', {
      amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsIcon)(lang, price, {
        asFont: true
      })
    }, {
      withNodes: true
    }),
    confirmHandler: handleConfirm,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div", {
      className: _GiftDescriptionRemoveModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].confirmText,
      children: lang('RemoveGiftDescriptionConfirmText')
    }), Boolean(description) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div", {
      className: _GiftDescriptionRemoveModal_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].giftDescription,
      children: description
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const senderPeer = modal?.details.senderId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, modal.details.senderId) : undefined;
  const recipientPeer = modal?.details.recipientId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, modal.details.recipientId) : undefined;
  return {
    senderPeer,
    recipientPeer
  };
})(GiftDescriptionRemoveModal)));

/***/ }),

/***/ "./src/components/modals/gift/recipient/GiftRecipientPicker.module.scss":
/*!******************************************************************************!*\
  !*** ./src/components/modals/gift/recipient/GiftRecipientPicker.module.scss ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"W3JMs1YE","picker":"wOipz1Y_"});

/***/ }),

/***/ "./src/components/modals/gift/recipient/GiftRecipientPicker.tsx":
/*!**********************************************************************!*\
  !*** ./src/components/modals/gift/recipient/GiftRecipientPicker.tsx ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/pickers/PickerModal */ "./src/components/common/pickers/PickerModal.tsx");
/* harmony import */ var _GiftRecipientPicker_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GiftRecipientPicker.module.scss */ "./src/components/modals/gift/recipient/GiftRecipientPicker.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GiftRecipientPicker = ({
  modal,
  currentUserId,
  userIds
}) => {
  const {
    closeGiftRecipientPicker,
    openGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const isOpen = modal;
  const [searchQuery, setSearchQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const displayedUserIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const idsWithSelf = userIds ? userIds.concat(currentUserId) : undefined;
    const filteredPeerIds = idsWithSelf ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.filterPeersByQuery)({
      ids: idsWithSelf,
      query: searchQuery
    }) : [];
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_5__["default"])((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(filteredPeerIds).filter(peerId => {
      return (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanGift)(global, peerId);
    }), undefined, [currentUserId]);
  }, [currentUserId, searchQuery, userIds]);
  const handleSelectedUserIdsChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(selectedId => {
    openGiftModal({
      forUserId: selectedId
    });
    closeGiftRecipientPicker();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_9__["default"], {
    className: _GiftRecipientPicker_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root,
    isOpen: isOpen,
    onClose: closeGiftRecipientPicker,
    title: oldLang('GiftTelegramPremiumOrStarsTitle'),
    hasCloseButton: true,
    shouldAdaptToSearch: true,
    withFixedHeight: true,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_8__["default"], {
      className: _GiftRecipientPicker_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].picker,
      itemIds: displayedUserIds,
      filterValue: searchQuery,
      filterPlaceholder: oldLang('Search'),
      onSelectedIdChange: handleSelectedUserIdsChange,
      onFilterChange: setSearchQuery,
      isSearchable: true,
      withDefaultPadding: true,
      withStatus: true,
      forceShowSelf: true
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    currentUserId
  } = global;
  return {
    currentUserId,
    userIds: global.contactList?.userIds
  };
})(GiftRecipientPicker)));

/***/ }),

/***/ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.module.scss":
/*!************************************************************************************!*\
  !*** ./src/components/modals/gift/resale/GiftResalePriceComposerModal.module.scss ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"checkBoxDescription":"pWjQiY4m","inputPriceDescription":"SGFmA4kL","checkBox":"yt_nODdj","descriptionPrice":"r9R0VR_w","inputPrice":"ElDo1Bru"});

/***/ }),

/***/ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/gift/resale/GiftResalePriceComposerModal.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_InputText__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../ui/InputText */ "./src/components/ui/InputText.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./GiftResalePriceComposerModal.module.scss */ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");














const GiftResalePriceComposerModal = ({
  modal,
  starsStargiftResaleCommissionPermille,
  starsStargiftResaleAmountMin,
  starsStargiftResaleAmountMax,
  starsUsdWithdrawRate,
  tonStargiftResaleCommissionPermille,
  tonStargiftResaleAmountMin,
  tonStargiftResaleAmountMax,
  tonUsdRate
}) => {
  const {
    closeGiftResalePriceComposerModal,
    closeGiftInfoModal,
    updateStarGiftPrice,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const [price, setPrice] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const [isPriceInTon, setIsPriceInTon] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_4__["default"])(modal);
  const {
    gift: typeGift
  } = renderingModal || {};
  const isSavedGift = typeGift && 'gift' in typeGift;
  const savedGift = isSavedGift ? typeGift : undefined;
  const hasPrice = Boolean(price);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleChangePrice = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(e => {
    const value = e.target.value;
    const number = parseFloat(value);
    const maxAmount = isPriceInTon ? tonStargiftResaleAmountMax : starsStargiftResaleAmountMax;
    const result = value === '' || Number.isNaN(number) ? undefined : maxAmount ? Math.min(number, maxAmount) : number;
    setPrice(result);
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    closeGiftResalePriceComposerModal();
  });
  const handleSellGift = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!savedGift || savedGift.gift.type !== 'starGiftUnique' || !savedGift.inputGift || !price) return;
    closeGiftResalePriceComposerModal();
    closeGiftInfoModal();
    updateStarGiftPrice({
      gift: savedGift.inputGift,
      price: {
        currency: isPriceInTon ? 'TON' : 'XTR',
        amount: isPriceInTon ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__.convertTonToNanos)(price) : price,
        nanos: 0
      }
    });
    showNotification({
      icon: 'sell-outline',
      message: {
        key: 'NotificationGiftIsSale',
        variables: {
          gift: lang('GiftUnique', {
            title: savedGift.gift.title,
            number: savedGift.gift.number
          })
        }
      }
    });
  });
  const commission = isPriceInTon ? tonStargiftResaleCommissionPermille : starsStargiftResaleCommissionPermille;
  const minAmount = isPriceInTon ? tonStargiftResaleAmountMin : starsStargiftResaleAmountMin;
  const isPriceCorrect = hasPrice && price >= minAmount;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isOpen: isOpen,
    title: isPriceInTon ? lang('PriceInTON') : lang('PriceInStars'),
    hasCloseButton: true,
    isSlim: true,
    onClose: handleClose,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div", {
      className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].inputPrice,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ui_InputText__WEBPACK_IMPORTED_MODULE_9__["default"], {
        label: isPriceInTon ? lang('EnterPriceInTon') : lang('EnterPriceInStars'),
        onChange: handleChangePrice,
        value: price?.toString(),
        inputMode: "numeric",
        tabIndex: 0,
        teactExperimentControlled: !isPriceInTon
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
      className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].inputPriceDescription,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("span", {
        children: [!isPriceCorrect && Boolean(commission) && lang('DescriptionComposerGiftMinimumPrice', {
          stars: isPriceInTon ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatTonAsText)(lang, minAmount) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsText)(lang, minAmount)
        }, {
          withMarkdown: true,
          withNodes: true
        }), isPriceCorrect && (() => {
          const priceWithCommission = commission ? Number((price * commission).toFixed()) : price;
          return lang('DescriptionComposerGiftResalePrice', {
            stars: isPriceInTon ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatTonAsText)(lang, priceWithCommission) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsText)(lang, priceWithCommission)
          }, {
            withMarkdown: true,
            withNodes: true
          });
        })()]
      }), isPriceCorrect && Boolean(isPriceInTon ? tonUsdRate : starsUsdWithdrawRate) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span", {
        className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].descriptionPrice,
        children: ` ${(0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__.formatCurrencyAsString)(isPriceInTon ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__.convertTonToUsd)(price, tonUsdRate) : price * starsUsdWithdrawRate, 'USD', lang.code)}`
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_8__["default"], {
      className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].checkBox,
      label: lang('OnlyAcceptTON'),
      checked: isPriceInTon,
      onCheck: setIsPriceInTon
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div", {
      className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].checkBoxDescription,
      children: lang('OnlyAcceptTONDescription')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
      noForcedUpperCase: true,
      disabled: !isPriceCorrect,
      onClick: handleSellGift,
      children: [isPriceCorrect && lang('ButtonSellGift', {
        stars: isPriceInTon ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatTonAsIcon)(lang, price) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsIcon)(lang, price, {
          asFont: true
        })
      }, {
        withNodes: true
      }), !isPriceCorrect && lang('Sell')]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const configPermille = global.appConfig.starsStargiftResaleCommissionPermille;
  const starsStargiftResaleCommissionPermille = configPermille ? configPermille / 1000 : undefined;
  const starsStargiftResaleAmountMin = global.appConfig.starsStargiftResaleAmountMin || 0;
  const starsStargiftResaleAmountMax = global.appConfig.starsStargiftResaleAmountMax;
  const starsUsdWithdrawRateX1000 = global.appConfig.starsUsdWithdrawRateX1000;
  const starsUsdWithdrawRate = starsUsdWithdrawRateX1000 ? starsUsdWithdrawRateX1000 / 1000 : 1;
  const tonConfigPermille = global.appConfig.tonStargiftResaleCommissionPermille;
  const tonStargiftResaleCommissionPermille = tonConfigPermille ? tonConfigPermille / 1000 : 0;
  const tonStargiftResaleAmountMin = (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__.convertTonFromNanos)(global.appConfig.tonStargiftResaleAmountMin || 0);
  const maxTonFromConfig = global.appConfig.tonStargiftResaleAmountMax;
  const tonStargiftResaleAmountMax = maxTonFromConfig && (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__.convertTonFromNanos)(maxTonFromConfig);
  const tonUsdRate = global.appConfig.tonUsdRate;
  return {
    starsStargiftResaleCommissionPermille,
    starsStargiftResaleAmountMin,
    starsStargiftResaleAmountMax,
    starsUsdWithdrawRate,
    tonStargiftResaleCommissionPermille,
    tonStargiftResaleAmountMin,
    tonStargiftResaleAmountMax,
    tonUsdRate
  };
})(GiftResalePriceComposerModal)));

/***/ }),

/***/ "./src/components/modals/gift/status/GiftStatusInfoModal.module.scss":
/*!***************************************************************************!*\
  !*** ./src/components/modals/gift/status/GiftStatusInfoModal.module.scss ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"qL0cHbwS","profileBlock":"t18QCmAb","radialPattern":"_1RfhkfB","lockIcon":"jiPObOWv","avatar":"JK2zOWA7","userTitle":"lxxbgNCl","status":"MLMdxkUg","giftTitle":"wxg_5ou_","infoDescription":"KSCLIMZm","footer":"VDrvalBo"});

/***/ }),

/***/ "./src/components/modals/gift/status/GiftStatusInfoModal.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/status/GiftStatusInfoModal.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_hooks_useCustomEmoji__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/hooks/useCustomEmoji */ "./src/components/common/hooks/useCustomEmoji.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableAboutModal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/TableAboutModal */ "./src/components/modals/common/TableAboutModal.tsx");
/* harmony import */ var _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./GiftStatusInfoModal.module.scss */ "./src/components/modals/gift/status/GiftStatusInfoModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const AVATAR_SIZE = 7 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.REM;
const GiftStatusInfoModal = ({
  modal,
  currentUser,
  isCurrentUserPremium
}) => {
  const {
    closeGiftStatusInfoModal,
    setEmojiStatus
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(modal);
  const {
    emojiStatus
  } = renderingModal || {};
  const subtitleColor = emojiStatus?.textColor;
  const patternIcon = (0,_common_hooks_useCustomEmoji__WEBPACK_IMPORTED_MODULE_10__["default"])(emojiStatus?.patternDocumentId);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    closeGiftStatusInfoModal();
  });
  const onWearClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (emojiStatus) {
      setEmojiStatus({
        emojiStatus
      });
    }
    closeGiftStatusInfoModal();
  });
  const radialPatternBackdrop = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!emojiStatus || !isOpen) return undefined;
    const backdropColors = [emojiStatus.centerColor, emojiStatus.edgeColor];
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__["default"], {
      className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternIcon: patternIcon.customEmoji,
      yPosition: 6.875 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.REM,
      maxRadius: 0.31,
      patternSize: isMobile ? 13 : 15,
      ovalFactor: 1
    });
  }, [emojiStatus, isOpen, isMobile, patternIcon]);
  const mockPeerWithStatus = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      ...currentUser,
      emojiStatus
    };
  }, [currentUser, emojiStatus]);
  const header = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
      className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].profileBlock),
        style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(subtitleColor && `color: ${subtitleColor}`),
        children: [radialPatternBackdrop, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
          peer: mockPeerWithStatus,
          size: AVATAR_SIZE,
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].avatar
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_12__["default"], {
          peer: mockPeerWithStatus,
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].userTitle,
          withEmojiStatus: true,
          noFake: true,
          noVerified: true
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].status,
          style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(subtitleColor && `color: ${subtitleColor}`),
          children: lang('Online')
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
        className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].giftTitle,
        children: lang('UniqueStatusWearTitle', {
          gift: mockPeerWithStatus?.emojiStatus?.title
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
        className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].infoDescription,
        children: lang('UniqueStatusBenefitsDescription')
      })]
    });
  }, [subtitleColor, radialPatternBackdrop, mockPeerWithStatus, lang]);
  const listItemData = [['radial-badge', lang('UniqueStatusBadgeBenefitTitle'), lang('UniqueStatusBadgeDescription')], ['unique-profile', lang('UniqueStatusProfileDesignBenefitTitle'), lang('UniqueStatusProfileDesignDescription')], ['proof-of-ownership', lang('UniqueStatusProofOfOwnershipBenefitTitle'), lang('UniqueStatusProofOfOwnershipDescription')]];
  const footer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
      className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].footer,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
        onClick: onWearClick,
        children: [lang('UniqueStatusWearButton'), !isCurrentUserPremium && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
          name: "lock-badge",
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].lockIcon
        })]
      })
    });
  }, [lang, isCurrentUserPremium, isOpen]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_TableAboutModal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    isOpen: isOpen,
    header: header,
    listItemData: listItemData,
    footer: footer,
    hasBackdrop: true,
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectUser)(global, global.currentUserId);
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsCurrentUserPremium)(global);
  return {
    currentUser,
    isCurrentUserPremium
  };
})(GiftStatusInfoModal)));

/***/ }),

/***/ "./src/components/modals/gift/transfer/GiftTransferConfirmModal.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/gift/transfer/GiftTransferConfirmModal.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/gift/GiftTransferPreview */ "./src/components/common/gift/GiftTransferPreview.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const GiftTransferConfirmModal = ({
  modal,
  selectedPeer
}) => {
  const {
    closeGiftTransferConfirmModal,
    transferGift,
    openChat,
    closeGiftModal,
    closeGiftTransferModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const renderingSelectedPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(selectedPeer);
  const handleConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!renderingModal?.gift.inputGift || !renderingModal.recipientId) return;
    transferGift({
      gift: renderingModal.gift.inputGift,
      recipientId: renderingModal.recipientId,
      transferStars: renderingModal.gift.transferStars
    });
    closeGiftTransferConfirmModal();
    openChat({
      id: renderingModal.recipientId
    });
    closeGiftModal();
    closeGiftTransferModal();
  });
  if (!renderingModal) return undefined;
  const {
    gift
  } = renderingModal;
  const uniqueGift = gift.gift.type === 'starGiftUnique' ? gift.gift : undefined;
  if (!uniqueGift) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isOpen: isOpen,
    noDefaultTitle: true,
    onClose: closeGiftTransferConfirmModal,
    confirmLabel: gift.transferStars ? lang('GiftTransferConfirmButton', {
      amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, gift.transferStars, {
        asFont: true
      })
    }, {
      withNodes: true
    }) : lang('GiftTransferConfirmButtonFree'),
    confirmHandler: handleConfirm,
    children: [renderingSelectedPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_8__["default"], {
      peer: renderingSelectedPeer,
      gift: uniqueGift
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("p", {
      children: gift.transferStars ? lang('GiftTransferConfirmDescription', {
        gift: lang('GiftUnique', {
          title: uniqueGift.title,
          number: uniqueGift.number
        }),
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, gift.transferStars),
        peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingSelectedPeer)
      }, {
        withNodes: true,
        withMarkdown: true
      }) : lang('GiftTransferConfirmDescriptionFree', {
        gift: lang('GiftUnique', {
          title: uniqueGift.title,
          number: uniqueGift.number
        }),
        peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingSelectedPeer)
      }, {
        withNodes: true,
        withMarkdown: true
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const selectedPeer = modal?.recipientId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, modal.recipientId) : undefined;
  return {
    selectedPeer
  };
})(GiftTransferConfirmModal)));

/***/ }),

/***/ "./src/components/modals/gift/transfer/GiftTransferModal.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/transfer/GiftTransferModal.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePeerSearch__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/usePeerSearch */ "./src/hooks/usePeerSearch.ts");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/pickers/PickerModal */ "./src/components/common/pickers/PickerModal.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");















const GiftTransferModal = ({
  modal,
  contactIds,
  currentUserId
}) => {
  const {
    closeGiftTransferModal,
    openGiftWithdrawModal,
    openGiftTransferConfirmModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [searchQuery, setSearchQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(modal);
  const orderedChatIds = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__.useFolderManagerForOrderedIds)(_config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID);
  const sortedLocalIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)([...(contactIds || []), ...(orderedChatIds || [])]);
  }, [contactIds, orderedChatIds]);
  const {
    result: foundIds,
    currentResultsQuery
  } = (0,_hooks_usePeerSearch__WEBPACK_IMPORTED_MODULE_11__["default"])({
    query: searchQuery,
    defaultValue: sortedLocalIds
  });
  const isLoading = currentResultsQuery !== searchQuery;
  const categories = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (currentResultsQuery) return _util_memo__WEBPACK_IMPORTED_MODULE_5__.MEMO_EMPTY_ARRAY;
    return [{
      type: 'withdraw',
      isCustomPeer: true,
      avatarIcon: 'toncoin',
      peerColorId: 5,
      title: lang('GiftTransferTON')
    }];
  }, [lang, currentResultsQuery]);
  const handleCategoryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(category => {
    if (category !== 'withdraw') return;
    openGiftWithdrawModal({
      gift: renderingModal.gift
    });
    closeGiftTransferModal();
  });
  const displayIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isLoading) return _util_memo__WEBPACK_IMPORTED_MODULE_5__.MEMO_EMPTY_ARRAY;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__["default"])((foundIds || []).filter(peerId => peerId !== currentUserId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanGift)(global, peerId)), false);
  }, [isLoading, foundIds, currentUserId]);
  const handlePeerSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(peerId => {
    if (!renderingModal?.gift) return;
    openGiftTransferConfirmModal({
      gift: renderingModal.gift,
      recipientId: peerId
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_13__["default"], {
    isOpen: isOpen,
    onClose: closeGiftTransferModal,
    title: lang('GiftTransferTitle'),
    hasCloseButton: true,
    shouldAdaptToSearch: true,
    withFixedHeight: true,
    ignoreFreeze: true,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_12__["default"], {
      itemIds: displayIds,
      categories: categories,
      onSelectedCategoryChange: handleCategoryChange,
      withDefaultPadding: true,
      withPeerUsernames: true,
      isSearchable: true,
      noScrollRestore: true,
      isLoading: isLoading,
      filterValue: searchQuery,
      filterPlaceholder: lang('Search'),
      onFilterChange: setSearchQuery,
      onSelectedIdChange: handlePeerSelect
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    contactList,
    currentUserId
  } = global;
  return {
    contactIds: contactList?.userIds,
    currentUserId
  };
})(GiftTransferModal)));

/***/ }),

/***/ "./src/components/modals/gift/upgrade/GiftUpgradeModal.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/upgrade/GiftUpgradeModal.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"footer":"EWaVCxY4","footerButton":"_Dt6RSQV","link":"Xu0TqkRj","priceDecreaseTimer":"ryB8xKvy"});

/***/ }),

/***/ "./src/components/modals/gift/upgrade/GiftUpgradeModal.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/upgrade/GiftUpgradeModal.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_TextTimer__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../ui/TextTimer */ "./src/components/ui/TextTimer.tsx");
/* harmony import */ var _common_TableAboutModal__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/TableAboutModal */ "./src/components/modals/common/TableAboutModal.tsx");
/* harmony import */ var _UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./GiftUpgradeModal.module.scss */ "./src/components/modals/gift/upgrade/GiftUpgradeModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const PREVIEW_UPDATE_INTERVAL = 3000;
const GiftUpgradeModal = ({
  modal,
  recipient
}) => {
  const {
    closeGiftUpgradeModal,
    closeGiftInfoModal,
    upgradeGift,
    upgradePrepaidGift,
    openStarGiftPriceDecreaseInfoModal,
    shiftGiftUpgradeNextPrice
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(modal);
  const renderingRecipient = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(recipient);
  const [shouldKeepOriginalDetails, setShouldKeepOriginalDetails] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const isPrepaid = Boolean(renderingModal?.gift?.prepaidUpgradeHash);
  const [previewAttributes, setPreviewAttributes] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => closeGiftUpgradeModal());
  const handleTimerEnd = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    shiftGiftUpgradeNextPrice();
  });
  const nextPrice = renderingModal?.nextPrices?.[0];
  const nextPriceDate = nextPrice?.date;
  const upgradeStars = renderingModal?.currentUpgradeStars;
  const handleUpgrade = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    const gift = renderingModal?.gift;
    if (!gift) return;
    if (isPrepaid && gift.prepaidUpgradeHash && renderingRecipient) {
      if (!upgradeStars) return;
      upgradePrepaidGift({
        peerId: renderingRecipient.id,
        hash: gift.prepaidUpgradeHash,
        stars: upgradeStars
      });
      handleClose();
      closeGiftInfoModal();
      return;
    }
    if (!gift?.inputGift) return;
    upgradeGift({
      gift: gift.inputGift,
      shouldKeepOriginalDetails,
      upgradeStars: !gift.alreadyPaidUpgradeStars ? upgradeStars : undefined
    });
    handleClose();
  });
  const updatePreviewAttributes = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!renderingModal?.sampleAttributes) return;
    setPreviewAttributes((0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__.getRandomGiftPreviewAttributes)(renderingModal.sampleAttributes, previewAttributes));
  });
  const handleOpenPriceInfo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!renderingModal?.prices) return;
    openStarGiftPriceDecreaseInfoModal({
      prices: renderingModal.prices,
      currentPrice: upgradeStars || 0,
      minPrice: renderingModal.minPrice || 0,
      maxPrice: renderingModal.maxPrice || 0
    });
  });
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_5__["default"])(updatePreviewAttributes, isOpen ? PREVIEW_UPDATE_INTERVAL : undefined, true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen && renderingModal?.sampleAttributes) {
      updatePreviewAttributes();
    }
  }, [isOpen, renderingModal?.sampleAttributes]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const attributes = renderingModal?.sampleAttributes;
    if (!attributes) return;
    (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__.preloadGiftAttributeStickers)(attributes);
  }, [renderingModal?.sampleAttributes]);
  const formattedPriceElement = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => upgradeStars ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span", {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
      name: "star",
      className: "star-amount-icon"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_9__["default"], {
      text: lang.number(upgradeStars)
    })]
  }) : undefined, [lang, upgradeStars]);
  const modalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!previewAttributes || !isOpen) {
      return undefined;
    }
    const gift = renderingModal?.gift;
    const userName = renderingRecipient ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingRecipient) : lang('ActionFallbackUser');
    const listItemData = renderingRecipient ? [['diamond', lang('GiftUpgradeUniqueTitle'), lang('GiftPeerUpgradeUniqueDescription', {
      user: userName
    })], ['trade', lang('GiftUpgradeTransferableTitle'), lang('GiftPeerUpgradeTransferableDescription', {
      user: userName
    })], ['auction', lang('GiftUpgradeTradeableTitle'), lang('GiftPeerUpgradeTradeableDescription', {
      user: userName
    })]] : [['diamond', lang('GiftUpgradeUniqueTitle'), lang('GiftUpgradeUniqueDescription')], ['trade', lang('GiftUpgradeTransferableTitle'), lang('GiftUpgradeTransferableDescription')], ['auction', lang('GiftUpgradeTradeableTitle'), lang('GiftUpgradeTradeableDescription')]];
    const subtitle = renderingRecipient ? lang('GiftPeerUpgradeText', {
      peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingRecipient)
    }) : lang('GiftUpgradeTextOwn');
    const hasPriceDecreaseInfo = Boolean(nextPriceDate) && Boolean(renderingModal?.prices?.length) && !gift?.alreadyPaidUpgradeStars;
    const header = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_16__["default"], {
      modelAttribute: previewAttributes.model,
      backdropAttribute: previewAttributes.backdrop,
      patternAttribute: previewAttributes.pattern,
      title: lang('GiftUpgradeTitle'),
      subtitle: subtitle
    });
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
      className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].footer,
      children: [!gift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
        className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].footerButton,
        onClick: handleClose,
        children: lang('OK')
      }), gift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment, {
        children: [!isPrepaid && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_12__["default"], {
          label: lang('GiftUpgradeKeepDetails'),
          onCheck: setShouldKeepOriginalDetails,
          checked: shouldKeepOriginalDetails
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
          className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].footerButton,
          isShiny: true,
          onClick: handleUpgrade,
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
            className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].buttonContent,
            children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
              children: gift.alreadyPaidUpgradeStars ? lang('GeneralConfirm') : isPrepaid ? lang('GiftPayForUpgradeButton', {
                amount: formattedPriceElement
              }, {
                withNodes: true
              }) : lang('GiftUpgradeButton', {
                amount: formattedPriceElement
              }, {
                withNodes: true
              })
            }), hasPriceDecreaseInfo && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div", {
              className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].priceDecreaseTimer,
              children: lang('StarGiftPriceDecreaseTimer', {
                timer: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_TextTimer__WEBPACK_IMPORTED_MODULE_14__["default"], {
                  endsAt: nextPriceDate,
                  onEnd: handleTimerEnd
                })
              }, {
                withNodes: true
              })
            })]
          })
        }), hasPriceDecreaseInfo && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_13__["default"], {
          className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].link,
          isPrimary: true,
          onClick: handleOpenPriceInfo,
          children: lang('StarGiftPriceDecreaseInfoLink')
        })]
      })]
    });
    return {
      listItemData,
      header,
      footer
    };
  }, [previewAttributes, isOpen, lang, renderingRecipient, renderingModal?.gift, shouldKeepOriginalDetails, isPrepaid, renderingModal?.prices?.length, nextPriceDate, formattedPriceElement]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_TableAboutModal__WEBPACK_IMPORTED_MODULE_15__["default"], {
    isOpen: isOpen,
    header: modalData?.header,
    footer: modalData?.footer,
    listItemData: modalData?.listItemData,
    hasBackdrop: true,
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const recipientId = modal?.recipientId;
  const recipient = recipientId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, recipientId) : undefined;
  return {
    recipient
  };
})(GiftUpgradeModal)));

/***/ }),

/***/ "./src/components/modals/gift/value/GiftInfoValueModal.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/value/GiftInfoValueModal.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"v4GJBsdC","sticker":"lJodRD0R","description":"VjWaO8un","initialPrice":"K7zsAhVt","starIcon":"Xw91xwpe","footer":"OJDo2xUd","footerSticker":"hspYTy7V"});

/***/ }),

/***/ "./src/components/modals/gift/value/GiftInfoValueModal.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/value/GiftInfoValueModal.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./GiftInfoValueModal.module.scss */ "./src/components/modals/gift/value/GiftInfoValueModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");














const HEADER_STICKER_SIZE = 120;
const FOOTER_STICKER_SIZE = 24;
const GiftInfoValueModal = ({
  modal
}) => {
  const {
    closeGiftInfoValueModal,
    openUrl,
    openGiftInMarket
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(modal);
  const handleOpenFragment = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (modal?.valueInfo.fragmentListedUrl) {
      openUrl({
        url: modal.valueInfo.fragmentListedUrl
      });
    }
  });
  const handleOpenTelegramMarket = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (modal?.gift) {
      openGiftInMarket({
        gift: modal.gift
      });
    }
  });
  const modalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!renderingModal) return undefined;
    const {
      gift,
      valueInfo
    } = renderingModal;
    const giftAttributes = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_5__.getGiftAttributes)(gift);
    if (!giftAttributes) return undefined;
    const header = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
      className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_9__["default"], {
        className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].sticker,
        sticker: giftAttributes.model.sticker,
        size: HEADER_STICKER_SIZE
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
        pill: true,
        size: "tiny",
        fluid: true,
        nonInteractive: true,
        children: (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(valueInfo.value, valueInfo.currency, lang.code)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
        className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].description,
        children: lang('GiftValueDescription', {
          giftName: gift.title
        }, {
          withMarkdown: true,
          withNodes: true
        })
      })]
    });
    const tableData = [];
    tableData.push([lang('GiftValueTitleInitialSale'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatDateToString)(valueInfo.initialSaleDate * 1000, lang.code)]);
    tableData.push([lang('GiftValueTitleInitialPrice'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("span", {
      className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].initialPrice,
      children: [(0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, valueInfo.initialSaleStars, {
        className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].starIcon
      }), ' (~ ', (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(valueInfo.initialSalePrice, valueInfo.currency, lang.code), ")"]
    })]);
    if (valueInfo.lastSaleDate) {
      tableData.push([lang('GiftValueTitleLastSale'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatDateToString)(valueInfo.lastSaleDate * 1000, lang.code)]);
    }
    if (valueInfo.lastSalePrice) {
      tableData.push([lang('GiftValueTitleLastPrice'), (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(valueInfo.lastSalePrice, valueInfo.currency, lang.code)]);
    }
    if (valueInfo.floorPrice) {
      tableData.push([lang('GiftValueTitleMinimumPrice'), (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(valueInfo.floorPrice, valueInfo.currency, lang.code)]);
    }
    if (valueInfo.averagePrice) {
      tableData.push([lang('GiftValueTitleAveragePrice'), (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(valueInfo.averagePrice, valueInfo.currency, lang.code)]);
    }
    const canBuyOnFragment = Boolean(valueInfo.fragmentListedUrl && valueInfo.fragmentListedCount);
    const canBuyOnTelegram = Boolean(valueInfo.listedCount && valueInfo.listedCount);
    const hasFooter = canBuyOnFragment || canBuyOnTelegram;
    const footer = hasFooter && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
      className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].footer,
      children: [canBuyOnFragment && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
        isText: true,
        onClick: handleOpenFragment,
        noForcedUpperCase: true,
        size: "tiny",
        children: [lang.number(valueInfo.fragmentListedCount), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_9__["default"], {
          className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].footerSticker,
          sticker: giftAttributes.model.sticker,
          size: FOOTER_STICKER_SIZE
        }), lang('GiftValueForSaleOnFragment')]
      }), canBuyOnTelegram && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
        isText: true,
        noForcedUpperCase: true,
        size: "tiny",
        onClick: handleOpenTelegramMarket,
        children: [lang.number(valueInfo.listedCount), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_9__["default"], {
          className: _GiftInfoValueModal_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].footerSticker,
          sticker: giftAttributes.model.sticker,
          size: FOOTER_STICKER_SIZE
        }), lang('GiftValueForSaleOnTelegram')]
      })]
    });
    return {
      header,
      tableData,
      footer
    };
  }, [lang, renderingModal, handleOpenFragment, handleOpenTelegramMarket]);
  if (!modalData) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isOpen: isOpen,
    onClose: closeGiftInfoValueModal,
    header: modalData.header,
    tableData: modalData.tableData,
    footer: modalData.footer
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftInfoValueModal));

/***/ }),

/***/ "./src/components/modals/gift/withdraw/GiftWithdrawModal.module.scss":
/*!***************************************************************************!*\
  !*** ./src/components/modals/gift/withdraw/GiftWithdrawModal.module.scss ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"LQgz8Nlx","giftPreview":"hgs0ts_O","backdrop":"OnBhMaBw","description":"HBxB4QPY","arrow":"kXTOUpfb","noPassword":"BnqLhoKr"});

/***/ }),

/***/ "./src/components/modals/gift/withdraw/GiftWithdrawModal.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/withdraw/GiftWithdrawModal.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_dates_units__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/dates/units */ "./src/util/dates/units.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PasswordForm__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/PasswordForm */ "./src/components/common/PasswordForm.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./GiftWithdrawModal.module.scss */ "./src/components/modals/gift/withdraw/GiftWithdrawModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const FRAGMENT_PEER = {
  isCustomPeer: true,
  avatarIcon: 'fragment',
  title: '',
  customPeerAvatarColor: '#000000'
};
const GIFT_STICKER_SIZE = 4.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.REM;
const GiftWithdrawModal = ({
  modal,
  hasPassword,
  passwordHint
}) => {
  const {
    closeGiftWithdrawModal,
    clearGiftWithdrawError,
    closeGiftInfoModal,
    processStarGiftWithdrawal,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const [shouldShowPassword, setShouldShowPassword] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(modal);
  const gift = renderingModal?.gift?.gift;
  const giftAttributes = gift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_5__.getGiftAttributes)(gift);
  const exportDelay = renderingModal?.gift?.canExportAt ? Math.max(renderingModal.gift.canExportAt - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_4__.getServerTime)(), 0) : undefined;
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    closeGiftWithdrawModal();
  });
  const handleSubmit = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(password => {
    processStarGiftWithdrawal({
      gift: renderingModal.gift.inputGift,
      password
    });
  });
  const handleSetUpPassword = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled
    });
    closeGiftWithdrawModal();
    closeGiftInfoModal();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    isOpen: isOpen,
    title: lang('GiftWithdrawTitle'),
    isCondensedHeader: true,
    hasCloseButton: true,
    isSlim: true,
    onClose: handleClose,
    children: [giftAttributes && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
        className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].header,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
          className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].giftPreview,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__["default"], {
            className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].backdrop,
            backgroundColors: [giftAttributes.backdrop.centerColor, giftAttributes.backdrop.edgeColor],
            patternIcon: giftAttributes.pattern?.sticker,
            ringsCount: 1,
            ovalFactor: 1,
            patternSize: 12
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_10__["default"], {
            className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].sticker,
            size: GIFT_STICKER_SIZE,
            sticker: giftAttributes.model?.sticker
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
          name: "next",
          className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].arrow
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
          peer: FRAGMENT_PEER,
          size: "giant",
          className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].avatar
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].description,
        children: lang('GiftWithdrawDescription', {
          gift: `${gift.title} #${gift.number}`
        }, {
          withNodes: true,
          withMarkdown: true,
          renderTextFilters: ['br']
        })
      })]
    }), Boolean(exportDelay) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
      className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].exportHint,
      children: lang('GiftWithdrawWait', {
        days: (0,_util_dates_units__WEBPACK_IMPORTED_MODULE_3__.getDays)(exportDelay)
      }, {
        pluralValue: (0,_util_dates_units__WEBPACK_IMPORTED_MODULE_3__.getDays)(exportDelay)
      })
    }), !hasPassword && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span", {
        className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].noPassword,
        children: lang('ErrorPasswordMissing')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: "mt-2",
        onClick: handleSetUpPassword,
        children: lang('SetUp2FA')
      })]
    }), hasPassword && !exportDelay && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_PasswordForm__WEBPACK_IMPORTED_MODULE_13__["default"], {
      shouldShowSubmit: true,
      placeholder: lang('CheckPasswordPlaceholder'),
      error: renderingModal?.errorKey && lang.withRegular(renderingModal?.errorKey),
      description: lang('CheckPasswordDescription'),
      onClearError: clearGiftWithdrawError,
      isLoading: renderingModal?.isLoading,
      hint: passwordHint,
      isPasswordVisible: shouldShowPassword,
      shouldResetValue: isOpen,
      onChangePasswordVisibility: setShouldShowPassword,
      submitLabel: lang('GiftWithdrawSubmit'),
      onSubmit: handleSubmit
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    settings: {
      byKey: {
        hasPassword
      }
    },
    twoFaSettings: {
      hint: passwordHint
    }
  } = global;
  return {
    hasPassword,
    passwordHint
  };
})(GiftWithdrawModal)));

/***/ }),

/***/ "./src/components/modals/paidReaction/PaidReactionModal.module.scss":
/*!**************************************************************************!*\
  !*** ./src/components/modals/paidReaction/PaidReactionModal.module.scss ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"content":"RdhRpsCn","title":"yzbjj73U","slider":"xePPMXOI","description":"BlpfdOtK","itemInfo":"nS9V516D","itemTitle":"sH5Nukjy","itemSubtitle":"dHlNODTI","itemIcon":"H_iHihXU","sendAsPeerButtonAvatar":"_mjvLELm","sendAsPeerMenuButton":"zxsRaWYV","buttonDownIcon":"zrwUUELS","sendAsPeerMenuBubble":"X1PB6mhQ","sendAsPeerMenu":"Px1MDij9","sendAsPeersMenuContainer":"Al1nfhHJ","headerControlPanel":"vu90kSL_","separator":"uhQLUjmo","checkBox":"Mc3bVeF0","topLabel":"bnou4CpV","top":"QludQDKR","topBadge":"JBF9pTUK","buttonStar":"NJJFuym9","topPeer":"Ty4Ud_Rd","disclaimer":"KRvkHeo1"});

/***/ }),

/***/ "./src/components/modals/paidReaction/PaidReactionModal.tsx":
/*!******************************************************************!*\
  !*** ./src/components/modals/paidReaction/PaidReactionModal.tsx ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerBadge__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PeerBadge */ "./src/components/common/PeerBadge.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_Separator__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/Separator */ "./src/components/ui/Separator.tsx");
/* harmony import */ var _stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../stars/BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _StarSlider__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./StarSlider */ "./src/components/modals/paidReaction/StarSlider.tsx");
/* harmony import */ var _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./PaidReactionModal.module.scss */ "./src/components/modals/paidReaction/PaidReactionModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




























const MAX_TOP_REACTORS = 3;
const DEFAULT_STARS_AMOUNT = 50;
const MAX_REACTION_AMOUNT = 2500;
const ANONYMOUS_PEER = {
  avatarIcon: 'author-hidden',
  customPeerAvatarColor: '#9eaab5',
  isCustomPeer: true,
  titleKey: 'StarsReactionAnonymous'
};
const PaidReactionModal = ({
  modal,
  chat,
  message,
  maxAmount,
  starBalance,
  defaultPrivacy,
  sendPaidReactionsAsPeerIds,
  currentUserId,
  currentUser
}) => {
  const {
    closePaidReactionModal,
    addLocalPaidReaction,
    loadSendPaidReactionsAs
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [starsAmount, setStarsAmount] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(DEFAULT_STARS_AMOUNT);
  const [isTouched, markTouched, unmarkTouched] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [shouldSendAsAnonymous, setShouldSendAsAnonymous] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [sendAsPeerId, setSendAsPeerId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(currentUserId);
  const chatId = chat?.id;
  const senderPeer = sendAsPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), sendAsPeerId) : currentUser;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const handleShowInTopSendersChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    setShouldSendAsAnonymous(!e.target.checked);
  });
  const handleAmountChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(value => {
    setStarsAmount(value);
    markTouched();
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && !sendPaidReactionsAsPeerIds) {
      loadSendPaidReactionsAs({
        chatId
      });
    }
  }, [chatId, sendPaidReactionsAsPeerIds]);
  const filteredMyReactorIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const result = sendPaidReactionsAsPeerIds?.map(peer => peer.id).filter(id => id !== chatId);
    result?.unshift(currentUserId);
    return result;
  }, [sendPaidReactionsAsPeerIds, chatId, currentUserId]);
  const canChangeSendAsPeer = filteredMyReactorIds && filteredMyReactorIds.length > 1;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!modal) {
      unmarkTouched();
    }
  }, [modal]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const currentReactor = message?.reactions?.topReactors?.find(reactor => reactor.isMy);
    if (currentReactor) {
      setShouldSendAsAnonymous(Boolean(currentReactor.isAnonymous));
      if (currentReactor.peerId) {
        setSendAsPeerId(currentReactor.peerId);
      }
      return;
    }
    setShouldSendAsAnonymous(defaultPrivacy?.type === 'anonymous' || false);
    if (defaultPrivacy?.type === 'peer' && filteredMyReactorIds?.includes(defaultPrivacy.peerId)) {
      setSendAsPeerId(defaultPrivacy.peerId);
      return;
    }
    setSendAsPeerId(currentUserId);
  }, [defaultPrivacy, message?.reactions?.topReactors, filteredMyReactorIds, currentUserId]);
  const handleSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (!modal) return;
    addLocalPaidReaction({
      chatId: modal.chatId,
      messageId: modal.messageId,
      count: starsAmount,
      isPrivate: shouldSendAsAnonymous,
      peerId: shouldSendAsAnonymous || sendAsPeerId === currentUserId ? undefined : sendAsPeerId,
      shouldIgnoreDefaultPrivacy: true
    });
    closePaidReactionModal();
  });
  const handleSendAsPeerChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(peerId => {
    setShouldSendAsAnonymous(false);
    setSendAsPeerId(peerId);
  });
  const renderMenuItem = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(peerId => {
    const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), peerId);
    const isSelected = sendAsPeerId === peerId && !shouldSendAsAnonymous;
    if (!peer) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_21__["default"], {
      onClick: () => handleSendAsPeerChange(peerId),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
        size: "small",
        peer: peer
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemInfo),
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_14__["default"], {
          className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemTitle,
          peer: peer,
          noFake: true,
          noVerified: true
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("span", {
          className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemSubtitle,
          children: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(peer) ? lang('PeerPersonalAccount') : lang('PeerChannel')
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemIcon,
        name: isSelected ? 'check' : 'placeholder'
      })]
    });
  });
  const SendAsPeerMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerMenuButton, isOpen ? 'active' : ''),
      onClick: onTrigger,
      ariaLabel: lang('AriaLabelOpenMenu'),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerButtonAvatar,
        size: "mini",
        peer: shouldSendAsAnonymous ? ANONYMOUS_PEER : senderPeer
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
        name: "down",
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].buttonDownIcon
      })]
    });
  }, [isMobile, lang, senderPeer, shouldSendAsAnonymous]);
  const sendAsPeersMenu = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!canChangeSendAsPeer) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_20__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerMenu, 'with-menu-transitions'),
      bubbleClassName: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerMenuBubble,
      trigger: SendAsPeerMenuButton,
      positionX: "right",
      autoClose: true,
      children: filteredMyReactorIds.map(id => renderMenuItem(id))
    });
  }, [SendAsPeerMenuButton, filteredMyReactorIds, canChangeSendAsPeer]);
  const topReactors = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const all = message?.reactions?.topReactors;
    if (!all) {
      return undefined;
    }
    const result = [];
    let hasCurrentSender = false;
    let myReactorAmount = 0;
    all.forEach(reactor => {
      const peer = reactor.peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, reactor.peerId) : undefined;
      if (!peer && !reactor.isAnonymous && !reactor.isMy) return;
      if (reactor.isMy) {
        myReactorAmount = reactor.count;
      }
      if (reactor.isMy && (reactor.peerId !== sendAsPeerId || reactor.isAnonymous && !shouldSendAsAnonymous)) return;
      const isCurrentReactor = sendAsPeerId === reactor.peerId || shouldSendAsAnonymous && reactor.isAnonymous;
      if (isCurrentReactor) {
        hasCurrentSender = true;
      }
      result.push({
        amount: reactor.count,
        localAmount: isCurrentReactor && isTouched ? starsAmount : 0,
        isMy: reactor.isMy,
        isAnonymous: reactor.isAnonymous,
        user: peer
      });
    });
    if (!hasCurrentSender) {
      const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, sendAsPeerId);
      result.push({
        amount: myReactorAmount,
        localAmount: isTouched ? starsAmount : 0,
        isMy: true,
        user: sender
      });
    }
    result.sort((a, b) => b.amount + b.localAmount - (a.amount + a.localAmount));
    return result.slice(0, MAX_TOP_REACTORS);
  }, [isTouched, message?.reactions?.topReactors, starsAmount, sendAsPeerId, shouldSendAsAnonymous]);
  const chatTitle = chat && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(oldLang, chat);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_22__["default"], {
    isOpen: Boolean(modal),
    onClose: closePaidReactionModal,
    isSlim: true,
    hasAbsoluteCloseButton: true,
    contentClassName: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].content,
    isLowStackPriority: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeersMenuContainer,
      children: sendAsPeersMenu
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].headerControlPanel,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_24__["default"], {
        balance: starBalance,
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].modalBalance,
        withAddButton: true
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_StarSlider__WEBPACK_IMPORTED_MODULE_25__["default"], {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].slider,
      defaultValue: DEFAULT_STARS_AMOUNT,
      maxValue: maxAmount,
      onChange: handleAmountChange
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].title,
      children: oldLang('StarsReactionTitle')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].description,
      children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(oldLang('StarsReactionText', chatTitle), ['simple_markdown', 'emoji'])
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Separator__WEBPACK_IMPORTED_MODULE_23__["default"], {
      children: topReactors && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].topLabel,
        children: oldLang('StarsReactionTopSenders')
      })
    }), topReactors && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].top,
      children: topReactors.map(reactor => {
        const countText = (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_6__.formatInteger)(reactor.amount + reactor.localAmount);
        const peer = reactor.isAnonymous || !reactor.user || reactor.isMy && shouldSendAsAnonymous ? ANONYMOUS_PEER : reactor.user;
        const text = 'isCustomPeer' in peer ? oldLang(peer.titleKey) : peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(oldLang, peer);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_PeerBadge__WEBPACK_IMPORTED_MODULE_16__["default"], {
          className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].topPeer,
          peer: peer,
          badgeText: countText,
          badgeIcon: "star",
          badgeClassName: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].topBadge,
          text: text
        }, `${reactor.user?.id || 'anonymous'}-${countText}`);
      })
    }), topReactors && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Separator__WEBPACK_IMPORTED_MODULE_23__["default"], {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].separator
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_19__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].checkBox, 'dialog-checkbox'),
      checked: !shouldSendAsAnonymous,
      onChange: handleShowInTopSendersChange,
      label: oldLang('StarsReactionShowMeInTopSenders')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      onClick: handleSend,
      children: lang('SendPaidReaction', {
        amount: starsAmount
      }, {
        withNodes: true,
        specialReplacement: {
          [_config__WEBPACK_IMPORTED_MODULE_2__.STARS_ICON_PLACEHOLDER]: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
            className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].buttonStar,
            name: "star"
          })
        }
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].disclaimer,
      children: lang('StarsReactionTerms', {
        link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_17__["default"], {
          text: lang('StarsReactionLinkText'),
          url: lang('StarsReactionLink')
        })
      }, {
        withNodes: true
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const chat = modal && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, modal.chatId);
  const message = modal && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessage)(global, modal.chatId, modal.messageId);
  const starBalance = global.stars?.balance;
  const maxAmount = global.appConfig.paidReactionMaxAmount || MAX_REACTION_AMOUNT;
  const defaultPrivacy = global.settings.paidReactionPrivacy;
  const sendPaidReactionsAsPeerIds = chat?.sendPaidReactionsAsPeerIds;
  const currentUserId = global.currentUserId;
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, currentUserId);
  return {
    chat,
    message,
    starBalance,
    maxAmount,
    defaultPrivacy,
    sendPaidReactionsAsPeerIds,
    currentUserId,
    currentUser
  };
})(PaidReactionModal)));

/***/ }),

/***/ "./src/components/modals/paidReaction/StarSlider.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/paidReaction/StarSlider.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"CuBAw2yg","dragging":"LbDNXOOQ","progress":"kwK0cNPX","floatingBadgeWrapper":"uvlMoXj0","floatingBadgeText":"qqQan8uF","floatingBadgeTriangle":"mIdJOmsB","slider":"euOOAbZi","sparkles":"_L1YQTIP","dynamicColor":"uIYIwZpx","floatingBadge":"BGSDWAYc","clickable":"JwkM7nwU","noTransition":"cG6CiHRL","floatingBadgeSparkles":"JCciTRtu","floatingBadgeContent":"f1UPSN27","withDescription":"WsptdVHe","floatingBadgeTitle":"HkY6dR8D","floatingBadgeDescription":"mR3ddE5s","floatingBadgeTrianglePath":"IW9YhMAx","customValueIcon":"Td8Tc1MH"});

/***/ }),

/***/ "./src/components/modals/paidReaction/StarSlider.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/paidReaction/StarSlider.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_Sparkles__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/Sparkles */ "./src/components/common/Sparkles.tsx");
/* harmony import */ var _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./StarSlider.module.scss */ "./src/components/modals/paidReaction/StarSlider.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const DEFAULT_POINTS = [50, 100, 500, 1000, 2000, 5000, 10000];
const LARGE_STEP = 10000;
const THUMB_SIZE = 1.875 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
const CORNER_BEAK_WIDTH = 44;
const DEFAULT_BEAK_WIDTH = 52;
const BEAK_HEIGHT = 32;
const BEAK_OFFSET_END = 10;
const TIP_OFFSET_END = 0;
const BEAK_TIP_PADDING = 1;
const BADGE_HORIZONTAL_PADDING = 2 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
const BADGE_ICON_SIZE = 1.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
const BADGE_TITLE_GAP = 0.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
const DRAG_DISTANCE_THRESHOLD = 5;
const BADGE_WIDTH_DELTA = 6;
let textMeasureCanvas;
function getTextWidth(text, font) {
  if (!textMeasureCanvas) {
    textMeasureCanvas = document.createElement('canvas');
  }
  const ctx = textMeasureCanvas.getContext('2d');
  ctx.font = font;
  return ctx.measureText(text).width;
}
const SLIDER_COLORS = ['#955CDB',
// Purple
'#955CDB',
// Purple
'#46A3EB',
// Blue
'#40A920',
// Green
'#E29A09',
// Yellow
'#ED771E',
// Orange
'#E14741',
// Red
'#5B6676' // Silver
];
function getColorForProgress(progress) {
  const index = Math.floor(progress * SLIDER_COLORS.length);
  return SLIDER_COLORS[Math.min(index, SLIDER_COLORS.length - 1)];
}
const StarSlider = ({
  maxValue,
  defaultValue,
  minValue: minValueProp,
  minAllowedValue,
  minAllowedProgress,
  className,
  floatingBadgeDescription,
  shouldUseDynamicColor,
  shouldAllowCustomValue,
  onChange,
  onBadgeClick,
  onCustomValueClick
}) => {
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const floatingBadgeContentRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const baseMinValue = minValueProp ?? 1;

  // Uses binary search - O(log n)
  const actualMinValue = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!minAllowedProgress || !minAllowedValue || minAllowedValue <= baseMinValue) {
      return baseMinValue;
    }
    let low = baseMinValue;
    let high = minAllowedValue;
    while (low < high) {
      const mid = Math.floor((low + high) / 2);
      const testPoints = buildPoints(mid, maxValue);
      const testProgress = getProgress(testPoints, minAllowedValue, mid);
      const normalizedProgress = testProgress / testPoints.length;
      if (normalizedProgress < minAllowedProgress) {
        high = mid;
      } else {
        low = mid + 1;
      }
    }
    return Math.max(baseMinValue, low);
  }, [baseMinValue, minAllowedValue, minAllowedProgress, maxValue]);
  const points = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return buildPoints(actualMinValue, maxValue);
  }, [maxValue, actualMinValue]);
  const [value, setValue] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [containerWidth, setContainerWidth] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [badgeWidth, setBadgeWidth] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [isDragging, setIsDragging] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const startXRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const prevBadgeWidth = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_6__["default"])(badgeWidth);
  const badgeText = lang.number(getValue(points, value, actualMinValue));
  const minSliderProgress = minAllowedValue !== undefined ? getProgress(points, minAllowedValue, actualMinValue) : 0;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setValue(getProgress(points, defaultValue, actualMinValue));
  }, [defaultValue, points, actualMinValue]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!floatingBadgeContentRef.current) return;
    const titleEl = floatingBadgeContentRef.current.querySelector(`.${_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeTitle}`);
    if (!titleEl) return;
    const computedStyle = getComputedStyle(titleEl);
    const font = `${computedStyle.fontWeight} ${computedStyle.fontSize} ${computedStyle.fontFamily}`;
    const textWidth = getTextWidth(badgeText, font);
    const titleWidth = BADGE_ICON_SIZE + BADGE_TITLE_GAP + textWidth;
    const descriptionEl = floatingBadgeContentRef.current.querySelector(`.${_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeDescription}`);
    const descriptionWidth = descriptionEl?.scrollWidth || 0;
    const contentWidth = Math.max(titleWidth, descriptionWidth);
    const newBadgeWidth = contentWidth + BADGE_HORIZONTAL_PADDING;
    setBadgeWidth(currentWidth => {
      if (Math.abs(newBadgeWidth - currentWidth) < BADGE_WIDTH_DELTA) {
        return currentWidth;
      }
      return newBadgeWidth;
    });
  }, [badgeText, floatingBadgeDescription]);
  const handleContainerResize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(entry => {
    setContainerWidth(entry.contentRect.width);
  });
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_7__["default"])(containerRef, handleContainerResize);
  const progress = value / points.length;
  const {
    minBadgeX,
    maxBadgeX,
    beakOffset,
    beakTipOffset,
    beakWidth: currentBeakWidth
  } = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return calcBadgePosition(containerWidth, badgeWidth, progress);
  }, [containerWidth, badgeWidth, progress]);
  const beakPath = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return generateBeakPath(currentBeakWidth, beakTipOffset);
  }, [currentBeakWidth, beakTipOffset]);
  const handleChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(event => {
    const rawValue = Number(event.currentTarget.value);
    const clampedValue = Math.max(rawValue, minSliderProgress);
    setValue(clampedValue);
    const resultValue = getValue(points, clampedValue, actualMinValue);
    onChange(resultValue);
  });
  const handlePointerDown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(e => {
    startXRef.current = e.clientX;
    setIsDragging(false);
  });
  const handlePointerMove = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(e => {
    if (startXRef.current === undefined) return;
    const distance = Math.abs(e.clientX - startXRef.current);
    if (distance >= DRAG_DISTANCE_THRESHOLD) {
      setIsDragging(true);
    }
  });
  const handlePointerUp = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(e => {
    startXRef.current = undefined;
    if (!isDragging && onCustomValueClick && containerRef.current) {
      const rect = containerRef.current.getBoundingClientRect();
      const clickZoneWidth = 1.875 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
      const isInIconArea = e.clientX >= rect.right - clickZoneWidth && e.clientX <= rect.right;
      if (isInIconArea) {
        onCustomValueClick();
      }
    }
    setIsDragging(false);
  });
  const dynamicColor = shouldUseDynamicColor ? getColorForProgress(progress) : undefined;
  const badgeStyle = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_2__["default"])(Boolean(badgeWidth) && `width: ${badgeWidth}px`);
  const rootStyle = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_2__["default"])(`--progress: ${progress}`, `--min-badge-x: ${minBadgeX}px`, `--max-badge-x: ${maxBadgeX}px`, dynamicColor && `--dynamic-color: ${dynamicColor}`);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
    ref: containerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root, isDragging && _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].dragging, className),
    style: rootStyle,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div", {
      className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeWrapper,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadge, onBadgeClick && _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].clickable),
        onClick: onBadgeClick,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeText, shouldUseDynamicColor && _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].dynamicColor, (!prevBadgeWidth || prevBadgeWidth === 0) && _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].noTransition),
          style: badgeStyle,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_Sparkles__WEBPACK_IMPORTED_MODULE_10__["default"], {
            preset: "button",
            className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeSparkles
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
            ref: floatingBadgeContentRef,
            className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeContent, floatingBadgeDescription && _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].withDescription),
            children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div", {
              className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeTitle,
              children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
                name: "star",
                className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeIcon
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__["default"], {
                text: badgeText
              })]
            }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div", {
              className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeDescription,
              children: floatingBadgeDescription
            })]
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("svg", {
          className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeTriangle,
          width: currentBeakWidth,
          height: BEAK_HEIGHT,
          viewBox: `0 0 ${currentBeakWidth} ${BEAK_HEIGHT}`,
          fill: "none",
          "aria-hidden": "true",
          role: "presentation",
          style: `transform: translate(calc(-50% + ${beakOffset}px), 33%)`,
          children: [!shouldUseDynamicColor && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("defs", {
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("linearGradient", {
              id: "StarBadgeTriangle",
              x1: "0",
              x2: "1",
              y1: "0",
              y2: "0",
              children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("stop", {
                offset: "-50%",
                "stop-color": "#FFAA00"
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("stop", {
                offset: "150%",
                "stop-color": "#FFCD3A"
              })]
            })
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("path", {
            className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].floatingBadgeTrianglePath,
            d: beakPath,
            fill: dynamicColor || 'url(#StarBadgeTriangle)'
          })]
        })]
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].progress, shouldUseDynamicColor && _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].dynamicColor),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_Sparkles__WEBPACK_IMPORTED_MODULE_10__["default"], {
        preset: "progress",
        className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].sparkles
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("input", {
      className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].slider,
      type: "range",
      min: 0,
      max: points.length,
      defaultValue: getProgress(points, defaultValue, actualMinValue),
      step: "any",
      onChange: handleChange,
      onPointerDown: handlePointerDown,
      onPointerMove: handlePointerMove,
      onPointerUp: handlePointerUp
    }), shouldAllowCustomValue && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
      name: "add",
      className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].customValueIcon
    })]
  });
};
function buildPoints(minValue, maxValue) {
  const result = [];
  for (let i = 0; i < DEFAULT_POINTS.length; i++) {
    if (DEFAULT_POINTS[i] <= minValue) continue;
    if (DEFAULT_POINTS[i] < maxValue) {
      result.push(DEFAULT_POINTS[i]);
    }
    if (DEFAULT_POINTS[i] >= maxValue) {
      result.push(maxValue);
      return result;
    }
  }
  const lastPoint = DEFAULT_POINTS[DEFAULT_POINTS.length - 1];
  const stepsNeeded = Math.ceil((minValue - lastPoint) / LARGE_STEP);
  let nextPoint = lastPoint + Math.max(1, stepsNeeded) * LARGE_STEP;
  while (nextPoint < maxValue) {
    result.push(nextPoint);
    nextPoint += LARGE_STEP;
  }
  result.push(maxValue);
  return result;
}
function getProgress(points, value, minValue) {
  const pointIndex = points.findIndex(point => value <= point);
  const prevPoint = points[pointIndex - 1] || minValue;
  const nextPoint = points[pointIndex] || points[points.length - 1];
  if (nextPoint === prevPoint) return pointIndex;
  const progress = (value - prevPoint) / (nextPoint - prevPoint);
  return pointIndex + progress;
}
function getValue(points, progress, minValue) {
  const pointIndex = Math.floor(progress);
  const prevPoint = points[pointIndex - 1] || minValue;
  const nextPoint = points[pointIndex] || points[points.length - 1];
  const value = prevPoint + (nextPoint - prevPoint) * (progress - pointIndex);
  return Math.round(value);
}
function calcBadgePosition(containerWidth, badgeWidth, progress) {
  const halfBadgeWidth = badgeWidth / 2;
  const cornerBeakHalfWidth = CORNER_BEAK_WIDTH / 2;
  const maxBeakOffset = halfBadgeWidth - cornerBeakHalfWidth;
  const minBadgeX = halfBadgeWidth;
  const maxBadgeX = containerWidth - halfBadgeWidth;
  const thumbHalf = THUMB_SIZE / 2;
  const trackLength = containerWidth - THUMB_SIZE;
  const distanceFromLeft = progress * trackLength;
  const distanceFromRight = trackLength - distanceFromLeft;
  const isLeftSide = distanceFromLeft < distanceFromRight;
  const distanceToEdge = isLeftSide ? distanceFromLeft : distanceFromRight;
  const direction = isLeftSide ? -1 : 1;
  let beakOffset = 0;
  let beakTipOffset = 0;
  let beakWidth = DEFAULT_BEAK_WIDTH;
  const beakOffsetStart = halfBadgeWidth - thumbHalf;
  if (distanceToEdge < beakOffsetStart) {
    if (distanceToEdge > BEAK_OFFSET_END) {
      const t = (beakOffsetStart - distanceToEdge) / (beakOffsetStart - BEAK_OFFSET_END);
      beakOffset = direction * t * maxBeakOffset;
    } else if (distanceToEdge > TIP_OFFSET_END) {
      beakOffset = direction * maxBeakOffset;
      const t = (BEAK_OFFSET_END - distanceToEdge) / (BEAK_OFFSET_END - TIP_OFFSET_END);
      const tExp = 1 - (1 - t) * (1 - t) * (1 - t);
      beakWidth = DEFAULT_BEAK_WIDTH - tExp * (DEFAULT_BEAK_WIDTH - CORNER_BEAK_WIDTH);
      beakTipOffset = direction * t * (beakWidth / 2);
    } else {
      beakOffset = direction * maxBeakOffset;
      beakWidth = CORNER_BEAK_WIDTH;
      beakTipOffset = direction * (beakWidth / 2);
    }
  }
  const maxTipOffset = beakWidth / 2 - TIP_RADIUS - BEAK_TIP_PADDING;
  const clampedTipOffset = Math.max(-maxTipOffset, Math.min(maxTipOffset, beakTipOffset));
  return {
    minBadgeX,
    maxBadgeX,
    beakOffset,
    beakTipOffset: clampedTipOffset,
    beakWidth
  };
}
const TIP_RADIUS = 2;
function generateBeakPath(beakWidth, tipOffset) {
  const tipX = beakWidth / 2 + tipOffset;
  const r = TIP_RADIUS;
  const y = BEAK_HEIGHT - r;
  return `M 0 0 L ${beakWidth} 0 L ${tipX + r} ${y} Q ${tipX} ${BEAK_HEIGHT} ${tipX - r} ${y} Z`;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarSlider));

/***/ }),

/***/ "./src/components/modals/priceConfirm/PriceConfirmModal.tsx":
/*!******************************************************************!*\
  !*** ./src/components/modals/priceConfirm/PriceConfirmModal.tsx ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");








const PriceConfirmModal = ({
  modal,
  starBalance,
  tonBalance
}) => {
  const actions = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleConfirm = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!modal?.directInfo) {
      actions.closePriceConfirmModal();
      return;
    }
    const {
      currency,
      newAmount
    } = modal;
    const isTon = currency === 'TON';
    const currentBalance = isTon ? tonBalance : starBalance?.amount;
    if (currentBalance === undefined) {
      actions.closePriceConfirmModal();
      return;
    }
    if (currentBalance < newAmount) {
      actions.openStarsBalanceModal({
        currency: isTon ? 'TON' : 'XTR',
        tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
      });
      actions.closePriceConfirmModal();
      return;
    }
    actions.sendStarPaymentForm({
      directInfo: modal.directInfo,
      tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
    });
    actions.closePriceConfirmModal();
  }, [modal, starBalance, tonBalance, actions]);
  const handleClose = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    actions.closePriceConfirmModal();
  }, [actions]);
  if (!modal) {
    return undefined;
  }
  const {
    originalAmount,
    newAmount,
    currency
  } = modal;
  const isTon = currency === 'TON';
  let originalAmountText;
  let newAmountText;
  if (isTon) {
    originalAmountText = (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatTonAsText)(lang, (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.convertTonFromNanos)(originalAmount));
    newAmountText = (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatTonAsText)(lang, (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.convertTonFromNanos)(newAmount));
  } else {
    originalAmountText = (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, originalAmount);
    newAmountText = (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, newAmount);
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_6__["default"], {
    isOpen: Boolean(modal),
    onClose: handleClose,
    title: lang('PriceChanged'),
    confirmHandler: handleConfirm,
    confirmLabel: lang('PayNewPrice'),
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("p", {
      children: lang('PriceChangedText', {
        originalAmount: originalAmountText,
        newAmount: newAmountText
      }, {
        withMarkdown: true,
        withNodes: true
      })
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const starBalance = global.stars?.balance;
  const tonBalance = global.ton?.balance?.amount;
  return {
    starBalance,
    tonBalance
  };
})(PriceConfirmModal)));

/***/ }),

/***/ "./src/components/modals/stars/BalanceBlock.tsx":
/*!******************************************************!*\
  !*** ./src/components/modals/stars/BalanceBlock.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./StarsBalanceModal.module.scss */ "./src/components/modals/stars/StarsBalanceModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const BalanceBlock = ({
  balance,
  className,
  withAddButton
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    openStarsBalanceModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const renderStarsAmount = () => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_9__["default"], {
        type: "gold",
        size: "middle"
      }), balance !== undefined && balance.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE ? (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_3__.formatStarsAmount)(lang, balance) : '', withAddButton && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].addStarsButton,
        onClick: () => openStarsBalanceModal({}),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].addStarsIcon,
          name: "add"
        })
      })]
    });
  };
  const renderTonAmount = () => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "toncoin"
      }), balance !== undefined ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.convertCurrencyFromBaseUnit)(balance.amount, balance.currency) : '']
    });
  };
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].balanceBlock, className),
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].balanceInfo,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].smallerText,
        children: lang('StarsBalance')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].balanceBottom,
        children: balance?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? renderTonAmount() : renderStarsAmount()
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(BalanceBlock));

/***/ }),

/***/ "./src/components/modals/stars/StarsBalanceModal.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"TtE8LQNJ","minimal":"nkV4JXHc","transition":"nXQS4E59","main":"JuWZY1ds","container":"mnhBs1uK","section":"lYkNd_gb","lastSection":"f749AI4g","sectionTitle":"FF8gm7MP","tos":"Vu6blJk9","hint":"Rs8WXoOz","topUpButton":"dc_DZoVF","tonBalanceContainer":"lorbW9II","tonBalance":"h2Fs3tOv","tonIconBalance":"Ut6GidJP","tonInUsd":"FdcdsB4l","tonIconLogo":"_hCjjyEv","description":"teXilLxe","header":"fnhXotO2","starHeaderText":"iUwego5s","botItem":"AhxcrKWn","hiddenHeader":"DZk6d6hF","noSeparator":"UwUaTrab","closeButton":"piD1PXHW","addStarsButton":"dqnGL2uh","addStarsIcon":"w9Db2eiK","balanceBlock":"Yk0OQBKC","balanceInfo":"p2dW9NOV","smallerText":"rUnPcfmE","balanceBottom":"F5BTkZ9G","modalBalance":"t8tMrx3y","starButton":"oOt4VBD2","paymentContent":"OReEUNTV","paymentImages":"oKorQYTC","paymentPhoto":"HGTrEtUF","avatarStar":"Wu10dXoa","paymentImageBackground":"os8jb_qv","paymentButton":"VzR5cibf","paymentButtonStar":"Uhg7yWxK","transactions":"Qvc0fTTH","subscriptions":"IX5BhCUF","tabs":"KZVEyKOX","disclaimer":"bpVifdwH","amountBadge":"BPM7LKwo","loadMore":"TKmZjMyd","loadMoreIcon":"buepwtN1"});

/***/ }),

/***/ "./src/components/modals/stars/StarsBalanceModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _common_ParticlesHeader_tsx__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../common/ParticlesHeader.tsx */ "./src/components/modals/common/ParticlesHeader.tsx");
/* harmony import */ var _BalanceBlock__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _StarTopupOptionList__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./StarTopupOptionList */ "./src/components/modals/stars/StarTopupOptionList.tsx");
/* harmony import */ var _subscription_StarsSubscriptionItem__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./subscription/StarsSubscriptionItem */ "./src/components/modals/stars/subscription/StarsSubscriptionItem.tsx");
/* harmony import */ var _transaction_StarsTransactionItem__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./transaction/StarsTransactionItem */ "./src/components/modals/stars/transaction/StarsTransactionItem.tsx");
/* harmony import */ var _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./StarsBalanceModal.module.scss */ "./src/components/modals/stars/StarsBalanceModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






























const HEADER_HEIGHT = 3.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__.REM;
const TRANSACTION_TYPES = ['all', 'inbound', 'outbound'];
const TRANSACTION_TABS_KEYS = ['StarsTransactionsAll', 'StarsTransactionsIncoming', 'StarsTransactionsOutgoing'];
const TRANSACTION_ITEM_CLASS = 'StarsTransactionItem';
const SUBSCRIPTION_PURPOSE = 'subs';
const StarsBalanceModal = ({
  modal,
  starsBalanceState,
  tonBalanceState,
  canBuyPremium,
  shouldForceHeight,
  tonUsdRate,
  tonTopupUrl,
  animationLevel
}) => {
  const {
    closeStarsBalanceModal,
    loadStarsTransactions,
    loadStarsSubscriptions,
    openStarsGiftingPickerModal,
    openInvoice,
    openUrl
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const currency = modal?.currency || _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE;
  const currentState = currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? tonBalanceState : starsBalanceState;
  const {
    balance,
    history
  } = currentState || {};
  const {
    subscriptions
  } = currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE && starsBalanceState || {};
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [isHeaderHidden, setHeaderHidden] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [areTabsPinned, pinTabs, unpinTabs] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__["default"])(false);
  const [selectedTabIndex, setSelectedTabIndex] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [areBuyOptionsShown, showBuyOptions, hideBuyOptions] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const tabsRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isOpen = Boolean(modal && (starsBalanceState || tonBalanceState));
  const {
    originStarsPayment,
    originReaction,
    originGift,
    topup
  } = modal || {};
  const shouldOpenOnBuy = originStarsPayment || originReaction || originGift || topup;
  const ongoingTransactionAmount = originStarsPayment?.form?.invoice?.totalAmount || originStarsPayment?.subscriptionInfo?.subscriptionPricing?.amount || originReaction?.amount || originGift?.gift.stars || topup?.balanceNeeded;
  const starsNeeded = ongoingTransactionAmount ? ongoingTransactionAmount - (balance?.amount || 0) : undefined;
  const starsNeededText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    if (originReaction) {
      const channel = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, originReaction.chatId);
      if (!channel) return undefined;
      return oldLang('StarsNeededTextReactions', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getChatTitle)(oldLang, channel));
    }
    if (originStarsPayment) {
      const bot = originStarsPayment.form?.botId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUser)(global, originStarsPayment.form.botId) : undefined;
      if (!bot) return undefined;
      return oldLang('StarsNeededText', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(bot));
    }
    if (originGift) {
      const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUser)(global, originGift.peerId);
      if (!peer) return undefined;
      return oldLang('StarsNeededTextGift', (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, peer));
    }
    if (topup?.purpose === SUBSCRIPTION_PURPOSE) {
      return oldLang('StarsNeededTextLink');
    }
    if (topup?.purpose === _config__WEBPACK_IMPORTED_MODULE_2__.PAID_MESSAGES_PURPOSE) {
      return lang('StarsNeededTextSendPaidMessages', undefined, {
        withMarkdown: true,
        withNodes: true
      });
    }
    return undefined;
  }, [originReaction, originStarsPayment, originGift, topup?.purpose, lang, oldLang]);
  const shouldShowItems = Boolean(history?.all?.transactions.length && !shouldOpenOnBuy);
  const shouldSuggestGifting = !shouldOpenOnBuy;
  const modalHeight = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const transactionCount = history?.all?.transactions.length || 0;
    if (transactionCount === 1) {
      return '35.5rem';
    }
    if (transactionCount === 2) {
      return '39.25rem';
    }
    if (transactionCount === 3) {
      return '43rem';
    }
    return '45rem';
  }, [history?.all?.transactions.length]);
  const transactionTabs = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return TRANSACTION_TABS_KEYS.map(key => ({
      title: lang(key)
    }));
  }, [lang]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setHeaderHidden(true);
      setSelectedTabIndex(0);
      hideBuyOptions();
      unpinTabs();
    }
  }, [isOpen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldOpenOnBuy) {
      showBuyOptions();
      return;
    }
    hideBuyOptions();
  }, [shouldOpenOnBuy]);
  const tosText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    const text = oldLang('lng_credits_summary_options_about');
    const parts = text.split('{link}');
    return [parts[0], (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_17__["default"], {
      url: oldLang('StarsTOSLink'),
      text: oldLang('lng_credits_summary_options_about_link')
    }), parts[1]];
  }, [isOpen, oldLang]);
  const renderStarsHeaderSection = () => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_common_ParticlesHeader_tsx__WEBPACK_IMPORTED_MODULE_23__["default"], {
        model: "swaying-star",
        color: "gold",
        title: starsNeeded ? oldLang('StarsNeededTitle', ongoingTransactionAmount) : oldLang('TelegramStars'),
        description: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(starsNeededText || oldLang('TelegramStarsInfo'), ['simple_markdown', 'emoji']),
        isDisabled: !isOpen
      }), canBuyPremium && !areBuyOptionsShown && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].starButton,
        onClick: showBuyOptions,
        fluid: true,
        children: oldLang('Star.List.BuyMoreStars')
      }), canBuyPremium && !areBuyOptionsShown && shouldSuggestGifting && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
        isText: true,
        noForcedUpperCase: true,
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].starButton,
        fluid: true,
        onClick: openStarsGiftingPickerModalHandler,
        children: oldLang('TelegramStarsGift')
      }), areBuyOptionsShown && starsBalanceState?.topupOptions && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_StarTopupOptionList__WEBPACK_IMPORTED_MODULE_25__["default"], {
        starsNeeded: starsNeeded,
        options: starsBalanceState.topupOptions,
        onClick: handleBuyStars
      })]
    });
  };
  const renderTonHeaderSection = () => {
    const tonAmount = (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_8__.convertCurrencyFromBaseUnit)(balance?.amount || 0, _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE);
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_common_ParticlesHeader_tsx__WEBPACK_IMPORTED_MODULE_23__["default"], {
        model: "speeding-diamond",
        color: "blue",
        title: lang('CurrencyTon'),
        description: lang('DescriptionAboutTon'),
        isDisabled: !isOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tonBalanceContainer,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)("div", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tonBalance,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
            name: "toncoin",
            className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tonIconBalance
          }), tonAmount]
        }), Boolean(tonUsdRate) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("span", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tonInUsd,
          children: ` ${(0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_8__.formatCurrencyAsString)((0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_8__.convertTonToUsd)(balance?.amount || 0, tonUsdRate, true), 'USD', lang.code)}`
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].topUpButton,
        onClick: handleTonTopUp,
        fluid: true,
        children: lang('ButtonTopUpViaFragment')
      }), currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].hint,
        children: lang('TonModalHint')
      })]
    });
  };
  function handleScroll(e) {
    const {
      scrollTop
    } = e.currentTarget;
    setHeaderHidden(scrollTop <= 150);
    if (tabsRef.current) {
      const {
        top: tabsTop
      } = tabsRef.current.getBoundingClientRect();
      const {
        top: scrollerTop
      } = e.currentTarget.getBoundingClientRect();
      const isPinned = tabsTop - scrollerTop <= HEADER_HEIGHT;
      if (isPinned) {
        pinTabs();
      } else {
        unpinTabs();
      }
    }
  }
  const handleLoadMoreTransactions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    loadStarsTransactions({
      type: TRANSACTION_TYPES[selectedTabIndex],
      isTon: currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE
    });
  });
  const handleLoadMoreSubscriptions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    loadStarsSubscriptions();
  });
  const openStarsGiftingPickerModalHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openStarsGiftingPickerModal({});
  });
  const handleBuyStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(option => {
    const originPaymentInputInvoice = originStarsPayment?.inputInvoice;
    let spendPurposePeerId;
    switch (originPaymentInputInvoice?.type) {
      case 'message':
        {
          spendPurposePeerId = originPaymentInputInvoice.chatId;
          break;
        }
      case 'slug':
        {
          const form = originStarsPayment?.form;
          spendPurposePeerId = form?.botId;
          break;
        }
    }
    if (originReaction) {
      spendPurposePeerId = originReaction.chatId;
    }
    openInvoice({
      type: 'stars',
      stars: option.stars,
      currency: option.currency,
      amount: option.amount,
      spendPurposePeerId
    });
  });
  const handleTonTopUp = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openUrl({
      url: tonTopupUrl
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_20__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].root, !shouldForceHeight && !areBuyOptionsShown && _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].minimal),
    isOpen: isOpen,
    onClose: closeStarsBalanceModal,
    dialogStyle: `--modal-height: ${modalHeight}`,
    hasAbsoluteCloseButton: true,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].main, 'custom-scroll'),
      onScroll: handleScroll,
      children: [currency !== _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_BalanceBlock__WEBPACK_IMPORTED_MODULE_24__["default"], {
        balance: balance,
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].modalBalance
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].header, isHeaderHidden && _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].hiddenHeader, areTabsPinned && _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].noSeparator),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("h2", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].starHeaderText,
          children: oldLang('TelegramStars')
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].section,
        children: currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? renderTonHeaderSection() : renderStarsHeaderSection()
      }), areBuyOptionsShown && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tos,
        children: tosText
      }), shouldShowItems && Boolean(subscriptions?.list.length) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("h3", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].sectionTitle,
          children: oldLang('StarMySubscriptions')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)("div", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].subscriptions,
          children: [subscriptions?.list.map(subscription => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_subscription_StarsSubscriptionItem__WEBPACK_IMPORTED_MODULE_26__["default"], {
            subscription: subscription
          }, subscription.id)), subscriptions?.nextOffset && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
            isText: true,
            disabled: subscriptions.isLoading,
            size: "smaller",
            noForcedUpperCase: true,
            className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].loadMore,
            onClick: handleLoadMoreSubscriptions,
            children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
              name: "down",
              className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].loadMoreIcon
            }), oldLang('StarMySubscriptionsExpand')]
          })]
        })]
      }), shouldShowItems && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].container,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)("div", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].lastSection,
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_22__["default"], {
            name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_9__.resolveTransitionName)('slideOptimized', animationLevel, undefined, lang.isRtl),
            activeKey: selectedTabIndex,
            renderCount: TRANSACTION_TABS_KEYS.length,
            shouldRestoreHeight: true,
            className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].transition,
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__["default"], {
              onLoadMore: handleLoadMoreTransactions,
              items: history?.[TRANSACTION_TYPES[selectedTabIndex]]?.transactions,
              scrollContainerClosest: `.${_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].main}`,
              itemSelector: `.${TRANSACTION_ITEM_CLASS}`,
              className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].transactions,
              noFastList: true,
              noScrollRestoreOnTop: true,
              children: history?.[TRANSACTION_TYPES[selectedTabIndex]]?.transactions.map(transaction => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_transaction_StarsTransactionItem__WEBPACK_IMPORTED_MODULE_27__["default"], {
                transaction: transaction,
                className: TRANSACTION_ITEM_CLASS
              }, `${transaction.id}-${transaction.isRefund}`))
            })
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_29__.jsx)(_ui_TabList__WEBPACK_IMPORTED_MODULE_21__["default"], {
          ref: tabsRef,
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tabs,
          tabClassName: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_28__["default"].tab,
          activeTab: selectedTabIndex,
          tabs: transactionTabs,
          onSwitchTab: setSelectedTabIndex
        })]
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const shouldForceHeight = modal?.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE ? Boolean(global.ton?.history?.all?.transactions.length) : Boolean(global.stars?.history?.all?.transactions.length);
  return {
    shouldForceHeight,
    starsBalanceState: global.stars,
    tonBalanceState: global.ton,
    canBuyPremium: !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsPremiumPurchaseBlocked)(global),
    tonUsdRate: global.appConfig.tonUsdRate,
    tonTopupUrl: global.appConfig.tonTopupUrl,
    animationLevel: (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_6__.selectSharedSettings)(global).animationLevel
  };
})(StarsBalanceModal)));

/***/ }),

/***/ "./src/components/modals/stars/StarsPaymentModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/stars/StarsPaymentModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_PeerBadge__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PeerBadge */ "./src/components/common/PeerBadge.tsx");
/* harmony import */ var _common_PeerChip__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PeerChip */ "./src/components/common/PeerChip.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _BalanceBlock__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _transaction_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./transaction/PaidMediaThumb */ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx");
/* harmony import */ var _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./StarsBalanceModal.module.scss */ "./src/components/modals/stars/StarsBalanceModal.module.scss");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

























const StarPaymentModal = ({
  modal,
  bot,
  starsBalanceState,
  paidMediaMessage,
  paidMediaChat
}) => {
  const {
    closeStarsPaymentModal,
    openStarsBalanceModal,
    sendStarPaymentForm
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isLoading, markLoading, unmarkLoading] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isOpen = Boolean(modal?.inputInvoice && starsBalanceState);
  const prevModal = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__["default"])(modal);
  const renderingModal = modal || prevModal;
  const {
    form,
    subscriptionInfo
  } = renderingModal || {};
  const amount = form?.invoice?.totalAmount || subscriptionInfo?.subscriptionPricing?.amount;
  const isBotSubscription = Boolean(form?.invoice.subscriptionPeriod);
  const canShowPeerItem = !subscriptionInfo?.subscriptionPricing;
  const photo = form?.photo;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      unmarkLoading();
    }
  }, [isOpen]);
  const descriptionText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!renderingModal?.inputInvoice) {
      return '';
    }
    const botName = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(bot);
    const starsText = oldLang('Stars.Intro.PurchasedText.Stars', amount);
    if (paidMediaMessage) {
      const extendedMedia = paidMediaMessage.content.paidMedia.extendedMedia;
      const areAllPhotos = extendedMedia.every(media => !media.duration);
      const areAllVideos = extendedMedia.every(media => Boolean(media.duration));
      const mediaText = areAllPhotos ? oldLang('Stars.Transfer.Photos', extendedMedia.length) : areAllVideos ? oldLang('Stars.Transfer.Videos', extendedMedia.length) : oldLang('Media', extendedMedia.length);
      const channelTitle = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(oldLang, paidMediaChat);
      return oldLang('Stars.Transfer.UnlockInfo', [mediaText, channelTitle, starsText]);
    }
    if (subscriptionInfo) {
      return lang('StarsSubscribeText', {
        chat: subscriptionInfo.title,
        amount
      }, {
        withNodes: true,
        withMarkdown: true,
        pluralValue: amount
      });
    }
    if (isBotSubscription) {
      return lang('StarsSubscribeBotText', {
        name: form.title,
        amount,
        bot: botName
      }, {
        pluralValue: amount
      });
    }
    return oldLang('Stars.Transfer.Info', [form.title, botName, starsText]);
  }, [renderingModal?.inputInvoice, bot, oldLang, amount, paidMediaMessage, subscriptionInfo, isBotSubscription, form, paidMediaChat, lang]);
  const disclaimerText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (subscriptionInfo) {
      return lang('StarsSubscribeInfo', {
        link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_17__["default"], {
          url: lang('StarsSubscribeInfoLink'),
          text: lang('StarsSubscribeInfoLinkText')
        })
      }, {
        withNodes: true
      });
    }
    return undefined;
  }, [subscriptionInfo, lang]);
  const inviteCustomPeer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!subscriptionInfo) {
      return undefined;
    }
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCustomPeerFromInvite)(subscriptionInfo);
  }, [subscriptionInfo]);
  const handlePayment = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    const balance = starsBalanceState?.balance;
    if (amount === undefined || balance === undefined) {
      return;
    }
    if (amount > balance.amount) {
      openStarsBalanceModal({
        originStarsPayment: modal
      });
      return;
    }
    sendStarPaymentForm({});
    markLoading();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_19__["default"], {
    contentClassName: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentContent,
    isOpen: isOpen,
    hasAbsoluteCloseButton: true,
    isSlim: true,
    onClose: closeStarsPaymentModal,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_BalanceBlock__WEBPACK_IMPORTED_MODULE_20__["default"], {
      balance: starsBalanceState?.balance,
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].modalBalance
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentImages,
      dir: lang.isRtl ? 'ltr' : 'rtl',
      children: [paidMediaMessage ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_transaction_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_21__["default"], {
        media: paidMediaMessage.content.paidMedia.extendedMedia
      }) : inviteCustomPeer ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentPhoto,
          peer: inviteCustomPeer,
          size: "giant"
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__["default"], {
          type: "gold",
          size: "adaptive",
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].avatarStar
        })]
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_PeerBadge__WEBPACK_IMPORTED_MODULE_15__["default"], {
        peer: !photo ? bot : undefined,
        avatarWebPhoto: photo,
        avatarSize: "giant",
        badgeIcon: "star",
        badgeText: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_6__.formatInteger)(amount),
        badgeClassName: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].amountBadge,
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentPhoto
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("img", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentImageBackground,
        src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_23__,
        alt: "",
        draggable: false
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("h2", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].headerText,
      children: inviteCustomPeer ? oldLang('StarsSubscribeTitle') : oldLang('StarsConfirmPurchaseTitle')
    }), canShowPeerItem && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_PeerChip__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].botItem,
      peerId: form?.botId
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].description,
      children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(descriptionText, ['simple_markdown', 'emoji'])
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentButton,
      onClick: handlePayment,
      isLoading: isLoading,
      children: lang(isBotSubscription ? 'StarsSubscribeBotButtonMonth' : 'StarsPay', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_5__.formatStarsAsIcon)(lang, amount, {
          asFont: true
        })
      }, {
        withNodes: true
      })
    }), Boolean(disclaimerText) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].disclaimer, _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].smallerText),
      children: disclaimerText
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const bot = modal?.form?.botId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, modal.form.botId) : undefined;
  const messageInputInvoice = modal?.inputInvoice?.type === 'message' ? modal.inputInvoice : undefined;
  const message = messageInputInvoice ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatMessage)(global, messageInputInvoice.chatId, messageInputInvoice.messageId) : undefined;
  const chat = messageInputInvoice ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, messageInputInvoice.chatId) : undefined;
  const isPaidMedia = message?.content.paidMedia;
  return {
    bot,
    starsBalanceState: global.stars,
    paidMediaMessage: isPaidMedia ? message : undefined,
    paidMediaChat: isPaidMedia ? chat : undefined
  };
})(StarPaymentModal)));

/***/ }),

/***/ "./src/components/modals/stars/chatRefund/ChatRefundModal.tsx":
/*!********************************************************************!*\
  !*** ./src/components/modals/stars/chatRefund/ChatRefundModal.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const ChatRefundModal = ({
  modal,
  user
}) => {
  const {
    closeChatRefundModal,
    toggleNoPaidMessagesException
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [shouldRefundStars, setShouldRefundStars] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const renderingUser = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(user);
  const {
    starsToRefund,
    userId
  } = renderingModal || {};
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const handleConfirmRemoveFee = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    closeChatRefundModal();
    if (!userId) return;
    toggleNoPaidMessagesException({
      userId,
      shouldRefundCharged: shouldRefundStars
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isOpen: isOpen,
    onClose: closeChatRefundModal,
    title: lang('RemoveFeeTitle'),
    confirmLabel: lang('ConfirmRemoveMessageFee'),
    confirmHandler: handleConfirmRemoveFee,
    children: [lang('ConfirmDialogMessageRemoveFee', {
      peer: renderingUser && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingUser)
    }, {
      withMarkdown: true,
      withNodes: true
    }), Boolean(starsToRefund) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_8__["default"], {
      className: "dialog-checkbox",
      label: lang('ConfirmDialogRemoveFeeRefundStars', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, starsToRefund)
      }, {
        withMarkdown: true,
        withNodes: true
      }),
      checked: shouldRefundStars,
      onCheck: setShouldRefundStars
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const user = modal?.userId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, modal.userId) : undefined;
  return {
    user
  };
})(ChatRefundModal)));

/***/ }),

/***/ "./src/components/modals/stars/gift/StarsGiftModal.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/modals/stars/gift/StarsGiftModal.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modalDialog":"MFXAwnxJ","content":"Sl6xVf1R","main":"bTN9Jeph","headerInfo":"c6MiyJgW","logo":"StGLWvzb","logoBackground":"SyTXSfml","description":"kFe3mIZo","section":"BgfHkWd2","header":"zMtAGfXs","starHeaderText":"q3v8orGj","hiddenHeader":"bq3FnXT0","closeButton":"bDsDTkbe","avatar":"jK36xUj4","center":"v1PckUQn","secondaryInfo":"TDWSRfP9"});

/***/ }),

/***/ "./src/components/modals/stars/gift/StarsGiftModal.tsx":
/*!*************************************************************!*\
  !*** ./src/components/modals/stars/gift/StarsGiftModal.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _StarTopupOptionList__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../StarTopupOptionList */ "./src/components/modals/stars/StarTopupOptionList.tsx");
/* harmony import */ var _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./StarsGiftModal.module.scss */ "./src/components/modals/stars/gift/StarsGiftModal.module.scss");
/* harmony import */ var _assets_icons_GoldStar_svg__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../assets/icons/GoldStar.svg */ "./src/assets/icons/GoldStar.svg");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");


















const AVATAR_SIZE = 100;
const StarsGiftModal = ({
  modal,
  user
}) => {
  const {
    closeStarsGiftModal,
    openInvoice,
    requestConfetti
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const dialogRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isOpen = Boolean(modal?.isOpen);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(modal);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [selectedOption, setSelectedOption] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isHeaderHidden, setHeaderHidden] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setHeaderHidden(true);
    }
  }, [isOpen]);
  const showConfetti = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    const dialog = dialogRef.current;
    if (!dialog) return;
    if (isOpen) {
      const {
        top,
        left,
        width,
        height
      } = dialog.querySelector('.modal-content').getBoundingClientRect();
      requestConfetti({
        top,
        left,
        width,
        height,
        withStars: true
      });
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (renderingModal?.isCompleted) {
      showConfetti();
    }
  }, [renderingModal, showConfetti]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(option => {
    if (!renderingModal) return;
    setSelectedOption(option);
    if (user) {
      openInvoice({
        type: 'starsgift',
        userId: user.id,
        stars: option.stars,
        currency: option.currency,
        amount: option.amount
      });
    } else {
      openInvoice({
        type: 'stars',
        stars: option.stars,
        currency: option.currency,
        amount: option.amount
      });
    }
  });
  function handleScroll(e) {
    const {
      scrollTop
    } = e.currentTarget;
    setHeaderHidden(scrollTop <= 150);
  }
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    closeStarsGiftModal();
  });
  function renderGiftTitle() {
    if (renderingModal?.isCompleted) {
      return user ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('Notification.StarsGift.SentYou', (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.formatCurrencyAsString)(selectedOption.amount, selectedOption.currency, oldLang.code)), ['simple_markdown']) : (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('StarsAcquiredInfo', selectedOption?.stars), ['simple_markdown']);
    }
    return user ? oldLang('GiftStarsTitle') : oldLang('Star.List.GetStars');
  }
  const bottomText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const text = oldLang('lng_credits_summary_options_about');
    const parts = text.split('{link}');
    return [parts[0], (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_11__["default"], {
      url: oldLang('StarsTOSLink'),
      text: oldLang('lng_credits_summary_options_about_link')
    }), parts[1]];
  }, [oldLang]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_12__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].modalDialog),
    contentClassName: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].content,
    dialogRef: dialogRef,
    isSlim: true,
    onClose: handleClose,
    isOpen: isOpen,
    hasAbsoluteCloseButton: true,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].main, 'custom-scroll'),
      onScroll: handleScroll,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].header, isHeaderHidden && _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].hiddenHeader),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("h2", {
          className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].starHeaderText,
          children: user ? oldLang('GiftStarsTitle') : oldLang('Star.List.GetStars')
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("div", {
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].headerInfo,
        children: user ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
            size: AVATAR_SIZE,
            peer: user,
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].avatar
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("img", {
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].logoBackground,
            src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_16__,
            alt: "",
            draggable: false
          })]
        }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("img", {
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].logo,
            src: _assets_icons_GoldStar_svg__WEBPACK_IMPORTED_MODULE_15__,
            alt: "",
            draggable: false
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("img", {
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].logoBackground,
            src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_16__,
            alt: "",
            draggable: false
          })]
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("h2", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].headerText, _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].center),
        children: renderGiftTitle()
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("p", {
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].description,
        children: user ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('ActionGiftStarsSubtitle', (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(oldLang, user)), ['simple_markdown']) : oldLang('Stars.Purchase.GetStarsInfo')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div", {
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_StarTopupOptionList__WEBPACK_IMPORTED_MODULE_13__["default"], {
          options: renderingModal?.starsGiftOptions,
          onClick: handleClick
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("div", {
          className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].secondaryInfo,
          children: bottomText
        })]
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const user = modal?.forUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, modal.forUserId) : undefined;
  return {
    user
  };
})(StarsGiftModal)));

/***/ }),

/***/ "./src/components/modals/stars/helpers/transaction.ts":
/*!************************************************************!*\
  !*** ./src/components/modals/stars/helpers/transaction.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getTransactionTitle: () => (/* binding */ getTransactionTitle),
/* harmony export */   isNegativeAmount: () => (/* binding */ isNegativeAmount)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");



function getTransactionTitle(oldLang, lang, transaction) {
  if (transaction.paidMessages) {
    return lang('PaidMessageTransaction', {
      count: transaction.paidMessages
    }, {
      withNodes: true,
      pluralValue: transaction.paidMessages
    });
  }
  if (transaction.isGiftResale) {
    return isNegativeAmount(transaction.amount) ? lang('StarGiftSaleTransaction') : lang('StarGiftPurchaseTransaction');
  }
  if (transaction.isPostsSearch) {
    return lang('PostsSearchTransaction');
  }
  if (transaction.isDropOriginalDetails) {
    return lang('DropOriginalDetailsTransaction');
  }
  if (transaction.isPrepaidUpgrade) {
    return lang('GiftPrepaidUpgradeTransactionTitle');
  }
  if (transaction.isStarGiftAuctionBid) {
    return isNegativeAmount(transaction.amount) ? lang('StarGiftAuctionBidTransaction') : lang('StarGiftAuctionBidRefundedTransaction');
  }
  if (transaction.starRefCommision) {
    return oldLang('StarTransactionCommission', (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_2__.formatPercent)(transaction.starRefCommision));
  }
  if (transaction.isGiftUpgrade) return oldLang('Gift2TransactionUpgraded');
  if (transaction.extendedMedia) return oldLang('StarMediaPurchase');
  if (transaction.subscriptionPeriod) return transaction.title || oldLang('StarSubscriptionPurchase');
  if (transaction.isReaction) return oldLang('StarsReactionsSent');
  if (transaction.giveawayPostId) return oldLang('StarsGiveawayPrizeReceived');
  if (transaction.isMyGift) return oldLang('StarsGiftSent');
  if (transaction.isGift) {
    if (transaction.amount.currency === _config__WEBPACK_IMPORTED_MODULE_0__.TON_CURRENCY_CODE) {
      return lang('TonGiftReceived');
    }
    return oldLang('StarsGiftReceived');
  }
  if (transaction.starGift) {
    return isNegativeAmount(transaction.amount) ? oldLang('Gift2TransactionSent') : oldLang('Gift2ConvertedTitle');
  }
  const customPeer = transaction.peer && (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_1__.shouldUseCustomPeer)(transaction) && (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_1__.buildStarsTransactionCustomPeer)(transaction) || undefined;
  if (customPeer) return customPeer.title || oldLang(customPeer.titleKey);
  return transaction.title;
}
function isNegativeAmount(currencyAmount) {
  if (currencyAmount.currency === _config__WEBPACK_IMPORTED_MODULE_0__.STARS_CURRENCY_CODE) {
    if (currencyAmount.amount) return currencyAmount.amount < 0;
    return currencyAmount.nanos < 0;
  }
  return currencyAmount.amount < 0;
}

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionItem.module.scss":
/*!************************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionItem.module.scss ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"ZXnbeQxP","info":"zLaaDX3c","status":"HbF2qTB2","statusPricing":"AveGvpdV","amount":"_CBiOQcv","title":"k9ZIv5Pd","description":"FlRlxMx2","subtitle":"YN2J8dw6","statusPeriod":"MRrP7Oew","statusEnded":"pRHwfr8m","preview":"t6Syyhzd","subscriptionStar":"ftlbevPm"});

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionItem.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionItem.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/data/useSelector */ "./src/hooks/data/useSelector.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./StarsSubscriptionItem.module.scss */ "./src/components/modals/stars/subscription/StarsSubscriptionItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");














function selectProvidedPeer(peerId) {
  return global => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, peerId);
}
const StarsSubscriptionItem = ({
  subscription
}) => {
  const {
    openStarsSubscriptionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    peerId,
    pricing,
    until,
    isCancelled,
    title,
    photo
  } = subscription;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const peer = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_7__["default"])(selectProvidedPeer(peerId));
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openStarsSubscriptionModal({
      subscription
    });
  });
  if (!peer) {
    return undefined;
  }
  const hasExpired = until < Date.now() / 1000;
  const formattedDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateToString)(until * 1000, lang.code, true, 'long');
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
    className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].root,
    onClick: handleClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
      className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].preview,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
        size: "medium",
        peer: peer
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__["default"], {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].subscriptionStar,
        type: "gold",
        size: "small"
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
      className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].info,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("h3", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].title,
        children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])((0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, peer) || '')
      }), title && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("p", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].subtitle,
        children: [photo && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
          webPhoto: photo,
          size: "micro"
        }), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(title)]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("p", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].description,
        children: lang(hasExpired ? 'StarsSubscriptionExpired' : isCancelled ? 'StarsSubscriptionExpires' : 'StarsSubscriptionRenews', formattedDate)
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
      className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].status,
      children: isCancelled || hasExpired ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].statusEnded,
        children: lang(hasExpired ? 'StarsSubscriptionStatusExpired' : 'StarsSubscriptionStatusCancelled')
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
          className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].statusPricing,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__["default"], {
            className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].star,
            type: "gold",
            size: "adaptive"
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span", {
            className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].amount,
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.formatInteger)(pricing.amount)
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
          className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].statusPeriod,
          children: lang('StarsParticipantSubscriptionPerMonth')
        })]
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarsSubscriptionItem));

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionModal.module.scss":
/*!*************************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionModal.module.scss ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"eR_RZfGB","header":"E3R22yAI","title":"qdydQHgc","amount":"FI6rEJlK","footer":"GMWMuWCr","starsBackground":"zGCayu45","subscriptionStar":"enRetSny","amountStar":"J8HIcN6k","secondary":"oBLHWBtJ","danger":"nkwiG25Q","avatarWrapper":"wuTMXDP9"});

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionModal.tsx":
/*!*****************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionModal.tsx ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_InteractiveSparkles__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/InteractiveSparkles */ "./src/components/common/InteractiveSparkles.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./StarsSubscriptionModal.module.scss */ "./src/components/modals/stars/subscription/StarsSubscriptionModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const AVATAR_SPARKLES_CENTER_SHIFT = [0, -50];
const StarsSubscriptionModal = ({
  modal,
  peer
}) => {
  const {
    closeStarsSubscriptionModal,
    fulfillStarsSubscription,
    changeStarsSubscription,
    checkChatInvite,
    loadStarStatus,
    openInvoice
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    subscription
  } = modal || {};
  const triggerSparklesRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const handleAvatarMouseMove = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    triggerSparklesRef.current?.();
  });
  const handleRequestAnimation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(animate => {
    triggerSparklesRef.current = animate;
  });
  const buttonState = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!subscription) {
      return 'hidden';
    }
    if (subscription.canRefulfill) {
      return 'refulfill';
    }
    const isActive = subscription.until > Date.now() / 1000;
    if (isActive && !subscription.isCancelled) {
      return 'cancel';
    }
    if (isActive && subscription.isCancelled) {
      return 'renew';
    }
    const canRestart = subscription.chatInviteHash || subscription.invoiceSlug;
    if (!isActive && canRestart) {
      return 'restart';
    }
    return 'ok';
  }, [subscription]);
  const handleButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!subscription) {
      return;
    }
    switch (buttonState) {
      case 'refulfill':
        {
          fulfillStarsSubscription({
            id: subscription.id
          });
          break;
        }
      case 'restart':
        {
          if (subscription.chatInviteHash) {
            checkChatInvite({
              hash: subscription.chatInviteHash
            });
          } else if (subscription.invoiceSlug) {
            openInvoice({
              type: 'slug',
              slug: subscription.invoiceSlug
            });
          }
          loadStarStatus();
          break;
        }
      case 'renew':
        {
          changeStarsSubscription({
            id: subscription.id,
            isCancelled: false
          });
          break;
        }
      case 'cancel':
        {
          changeStarsSubscription({
            id: subscription.id,
            isCancelled: true
          });
          break;
        }
    }
    closeStarsSubscriptionModal();
  });
  const starModalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!subscription || !peer) {
      return undefined;
    }
    const {
      pricing,
      until,
      isCancelled,
      canRefulfill,
      photo,
      title,
      hasBotCancelled
    } = subscription;
    const isBotSubscription = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(peer);
    const header = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
      className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].avatarWrapper,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
          peer: !photo ? peer : undefined,
          webPhoto: photo,
          size: "giant",
          onMouseMove: handleAvatarMouseMove
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_12__["default"], {
          className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].subscriptionStar,
          type: "gold",
          size: "adaptive"
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_InteractiveSparkles__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].starsBackground),
        color: "gold",
        onRequestAnimation: handleRequestAnimation,
        centerShift: AVATAR_SPARKLES_CENTER_SHIFT
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("h1", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].title,
        children: title || oldLang('StarsSubscriptionTitle')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].amount,
        children: lang('StarsPerMonth', {
          amount: pricing.amount
        }, {
          withNodes: true,
          specialReplacement: {
            [_config__WEBPACK_IMPORTED_MODULE_2__.STARS_ICON_PLACEHOLDER]: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_12__["default"], {
              className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].amountStar,
              size: "adaptive",
              type: "gold"
            })
          }
        })
      })]
    });
    const tableData = [];
    tableData.push([oldLang(isBotSubscription ? 'StarsSubscriptionBot' : 'StarsSubscriptionChannel'), {
      chatId: peer.id
    }]);
    if (title) {
      tableData.push([oldLang('StarsSubscriptionBotProduct'), title]);
    }
    const hasExpired = until < Date.now() / 1000;
    tableData.push([oldLang(hasExpired ? 'StarsSubscriptionUntilExpired' : isCancelled ? 'StarsSubscriptionUntilExpires' : 'StarsSubscriptionUntilRenews'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true)]);
    const footerTos = lang('StarsTransactionTOS', {
      link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_14__["default"], {
        url: lang('StarsTransactionTOSLink'),
        text: lang('StarsTransactionTOSLinkText')
      })
    }, {
      withNodes: true
    });
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span", {
      className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].footer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].secondary,
        children: footerTos
      }), isCancelled && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].danger,
        children: oldLang(hasBotCancelled ? 'StarsSubscriptionBotCancelledText' : 'StarsSubscriptionCancelledText')
      }), canRefulfill && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].secondary,
        children: oldLang('StarsSubscriptionRefulfillInfo', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true))
      }), !isCancelled && !canRefulfill && hasExpired && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].secondary,
        children: oldLang('StarsSubscriptionExpiredInfo', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true))
      }), !isCancelled && !canRefulfill && !hasExpired && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].secondary,
        children: oldLang('StarsSubscriptionCancelInfo', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true))
      }), buttonState !== 'hidden' && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
        color: buttonState === 'cancel' ? 'danger' : 'primary',
        isText: buttonState === 'cancel',
        onClick: handleButtonClick,
        children: oldLang(buttonState === 'cancel' ? 'StarsSubscriptionCancel' : buttonState === 'refulfill' ? 'StarsSubscriptionRefulfill' : buttonState === 'restart' ? 'StarsSubscriptionAgain' : buttonState === 'renew' ? 'StarsSubscriptionRenew' : 'OK')
      })]
    });
    return {
      header,
      tableData,
      footer
    };
  }, [buttonState, lang, oldLang, peer, subscription]);
  const prevModalData = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_10__["default"])(starModalData);
  const renderingModalData = prevModalData || starModalData;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    isOpen: Boolean(subscription),
    className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].modal,
    header: renderingModalData?.header,
    tableData: renderingModalData?.tableData,
    footer: renderingModalData?.footer,
    onClose: closeStarsSubscriptionModal
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const peerId = modal?.subscription.peerId;
  const peer = peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId) : undefined;
  return {
    peer
  };
})(StarsSubscriptionModal)));

/***/ }),

/***/ "./src/components/modals/stars/transaction/PaidMediaThumb.module.scss":
/*!****************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/PaidMediaThumb.module.scss ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"jQkp75Gb","preview":"OYGSN3PF","count":"KX1yz2Jy","thumb":"EvinKr5k","noOutline":"KSAAsUDv","itemCount1":"GxDajfX_","itemCount2":"jXuZoxq8","itemCount3":"TPn3XGHJ","blurry":"hWZuxLS8","full":"w56QPFhl","fadeIn":"ds43W8Wq"});

/***/ }),

/***/ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx":
/*!********************************************************************!*\
  !*** ./src/components/modals/stars/transaction/PaidMediaThumb.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./PaidMediaThumb.module.scss */ "./src/components/modals/stars/transaction/PaidMediaThumb.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");








const THUMB_LIMIT = 3;
const PREVIEW_THUMB_LIMIT = 2;
const PaidMediaThumb = ({
  media,
  className,
  isTransactionPreview,
  onClick
}) => {
  const count = Math.min(media.length, isTransactionPreview ? PREVIEW_THUMB_LIMIT : THUMB_LIMIT);
  const isLocked = 'mediaType' in media[0];
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].root, _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"][`itemCount${count}`], isTransactionPreview && _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].preview, className),
    dir: "rtl",
    onClick: onClick,
    children: [media.slice(0, count).reverse().map((item, i, arr) => {
      const realIndex = arr.length - i - 1;
      return 'mediaType' in item ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_5__["default"], {
        className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].thumb,
        isVisible: true,
        width: item.width,
        height: item.height,
        thumbDataUri: item.thumbnail?.dataUri
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(SingleMediaThumb, {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(isTransactionPreview && realIndex > 0 && _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].noOutline),
        boughtMedia: item,
        index: realIndex
      });
    }), isLocked && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
      className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].count,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
        name: "stars-lock"
      }), media.length > 1 ? media.length : '']
    })]
  });
};
function SingleMediaThumb({
  boughtMedia,
  index,
  className
}) {
  const media = boughtMedia.video || boughtMedia.photo;
  const mediaHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaHash)(media, 'pictogram');
  const thumb = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaThumbUri)(media);
  const mediaBlob = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__["default"])(mediaHash);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].thumb, index !== undefined && `stars-transaction-media-${index}`, className),
    children: [thumb && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("img", {
      className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].blurry,
      src: thumb,
      alt: ""
    }), mediaBlob && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("img", {
      className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].full,
      src: mediaBlob,
      alt: ""
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PaidMediaThumb));

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionItem.module.scss":
/*!**********************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionItem.module.scss ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"aHAxv_Jg","info":"oyYrn3II","stars":"K5lc75ku","amount":"QLQPuLAr","title":"e0pK8CJ_","description":"xbERdDMQ","date":"l6CwQ0Ev","positive":"P_42_ZWR","negative":"TGjnLJfH","preview":"cnjGihOT","subscriptionStar":"z43YvnDX","uniqueGiftBackground":"eNvzMw2p","giftSticker":"U3dqmnM4"});

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionItem.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionItem.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_transaction__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../helpers/transaction */ "./src/components/modals/stars/helpers/transaction.ts");
/* harmony import */ var _hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/data/useSelector */ "./src/hooks/data/useSelector.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _PaidMediaThumb__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./PaidMediaThumb */ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx");
/* harmony import */ var _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./StarsTransactionItem.module.scss */ "./src/components/modals/stars/transaction/StarsTransactionItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
























const GIFT_STICKER_SIZE = 36;
function selectOptionalPeer(peerId) {
  return global => peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPeer)(global, peerId) : undefined;
}
const StarsTransactionItem = ({
  transaction,
  className
}) => {
  const {
    openStarsTransactionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    date,
    amount,
    photo,
    peer: transactionPeer,
    extendedMedia,
    subscriptionPeriod
  } = transaction;
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const peerId = transactionPeer.type === 'peer' ? transactionPeer.id : undefined;
  const peer = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_12__["default"])(selectOptionalPeer(peerId));
  const starGift = transaction.starGift;
  const isUniqueGift = starGift?.type === 'starGiftUnique';
  const giftSticker = starGift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__.getStickerFromGift)(starGift);
  const data = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    let title = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_11__.getTransactionTitle)(oldLang, lang, transaction);
    let description;
    let status;
    let avatarPeer;
    if (!(0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_3__.shouldUseCustomPeer)(transaction)) {
      description = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(oldLang, peer);
      avatarPeer = peer || _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_8__.CUSTOM_PEER_PREMIUM;
    } else {
      const customPeer = (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_3__.buildStarsTransactionCustomPeer)(transaction);
      title = customPeer.title || oldLang(customPeer.titleKey);
      description = oldLang(customPeer.subtitleKey);
      avatarPeer = customPeer;
    }
    if ((transaction.isGiftUpgrade || transaction.isDropOriginalDetails) && transaction.starGift?.type === 'starGiftUnique') {
      description = lang('GiftUnique', {
        title: transaction.starGift.title,
        number: transaction.starGift.number
      });
    }
    if (transaction.isGiftResale && transaction.starGift?.type === 'starGiftUnique') {
      description = lang('GiftUnique', {
        title: transaction.starGift.title,
        number: transaction.starGift.number
      });
    }
    if (transaction.isPostsSearch) {
      title = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_11__.getTransactionTitle)(oldLang, lang, transaction);
      description = undefined;
    }
    if (transaction.photo) {
      avatarPeer = undefined;
    }
    if (transaction.isRefund) {
      status = oldLang('StarsRefunded');
    }
    if (transaction.hasFailed) {
      status = oldLang('StarsFailed');
    }
    if (transaction.isPending) {
      status = oldLang('StarsPending');
    }
    return {
      title,
      description,
      avatarPeer,
      status
    };
  }, [oldLang, lang, peer, transaction]);
  const previewContent = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isUniqueGift) {
      const {
        backdrop
      } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_9__.getGiftAttributes)(starGift);
      const backgroundColors = [backdrop.centerColor, backdrop.edgeColor];
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_20__["default"], {
          className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].uniqueGiftBackground,
          backgroundColors: backgroundColors
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_16__["default"], {
          className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].giftSticker,
          sticker: giftSticker,
          size: GIFT_STICKER_SIZE,
          play: false
        })]
      });
    }
    if (giftSticker) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].giftSticker,
        sticker: giftSticker,
        size: GIFT_STICKER_SIZE,
        play: false
      });
    }
    if (extendedMedia) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_21__["default"], {
        media: extendedMedia,
        isTransactionPreview: true
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_17__["default"], {
        size: "medium",
        webPhoto: photo,
        peer: data.avatarPeer
      }), Boolean(subscriptionPeriod) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].subscriptionStar,
        type: "gold",
        size: "small"
      })]
    });
  }, [isUniqueGift, extendedMedia, photo, data.avatarPeer, subscriptionPeriod, starGift, giftSticker]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openStarsTransactionModal({
      transaction
    });
  });
  const amountColorClass = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_11__.isNegativeAmount)(amount) ? _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].negative : _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].positive;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].root, className),
    onClick: handleClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("div", {
      className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].preview,
      children: previewContent
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div", {
      className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].info,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("h3", {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].title,
        children: data.title
      }), data.description && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("p", {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].description,
        children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(data.description)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("p", {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].date,
        children: [(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(date * 1000, oldLang.code, true), data.status && `  (${data.status})`]
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div", {
      className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].stars,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("span", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].amount, amountColorClass),
        children: (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_3__.formatStarsTransactionAmount)(lang, amount)
      }), amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].star,
        type: "gold",
        size: "adaptive"
      }), amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_18__["default"], {
        name: "toncoin",
        className: amountColorClass
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarsTransactionItem));

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionModal.module.scss":
/*!***********************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionModal.module.scss ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"IzhfRIWu","positive":"jvBZSrpd","negative":"xDyq9cc0","header":"qBOIq6Jn","uniqueGift":"ApoQz22o","amount":"sso9uZM6","title":"ZZAj3hj7","description":"NuWOY7ED","tid":"tMF8VIOM","refunded":"sxWAwxTd","totalStars":"Z2YALGgl","starIcon":"cU5QlvwL","footer":"KgzPpgS6","starsBackground":"nML8IQqX","copyIcon":"voCttFzS","mediaPreview":"C5r59yiV","subtitle":"mFYcIYMJ","starGiftSticker":"j3akHdtm","avatar":"hcrszlpT"});

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionModal.tsx":
/*!***************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionModal.tsx ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _helpers_transaction__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../helpers/transaction */ "./src/components/modals/stars/helpers/transaction.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_InteractiveSparkles__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../common/InteractiveSparkles */ "./src/components/common/InteractiveSparkles.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _gift_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../gift/UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _PaidMediaThumb__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./PaidMediaThumb */ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx");
/* harmony import */ var _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./StarsTransactionModal.module.scss */ "./src/components/modals/stars/transaction/StarsTransactionModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





























const AVATAR_SPARKLES_CENTER_SHIFT = [0, -50];
const StarsTransactionModal = ({
  modal,
  peer,
  canPlayAnimatedEmojis,
  topSticker,
  paidMessageCommission
}) => {
  const {
    showNotification,
    openMediaViewer,
    closeStarsTransactionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const {
    transaction
  } = modal || {};
  const triggerSparklesRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const handleOpenMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    const media = transaction?.extendedMedia;
    if (!media) return;
    openMediaViewer({
      origin: _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.StarsTransaction,
      standaloneMedia: media.flatMap(item => Object.values(item))
    });
  });
  const handleAvatarMouseMove = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    triggerSparklesRef.current?.();
  });
  const handleRequestAnimation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(animate => {
    triggerSparklesRef.current = animate;
  });
  const starModalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!transaction) {
      return undefined;
    }
    const {
      giveawayPostId,
      photo,
      amount,
      isGiftUpgrade,
      isDropOriginalDetails,
      starGift,
      isGiftResale,
      starRefCommision
    } = transaction;
    const gift = transaction?.starGift;
    const isUniqueGift = gift?.type === 'starGiftUnique';
    const sticker = transaction?.starGift ? (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_12__.getStickerFromGift)(transaction.starGift) : topSticker;
    const giftAttributes = isUniqueGift ? (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_12__.getGiftAttributes)(gift) : undefined;
    const customPeer = transaction.peer && (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_5__.shouldUseCustomPeer)(transaction) && (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_5__.buildStarsTransactionCustomPeer)(transaction) || undefined;
    const peerId = transaction.peer?.type === 'peer' ? transaction.peer.id : undefined;
    const toName = transaction.peer && oldLang(getStarsPeerTitleKey(transaction.peer));
    const title = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_13__.getTransactionTitle)(oldLang, lang, transaction);
    const messageLink = peer && transaction.messageId && !isGiftUpgrade && !isDropOriginalDetails ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageLink)(peer, undefined, transaction.messageId) : undefined;
    const giveawayMessageLink = peer && giveawayPostId ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageLink)(peer, undefined, giveawayPostId) : undefined;
    const media = transaction.extendedMedia;
    const mediaAmount = media?.length || 0;
    const areAllPhotos = media?.every(m => !m.video);
    const areAllVideos = media?.every(m => !m.photo);
    const mediaText = areAllPhotos ? oldLang('Stars.Transfer.Photos', mediaAmount) : areAllVideos ? oldLang('Stars.Transfer.Videos', mediaAmount) : oldLang('Media', mediaAmount);
    const description = transaction.description || ((isGiftUpgrade || isDropOriginalDetails) && starGift?.type === 'starGiftUnique' ? starGift.title : undefined) || (media ? mediaText : undefined);
    const shouldDisplayAvatar = !media && !sticker && !transaction.isPostsSearch;
    const avatarPeer = !photo ? !(0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_5__.shouldUseCustomPeer)(transaction) && peer || customPeer : undefined;
    const uniqueGiftHeader = isUniqueGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].header, _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].uniqueGift),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_gift_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_25__["default"], {
        backdropAttribute: giftAttributes.backdrop,
        patternAttribute: giftAttributes.pattern,
        modelAttribute: giftAttributes.model,
        title: gift.title,
        subtitle: lang('GiftInfoCollectible', {
          number: gift.number
        }),
        resellPrice: transaction.amount
      })
    });
    const amountColorClass = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_13__.isNegativeAmount)(amount) ? _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].negative : _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].positive;
    const regularHeader = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
      className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].header,
      children: [media && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_26__["default"], {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].mediaPreview, 'transaction-media-preview'),
        media: media,
        onClick: handleOpenMedia
      }), !media && sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_18__["default"], {
        sticker: sticker,
        play: canPlayAnimatedEmojis,
        noLoop: true
      }, transaction.id), shouldDisplayAvatar && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].avatar,
        peer: avatarPeer,
        webPhoto: photo,
        size: "giant",
        onMouseMove: handleAvatarMouseMove
      }), !sticker && !transaction.isPostsSearch && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_InteractiveSparkles__WEBPACK_IMPORTED_MODULE_22__["default"], {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].starsBackground),
        color: "gold",
        onRequestAnimation: handleRequestAnimation,
        centerShift: AVATAR_SPARKLES_CENTER_SHIFT
      }), Boolean(title) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("h1", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].title,
        children: title
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("p", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].description,
        children: description
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("p", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].amount,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("span", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].amount, amountColorClass),
          children: (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_5__.formatStarsTransactionAmount)(lang, amount)
        }), amount.currency === _config__WEBPACK_IMPORTED_MODULE_3__.STARS_CURRENCY_CODE && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_21__["default"], {
          type: "gold",
          size: "middle"
        }), amount.currency === 'TON' && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "toncoin",
          className: amountColorClass
        }), transaction.isRefund && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("p", {
          className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].refunded,
          children: lang('Refunded')
        })]
      }), Boolean(transaction.paidMessages && transaction.starRefCommision && paidMessageCommission) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("p", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].description,
        children: lang('PaidMessageTransactionDescription', {
          percent: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_11__.formatPercent)(paidMessageCommission / 10)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      })]
    });
    const tableData = [];
    if (transaction && starRefCommision && !transaction.paidMessages && !isGiftResale) {
      tableData.push([oldLang('StarsTransaction.StarRefReason.Title'), oldLang('StarsTransaction.StarRefReason.Program')]);
    }
    if (isGiftUpgrade) {
      tableData.push([oldLang('StarGiftReason'), oldLang('StarGiftReasonUpgrade')]);
    }
    if (isDropOriginalDetails) {
      tableData.push([oldLang('StarGiftReason'), lang('StarGiftReasonDropOriginalDetails')]);
    }
    if (isGiftResale) {
      tableData.push([oldLang('StarGiftReason'), (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_13__.isNegativeAmount)(transaction.amount) ? lang('StarGiftSaleTransaction') : lang('StarGiftPurchaseTransaction')]);
    }
    let peerLabel;
    if (isGiftUpgrade) {
      peerLabel = oldLang('Stars.Transaction.GiftFrom');
    } else if ((0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_13__.isNegativeAmount)(amount) || transaction.isMyGift) {
      peerLabel = oldLang('Stars.Transaction.To');
    } else if (transaction.starRefCommision && !transaction.paidMessages && !isGiftResale) {
      peerLabel = oldLang('StarsTransaction.StarRefReason.Miniapp');
    } else if (peerId) {
      peerLabel = oldLang('Star.Transaction.From');
    } else {
      peerLabel = oldLang('Stars.Transaction.Via');
    }
    if (!transaction.isPostsSearch && !isDropOriginalDetails && !transaction.isStarGiftAuctionBid) {
      tableData.push([peerLabel, peerId ? {
        chatId: peerId
      } : toName || '']);
    }
    if (transaction.starRefCommision && transaction.paidMessages) {
      tableData.push([lang('PaidMessageTransactionTotal'), (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_10__.formatStarsAsIcon)(lang, transaction.amount.amount / ((100 - transaction.starRefCommision) / 100), {
        asFont: false,
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].starIcon,
        containerClassName: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].totalStars
      })]);
    }
    if (messageLink) {
      tableData.push([oldLang('Stars.Transaction.Reaction.Post'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_23__["default"], {
        url: messageLink,
        text: messageLink
      })]);
    }
    if (giveawayMessageLink && transaction.amount.currency === _config__WEBPACK_IMPORTED_MODULE_3__.STARS_CURRENCY_CODE) {
      tableData.push([oldLang('BoostReason'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_23__["default"], {
        url: giveawayMessageLink,
        text: oldLang('Giveaway')
      })]);
      tableData.push([oldLang('Gift'), oldLang('Stars', transaction.amount, 'i')]);
    }
    if (transaction.id) {
      tableData.push([oldLang('Stars.Transaction.Id'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
          className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].tid,
          onClick: () => {
            (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_8__.copyTextToClipboard)(transaction.id);
            showNotification({
              message: oldLang('StarsTransactionIDCopied')
            });
          },
          children: transaction.id
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].copyIcon,
          name: "copy"
        })]
      })]);
    }
    tableData.push([oldLang('Stars.Transaction.Date'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateTimeToString)(transaction.date * 1000, oldLang.code, true)]);
    if (transaction.isStarGiftAuctionBid && gift?.type === 'starGift' && gift.availabilityTotal) {
      tableData.push([lang('GiftInfoAvailability'), lang('GiftInfoAvailabilityValue', {
        count: gift.availabilityRemains || 0,
        total: gift.availabilityTotal
      }, {
        pluralValue: gift.availabilityRemains || 0
      })]);
    }
    const footerText = oldLang('lng_credits_box_out_about');
    const footerTextParts = footerText.split('{link}');
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("span", {
      className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].footer,
      children: [footerTextParts[0], (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_23__["default"], {
        url: oldLang('StarsTOSLink'),
        text: oldLang('lng_credits_summary_options_about_link')
      }), footerTextParts[1]]
    });
    return {
      header: isUniqueGift ? uniqueGiftHeader : regularHeader,
      tableData,
      footer
    };
  }, [transaction, oldLang, lang, peer, canPlayAnimatedEmojis, topSticker, paidMessageCommission, handleRequestAnimation]);
  const prevModalData = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_17__["default"])(starModalData);
  const renderingModalData = prevModalData || starModalData;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_24__["default"], {
    isOpen: Boolean(transaction),
    className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].modal,
    hasBackdrop: transaction?.starGift?.type === 'starGiftUnique',
    header: renderingModalData?.header,
    tableData: renderingModalData?.tableData,
    footer: renderingModalData?.footer,
    buttonText: oldLang('OK'),
    onClose: closeStarsTransactionModal
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const peerId = modal?.transaction?.peer?.type === 'peer' && modal.transaction.peer.id;
  const peer = peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, peerId) : undefined;
  const paidMessageCommission = global.appConfig.starsPaidMessageCommissionPermille;
  const currencyAmount = modal?.transaction.amount;
  const starsGiftSticker = modal?.transaction.isGift ? currencyAmount?.currency === _config__WEBPACK_IMPORTED_MODULE_3__.STARS_CURRENCY_CODE ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectGiftStickerForStars)(global, currencyAmount?.amount) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectGiftStickerForTon)(global, currencyAmount?.amount) : undefined;
  return {
    peer,
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanPlayAnimatedEmojis)(global),
    topSticker: starsGiftSticker,
    paidMessageCommission
  };
})(StarsTransactionModal)));
function getStarsPeerTitleKey(peer) {
  switch (peer.type) {
    case 'appStore':
      return 'AppStore';
    case 'playMarket':
      return 'PlayMarket';
    case 'fragment':
      return 'Fragment';
    case 'premiumBot':
      return 'StarsTransactionBot';
    case 'ads':
      return 'StarsTransactionAds';
    case 'api':
      return 'Stars.Intro.Transaction.TelegramBotApi.Subtitle';
    default:
      return 'Stars.Transaction.Unsupported.Title';
  }
}

/***/ }),

/***/ "./src/hooks/useDebouncedMemo.ts":
/*!***************************************!*\
  !*** ./src/hooks/useDebouncedMemo.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useDebouncedMemo)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _useHeavyAnimation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useHeavyAnimation */ "./src/hooks/useHeavyAnimation.ts");
/* harmony import */ var _useRunDebounced__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useRunDebounced */ "./src/hooks/useRunDebounced.ts");
/* harmony import */ var _useSyncEffect__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./useSyncEffect */ "./src/hooks/useSyncEffect.ts");





function useDebouncedMemo(resolverFn, ms, dependencies) {
  const [value, setValue] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const {
    isFrozen,
    updateWhenUnfrozen
  } = useHeavyAnimationFreeze();
  const runDebounced = (0,_useRunDebounced__WEBPACK_IMPORTED_MODULE_3__["default"])(ms, true);
  (0,_useSyncEffect__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (isFrozen) {
      updateWhenUnfrozen();
      return;
    }
    runDebounced(() => {
      setValue(resolverFn());
    });
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [...dependencies, isFrozen]);
  return value;
}
function useHeavyAnimationFreeze() {
  const isPending = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const updateWhenUnfrozen = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    isPending.current = true;
  }, []);
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  const handleUnfreeze = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!isPending.current) {
      return;
    }
    isPending.current = false;
    forceUpdate();
  }, [forceUpdate]);
  (0,_useHeavyAnimation__WEBPACK_IMPORTED_MODULE_2__["default"])(noop, handleUnfreeze);
  return {
    isFrozen: (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.getIsHeavyAnimating)(),
    updateWhenUnfrozen
  };
}
function noop() {}

/***/ }),

/***/ "./src/hooks/usePeerSearch.ts":
/*!************************************!*\
  !*** ./src/hooks/usePeerSearch.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePeerSearch),
/* harmony export */   peerGlobalSearch: () => (/* binding */ peerGlobalSearch),
/* harmony export */   prepareChatMemberSearch: () => (/* binding */ prepareChatMemberSearch)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _useAsync__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useAsync */ "./src/hooks/useAsync.ts");
/* harmony import */ var _useDebouncedMemo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useDebouncedMemo */ "./src/hooks/useDebouncedMemo.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");





const DEBOUNCE_TIMEOUT = 300;
async function peerGlobalSearch(query) {
  const searchResult = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('searchChats', {
    query
  });
  if (!searchResult) return undefined;
  const ids = [...searchResult.accountResultIds, ...searchResult.globalResultIds];
  return ids;
}
function prepareChatMemberSearch(chat) {
  return async query => {
    const searchResult = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMembers', {
      chat,
      memberFilter: 'search',
      query
    });
    return searchResult?.members?.map(member => member.userId) || [];
  };
}
function usePeerSearch({
  query,
  queryFn = peerGlobalSearch,
  defaultValue,
  debounceTimeout = DEBOUNCE_TIMEOUT,
  isDisabled
}) {
  const debouncedQuery = (0,_useDebouncedMemo__WEBPACK_IMPORTED_MODULE_3__["default"])(() => query, debounceTimeout, [query]);
  const [currentResultsQuery, setCurrentResultsQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const searchQuery = !query ? query : debouncedQuery; // Ignore debounce if query is empty
  const queryCallback = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(queryFn);
  const result = (0,_useAsync__WEBPACK_IMPORTED_MODULE_2__["default"])(async () => {
    if (!searchQuery || isDisabled) {
      setCurrentResultsQuery('');
      return Promise.resolve(defaultValue);
    }
    const answer = await queryCallback(searchQuery);
    setCurrentResultsQuery(searchQuery);
    return answer;
  }, [searchQuery, defaultValue, queryCallback, isDisabled], defaultValue);
  return {
    ...result,
    currentResultsQuery
  };
}

/***/ })

}]);
//# sourceMappingURL=BundleStars.8f11f4808f416e5f969d.js.map