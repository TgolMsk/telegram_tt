"use strict";
(self["webpackChunktelegram_t"] = self["webpackChunktelegram_t"] || []).push([["BundleMain"],{

/***/ "./src/assets/telegram-logo-filled.svg":
/*!*********************************************!*\
  !*** ./src/assets/telegram-logo-filled.svg ***!
  \*********************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "telegram-logo-filled.67469f6dc5e301e8e0bd.svg";

/***/ }),

/***/ "./src/assets/wave_ripple.jpg":
/*!************************************!*\
  !*** ./src/assets/wave_ripple.jpg ***!
  \************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "wave_ripple.5d7d9fa793232bef56c0.jpg";

/***/ }),

/***/ "./src/bundles/main.ts":
/*!*****************************!*\
  !*** ./src/bundles/main.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LockScreen: () => (/* reexport safe */ _components_main_LockScreen__WEBPACK_IMPORTED_MODULE_2__["default"]),
/* harmony export */   Main: () => (/* reexport safe */ _components_main_Main__WEBPACK_IMPORTED_MODULE_1__["default"])
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _components_main_Main__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/main/Main */ "./src/components/main/Main.tsx");
/* harmony import */ var _components_main_LockScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../components/main/LockScreen */ "./src/components/main/LockScreen.tsx");



if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
  // eslint-disable-next-line no-console
  console.log('>>> FINISH LOAD MAIN BUNDLE');
}

/***/ }),

/***/ "./src/components/calls/ActiveCallHeader.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/calls/ActiveCallHeader.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ActiveCallHeaderAsync = props => {
  const {
    isActive
  } = props;
  const ActiveCallHeader = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Calls, 'ActiveCallHeader', !isActive);
  return ActiveCallHeader ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ActiveCallHeader, {}) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ActiveCallHeaderAsync);

/***/ }),

/***/ "./src/components/calls/group/GroupCall.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/calls/group/GroupCall.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GroupCallAsync = props => {
  const {
    groupCallId
  } = props;
  const GroupCall = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Calls, 'GroupCall', !groupCallId);
  return GroupCall ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GroupCall, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GroupCallAsync);

/***/ }),

/***/ "./src/components/calls/phone/PhoneCall.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/calls/phone/PhoneCall.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PhoneCallAsync = props => {
  const {
    isActive
  } = props;
  const PhoneCall = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Calls, 'PhoneCall', !isActive);
  return PhoneCall ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PhoneCall, {}) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PhoneCallAsync);

/***/ }),

/***/ "./src/components/calls/phone/RatePhoneCallModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/calls/phone/RatePhoneCallModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const RatePhoneCallModalAsync = props => {
  const {
    isOpen
  } = props;
  const RatePhoneCallModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Calls, 'RatePhoneCallModal', !isOpen);
  return RatePhoneCallModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(RatePhoneCallModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RatePhoneCallModalAsync);

/***/ }),

/***/ "./src/components/common/AboutMonetizationModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/common/AboutMonetizationModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const AboutMonetizationModalAsync = props => {
  const {
    isOpen
  } = props;
  const AboutMonetizationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'AboutMonetizationModal', !isOpen);
  return AboutMonetizationModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AboutMonetizationModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AboutMonetizationModalAsync);

/***/ }),

/***/ "./src/components/common/AnimatedTabItem.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/common/AnimatedTabItem.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"item":"_KBrROQt","icon":"Y3vEed9M"});

/***/ }),

/***/ "./src/components/common/AnimatedTabItem.tsx":
/*!***************************************************!*\
  !*** ./src/components/common/AnimatedTabItem.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _AnimatedTabItem_module_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./AnimatedTabItem.module.scss */ "./src/components/common/AnimatedTabItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





const AnimatedTabItem = ({
  id,
  title,
  sticker,
  onClick
}) => {
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(() => {
    onClick?.(id);
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
    className: _AnimatedTabItem_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].item,
    onClick: handleClick,
    children: [sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_2__["default"], {
      className: _AnimatedTabItem_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].icon,
      sticker: sticker,
      size: 20,
      forcePreview: true
    }), title]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AnimatedTabItem));

/***/ }),

/***/ "./src/components/common/AnimatedTabList.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/common/AnimatedTabList.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"container":"UQ6pUmuC","clipPathContainer":"c397ZVz4","isVisible":"_Nw3GzkO","noAnimation":"zNFdzcTe"});

/***/ }),

/***/ "./src/components/common/AnimatedTabList.tsx":
/*!***************************************************!*\
  !*** ./src/components/common/AnimatedTabList.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useHorizontalScroll */ "./src/hooks/useHorizontalScroll.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _AnimatedTabItem__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./AnimatedTabItem */ "./src/components/common/AnimatedTabItem.tsx");
/* harmony import */ var _AnimatedTabList_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./AnimatedTabList.module.scss */ "./src/components/common/AnimatedTabList.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const AnimatedTabList = ({
  items,
  selectedItemId,
  animationLevel,
  onItemSelect,
  className
}) => {
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const clipPathContainerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const selectedIndex = items.findIndex(item => item.id === selectedItemId) || 0;
  const [clipPath, setClipPath] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const shouldAnimate = animationLevel > _config__WEBPACK_IMPORTED_MODULE_1__.ANIMATION_LEVEL_MIN;
  (0,_hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_3__["default"])(containerRef, !items.length, true);
  const updateClipPath = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    const clipPathContainer = clipPathContainerRef.current;
    const activeTab = selectedIndex >= 0 && clipPathContainer?.childNodes[selectedIndex];
    if (clipPathContainer && activeTab && clipPathContainer.offsetWidth > 0) {
      const {
        offsetLeft,
        offsetWidth
      } = activeTab;
      const containerWidth = clipPathContainer.offsetWidth;
      const left = (offsetLeft / containerWidth * 100).toFixed(1);
      const right = ((containerWidth - (offsetLeft + offsetWidth)) / containerWidth * 100).toFixed(1);
      const newClipPath = `inset(0 ${right}% 0 ${left}% round 1rem)`;
      setClipPath(newClipPath);
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    updateClipPath();
  }, [selectedIndex, items]);
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_5__["default"])(clipPathContainerRef, updateClipPath);
  if (!items.length) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
    ref: containerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_AnimatedTabList_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].container, 'no-scrollbar', className, clipPath && _AnimatedTabList_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].isVisible),
    children: [items.map(item => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_AnimatedTabItem__WEBPACK_IMPORTED_MODULE_6__["default"], {
      id: item.id,
      title: item.title,
      sticker: item.sticker,
      onClick: onItemSelect
    }, item.id)), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div", {
      ref: clipPathContainerRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_AnimatedTabList_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].clipPathContainer, 'clip-path-container', !shouldAnimate && _AnimatedTabList_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].noAnimation),
      style: clipPath ? `clip-path: ${clipPath}` : undefined,
      "aria-hidden": true,
      children: items.map((item, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_AnimatedTabItem__WEBPACK_IMPORTED_MODULE_6__["default"], {
        id: item.id,
        title: item.title,
        sticker: item.sticker,
        onClick: onItemSelect
      }, item.id))
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AnimatedTabList));

/***/ }),

/***/ "./src/components/common/CustomEmojiSetsModal.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/common/CustomEmojiSetsModal.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const CustomEmojiSetsModalAsync = props => {
  const {
    customEmojiSetIds
  } = props;
  const CustomEmojiSetsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'CustomEmojiSetsModal', !customEmojiSetIds);
  return CustomEmojiSetsModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CustomEmojiSetsModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomEmojiSetsModalAsync);

/***/ }),

/***/ "./src/components/common/DeleteMessageModal.async.tsx":
/*!************************************************************!*\
  !*** ./src/components/common/DeleteMessageModal.async.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const DeleteMessageModalAsync = props => {
  const {
    isOpen
  } = props;
  const DeleteMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'DeleteMessageModal', !isOpen);
  return DeleteMessageModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeleteMessageModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteMessageModalAsync);

/***/ }),

/***/ "./src/components/common/MainMenuDropdown.tsx":
/*!****************************************************!*\
  !*** ./src/components/common/MainMenuDropdown.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _left_main_hooks_useLeftHeaderButtonRtlForumTransition__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../left/main/hooks/useLeftHeaderButtonRtlForumTransition */ "./src/components/left/main/hooks/useLeftHeaderButtonRtlForumTransition.ts");
/* harmony import */ var _left_main_LeftSideMenuItems__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../left/main/LeftSideMenuItems */ "./src/components/left/main/LeftSideMenuItems.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const LeftSideMenuDropdown = ({
  trigger,
  shouldHideSearch,
  className
}) => {
  const {
    openLeftColumnContent,
    closeForumPanel,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isBotMenuOpen, markBotMenuOpen, unmarkBotMenuOpen] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const versionString = _config__WEBPACK_IMPORTED_MODULE_3__.IS_BETA ? `${"12.0.16"} Beta (${"main#3039b57"})` : _config__WEBPACK_IMPORTED_MODULE_3__.DEBUG ? "main#3039b57" : "12.0.16";

  // Disable dropdown menu RTL animation for resize
  const {
    shouldDisableDropdownMenuTransitionRef,
    handleDropdownMenuTransitionEnd
  } = (0,_left_main_hooks_useLeftHeaderButtonRtlForumTransition__WEBPACK_IMPORTED_MODULE_8__["default"])(shouldHideSearch);
  const handleSelectSettings = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main
    });
  });
  const handleSelectContacts = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts
    });
  });
  const handleSelectArchived = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived
    });
    closeForumPanel();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_10__["default"], {
    trigger: trigger,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('main-menu', lang.isRtl && 'rtl', shouldHideSearch && lang.isRtl && 'right-aligned', shouldDisableDropdownMenuTransitionRef.current && lang.isRtl && 'disable-transition', className),
    forceOpen: isBotMenuOpen,
    positionX: shouldHideSearch && lang.isRtl ? 'right' : 'left',
    transformOriginX: 90,
    transformOriginY: 100,
    onTransitionEnd: lang.isRtl ? handleDropdownMenuTransitionEnd : undefined,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_left_main_LeftSideMenuItems__WEBPACK_IMPORTED_MODULE_9__["default"], {
      onSelectArchived: handleSelectArchived,
      onSelectContacts: handleSelectContacts,
      onSelectSettings: handleSelectSettings,
      onBotMenuOpened: markBotMenuOpen,
      onBotMenuClosed: unmarkBotMenuOpen,
      footer: `${_config__WEBPACK_IMPORTED_MODULE_3__.APP_NAME} ${versionString}`
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(LeftSideMenuDropdown));

/***/ }),

/***/ "./src/components/common/PreviewMedia.tsx":
/*!************************************************!*\
  !*** ./src/components/common/PreviewMedia.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useMediaTransitionDeprecated */ "./src/hooks/useMediaTransitionDeprecated.ts");
/* harmony import */ var _Media_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./Media.scss */ "./src/components/common/Media.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const PreviewMedia = ({
  media,
  idPrefix = 'preview-media',
  isProtected,
  observeIntersection,
  onClick,
  index
}) => {
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_6__.useIsIntersecting)(ref, observeIntersection);
  const thumbDataUri = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_5__["default"])(media);
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_4__["default"])(media, 'preview');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__["default"])(mediaHash, !isIntersecting);
  const transitionClassNames = (0,_hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_9__["default"])(mediaBlobUrl);
  const video = media.content.video;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onClick(index);
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    ref: ref,
    id: `${idPrefix}${index}`,
    className: "Media scroll-item",
    onClick: handleClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("img", {
      src: thumbDataUri,
      className: "media-miniature",
      alt: "",
      draggable: !isProtected,
      decoding: "async",
      onContextMenu: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__["default"] : undefined
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("img", {
      src: mediaBlobUrl,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('full-media', 'media-miniature', transitionClassNames),
      alt: "",
      draggable: !isProtected,
      decoding: "async",
      onContextMenu: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__["default"] : undefined
    }), video && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
      className: "video-duration",
      children: video.isGif ? 'GIF' : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatMediaDuration)(video.duration)
    }), isProtected && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
      className: "protector"
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PreviewMedia));

/***/ }),

/***/ "./src/components/common/PrivacySettingsNoticeModal.async.tsx":
/*!********************************************************************!*\
  !*** ./src/components/common/PrivacySettingsNoticeModal.async.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PrivacySettingsNoticeModalAsync = props => {
  const {
    isOpen
  } = props;
  const PrivacySettingsNoticeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PrivacySettingsNoticeModal', !isOpen);
  return PrivacySettingsNoticeModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PrivacySettingsNoticeModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PrivacySettingsNoticeModalAsync);

/***/ }),

/***/ "./src/components/common/SeenByModal.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/common/SeenByModal.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const SeenByModalAsync = props => {
  const {
    isOpen
  } = props;
  const SeenByModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'SeenByModal', !isOpen);
  return SeenByModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SeenByModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SeenByModalAsync);

/***/ }),

/***/ "./src/components/common/StickerSetModal.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/common/StickerSetModal.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StickerSetModalAsync = props => {
  const {
    isOpen
  } = props;
  const StickerSetModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'StickerSetModal', !isOpen);
  return StickerSetModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StickerSetModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerSetModalAsync);

/***/ }),

/***/ "./src/components/common/UnpinAllMessagesModal.async.tsx":
/*!***************************************************************!*\
  !*** ./src/components/common/UnpinAllMessagesModal.async.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const UnpinAllMessagesModalAsync = props => {
  const {
    isOpen
  } = props;
  const UnpinAllMessagesModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'UnpinAllMessagesModal', !isOpen);
  return UnpinAllMessagesModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(UnpinAllMessagesModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UnpinAllMessagesModalAsync);

/***/ }),

/***/ "./src/components/common/UnreadCounter.tsx":
/*!*************************************************!*\
  !*** ./src/components/common/UnreadCounter.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_appBadge__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/appBadge */ "./src/util/appBadge.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");







const UnreadCounter = ({
  isForAppBadge
}) => {
  (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_4__.useFolderManagerForUnreadCounters)();
  const unreadNotificationsCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_2__.getAllNotificationsCount)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isForAppBadge) {
      (0,_util_appBadge__WEBPACK_IMPORTED_MODULE_1__.updateAppBadge)(unreadNotificationsCount);
    }
  }, [isForAppBadge, unreadNotificationsCount]);
  if (isForAppBadge || !unreadNotificationsCount) {
    return undefined;
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div", {
    className: "unread-count active",
    children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(lang, unreadNotificationsCount)
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(UnreadCounter));

/***/ }),

/***/ "./src/components/common/VerificationMonetizationModal.async.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/common/VerificationMonetizationModal.async.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const VerificationMonetizationModalAsync = props => {
  const {
    modal
  } = props;
  const VerificationMonetizationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'VerificationMonetizationModal', !modal);
  return VerificationMonetizationModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(VerificationMonetizationModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (VerificationMonetizationModalAsync);

/***/ }),

/***/ "./src/components/common/gift/GiftMenuItems.tsx":
/*!******************************************************!*\
  !*** ./src/components/common/gift/GiftMenuItems.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GiftMenuItems = ({
  peerId,
  canManage,
  gift: typeGift,
  currentUserEmojiStatus,
  collectibleEmojiStatuses
}) => {
  const {
    showNotification,
    openChatWithDraft,
    openGiftTransferModal,
    openGiftResalePriceComposerModal,
    openGiftStatusInfoModal,
    setEmojiStatus,
    toggleSavedGiftPinned,
    changeGiftVisibility,
    updateStarGiftPrice,
    closeGiftInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isSavedGift = typeGift && 'gift' in typeGift;
  const savedGift = isSavedGift ? typeGift : undefined;
  const gift = isSavedGift ? typeGift.gift : typeGift;
  const starGiftUniqueSlug = gift?.type === 'starGiftUnique' ? gift.slug : undefined;
  const starGiftUniqueLink = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUniqueSlug) return undefined;
    return `${_config__WEBPACK_IMPORTED_MODULE_2__.TME_LINK_PREFIX}nft/${starGiftUniqueSlug}`;
  }, [starGiftUniqueSlug]);
  const userCollectibleStatus = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUniqueSlug) return undefined;
    return collectibleEmojiStatuses?.find(status => status.type === 'collectible' && status.slug === starGiftUniqueSlug);
  }, [starGiftUniqueSlug, collectibleEmojiStatuses]);
  const currenUniqueEmojiStatusSlug = currentUserEmojiStatus?.type === 'collectible' ? currentUserEmojiStatus.slug : undefined;
  const isGiftUnique = gift && gift.type === 'starGiftUnique';
  const canTakeOff = isGiftUnique && currenUniqueEmojiStatusSlug === gift.slug;
  const canWear = userCollectibleStatus && !canTakeOff;
  const giftResalePrice = isGiftUnique ? gift.resellPrice : undefined;
  const hasPinOptions = canManage && savedGift && !savedGift.isUnsaved && isGiftUnique;
  const handleTriggerVisibility = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    const {
      inputGift,
      isUnsaved
    } = savedGift;
    changeGiftVisibility({
      gift: inputGift,
      shouldUnsave: !isUnsaved
    });
  });
  const handleCopyLink = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!starGiftUniqueLink) return;
    (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyTextToClipboard)(starGiftUniqueLink);
    showNotification({
      message: lang('LinkCopied')
    });
  });
  const handleLinkShare = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!starGiftUniqueLink) return;
    openChatWithDraft({
      text: {
        text: starGiftUniqueLink
      }
    });
  });
  const handleTransfer = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || savedGift?.gift.type !== 'starGiftUnique') return;
    if (savedGift.canTransferAt && savedGift.canTransferAt > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()) {
      showNotification({
        message: {
          key: 'NotificationGiftCanTransferAt',
          variables: {
            date: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateAtTime)(oldLang, savedGift.canTransferAt * 1000)
          }
        }
      });
      return;
    }
    openGiftTransferModal({
      gift: savedGift
    });
  });
  const handleSell = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift) return;
    if (savedGift.canResellAt && savedGift.canResellAt > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)()) {
      showNotification({
        message: {
          key: 'NotificationGiftCanResellAt',
          variables: {
            date: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateAtTime)(oldLang, savedGift.canResellAt * 1000)
          }
        }
      });
      return;
    }
    openGiftResalePriceComposerModal({
      peerId,
      gift: savedGift
    });
  });
  const handleUnsell = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!savedGift || savedGift.gift.type !== 'starGiftUnique' || !savedGift.inputGift) return;
    closeGiftInfoModal();
    updateStarGiftPrice({
      gift: savedGift.inputGift,
      price: {
        currency: _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE,
        amount: 0,
        nanos: 0
      }
    });
    showNotification({
      icon: 'unlist-outline',
      message: {
        key: 'NotificationGiftIsUnlist',
        variables: {
          gift: lang('GiftUnique', {
            title: savedGift.gift.title,
            number: savedGift.gift.number
          })
        }
      }
    });
  });
  const handleWear = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (gift?.type !== 'starGiftUnique' || !userCollectibleStatus) return;
    openGiftStatusInfoModal({
      emojiStatus: userCollectibleStatus
    });
  });
  const handleTakeOff = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (canTakeOff) {
      setEmojiStatus({
        emojiStatus: {
          type: 'regular',
          documentId: _config__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_STATUS_ICON_ID
        }
      });
    }
  });
  const handleTogglePin = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    toggleSavedGiftPinned({
      peerId,
      gift: savedGift
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment, {
    children: [hasPinOptions && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: savedGift.isPinned ? 'unpin' : 'pin',
      onClick: handleTogglePin,
      children: lang(savedGift.isPinned ? 'ChatListUnpinFromTop' : 'ChatListPinToTop')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "link-badge",
      onClick: handleCopyLink,
      children: lang('CopyLink')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "forward",
      onClick: handleLinkShare,
      children: lang('Share')
    }), canManage && isGiftUnique && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "diamond",
      onClick: handleTransfer,
      children: lang('GiftInfoTransfer')
    }), canManage && isGiftUnique && !giftResalePrice && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "sell-outline",
      onClick: handleSell,
      children: lang('Sell')
    }), canManage && isGiftUnique && Boolean(giftResalePrice) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "unlist-outline",
      onClick: handleUnsell,
      children: lang('GiftInfoUnlist')
    }), canManage && savedGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: savedGift.isUnsaved ? 'eye-outline' : 'eye-crossed-outline',
      onClick: handleTriggerVisibility,
      children: lang(savedGift.isUnsaved ? 'GiftActionShow' : 'GiftActionHide')
    }), canWear && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "crown-wear-outline",
      onClick: handleWear,
      children: lang('GiftInfoWear')
    }), canTakeOff && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
      icon: "crown-take-off-outline",
      onClick: handleTakeOff,
      children: lang('GiftInfoTakeOff')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftMenuItems));

/***/ }),

/***/ "./src/components/common/gift/SavedGift.module.scss":
/*!**********************************************************!*\
  !*** ./src/components/common/gift/SavedGift.module.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"HN4dYXIk","star":"LLQBJODm","priceBadge":"haa6STaT","topIcon":"_TMVTkD4","hiddenGift":"xY4yqqYA","radialPattern":"_I9aOdGr","stickerWrapper":"NYuBBB9j"});

/***/ }),

/***/ "./src/components/common/gift/SavedGift.tsx":
/*!**************************************************!*\
  !*** ./src/components/common/gift/SavedGift.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _helpers_gifts__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _GiftMenuItems__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./GiftMenuItems */ "./src/components/common/gift/GiftMenuItems.tsx");
/* harmony import */ var _GiftRibbon__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./GiftRibbon */ "./src/components/common/gift/GiftRibbon.tsx");
/* harmony import */ var _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./SavedGift.module.scss */ "./src/components/common/gift/SavedGift.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

























const GIFT_STICKER_SIZE = 90;
const SavedGift = ({
  peerId,
  gift,
  style,
  fromPeer,
  currentUserId,
  hasAdminRights,
  collectibleEmojiStatuses,
  currentUserEmojiStatus,
  className,
  observeIntersection
}) => {
  const {
    openGiftInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const stickerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [isHover, markHover, unmarkHover] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const canManage = peerId === currentUserId || hasAdminRights;
  const totalIssued = (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_10__.getTotalGiftAvailability)(gift.gift);
  const starGift = gift.gift;
  const starGiftUnique = starGift.type === 'starGiftUnique' ? starGift : undefined;
  const resellPrice = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUnique?.resellPrice) return undefined;
    if (starGiftUnique.resaleTonOnly) {
      return starGiftUnique.resellPrice.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE);
    }
    return starGiftUnique.resellPrice.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE);
  }, [starGiftUnique]);
  const ribbonText = (() => {
    if (starGiftUnique?.resellPrice) {
      return lang('GiftRibbonSale');
    }
    if (gift.isPinned && starGiftUnique) {
      return lang('GiftSavedNumber', {
        number: starGiftUnique.number
      });
    }
    if (totalIssued) {
      return lang('ActionStarGiftLimitedRibbon', {
        total: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_9__.formatIntegerCompact)(lang, totalIssued)
      });
    }
    return undefined;
  })();
  const ribbonColor = starGiftUnique?.resellPrice ? 'green' : 'blue';
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_11__["default"])(ref);
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => ref.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => ref.current.closest('.custom-scroll'));
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => document.querySelector('#portals')?.querySelector('.saved-gift-context-menu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => ({
    withPortal: true
  }));
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openGiftInfoModal({
      peerId,
      gift
    });
  });
  const avatarPeer = gift.isNameHidden && !fromPeer ? _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_8__.CUSTOM_PEER_HIDDEN : fromPeer;
  const sticker = (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_10__.getStickerFromGift)(gift.gift);
  const giftAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_10__.getGiftAttributes)(gift.gift), [gift.gift]);
  const {
    backdrop,
    pattern
  } = giftAttributes || {};
  const radialPatternBackdrop = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!backdrop || !pattern) {
      return undefined;
    }
    const backdropColors = [backdrop.centerColor, backdrop.edgeColor];
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_20__["default"], {
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternIcon: pattern.sticker,
      patternSize: 14,
      ringsCount: 1,
      ovalFactor: 1,
      withAdaptiveHeight: true
    });
  }, [backdrop, pattern]);
  if (!sticker) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('interactive-gift scroll-item', _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].root, className),
    style: style,
    onClick: handleClick,
    onContextMenu: handleContextMenu,
    onMouseDown: handleBeforeContextMenu,
    onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? markHover : undefined,
    onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? unmarkHover : undefined,
    children: [radialPatternBackdrop, !radialPatternBackdrop && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_18__["default"], {
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].topIcon,
      peer: avatarPeer,
      size: "micro"
    }), gift.isPinned && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
      name: "pinned-message",
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].topIcon
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      ref: stickerRef,
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].stickerWrapper,
      style: `width: ${GIFT_STICKER_SIZE}px; height: ${GIFT_STICKER_SIZE}px`,
      children: sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_StickerView__WEBPACK_IMPORTED_MODULE_15__["default"], {
        containerRef: stickerRef,
        sticker: sticker,
        size: GIFT_STICKER_SIZE,
        shouldLoop: isHover,
        shouldPreloadPreview: true,
        observeIntersectionForPlaying: observeIntersection,
        observeIntersectionForLoading: observeIntersection
      })
    }), gift.isUnsaved && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].hiddenGift,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
        name: "eye-crossed-outline"
      })
    }), resellPrice && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].priceBadge,
      nonInteractive: true,
      size: "tiny",
      withSparkleEffect: true,
      noSparkleAnimation: true,
      pill: true,
      fluid: true,
      children: resellPrice.currency === 'TON' ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatTonAsIcon)(lang, resellPrice.amount, {
        shouldConvertFromNanos: true,
        className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].star
      }) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatStarsAsIcon)(lang, resellPrice.amount, {
        asFont: true,
        className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].star
      })
    }), ribbonText && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_GiftRibbon__WEBPACK_IMPORTED_MODULE_22__["default"], {
      color: ribbonColor,
      text: ribbonText
    }), contextMenuAnchor !== undefined && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_17__["default"], {
      isOpen: isContextMenuOpen,
      anchor: contextMenuAnchor,
      className: "saved-gift-context-menu",
      autoClose: true,
      withPortal: true,
      getMenuElement: getMenuElement,
      getTriggerElement: getTriggerElement,
      getRootElement: getRootElement,
      getLayout: getLayout,
      onClose: handleContextMenuClose,
      onCloseAnimationEnd: handleContextMenuHide,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_GiftMenuItems__WEBPACK_IMPORTED_MODULE_21__["default"], {
        peerId: peerId,
        gift: gift,
        canManage: canManage,
        collectibleEmojiStatuses: collectibleEmojiStatuses,
        currentUserEmojiStatus: currentUserEmojiStatus
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId,
  gift
}) => {
  const fromPeer = gift.fromId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, gift.fromId) : undefined;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, peerId);
  const hasAdminRights = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getHasAdminRight)(chat, 'postMessages');
  const currentUserId = global.currentUserId;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, currentUserId) : undefined;
  const currentUserEmojiStatus = currentUser?.emojiStatus;
  const collectibleEmojiStatuses = global.collectibleEmojiStatuses?.statuses;
  return {
    fromPeer,
    hasAdminRights,
    currentUserId,
    currentUserEmojiStatus,
    collectibleEmojiStatuses
  };
})(SavedGift)));

/***/ }),

/***/ "./src/components/left/ArchivedChats.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/left/ArchivedChats.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const ArchivedChatsAsync = props => {
  const ArchivedChats = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ArchivedChats');
  return ArchivedChats ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(ArchivedChats, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ArchivedChatsAsync);

/***/ }),

/***/ "./src/components/left/ConnectionStatusOverlay.scss":
/*!**********************************************************!*\
  !*** ./src/components/left/ConnectionStatusOverlay.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/ConnectionStatusOverlay.tsx":
/*!*********************************************************!*\
  !*** ./src/components/left/ConnectionStatusOverlay.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ConnectionStatusOverlay_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ConnectionStatusOverlay.scss */ "./src/components/left/ConnectionStatusOverlay.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");







const ConnectionStatusOverlay = ({
  connectionStatus,
  connectionStatusText,
  onClick
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_1__["default"])();
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div", {
    id: "ConnectionStatusOverlay",
    dir: lang.isRtl ? 'rtl' : undefined,
    onClick: onClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Spinner__WEBPACK_IMPORTED_MODULE_3__["default"], {
      color: "black"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div", {
      className: "state-text",
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_4__["default"], {
        activeKey: connectionStatus,
        name: "slideFade",
        children: connectionStatusText
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_2__["default"], {
      round: true,
      size: "tiny",
      color: "translucent-black",
      iconName: "close"
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ConnectionStatusOverlay));

/***/ }),

/***/ "./src/components/left/LeftColumn.scss":
/*!*********************************************!*\
  !*** ./src/components/left/LeftColumn.scss ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/LeftColumn.tsx":
/*!********************************************!*\
  !*** ./src/components/left/LeftColumn.tsx ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_resolveTransitionName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/resolveTransitionName */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _util_swipeController__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/swipeController */ "./src/util/swipeController.ts");
/* harmony import */ var _hooks_reducers_useFoldersReducer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/reducers/useFoldersReducer */ "./src/hooks/reducers/useFoldersReducer.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ArchivedChats_async__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./ArchivedChats.async */ "./src/components/left/ArchivedChats.async.tsx");
/* harmony import */ var _main_LeftMain__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./main/LeftMain */ "./src/components/left/main/LeftMain.tsx");
/* harmony import */ var _newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./newChat/NewChat.async */ "./src/components/left/newChat/NewChat.async.tsx");
/* harmony import */ var _settings_Settings_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./settings/Settings.async */ "./src/components/left/settings/Settings.async.tsx");
/* harmony import */ var _LeftColumn_scss__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./LeftColumn.scss */ "./src/components/left/LeftColumn.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






















var ContentType = /*#__PURE__*/function (ContentType) {
  ContentType[ContentType["Main"] = 0] = "Main";
  // eslint-disable-next-line @typescript-eslint/no-shadow
  ContentType[ContentType["Settings"] = 1] = "Settings";
  ContentType[ContentType["Archived"] = 2] = "Archived";
  ContentType[ContentType["NewGroup"] = 3] = "NewGroup";
  ContentType[ContentType["NewChannel"] = 4] = "NewChannel";
  return ContentType;
}(ContentType || {});
const RENDER_COUNT = Object.keys(ContentType).length / 2;
const RESET_TRANSITION_DELAY_MS = 250;
function LeftColumn({
  ref,
  contentKey,
  settingsScreen,
  searchQuery,
  searchDate,
  isFirstChatFolderActive,
  animationLevel,
  shouldSkipHistoryAnimations,
  currentUserId,
  hasPasscode,
  nextFoldersAction,
  isChatOpen,
  isAppUpdateAvailable,
  isForumPanelOpen,
  forumPanelChatId,
  isClosingSearch,
  archiveSettings,
  isArchivedStoryRibbonShown,
  isAccountFrozen,
  isFoldersSidebarShown
}) {
  const {
    setGlobalSearchQuery,
    setGlobalSearchClosing,
    setGlobalSearchChatId,
    resetChatCreation,
    setGlobalSearchDate,
    loadPasswordInfo,
    clearTwoFaError,
    openChat,
    openLeftColumnContent,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [contactsFilter, setContactsFilter] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [foldersState, foldersDispatch] = (0,_hooks_reducers_useFoldersReducer__WEBPACK_IMPORTED_MODULE_9__["default"])();

  // Used to reset child components in background.
  const [lastResetTime, setLastResetTime] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  let contentType = ContentType.Main;
  switch (contentKey) {
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived:
      contentType = ContentType.Archived;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings:
      contentType = ContentType.Settings;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1:
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep2:
      contentType = ContentType.NewChannel;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1:
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep2:
      contentType = ContentType.NewGroup;
      break;
  }
  const handleReset = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(forceReturnToChatList => {
    function fullReset() {
      openLeftColumnContent({
        contentKey: undefined
      });
      openSettingsScreen({
        screen: undefined
      });
      setContactsFilter('');
      setGlobalSearchClosing({
        isClosing: true
      });
      resetChatCreation();
      setTimeout(() => {
        setGlobalSearchQuery({
          query: ''
        });
        setGlobalSearchDate({
          date: undefined
        });
        setGlobalSearchChatId({
          id: undefined
        });
        setGlobalSearchClosing({
          isClosing: false
        });
        setLastResetTime(Date.now());
      }, RESET_TRANSITION_DELAY_MS);
    }
    if (forceReturnToChatList === true) {
      fullReset();
      return;
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep2) {
      openLeftColumnContent({
        contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1
      });
      return;
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep2) {
      openLeftColumnContent({
        contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1
      });
      return;
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1) {
      const pickerSearchInput = document.getElementById('new-group-picker-search');
      if (pickerSearchInput) {
        pickerSearchInput.blur();
      }
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings) {
      switch (settingsScreen) {
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.EditProfile:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.General:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Notifications:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.DataStorage:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Performance:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.ActiveSessions:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Language:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Stickers:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Experimental:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackground:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.General
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackgroundColor:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackground
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumber:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyAddByPhone:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeen:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhoto:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBio:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthday:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGifts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCall:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2P:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwarding:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChats:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessages:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyMessages:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBlockedUsers:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.ActiveWebsites:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaEnabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaCongratulations:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeCongratulations:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Passkeys:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscode:
          openSettingsScreen({
            screen: hasPasscode ? _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled : _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeCurrent:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeTurnOff:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscodeConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscode
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeNew:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeCurrent
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeNew
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumberAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumberDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumber
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeenAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeenDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeen
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhotoAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhotoDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhoto
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBioAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBioDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBio
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthdayAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthdayDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthday
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGiftsAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGiftsDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGifts
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCallAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCallDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCall
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2PAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2PDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2P
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwardingAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwardingDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwarding
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessagesAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessagesDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessages
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChatsAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChatsDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChats
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPassword:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPassword
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordHint:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordConfirm
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmail:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordHint
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmailCode:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmail
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordCurrent:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaTurnOff:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCurrentPassword:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaEnabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordNew:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordCurrent
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordNew
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordHint:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordConfirm
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmail:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCurrentPassword
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCode:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmail
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersCreateFolder:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolder:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersShare:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolder
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersIncludedChatsFromChatList:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersExcludedChatsFromChatList:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderInvites:
          openLeftColumnContent({
            contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList
          });
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.QuickReaction:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.CustomEmoji:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Stickers
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.DoNotTranslate:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Language
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyNoPaidMessages:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyMessages
          });
          return;
        default:
          break;
      }
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList && isFirstChatFolderActive) {
      openLeftColumnContent({
        contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
      });
      return;
    }
    fullReset();
  });
  const handleSearchQuery = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(query => {
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts) {
      setContactsFilter(query);
      return;
    }
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
    });
    if (query !== searchQuery) {
      setGlobalSearchQuery({
        query
      });
    }
  });
  const handleTopicSearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
    });
    setGlobalSearchQuery({
      query: ''
    });
    setGlobalSearchChatId({
      id: forumPanelChatId
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const isArchived = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived;
    const isChatList = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
    const noChatOrForumOpen = !isChatOpen && !isForumPanelOpen;
    // We listen for escape key only in these cases:
    // 1. When we are in archived chats and no chat or forum is open.
    // 2. When we are in any other screen except chat list and archived chat list.
    // 3. When we are in chat list and first chat folder is active and no chat or forum is open.
    if (isArchived && noChatOrForumOpen || !isChatList && !isArchived || isFirstChatFolderActive && noChatOrForumOpen) {
      return (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
        handleReset();
      });
    } else {
      return undefined;
    }
  }, [isFirstChatFolderActive, contentKey, handleReset, isChatOpen, isForumPanelOpen]);
  const handleHotkeySearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch) {
      return;
    }
    e.preventDefault();
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
    });
  });
  const handleHotkeySavedMessages = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    e.preventDefault();
    openChat({
      id: currentUserId,
      shouldReplaceHistory: true
    });
  });
  const handleArchivedChats = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    e.preventDefault();
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived
    });
  });
  const handleHotkeySettings = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    e.preventDefault();
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings
    });
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_10__.useHotkeys)((0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => ({
    'Mod+Shift+F': handleHotkeySearch,
    // https://support.mozilla.org/en-US/kb/take-screenshots-firefox
    ...(!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_FIREFOX && {
      'Mod+Shift+S': handleHotkeySavedMessages
    }),
    ...(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_APP && {
      'Mod+0': handleHotkeySavedMessages,
      'Mod+9': handleArchivedChats
    }),
    ...(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_MAC_OS && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_APP && {
      'Mod+,': handleHotkeySettings
    })
  }), []));
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    clearTwoFaError();
    if (settingsScreen === _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy) {
      loadPasswordInfo();
    }
  }, [clearTwoFaError, loadPasswordInfo, settingsScreen]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (nextFoldersAction) {
      foldersDispatch(nextFoldersAction);
    }
  }, [foldersDispatch, nextFoldersAction]);
  const prevSettingsScreenRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_13__.useStateRef)((0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__["default"])(contentType === ContentType.Settings ? settingsScreen : -1));
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_swipeController__WEBPACK_IMPORTED_MODULE_8__.captureControlledSwipe)(ref.current, {
      excludedClosestSelector: '.ProfileInfo, .color-picker, .hue-picker',
      selectorToPreventScroll: '#Settings .custom-scroll',
      onSwipeRightStart: handleReset,
      onCancel: () => {
        openLeftColumnContent({
          contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings
        });
        openSettingsScreen({
          screen: prevSettingsScreenRef.current
        });
      }
    });
  }, [prevSettingsScreenRef, ref]);
  function renderContent(isActive) {
    switch (contentType) {
      case ContentType.Archived:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ArchivedChats_async__WEBPACK_IMPORTED_MODULE_16__["default"], {
          isActive: isActive,
          onReset: handleReset,
          onTopicSearch: handleTopicSearch,
          foldersDispatch: foldersDispatch,
          isForumPanelOpen: isForumPanelOpen,
          archiveSettings: archiveSettings,
          isStoryRibbonShown: isArchivedStoryRibbonShown
        });
      case ContentType.Settings:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_settings_Settings_async__WEBPACK_IMPORTED_MODULE_19__["default"], {
          isActive: isActive,
          currentScreen: settingsScreen,
          foldersState: foldersState,
          foldersDispatch: foldersDispatch,
          animationLevel: animationLevel,
          shouldSkipTransition: shouldSkipHistoryAnimations,
          onReset: handleReset
        });
      case ContentType.NewChannel:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_18__["default"], {
          isActive: isActive,
          isChannel: true,
          content: contentKey,
          animationLevel: animationLevel,
          onReset: handleReset
        }, lastResetTime);
      case ContentType.NewGroup:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_18__["default"], {
          isActive: isActive,
          content: contentKey,
          animationLevel: animationLevel,
          onReset: handleReset
        }, lastResetTime);
      default:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_main_LeftMain__WEBPACK_IMPORTED_MODULE_17__["default"], {
          content: contentKey,
          isClosingSearch: isClosingSearch,
          searchQuery: searchQuery,
          searchDate: searchDate,
          contactsFilter: contactsFilter,
          foldersDispatch: foldersDispatch,
          onSearchQuery: handleSearchQuery,
          onReset: handleReset,
          shouldSkipTransition: shouldSkipHistoryAnimations,
          isAppUpdateAvailable: isAppUpdateAvailable,
          isForumPanelOpen: isForumPanelOpen,
          onTopicSearch: handleTopicSearch,
          isAccountFrozen: isAccountFrozen,
          isFoldersSidebarShown: isFoldersSidebarShown
        });
    }
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_15__["default"], {
    ref: ref,
    name: (0,_util_resolveTransitionName__WEBPACK_IMPORTED_MODULE_7__.resolveTransitionName)('layers', animationLevel, shouldSkipHistoryAnimations),
    renderCount: RENDER_COUNT,
    activeKey: contentType,
    shouldCleanup: true,
    cleanupExceptionKey: ContentType.Main,
    shouldWrap: true,
    wrapExceptionKey: ContentType.Main,
    id: "LeftColumn",
    withSwipeControl: true,
    children: renderContent
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const {
    globalSearch: {
      query,
      minDate
    },
    shouldSkipHistoryAnimations,
    activeChatFolder,
    leftColumn,
    nextFoldersAction,
    storyViewer: {
      isArchivedRibbonShown
    }
  } = tabState;
  const {
    currentUserId,
    passcode: {
      hasPasscode
    },
    isAppUpdateAvailable,
    archiveSettings
  } = global;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_4__.selectSharedSettings)(global);
  const currentChat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentChat)(global);
  const isChatOpen = Boolean(currentChat?.id);
  const isForumPanelOpen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsForumPanelOpen)(global);
  const forumPanelChatId = tabState.forumPanelChatId;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserFrozen)(global);
  return {
    searchQuery: query,
    searchDate: minDate,
    isFirstChatFolderActive: activeChatFolder === 0,
    animationLevel,
    shouldSkipHistoryAnimations,
    currentUserId,
    hasPasscode,
    nextFoldersAction,
    isChatOpen,
    isAppUpdateAvailable,
    isForumPanelOpen,
    forumPanelChatId,
    isClosingSearch: tabState.globalSearch.isClosing,
    archiveSettings,
    isArchivedStoryRibbonShown: isArchivedRibbonShown,
    isAccountFrozen,
    contentKey: leftColumn.contentKey,
    settingsScreen: leftColumn.settingsScreen
  };
})(LeftColumn)));

/***/ }),

/***/ "./src/components/left/NewChatButton.scss":
/*!************************************************!*\
  !*** ./src/components/left/NewChatButton.scss ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/NewChatButton.tsx":
/*!***********************************************!*\
  !*** ./src/components/left/NewChatButton.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _NewChatButton_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./NewChatButton.scss */ "./src/components/left/NewChatButton.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");










const NewChatButton = ({
  isShown,
  onNewPrivateChat,
  onNewChannel,
  onNewGroup,
  isAccountFrozen
}) => {
  const [isMenuOpen, setIsMenuOpen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const shouldRender = isShown || isMenuOpen;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!shouldRender) {
      setIsMenuOpen(false);
    }
  }, [shouldRender]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const fabClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('NewChatButton', shouldRender && 'revealed', isMenuOpen && 'menu-is-open');
  const toggleIsMenuOpen = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    setIsMenuOpen(!isMenuOpen);
  }, [isMenuOpen, isAccountFrozen]);
  const handleClose = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setIsMenuOpen(false);
  }, []);
  const menuItems = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment, {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
      icon: "channel",
      onClick: onNewChannel,
      children: lang('NewChannel')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
      icon: "group",
      onClick: onNewGroup,
      children: lang('NewGroup')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
      icon: "user",
      onClick: onNewPrivateChat,
      children: lang('NewMessageTitle')
    })]
  }), [lang, onNewChannel, onNewGroup, onNewPrivateChat]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div", {
    className: fabClassName,
    dir: lang.isRtl ? 'rtl' : undefined,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
      round: true,
      color: "primary",
      className: isMenuOpen ? 'active' : '',
      onClick: toggleIsMenuOpen,
      ariaLabel: lang(isMenuOpen ? 'Close' : 'NewMessageTitle'),
      tabIndex: -1,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
        name: "new-chat-filled"
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
        name: "close"
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_6__["default"], {
      isOpen: isMenuOpen,
      positionX: lang.isRtl ? 'left' : 'right',
      positionY: "bottom",
      autoClose: true,
      onClose: handleClose,
      children: menuItems
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewChatButton);

/***/ }),

/***/ "./src/components/left/main/AccountMenuItems.tsx":
/*!*******************************************************!*\
  !*** ./src/components/left/main/AccountMenuItems.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_cache__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/cache */ "./src/global/cache.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_multiaccount__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/multiaccount */ "./src/util/multiaccount.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMultiaccountInfo__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useMultiaccountInfo */ "./src/hooks/useMultiaccountInfo.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");















const NOTIFICATION_DURATION = 7000;
const AccountMenuItems = ({
  currentUser,
  totalLimit,
  onSelectCurrent
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const accounts = (0,_hooks_useMultiaccountInfo__WEBPACK_IMPORTED_MODULE_9__["default"])(currentUser);
  const currentCount = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getCurrentProdAccountCount)();
  const maxCount = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getCurrentMaxAccountCount)();
  const currentAccountInfo = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return Object.values(accounts).find(account => account.userId === currentUser.id);
  }, [accounts, currentUser.id]);
  const shouldShowLimit = currentCount >= maxCount;
  const handleAccountClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(account => {
    if (account.userId === currentUser.id) {
      onSelectCurrent?.();
      return;
    }

    // IDB locks up if we write large payload on navigation
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_SAFARI) (0,_global_cache__WEBPACK_IMPORTED_MODULE_2__.temporarilySuspendCacheUpdate)();
  });
  const handleNewAccountClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (shouldShowLimit) {
      showNotification({
        title: lang('PremiumLimitAccountsTitle'),
        message: currentUser.isPremium ? lang('PremiumLimitAccounts') : lang('PremiumLimitAccountsNoPremium'),
        duration: NOTIFICATION_DURATION
      });
      return;
    }
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_SAFARI) (0,_global_cache__WEBPACK_IMPORTED_MODULE_2__.temporarilySuspendCacheUpdate)();
  });
  const newAccountUrl = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!Object.values(accounts).length) {
      return undefined;
    }
    if (currentCount === totalLimit) {
      return undefined;
    }
    let freeIndex = 1;
    while (accounts[freeIndex]) {
      freeIndex += 1;
    }
    return (0,_util_multiaccount__WEBPACK_IMPORTED_MODULE_5__.getAccountSlotUrl)(freeIndex, true);
  }, [accounts, currentCount, totalLimit]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment, {
    children: [Object.entries(accounts || {}).sort(([, account]) => account.userId === currentUser.id ? -1 : 1).map(([slot, account], index, arr) => {
      const isSameServer = account.isTest === currentAccountInfo?.isTest;
      const mockUser = {
        title: [account.firstName, account.lastName].filter(Boolean).join(' '),
        isCustomPeer: true,
        peerColorId: account.color,
        emojiStatusId: isSameServer ? account.emojiStatusId : undefined,
        isPremium: account.isPremium
      };
      const hasSeparator = account.userId === currentUser.id && (newAccountUrl || arr.length > 1);
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_12__["default"], {
          className: "account-menu-item",
          customIcon: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
            size: "mini",
            className: "account-avatar",
            peer: mockUser,
            previewUrl: account.avatarUri
          }),
          onClick: () => handleAccountClick(account),
          href: account.userId !== currentUser.id ? (0,_util_multiaccount__WEBPACK_IMPORTED_MODULE_5__.getAccountSlotUrl)(Number(slot)) : undefined,
          children: [account.isTest && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("span", {
            className: "account-menu-item-test",
            children: "T"
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_11__["default"], {
            peer: mockUser,
            withEmojiStatus: true,
            emojiStatusSize: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.REM
          })]
        }), hasSeparator && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_13__["default"], {})]
      });
    }), newAccountUrl && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_12__["default"], {
      icon: "add",
      rel: "noopener" // Allow referrer to be passed
      ,
      href: !shouldShowLimit ? newAccountUrl : undefined,
      onClick: handleNewAccountClick,
      children: lang('MenuAddAccount')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AccountMenuItems));

/***/ }),

/***/ "./src/components/left/main/ChatFolders.tsx":
/*!**************************************************!*\
  !*** ./src/components/left/main/ChatFolders.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_resolveTransitionName__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/resolveTransitionName */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFolderTabs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useFolderTabs */ "./src/hooks/useFolderTabs.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _story_StoryRibbon__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../story/StoryRibbon */ "./src/components/story/StoryRibbon.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ChatList__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ChatList */ "./src/components/left/main/ChatList.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






















const SAVED_MESSAGES_HOTKEY = '0';
const FIRST_FOLDER_INDEX = 0;
const ChatFolders = ({
  foldersDispatch,
  chatFoldersById,
  orderedFolderIds,
  activeChatFolder,
  currentUserId,
  isForumPanelOpen,
  animationLevel,
  shouldSkipHistoryAnimations,
  maxFolders,
  maxChatLists,
  shouldHideFolderTabs,
  folderInvitesById,
  maxFolderInvites,
  hasArchivedChats,
  hasArchivedStories,
  archiveSettings,
  isStoryRibbonShown,
  isFoldersSidebarShown
}) => {
  const {
    loadChatFolders,
    setActiveChatFolder,
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    loadChatFolders();
  }, []);
  const {
    ref,
    shouldRender: shouldRenderStoryRibbon,
    getIsClosing: getIsStoryRibbonClosing
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_16__["default"])({
    isOpen: isStoryRibbonShown,
    className: false,
    withShouldRender: true
  });
  const isStoryRibbonClosing = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_11__["default"])(getIsStoryRibbonClosing);
  const scrollToTop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(() => {
    const activeList = ref.current?.querySelector('#LeftColumn .chat-list.Transition_slide-active');
    activeList?.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
  const {
    displayedFolders,
    folderTabs
  } = (0,_hooks_useFolderTabs__WEBPACK_IMPORTED_MODULE_12__["default"])({
    sidebarMode: false,
    orderedFolderIds,
    chatFoldersById,
    maxFolders,
    maxChatLists,
    folderInvitesById,
    maxFolderInvites
  });
  const allChatsFolderIndex = displayedFolders?.findIndex(folder => folder.id === _config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID);
  const isInAllChatsFolder = allChatsFolderIndex === activeChatFolder;
  const isInFirstFolder = FIRST_FOLDER_INDEX === activeChatFolder;
  const handleSwitchTab = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(index => {
    setActiveChatFolder({
      activeChatFolder: index
    }, {
      forceOnHeavyAnimation: true
    });
    if (activeChatFolder === index) {
      scrollToTop();
    }
  });

  // Prevent `activeTab` pointing at non-existing folder after update
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!folderTabs?.length) {
      return;
    }
    if (activeChatFolder >= folderTabs.length) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }, [activeChatFolder, folderTabs, setActiveChatFolder]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV || !folderTabs?.length || isForumPanelOpen) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.chat-list',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.SwipeDirection.Left) {
          setActiveChatFolder({
            activeChatFolder: Math.min(activeChatFolder + 1, folderTabs.length - 1)
          }, {
            forceOnHeavyAnimation: true
          });
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.SwipeDirection.Right) {
          setActiveChatFolder({
            activeChatFolder: Math.max(0, activeChatFolder - 1)
          }, {
            forceOnHeavyAnimation: true
          });
          return true;
        }
        return false;
      }
    });
  }, [activeChatFolder, folderTabs, isForumPanelOpen, setActiveChatFolder]);
  const isNotInFirstFolderRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  isNotInFirstFolderRef.current = !isInFirstFolder;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isNotInFirstFolderRef.current ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (isNotInFirstFolderRef.current) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }) : undefined, [activeChatFolder, setActiveChatFolder]);
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_13__["default"])({
    isActive: !isInFirstFolder,
    onBack: () => setActiveChatFolder({
      activeChatFolder: FIRST_FOLDER_INDEX
    }, {
      forceOnHeavyAnimation: true
    })
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const handleKeyDown = e => {
      if (e.ctrlKey && e.shiftKey && e.code.startsWith('Digit') && folderTabs) {
        const [, digit] = e.code.match(/Digit(\d)/) || [];
        if (!digit) return;
        if (digit === SAVED_MESSAGES_HOTKEY) {
          openChat({
            id: currentUserId,
            shouldReplaceHistory: true
          });
          return;
        }
        const folder = Number(digit) - 1;
        if (folder > folderTabs.length - 1) return;
        setActiveChatFolder({
          activeChatFolder: folder
        }, {
          forceOnHeavyAnimation: true
        });
        e.preventDefault();
      }
    };
    document.addEventListener('keydown', handleKeyDown, true);
    return () => {
      document.removeEventListener('keydown', handleKeyDown, true);
    };
  }, [currentUserId, folderTabs, openChat, setActiveChatFolder]);
  const {
    ref: placeholderRef,
    shouldRender: shouldRenderPlaceholder
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_16__["default"])({
    isOpen: !orderedFolderIds && !isFoldersSidebarShown,
    noMountTransition: true,
    withShouldRender: true
  });
  function renderCurrentTab(isActive) {
    const activeFolder = Object.values(chatFoldersById).find(({
      id
    }) => id === folderTabs[activeChatFolder].id);
    const isFolder = activeFolder && !isInAllChatsFolder;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ChatList__WEBPACK_IMPORTED_MODULE_20__["default"], {
      folderType: isFolder ? 'folder' : 'all',
      folderId: isFolder ? activeFolder.id : undefined,
      isActive: isActive,
      isForumPanelOpen: isForumPanelOpen,
      foldersDispatch: foldersDispatch,
      isMainList: true,
      canDisplayArchive: (hasArchivedChats || hasArchivedStories) && !archiveSettings.isHidden,
      archiveSettings: archiveSettings,
      isFoldersSidebarShown: isFoldersSidebarShown,
      isStoryRibbonShown: isStoryRibbonShown,
      withTags: true
    });
  }
  const hasFolders = folderTabs && folderTabs.length > 1;
  const shouldRenderFolders = hasFolders && !isFoldersSidebarShown;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('ChatFolders', shouldRenderFolders && shouldHideFolderTabs && 'ChatFolders--tabs-hidden', shouldRenderStoryRibbon && 'with-story-ribbon', isFoldersSidebarShown && 'ChatFolders--tabs-sidebar-shown'),
    children: [shouldRenderStoryRibbon && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_story_StoryRibbon__WEBPACK_IMPORTED_MODULE_17__["default"], {
      isClosing: isStoryRibbonClosing
    }), shouldRenderFolders ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_TabList__WEBPACK_IMPORTED_MODULE_18__["default"], {
      contextRootElementSelector: "#LeftColumn",
      tabs: folderTabs,
      activeTab: activeChatFolder,
      onSwitchTab: handleSwitchTab
    }) : shouldRenderPlaceholder ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
      ref: placeholderRef,
      className: "tabs-placeholder"
    }) : undefined, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_19__["default"], {
      ref: transitionRef,
      name: (0,_util_resolveTransitionName__WEBPACK_IMPORTED_MODULE_10__.resolveTransitionName)('slideOptimized', animationLevel, shouldSkipHistoryAnimations, lang.isRtl),
      activeKey: activeChatFolder,
      renderCount: hasFolders ? folderTabs.length : undefined,
      children: renderCurrentTab
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chatFolders: {
      byId: chatFoldersById,
      orderedIds: orderedFolderIds,
      invites: folderInvitesById
    },
    chats: {
      listIds: {
        archived
      }
    },
    stories: {
      orderedPeerIds: {
        archived: archivedStories
      }
    },
    currentUserId,
    archiveSettings
  } = global;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_5__.selectSharedSettings)(global);
  const {
    shouldSkipHistoryAnimations,
    activeChatFolder
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const {
    storyViewer: {
      isRibbonShown: isStoryRibbonShown
    }
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  return {
    chatFoldersById,
    folderInvitesById,
    orderedFolderIds,
    activeChatFolder,
    currentUserId,
    animationLevel,
    shouldSkipHistoryAnimations,
    hasArchivedChats: Boolean(archived?.length),
    hasArchivedStories: Boolean(archivedStories?.length),
    maxFolders: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'dialogFilters'),
    maxFolderInvites: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'chatlistInvites'),
    maxChatLists: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'chatlistJoined'),
    archiveSettings,
    isStoryRibbonShown
  };
})(ChatFolders)));

/***/ }),

/***/ "./src/components/left/main/ContactList.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/left/main/ContactList.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const ContactListAsync = props => {
  const ContactList = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ContactList');
  return ContactList ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(ContactList, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ContactListAsync);

/***/ }),

/***/ "./src/components/left/main/LeftMain.scss":
/*!************************************************!*\
  !*** ./src/components/left/main/LeftMain.scss ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/main/LeftMain.tsx":
/*!***********************************************!*\
  !*** ./src/components/left/main/LeftMain.tsx ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useForumPanelRender__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useForumPanelRender */ "./src/hooks/useForumPanelRender.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _NewChatButton__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../NewChatButton */ "./src/components/left/NewChatButton.tsx");
/* harmony import */ var _search_LeftSearch_async__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../search/LeftSearch.async */ "./src/components/left/search/LeftSearch.async.tsx");
/* harmony import */ var _ChatFolders__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./ChatFolders */ "./src/components/left/main/ChatFolders.tsx");
/* harmony import */ var _ContactList_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ContactList.async */ "./src/components/left/main/ContactList.async.tsx");
/* harmony import */ var _forum_ForumPanel__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./forum/ForumPanel */ "./src/components/left/main/forum/ForumPanel.tsx");
/* harmony import */ var _LeftMainHeader__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./LeftMainHeader */ "./src/components/left/main/LeftMainHeader.tsx");
/* harmony import */ var _LeftMain_scss__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./LeftMain.scss */ "./src/components/left/main/LeftMain.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






















const TRANSITION_RENDER_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent).length / 2;
const BUTTON_CLOSE_DELAY_MS = 250;
const TAURI_CHECK_UPDATE_INTERVAL = 10 * 60 * 1000;
let closeTimeout;
const LeftMain = ({
  content,
  searchQuery,
  searchDate,
  isClosingSearch,
  contactsFilter,
  shouldSkipTransition,
  foldersDispatch,
  isAppUpdateAvailable,
  isForumPanelOpen,
  onSearchQuery,
  onReset,
  onTopicSearch,
  isAccountFrozen,
  isFoldersSidebarShown
}) => {
  const {
    openLeftColumnContent
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isNewChatButtonShown, setIsNewChatButtonShown] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV);
  const [tauriUpdate, setTauriUpdate] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isTauriUpdateDownloading, setIsTauriUpdateDownloading] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    shouldRenderForumPanel,
    handleForumPanelAnimationEnd,
    handleForumPanelAnimationStart,
    isAnimationStarted
  } = (0,_hooks_useForumPanelRender__WEBPACK_IMPORTED_MODULE_8__["default"])(isForumPanelOpen);
  const isForumPanelRendered = isForumPanelOpen && content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
  const isForumPanelVisible = isForumPanelRendered && isAnimationStarted;
  const {
    shouldRender: shouldRenderUpdateButton,
    transitionClassNames: updateButtonClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_11__["default"])(isAppUpdateAvailable || Boolean(tauriUpdate));
  const isMouseInside = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const handleMouseEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (content !== _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList) {
      return;
    }
    isMouseInside.current = true;
    setIsNewChatButtonShown(true);
  });
  const handleMouseLeave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    isMouseInside.current = false;
    if (closeTimeout) {
      clearTimeout(closeTimeout);
      closeTimeout = undefined;
    }
    closeTimeout = window.setTimeout(() => {
      if (!isMouseInside.current) {
        setIsNewChatButtonShown(false);
      }
    }, BUTTON_CLOSE_DELAY_MS);
  });
  const handleSelectContacts = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts
    });
  });
  const handleUpdateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(async () => {
    if (tauriUpdate) {
      try {
        setIsTauriUpdateDownloading(true);
        await tauriUpdate.downloadAndInstall();
        setIsTauriUpdateDownloading(false);
        await window.tauri?.relaunch();
      } catch (e) {
        // eslint-disable-next-line no-console
        console.error('Failed to download and install Tauri update', e);
      } finally {
        setIsTauriUpdateDownloading(false);
      }
    } else {
      window.location.reload();
    }
  });
  const handleSelectNewChannel = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1
    });
  });
  const handleSelectNewGroup = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    let autoCloseTimeout;
    if (content !== _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList) {
      autoCloseTimeout = window.setTimeout(() => {
        setIsNewChatButtonShown(false);
      }, BUTTON_CLOSE_DELAY_MS);
    } else if (isMouseInside.current || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV) {
      setIsNewChatButtonShown(true);
    }
    return () => {
      if (autoCloseTimeout) {
        clearTimeout(autoCloseTimeout);
        autoCloseTimeout = undefined;
      }
    };
  }, [content]);
  const checkTauriUpdate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    window.tauri?.checkUpdate().then(update => setTauriUpdate(update ?? undefined)).catch(e => {
      // eslint-disable-next-line no-console
      console.error('Tauri update check failed:', e);
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    checkTauriUpdate();
  }, []);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_7__["default"])(checkTauriUpdate, _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TAURI && !_config__WEBPACK_IMPORTED_MODULE_3__.DEBUG ? TAURI_CHECK_UPDATE_INTERVAL : undefined);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
    id: "LeftColumn-main",
    onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? handleMouseEnter : undefined,
    onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? handleMouseLeave : undefined,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_LeftMainHeader__WEBPACK_IMPORTED_MODULE_19__["default"], {
      shouldHideSearch: isForumPanelVisible,
      content: content,
      contactsFilter: contactsFilter,
      onSearchQuery: onSearchQuery,
      onReset: onReset,
      shouldSkipTransition: shouldSkipTransition,
      isClosingSearch: isClosingSearch,
      isFoldersSidebarShown: isFoldersSidebarShown
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_13__["default"], {
      name: shouldSkipTransition ? 'none' : 'zoomFade',
      renderCount: TRANSITION_RENDER_COUNT,
      activeKey: content,
      shouldCleanup: true,
      cleanupExceptionKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList,
      shouldWrap: true,
      wrapExceptionKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList,
      children: isActive => {
        switch (content) {
          case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList:
            return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ChatFolders__WEBPACK_IMPORTED_MODULE_16__["default"], {
              shouldHideFolderTabs: isForumPanelVisible,
              foldersDispatch: foldersDispatch,
              isForumPanelOpen: isForumPanelVisible,
              isFoldersSidebarShown: isFoldersSidebarShown
            });
          case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch:
            return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_search_LeftSearch_async__WEBPACK_IMPORTED_MODULE_15__["default"], {
              searchQuery: searchQuery,
              searchDate: searchDate,
              isActive: isActive,
              onReset: onReset
            });
          case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts:
            return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ContactList_async__WEBPACK_IMPORTED_MODULE_17__["default"], {
              filter: contactsFilter,
              isActive: isActive,
              onReset: onReset
            });
          default:
            return undefined;
        }
      }
    }), shouldRenderUpdateButton && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
      fluid: true,
      badge: true,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('btn-update', updateButtonClassNames),
      onClick: handleUpdateClick,
      isLoading: isTauriUpdateDownloading,
      children: lang('lng_update_telegram')
    }), shouldRenderForumPanel && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_forum_ForumPanel__WEBPACK_IMPORTED_MODULE_18__["default"], {
      isOpen: isForumPanelOpen,
      isHidden: !isForumPanelRendered,
      onTopicSearch: onTopicSearch,
      onOpenAnimationStart: handleForumPanelAnimationStart,
      onCloseAnimationEnd: handleForumPanelAnimationEnd
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_NewChatButton__WEBPACK_IMPORTED_MODULE_14__["default"], {
      isShown: isNewChatButtonShown,
      onNewPrivateChat: handleSelectContacts,
      onNewChannel: handleSelectNewChannel,
      onNewGroup: handleSelectNewGroup,
      isAccountFrozen: isAccountFrozen
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(LeftMain));

/***/ }),

/***/ "./src/components/left/main/LeftMainHeader.scss":
/*!******************************************************!*\
  !*** ./src/components/left/main/LeftMainHeader.scss ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/left/main/LeftMainHeader.tsx":
/*!*****************************************************!*\
  !*** ./src/components/left/main/LeftMainHeader.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MainMenuDropdown__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/MainMenuDropdown */ "./src/components/common/MainMenuDropdown.tsx");
/* harmony import */ var _common_PeerChip__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../common/PeerChip */ "./src/components/common/PeerChip.tsx");
/* harmony import */ var _story_StoryToggler__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../story/StoryToggler */ "./src/components/story/StoryToggler.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ui_ShowTransition__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/ShowTransition */ "./src/components/ui/ShowTransition.tsx");
/* harmony import */ var _ConnectionStatusOverlay__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../ConnectionStatusOverlay */ "./src/components/left/ConnectionStatusOverlay.tsx");
/* harmony import */ var _StatusButton__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./StatusButton */ "./src/components/left/main/StatusButton.tsx");
/* harmony import */ var _LeftMainHeader_scss__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./LeftMainHeader.scss */ "./src/components/left/main/LeftMainHeader.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



























const CLEAR_DATE_SEARCH_PARAM = {
  date: undefined
};
const CLEAR_CHAT_SEARCH_PARAM = {
  id: undefined
};
const IS_WITH_WINDOW_BUTTONS = _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TAURI && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_MAC_OS;
const LeftMainHeader = ({
  shouldHideSearch,
  content,
  contactsFilter,
  isClosingSearch,
  searchQuery,
  isLoading,
  isCurrentUserPremium,
  shouldSkipTransition,
  globalSearchChatId,
  searchDate,
  theme,
  connectionState,
  isSyncing,
  isFetchingDifference,
  isMessageListOpen,
  isConnectionStatusMinimized,
  areChatsLoaded,
  hasPasscode,
  canSetPasscode,
  isFoldersSidebarShown,
  isForumPanelOpen,
  onSearchQuery,
  onReset
}) => {
  const {
    setGlobalSearchDate,
    setSharedSettingOption,
    setGlobalSearchChatId,
    lockScreen,
    openSettingsScreen,
    searchMessagesGlobal,
    closeForumPanel
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const areContactsVisible = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts;
  const hasMenu = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
  const isSearchButton = isForumPanelOpen && isFoldersSidebarShown && !IS_WITH_WINDOW_BUTTONS;
  const selectedSearchDate = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return searchDate ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateToString)(new Date(searchDate * 1000)) : undefined;
  }, [searchDate]);
  const {
    connectionStatus,
    connectionStatusText,
    connectionStatusPosition
  } = (0,_hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__["default"])(oldLang, connectionState, isSyncing || isFetchingDifference, isMessageListOpen, isConnectionStatusMinimized, !areChatsLoaded);
  const handleLockScreenHotkey = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(e => {
    e.preventDefault();
    e.stopPropagation();
    if (hasPasscode) {
      lockScreen();
    } else {
      openSettingsScreen({
        screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled
      });
    }
  });
  const handleForumSearchClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    closeForumPanel();
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_12__.useHotkeys)((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => canSetPasscode ? {
    'Ctrl+Shift+L': handleLockScreenHotkey,
    'Alt+Shift+L': handleLockScreenHotkey,
    'Meta+Shift+L': handleLockScreenHotkey,
    ...(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_APP && {
      'Mod+L': handleLockScreenHotkey
    })
  } : undefined, [canSetPasscode]));
  const MainButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_20__["default"], {
      round: true,
      ripple: hasMenu && !isMobile,
      size: "smaller",
      color: "translucent",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(isOpen && 'active'),
      onClick: isSearchButton ? handleForumSearchClick : hasMenu ? onTrigger : () => onReset(),
      ariaLabel: hasMenu ? lang('AriaLabelOpenMenu') : lang('AriaLabelBackChatList'),
      children: isSearchButton ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
        name: "search"
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('animated-menu-icon', !hasMenu && 'state-back', shouldSkipTransition && 'no-animation')
      })
    });
  }, [hasMenu, isSearchButton, isMobile, lang, onReset, shouldSkipTransition]);
  const handleSearchFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!searchQuery) {
      onSearchQuery('');
    }
  });
  const toggleConnectionStatus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    setSharedSettingOption({
      isConnectionStatusMinimized: !isConnectionStatusMinimized
    });
  });
  const handleLockScreen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    lockScreen();
  });
  const handleSearchEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (searchQuery && content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch) {
      searchMessagesGlobal({
        type: 'publicPosts',
        shouldResetResultsByType: true
      });
    }
  });
  const isSearchRelevant = Boolean(globalSearchChatId) || content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch || content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts;
  const isSearchFocused = isMobile ? !isMessageListOpen && isSearchRelevant : isSearchRelevant;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isSearchFocused ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_8__["default"])(() => onReset()) : undefined, [isSearchFocused, onReset]);
  const searchInputPlaceholder = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts ? lang('SearchFriends') : lang('Search');
  const withStoryToggler = !isSearchFocused && !selectedSearchDate && !globalSearchChatId && !areContactsVisible;
  const searchContent = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.Fragment, {
      children: [selectedSearchDate && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_PeerChip__WEBPACK_IMPORTED_MODULE_18__["default"], {
        icon: "calendar",
        title: selectedSearchDate,
        canClose: true,
        isMinimized: Boolean(globalSearchChatId),
        className: "left-search-picker-item",
        onClick: setGlobalSearchDate,
        isCloseNonDestructive: true,
        clickArg: CLEAR_DATE_SEARCH_PARAM
      }), globalSearchChatId && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_PeerChip__WEBPACK_IMPORTED_MODULE_18__["default"], {
        className: "left-search-picker-item",
        peerId: globalSearchChatId,
        onClick: setGlobalSearchChatId,
        canClose: true,
        isMinimized: true,
        clickArg: CLEAR_CHAT_SEARCH_PARAM
      })]
    });
  }, [globalSearchChatId, selectedSearchDate]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
    className: "LeftMainHeader",
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)("div", {
      id: "LeftMainHeader",
      className: "left-header",
      "data-tauri-drag-region": IS_WITH_WINDOW_BUTTONS ? true : undefined,
      children: [lang.isRtl && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
        className: "DropdownMenuFiller"
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_MainMenuDropdown__WEBPACK_IMPORTED_MODULE_17__["default"], {
        trigger: MainButton,
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(hasMenu && isFoldersSidebarShown && !IS_WITH_WINDOW_BUTTONS && !isSearchButton && 'hide-menu-button', isSearchButton && 'forum-search-button')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_21__["default"], {
        inputId: "telegram-search-input",
        resultsItemSelector: ".LeftSearch .ListItem-button",
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(globalSearchChatId || searchDate ? 'with-picker-item' : undefined, shouldHideSearch && 'SearchInput--hidden', hasMenu && isFoldersSidebarShown && !IS_WITH_WINDOW_BUTTONS && 'SearchInput--no-left-margin'),
        value: isClosingSearch ? undefined : contactsFilter || searchQuery,
        focused: isSearchFocused,
        isLoading: isLoading || connectionStatusPosition === 'minimized',
        spinnerColor: connectionStatusPosition === 'minimized' ? 'yellow' : undefined,
        spinnerBackgroundColor: connectionStatusPosition === 'minimized' && theme === 'light' ? 'light' : undefined,
        placeholder: searchInputPlaceholder,
        autoComplete: "off",
        canClose: Boolean(globalSearchChatId || searchDate),
        onChange: onSearchQuery,
        onReset: onReset,
        onFocus: handleSearchFocus,
        onSpinnerClick: connectionStatusPosition === 'minimized' ? toggleConnectionStatus : undefined,
        onEnter: handleSearchEnter,
        children: [searchContent, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_story_StoryToggler__WEBPACK_IMPORTED_MODULE_19__["default"], {
          canShow: withStoryToggler
        })]
      }), isCurrentUserPremium && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_StatusButton__WEBPACK_IMPORTED_MODULE_24__["default"], {}), hasPasscode && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_20__["default"], {
        round: true,
        ripple: !isMobile,
        size: "smaller",
        color: "translucent",
        ariaLabel: `${oldLang('ShortcutsController.Others.LockByPasscode')} (Ctrl+Shift+L)`,
        onClick: handleLockScreen,
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(!isCurrentUserPremium && 'extra-spacing'),
        iconName: "lock"
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_ShowTransition__WEBPACK_IMPORTED_MODULE_22__["default"], {
        isOpen: connectionStatusPosition === 'overlay',
        isCustom: true,
        className: "connection-state-wrapper",
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ConnectionStatusOverlay__WEBPACK_IMPORTED_MODULE_23__["default"], {
          connectionStatus: connectionStatus,
          connectionStatusText: connectionStatusText,
          onClick: toggleConnectionStatus
        })
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const {
    query: searchQuery,
    fetchingStatus,
    chatId,
    minDate
  } = tabState.globalSearch;
  const {
    connectionState,
    isSyncing,
    isFetchingDifference
  } = global;
  const {
    isConnectionStatusMinimized
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_4__.selectSharedSettings)(global);
  const isForumPanelOpen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsForumPanelOpen)(global);
  return {
    searchQuery,
    isLoading: fetchingStatus ? Boolean(fetchingStatus.chats || fetchingStatus.messages || fetchingStatus.publicPosts) : false,
    globalSearchChatId: chatId,
    searchDate: minDate,
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTheme)(global),
    connectionState,
    isSyncing,
    isFetchingDifference,
    isMessageListOpen: Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global)),
    isConnectionStatusMinimized,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global),
    areChatsLoaded: Boolean(global.chats.listIds.active),
    hasPasscode: Boolean(global.passcode.hasPasscode),
    canSetPasscode: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanSetPasscode)(global),
    isForumPanelOpen
  };
})(LeftMainHeader)));

/***/ }),

/***/ "./src/components/left/main/LeftSideMenuItems.tsx":
/*!********************************************************!*\
  !*** ./src/components/left/main/LeftSideMenuItems.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_initialState__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/initialState */ "./src/global/initialState.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_installPrompt__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/installPrompt */ "./src/util/installPrompt.ts");
/* harmony import */ var _util_permanentWebVersion__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/permanentWebVersion */ "./src/util/permanentWebVersion.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _middle_composer_AttachBotItem__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../middle/composer/AttachBotItem */ "./src/components/middle/composer/AttachBotItem.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _ui_NestedMenuItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/NestedMenuItem */ "./src/components/ui/NestedMenuItem.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _ui_Toggle__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Toggle */ "./src/components/ui/Toggle.tsx");
/* harmony import */ var _AccountMenuItems__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./AccountMenuItems */ "./src/components/left/main/AccountMenuItems.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






















const LeftSideMenuItems = ({
  currentUserId,
  archiveSettings,
  animationLevel,
  theme,
  canInstall,
  attachBots,
  currentUser,
  accountsTotalLimit,
  onSelectArchived,
  onSelectContacts,
  onSelectSettings,
  onBotMenuOpened,
  onBotMenuClosed,
  footer
}) => {
  const {
    openChat,
    setSharedSettingOption,
    updatePerformanceSettings,
    openChatByUsername,
    openUrl,
    openChatWithInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const animationLevelValue = animationLevel !== _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MIN ? animationLevel === _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MAX ? 'max' : 'mid' : 'min';
  const withOtherVersions = !_util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_TAURI && (window.location.hostname === _config__WEBPACK_IMPORTED_MODULE_2__.PRODUCTION_HOSTNAME || _config__WEBPACK_IMPORTED_MODULE_2__.IS_TEST);
  const archivedUnreadChatsCount = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_10__.useFolderManagerForUnreadCounters)()[_config__WEBPACK_IMPORTED_MODULE_2__.ARCHIVED_FOLDER_ID]?.chatsCount || 0;
  const bots = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => Object.values(attachBots).filter(bot => bot.isForSideMenu), [attachBots]);
  const handleSelectMyProfile = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    openChatWithInfo({
      id: currentUserId,
      shouldReplaceHistory: true,
      isOwnProfile: true
    });
  });
  const handleSelectSaved = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    openChat({
      id: currentUserId,
      shouldReplaceHistory: true
    });
  });
  const handleDarkModeToggle = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    e.stopPropagation();
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setSharedSettingOption({
      theme: newTheme
    });
    setSharedSettingOption({
      shouldUseSystemTheme: false
    });
  });
  const handleAnimationLevelChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    e.stopPropagation();
    let newLevel = animationLevel + 1;
    if (newLevel > _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MAX) {
      newLevel = _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MIN;
    }
    const performanceSettings = newLevel === _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MIN ? _global_initialState__WEBPACK_IMPORTED_MODULE_3__.INITIAL_PERFORMANCE_STATE_MIN : newLevel === _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_LEVEL_MAX ? _global_initialState__WEBPACK_IMPORTED_MODULE_3__.INITIAL_PERFORMANCE_STATE_MAX : _global_initialState__WEBPACK_IMPORTED_MODULE_3__.INITIAL_PERFORMANCE_STATE_MED;
    setSharedSettingOption({
      animationLevel: newLevel,
      wasAnimationLevelSetManually: true
    });
    updatePerformanceSettings(performanceSettings);
  });
  const handleChangelogClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    window.open(_config__WEBPACK_IMPORTED_MODULE_2__.BETA_CHANGELOG_URL, '_blank', 'noopener,noreferrer');
  });
  const handleSwitchToWebK = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    (0,_util_permanentWebVersion__WEBPACK_IMPORTED_MODULE_9__.switchPermanentWebVersion)('K');
  });
  const handleOpenTipsChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    openChatByUsername({
      username: lang('TelegramFeaturesUsername')
    });
  });
  const handleBugReportClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    openUrl({
      url: _config__WEBPACK_IMPORTED_MODULE_2__.FEEDBACK_URL
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment, {
    children: [_util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_MULTIACCOUNT_SUPPORTED && currentUser && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_AccountMenuItems__WEBPACK_IMPORTED_MODULE_19__["default"], {
        currentUser: currentUser,
        totalLimit: accountsTotalLimit,
        onSelectCurrent: onSelectSettings
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_15__["default"], {})]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "user",
      onClick: handleSelectMyProfile,
      children: lang('MenuMyProfile')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "saved-messages",
      onClick: handleSelectSaved,
      children: lang('MenuSavedMessages')
    }), archiveSettings.isHidden && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "archive",
      onClick: onSelectArchived,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span", {
        className: "menu-item-name",
        children: lang('MenuArchivedChats')
      }), archivedUnreadChatsCount > 0 && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div", {
        className: "right-badge",
        children: archivedUnreadChatsCount
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "group",
      onClick: onSelectContacts,
      children: lang('MenuContacts')
    }), bots.map(bot => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_middle_composer_AttachBotItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
      bot: bot,
      theme: theme,
      isInSideMenu: true,
      canShowNew: true,
      onMenuOpened: onBotMenuOpened,
      onMenuClosed: onBotMenuClosed
    })), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "settings",
      onClick: onSelectSettings,
      children: lang('MenuSettings')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_NestedMenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      icon: "more",
      footer: footer,
      submenu: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "darkmode",
          onClick: handleDarkModeToggle,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span", {
            className: "menu-item-name",
            children: lang('MenuNightMode')
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_17__["default"], {
            id: "darkmode",
            label: lang(theme === 'dark' ? 'AriaMenuDisableNightMode' : 'AriaMenuEnableNightMode'),
            checked: theme === 'dark',
            noAnimation: true
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "animations",
          onClick: handleAnimationLevelChange,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span", {
            className: "menu-item-name capitalize",
            children: lang('MenuAnimationsSwitch')
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Toggle__WEBPACK_IMPORTED_MODULE_18__["default"], {
            value: animationLevelValue
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_15__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "help",
          onClick: handleOpenTipsChat,
          children: lang('MenuTelegramFeatures')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "bug",
          onClick: handleBugReportClick,
          children: lang('MenuReportBug')
        }), _config__WEBPACK_IMPORTED_MODULE_2__.IS_BETA && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "permissions",
          onClick: handleChangelogClick,
          children: lang('MenuBetaChangelog')
        }), withOtherVersions && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "K",
          isCharIcon: true,
          href: `${_config__WEBPACK_IMPORTED_MODULE_2__.WEB_VERSION_BASE}k`,
          onClick: handleSwitchToWebK,
          children: lang('MenuSwitchToK')
        }), canInstall && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
          icon: "install",
          onClick: (0,_util_installPrompt__WEBPACK_IMPORTED_MODULE_8__.getPromptInstall)(),
          children: lang('MenuInstallApp')
        })]
      }),
      children: lang('MenuMore')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const {
    currentUserId,
    archiveSettings
  } = global;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_6__.selectSharedSettings)(global);
  const attachBots = global.attachMenu.bots;
  return {
    currentUserId,
    currentUser: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, currentUserId),
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global),
    animationLevel,
    canInstall: Boolean(tabState.canInstall),
    archiveSettings,
    attachBots,
    accountsTotalLimit: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_5__.selectPremiumLimit)(global, 'moreAccounts')
  };
})(LeftSideMenuItems)));

/***/ }),

/***/ "./src/components/left/main/StatusButton.tsx":
/*!***************************************************!*\
  !*** ./src/components/left/main/StatusButton.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _common_gift_GiftEffectWrapper__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/gift/GiftEffectWrapper */ "./src/components/common/gift/GiftEffectWrapper.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_reactions_CustomEmojiEffect__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/reactions/CustomEmojiEffect */ "./src/components/common/reactions/CustomEmojiEffect.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _StatusPickerMenu_async__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./StatusPickerMenu.async */ "./src/components/left/main/StatusPickerMenu.async.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
















const EFFECT_DURATION_MS = 1500;
const EMOJI_STATUS_SIZE = 24;
const StatusButton = ({
  emojiStatus,
  collectibleStatuses,
  isAccountFrozen
}) => {
  const {
    setEmojiStatus,
    loadCurrentUser,
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const buttonRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [shouldShowEffect, markShouldShowEffect, unmarkShouldShowEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const [isEffectShown, showEffect, hideEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const [isStatusPickerOpen, openStatusPicker, closeStatusPicker] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const collectibleEmojiStatus = emojiStatus?.type === 'collectible' ? emojiStatus : undefined;
  const delay = emojiStatus?.until ? (emojiStatus.until - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_4__.getServerTime)()) * 1000 : undefined;
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__["default"])(loadCurrentUser, delay);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__["default"])(([prevEmojiStatus]) => {
    if (shouldShowEffect && emojiStatus && emojiStatus.documentId !== prevEmojiStatus?.documentId) {
      showEffect();
      unmarkShouldShowEffect();
    }
  }, [emojiStatus, shouldShowEffect, showEffect, unmarkShouldShowEffect]);
  const handleEmojiStatusSet = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(sticker => {
    const collectibleStatus = collectibleStatuses?.find(status => 'collectibleId' in status && status.documentId === sticker.id);
    markShouldShowEffect();
    setEmojiStatus({
      emojiStatus: collectibleStatus || {
        type: 'regular',
        documentId: sticker.id
      }
    });
  }, [markShouldShowEffect, setEmojiStatus, collectibleStatuses]);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__["default"])(hideEffect, isEffectShown ? EFFECT_DURATION_MS : undefined);
  const handleEmojiStatusClick = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    openStatusPicker();
  }, [openStatusPicker, isAccountFrozen]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
    className: "StatusButton extra-spacing",
    children: [Boolean(isEffectShown && emojiStatus) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_reactions_CustomEmojiEffect__WEBPACK_IMPORTED_MODULE_12__["default"], {
      reaction: emojiStatus,
      isLottie: true,
      className: "emoji-status-effect"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
      round: true,
      ref: buttonRef,
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: "emoji-status",
      onClick: handleEmojiStatusClick,
      children: emojiStatus ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_gift_GiftEffectWrapper__WEBPACK_IMPORTED_MODULE_10__["default"], {
        withSparkles: Boolean(collectibleEmojiStatus),
        sparklesClassName: "statusSparkles",
        sparklesColor: collectibleEmojiStatus?.textColor,
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_9__["default"], {
          documentId: emojiStatus.documentId,
          size: EMOJI_STATUS_SIZE,
          loopLimit: _config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_STATUS_LOOP_LIMIT
        }, emojiStatus.documentId)
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__["default"], {})
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_StatusPickerMenu_async__WEBPACK_IMPORTED_MODULE_14__["default"], {
      statusButtonRef: buttonRef,
      isOpen: isStatusPickerOpen,
      onEmojiStatusSelect: handleEmojiStatusSet,
      onClose: closeStatusPicker
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    currentUserId
  } = global;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId) : undefined;
  const collectibleStatuses = global.collectibleEmojiStatuses?.statuses;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserFrozen)(global);
  return {
    emojiStatus: currentUser?.emojiStatus,
    collectibleStatuses,
    isAccountFrozen
  };
})(StatusButton)));

/***/ }),

/***/ "./src/components/left/main/StatusPickerMenu.async.tsx":
/*!*************************************************************!*\
  !*** ./src/components/left/main/StatusPickerMenu.async.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StatusPickerMenuAsync = props => {
  const {
    isOpen
  } = props;
  const StatusPickerMenu = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'StatusPickerMenu', !isOpen);
  return StatusPickerMenu ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatusPickerMenu, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StatusPickerMenuAsync);

/***/ }),

/***/ "./src/components/left/newChat/NewChat.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/left/newChat/NewChat.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const NewChatAsync = props => {
  const NewChat = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'NewChat');
  return NewChat ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(NewChat, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewChatAsync);

/***/ }),

/***/ "./src/components/left/search/LeftSearch.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/left/search/LeftSearch.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const LeftSearchAsync = props => {
  const LeftSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'LeftSearch');
  return LeftSearch ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(LeftSearch, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (LeftSearchAsync);

/***/ }),

/***/ "./src/components/left/settings/Settings.async.tsx":
/*!*********************************************************!*\
  !*** ./src/components/left/settings/Settings.async.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const SettingsAsync = props => {
  const Settings = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'Settings');
  return Settings ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(Settings, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SettingsAsync);

/***/ }),

/***/ "./src/components/main/AttachBotRecipientPicker.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/main/AttachBotRecipientPicker.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const AttachBotRecipientPickerAsync = props => {
  const {
    requestedAttachBotInChat
  } = props;
  const AttachBotRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'AttachBotRecipientPicker', !requestedAttachBotInChat);
  return AttachBotRecipientPicker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AttachBotRecipientPicker, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachBotRecipientPickerAsync);

/***/ }),

/***/ "./src/components/main/BotTrustModal.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/main/BotTrustModal.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const BotTrustModalAsync = props => {
  const {
    bot
  } = props;
  const BotTrustModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'BotTrustModal', !bot);
  return BotTrustModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BotTrustModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BotTrustModalAsync);

/***/ }),

/***/ "./src/components/main/DeleteFolderDialog.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/main/DeleteFolderDialog.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const DeleteFolderDialogAsync = props => {
  const {
    folder
  } = props;
  const DeleteFolderDialog = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'DeleteFolderDialog', !folder);
  return DeleteFolderDialog ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeleteFolderDialog, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteFolderDialogAsync);

/***/ }),

/***/ "./src/components/main/DownloadManager.tsx":
/*!*************************************************!*\
  !*** ./src/components/main/DownloadManager.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_download__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/download */ "./src/util/download.ts");
/* harmony import */ var _util_generateUniqueId__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useRunDebounced */ "./src/hooks/useRunDebounced.ts");










const GLOBAL_UPDATE_DEBOUNCE = 1000;
const processedHashes = new Set();
const downloadedHashes = new Set();
const DownloadManager = ({
  activeDownloads
}) => {
  const {
    cancelMediaHashDownloads,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const runDebounced = (0,_hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_9__["default"])(GLOBAL_UPDATE_DEBOUNCE, true);
  const handleMediaDownloaded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(hash => {
    downloadedHashes.add(hash);
    runDebounced(() => {
      if (downloadedHashes.size) {
        cancelMediaHashDownloads({
          mediaHashes: Array.from(downloadedHashes)
        });
        downloadedHashes.clear();
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!Object.keys(activeDownloads).length) {
      processedHashes.clear();
      return;
    }
    Object.entries(activeDownloads).forEach(([mediaHash, metadata]) => {
      if (processedHashes.has(mediaHash)) {
        return;
      }
      processedHashes.add(mediaHash);
      const {
        size,
        filename,
        format: mediaFormat
      } = metadata;
      const mediaData = _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.getFromMemory(mediaHash);
      if (mediaData) {
        (0,_util_download__WEBPACK_IMPORTED_MODULE_5__["default"])(mediaData, filename);
        handleMediaDownloaded(mediaHash);
        return;
      }
      if (size > _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.MAX_BUFFER_SIZE && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_OPFS_SUPPORTED && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_SERVICE_WORKER_SUPPORTED) {
        showNotification({
          message: 'Downloading files bigger than 2GB is not supported in your browser.'
        });
        handleMediaDownloaded(mediaHash);
        return;
      }
      const handleProgress = () => {
        const currentDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)()).activeDownloads;
        if (!currentDownloads[mediaHash]) {
          _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.cancelProgress(handleProgress);
        }
      };
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.fetch(mediaHash, mediaFormat, true, handleProgress, (0,_util_generateUniqueId__WEBPACK_IMPORTED_MODULE_6__["default"])()).then(result => {
        if (mediaFormat === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.DownloadUrl) {
          const url = new URL(result, window.document.baseURI);
          url.searchParams.set('filename', encodeURIComponent(filename));
          const downloadWindow = window.open(url.toString());
          downloadWindow?.addEventListener('beforeunload', () => {
            showNotification({
              message: 'Download started. Please, do not close the app before it is finished.'
            });
          });
        } else if (result) {
          (0,_util_download__WEBPACK_IMPORTED_MODULE_5__["default"])(result, filename);
        }
        handleMediaDownloaded(mediaHash);
      });
    });
  }, [activeDownloads]);
  return undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global).activeDownloads;
  return {
    activeDownloads
  };
})(DownloadManager)));

/***/ }),

/***/ "./src/components/main/DraftRecipientPicker.async.tsx":
/*!************************************************************!*\
  !*** ./src/components/main/DraftRecipientPicker.async.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const DraftRecipientPickerAsync = props => {
  const {
    requestedDraft
  } = props;
  const DraftRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'DraftRecipientPicker', !requestedDraft);
  return DraftRecipientPicker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DraftRecipientPicker, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DraftRecipientPickerAsync);

/***/ }),

/***/ "./src/components/main/FoldersSidebar.module.scss":
/*!********************************************************!*\
  !*** ./src/components/main/FoldersSidebar.module.scss ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"kRuZeoF6","tabs":"rABcVLvv","icon":"os3EiiML","menuButton":"wrXChz0J","divider":"tXL6PpB_","hideMenuButton":"OkCgWlzE"});

/***/ }),

/***/ "./src/components/main/FoldersSidebar.tsx":
/*!************************************************!*\
  !*** ./src/components/main/FoldersSidebar.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useFolderTabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useFolderTabs */ "./src/hooks/useFolderTabs.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useScrolledState__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useScrolledState */ "./src/hooks/useScrolledState.ts");
/* harmony import */ var _common_MainMenuDropdown__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../common/MainMenuDropdown */ "./src/components/common/MainMenuDropdown.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Folder__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/Folder */ "./src/components/ui/Folder.tsx");
/* harmony import */ var _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./FoldersSidebar.module.scss */ "./src/components/main/FoldersSidebar.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

















const FIRST_FOLDER_INDEX = 0;
const FoldersSidebar = ({
  chatFoldersById,
  orderedFolderIds,
  activeChatFolder,
  maxFolders,
  maxChatLists,
  folderInvitesById,
  maxFolderInvites,
  isActive
}) => {
  const {
    loadChatFolders,
    setActiveChatFolder,
    openLeftColumnContent,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const tabsRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    loadChatFolders();
  }, []);
  const scrollChatListToTop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    const activeList = document.querySelector('#LeftColumn .chat-list.Transition_slide-active');
    activeList?.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
  const {
    folderTabs
  } = (0,_hooks_useFolderTabs__WEBPACK_IMPORTED_MODULE_8__["default"])({
    sidebarMode: true,
    orderedFolderIds,
    chatFoldersById,
    maxFolders,
    maxChatLists,
    folderInvitesById,
    maxFolderInvites
  });
  const {
    handleScroll,
    isAtBeginning,
    isAtEnd
  } = (0,_hooks_useScrolledState__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const handleSwitchTab = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(index => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList
    });
    openSettingsScreen({
      screen: undefined
    });
    setActiveChatFolder({
      activeChatFolder: index
    }, {
      forceOnHeavyAnimation: true
    });
    if (activeChatFolder === index) {
      scrollChatListToTop();
    }
    tabsRef.current?.children[index]?.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
  });
  const handleSettingsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings
    });
    openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders
    });
  });

  // Prevent `activeTab` pointing at non-existing folder after update
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!folderTabs?.length) {
      return;
    }
    if (activeChatFolder >= folderTabs.length) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }, [activeChatFolder, folderTabs, setActiveChatFolder]);
  const MainButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
      color: "translucent",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(isOpen ? 'active' : '', _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].menuButton),
      onClick: onTrigger,
      ariaLabel: lang('AriaLabelOpenMenu'),
      iconName: "menu",
      iconClassName: _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].icon
    });
  }, [lang]);
  if (!isActive) {
    return undefined;
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div", {
    className: _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].root,
    id: "FoldersSidebar",
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_MainMenuDropdown__WEBPACK_IMPORTED_MODULE_12__["default"], {
      trigger: MainButton,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TAURI && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_MAC_OS && _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].hideMenuButton)
    }), !isAtBeginning && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
      className: _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].divider
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
      ref: tabsRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].tabs, 'custom-scroll', 'no-scrollbar'),
      onScroll: handleScroll,
      children: folderTabs?.map((tab, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_Folder__WEBPACK_IMPORTED_MODULE_14__["default"], {
        title: tab.title,
        isActive: i === activeChatFolder,
        isBlocked: tab.isBlocked,
        badgeCount: tab.badgeCount,
        isBadgeActive: tab.isBadgeActive,
        onClick: handleSwitchTab,
        clickArg: i,
        contextActions: tab.contextActions,
        contextRootElementSelector: "#FoldersSidebar",
        icon: tab.emoticon,
        className: _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].tab
      }, tab.id))
    }), !isAtEnd && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
      className: _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].divider
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
      color: "translucent",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].menuButton, _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].settingsButton),
      onClick: handleSettingsClick,
      iconName: "tools",
      iconClassName: _FoldersSidebar_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].icon
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chatFolders: {
      byId: chatFoldersById,
      orderedIds: orderedFolderIds,
      invites: folderInvitesById
    }
  } = global;
  const {
    activeChatFolder
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  return {
    chatFoldersById,
    folderInvitesById,
    orderedFolderIds,
    activeChatFolder,
    maxFolders: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'dialogFilters'),
    maxFolderInvites: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'chatlistInvites'),
    maxChatLists: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_4__.selectCurrentLimit)(global, 'chatlistJoined')
  };
})(FoldersSidebar)));

/***/ }),

/***/ "./src/components/main/ForwardRecipientPicker.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/main/ForwardRecipientPicker.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ForwardRecipientPickerAsync = props => {
  const {
    isOpen
  } = props;
  const ForwardRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ForwardRecipientPicker', !isOpen);
  return ForwardRecipientPicker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ForwardRecipientPicker, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ForwardRecipientPickerAsync);

/***/ }),

/***/ "./src/components/main/GameModal.scss":
/*!********************************************!*\
  !*** ./src/components/main/GameModal.scss ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/main/GameModal.tsx":
/*!*******************************************!*\
  !*** ./src/components/main/GameModal.tsx ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useSendMessageAction */ "./src/hooks/useSendMessageAction.ts");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GameModal_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./GameModal.scss */ "./src/components/main/GameModal.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");










const PLAY_GAME_ACTION_INTERVAL = 5000;
const GameModal = ({
  openedGame,
  gameTitle,
  canPost
}) => {
  const {
    closeGame,
    openForwardMenu
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    url,
    chatId,
    messageId
  } = openedGame || {};
  const isOpen = Boolean(url);
  const sendMessageAction = (0,_hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_6__["default"])(chatId);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    sendMessageAction({
      type: 'playingGame'
    });
  }, isOpen && canPost ? PLAY_GAME_ACTION_INTERVAL : undefined);
  const handleMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(event => {
    if (!chatId || !messageId) return;
    try {
      const data = JSON.parse(event.data);
      if (data.eventType === 'share_score') {
        openForwardMenu({
          fromChatId: chatId,
          messageIds: [messageId],
          withMyScore: true
        });
        closeGame();
      }
      if (data.eventType === 'share_game') {
        openForwardMenu({
          fromChatId: chatId,
          messageIds: [messageId]
        });
        closeGame();
      }
    } catch (e) {
      // Ignore other messages
    }
  }, [chatId, closeGame, messageId, openForwardMenu]);
  const handleLoad = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(event => {
    event.currentTarget.focus();
  }, []);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    window.addEventListener('message', handleMessage);
    return () => window.removeEventListener('message', handleMessage);
  }, [handleMessage]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_7__["default"], {
    className: "GameModal",
    isOpen: isOpen,
    onClose: closeGame,
    title: gameTitle,
    hasCloseButton: true,
    children: isOpen && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("iframe", {
      className: "game-frame",
      onLoad: handleLoad,
      src: url,
      title: lang('AttachGame'),
      sandbox: "allow-scripts allow-same-origin allow-orientation-lock",
      allow: "fullscreen"
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  openedGame
}) => {
  const {
    chatId
  } = openedGame || {};
  const chat = chatId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const chatFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatFullInfo)(global, chatId) : undefined;
  const canPost = Boolean(chat) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCanPostInChat)(chat, undefined, undefined, chatFullInfo);
  return {
    canPost
  };
})(GameModal)));

/***/ }),

/***/ "./src/components/main/HistoryCalendar.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/main/HistoryCalendar.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const HistoryCalendarAsync = props => {
  const {
    isOpen
  } = props;
  const HistoryCalendar = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'HistoryCalendar', !isOpen);
  return HistoryCalendar ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(HistoryCalendar, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (HistoryCalendarAsync);

/***/ }),

/***/ "./src/components/main/LockScreen.module.scss":
/*!****************************************************!*\
  !*** ./src/components/main/LockScreen.module.scss ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"container":"bdKGCai4","wrapper":"BIi4Pl4Z","icon":"JwlsF2tF","help":"VlXFyC_a"});

/***/ }),

/***/ "./src/components/main/LockScreen.tsx":
/*!********************************************!*\
  !*** ./src/components/main/LockScreen.tsx ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_passcode__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/passcode */ "./src/util/passcode.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_PasswordForm__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../common/PasswordForm */ "./src/components/common/PasswordForm.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./LockScreen.module.scss */ "./src/components/main/LockScreen.module.scss");
/* harmony import */ var _assets_lock_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../assets/lock.png */ "./src/assets/lock.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
















const ICON_SIZE = 160;
const LockScreen = ({
  isLocked,
  passcodeSettings
}) => {
  const {
    unlockScreen,
    signOut,
    logInvalidUnlockAttempt,
    resetInvalidUnlockAttempts
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    invalidAttemptsCount,
    timeoutUntil,
    isLoading
  } = passcodeSettings;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [validationError, setValidationError] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [shouldShowPasscode, setShouldShowPasscode] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isSignOutDialogOpen, openSignOutConfirmation, closeSignOutConfirmation] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])(false);
  const {
    shouldRender
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_7__["default"])(isLocked);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_4__["default"])(resetInvalidUnlockAttempts, timeoutUntil ? timeoutUntil - Date.now() : undefined);
  const handleClearError = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setValidationError('');
  }, []);
  const handleSubmit = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(passcode => {
    if (timeoutUntil !== undefined) {
      setValidationError(lang('FloodWait'));
      return;
    }
    setValidationError('');
    (0,_util_passcode__WEBPACK_IMPORTED_MODULE_2__.decryptSession)(passcode).then(unlockScreen, err => {
      if (err instanceof _util_passcode__WEBPACK_IMPORTED_MODULE_2__.UnrecoverablePasscodeError) {
        signOut({
          forceInitApi: true
        });
      }
      logInvalidUnlockAttempt();
      setValidationError(lang('lng_passcode_wrong'));
    });
  }, [lang, timeoutUntil]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (timeoutUntil !== undefined) {
      setValidationError(lang('FloodWait'));
    } else if (invalidAttemptsCount === 0) {
      setValidationError('');
    }
  }, [timeoutUntil, lang, invalidAttemptsCount]);
  const handleSignOutMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    closeSignOutConfirmation();
    signOut({
      forceInitApi: true
    });
  }, [closeSignOutConfirmation, signOut]);
  if (!shouldRender) {
    return undefined;
  }
  function renderLogoutPrompt() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].help,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("p", {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
          onClick: openSignOutConfirmation,
          children: "Log out"
        }), ' ', "if you don't remember your passcode."]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("p", {
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
          color: "translucent",
          size: "tiny",
          isText: true,
          onClick: openSignOutConfirmation,
          children: lang('AccountSettings.Logout')
        })
      })]
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].container,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].wrapper,
      dir: lang.isRtl ? 'rtl' : undefined,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__["default"], {
        tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_3__.LOCAL_TGS_URLS.Lock,
        previewUrl: _assets_lock_png__WEBPACK_IMPORTED_MODULE_14__,
        size: ICON_SIZE,
        className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].icon
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_PasswordForm__WEBPACK_IMPORTED_MODULE_9__["default"], {
        shouldShowSubmit: true,
        shouldDisablePasswordManager: true,
        isLoading: isLoading,
        error: validationError,
        placeholder: lang('Passcode.EnterPasscodePlaceholder'),
        submitLabel: lang('Next'),
        onClearError: handleClearError,
        isPasswordVisible: shouldShowPasscode,
        noRipple: true,
        onChangePasswordVisibility: setShouldShowPasscode,
        onSubmit: handleSubmit
      }, "password-form"), renderLogoutPrompt()]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_11__["default"], {
      isOpen: isSignOutDialogOpen,
      onClose: closeSignOutConfirmation,
      text: lang('lng_sure_logout'),
      confirmLabel: lang('AccountSettings.Logout'),
      confirmHandler: handleSignOutMessage,
      confirmIsDestructive: true
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    passcodeSettings: global.passcode
  };
})(LockScreen)));

/***/ }),

/***/ "./src/components/main/Main.scss":
/*!***************************************!*\
  !*** ./src/components/main/Main.scss ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/main/Main.tsx":
/*!**************************************!*\
  !*** ./src/components/main/Main.tsx ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _global_actions_all__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../global/actions/all */ "./src/global/actions/all.ts");
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/cssAnimationEndListeners */ "./src/util/cssAnimationEndListeners.ts");
/* harmony import */ var _util_deeplink__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/deeplink */ "./src/util/deeplink.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _util_updateIcon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../util/updateIcon */ "./src/util/updateIcon.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_tauri_useTauriEvent__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/tauri/useTauriEvent */ "./src/hooks/tauri/useTauriEvent.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePreventPinchZoomGesture__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/usePreventPinchZoomGesture */ "./src/hooks/usePreventPinchZoomGesture.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/window/useBeforeUnload */ "./src/hooks/window/useBeforeUnload.ts");
/* harmony import */ var _hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../hooks/window/useFullscreen */ "./src/hooks/window/useFullscreen.ts");
/* harmony import */ var _calls_ActiveCallHeader_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../calls/ActiveCallHeader.async */ "./src/components/calls/ActiveCallHeader.async.tsx");
/* harmony import */ var _calls_group_GroupCall_async__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../calls/group/GroupCall.async */ "./src/components/calls/group/GroupCall.async.tsx");
/* harmony import */ var _calls_phone_PhoneCall_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../calls/phone/PhoneCall.async */ "./src/components/calls/phone/PhoneCall.async.tsx");
/* harmony import */ var _calls_phone_RatePhoneCallModal_async__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../calls/phone/RatePhoneCallModal.async */ "./src/components/calls/phone/RatePhoneCallModal.async.tsx");
/* harmony import */ var _common_CustomEmojiSetsModal_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../common/CustomEmojiSetsModal.async */ "./src/components/common/CustomEmojiSetsModal.async.tsx");
/* harmony import */ var _common_DeleteMessageModal_async__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../common/DeleteMessageModal.async */ "./src/components/common/DeleteMessageModal.async.tsx");
/* harmony import */ var _common_StickerSetModal_async__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../common/StickerSetModal.async */ "./src/components/common/StickerSetModal.async.tsx");
/* harmony import */ var _common_UnreadCounter__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../common/UnreadCounter */ "./src/components/common/UnreadCounter.tsx");
/* harmony import */ var _left_LeftColumn__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../left/LeftColumn */ "./src/components/left/LeftColumn.tsx");
/* harmony import */ var _mediaViewer_MediaViewer_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../mediaViewer/MediaViewer.async */ "./src/components/mediaViewer/MediaViewer.async.tsx");
/* harmony import */ var _middle_message_reactions_ReactionPicker_async__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../middle/message/reactions/ReactionPicker.async */ "./src/components/middle/message/reactions/ReactionPicker.async.tsx");
/* harmony import */ var _middle_MessageListHistoryHandler__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../middle/MessageListHistoryHandler */ "./src/components/middle/MessageListHistoryHandler.tsx");
/* harmony import */ var _middle_MiddleColumn__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../middle/MiddleColumn */ "./src/components/middle/MiddleColumn.tsx");
/* harmony import */ var _middle_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../middle/panes/AudioPlayer */ "./src/components/middle/panes/AudioPlayer.tsx");
/* harmony import */ var _modals_ModalContainer__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../modals/ModalContainer */ "./src/components/modals/ModalContainer.tsx");
/* harmony import */ var _payment_PaymentModal_async__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../payment/PaymentModal.async */ "./src/components/payment/PaymentModal.async.tsx");
/* harmony import */ var _payment_ReceiptModal_async__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../payment/ReceiptModal.async */ "./src/components/payment/ReceiptModal.async.tsx");
/* harmony import */ var _right_RightColumn__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../right/RightColumn */ "./src/components/right/RightColumn.tsx");
/* harmony import */ var _story_StoryViewer_async__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../story/StoryViewer.async */ "./src/components/story/StoryViewer.async.tsx");
/* harmony import */ var _AttachBotRecipientPicker_async__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./AttachBotRecipientPicker.async */ "./src/components/main/AttachBotRecipientPicker.async.tsx");
/* harmony import */ var _BotTrustModal_async__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./BotTrustModal.async */ "./src/components/main/BotTrustModal.async.tsx");
/* harmony import */ var _DeleteFolderDialog_async__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./DeleteFolderDialog.async */ "./src/components/main/DeleteFolderDialog.async.tsx");
/* harmony import */ var _Dialogs__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./Dialogs */ "./src/components/main/Dialogs.tsx");
/* harmony import */ var _DownloadManager__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./DownloadManager */ "./src/components/main/DownloadManager.tsx");
/* harmony import */ var _DraftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./DraftRecipientPicker.async */ "./src/components/main/DraftRecipientPicker.async.tsx");
/* harmony import */ var _FoldersSidebar__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./FoldersSidebar */ "./src/components/main/FoldersSidebar.tsx");
/* harmony import */ var _ForwardRecipientPicker_async__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./ForwardRecipientPicker.async */ "./src/components/main/ForwardRecipientPicker.async.tsx");
/* harmony import */ var _GameModal__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./GameModal */ "./src/components/main/GameModal.tsx");
/* harmony import */ var _HistoryCalendar_async__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ./HistoryCalendar.async */ "./src/components/main/HistoryCalendar.async.tsx");
/* harmony import */ var _NewContactModal_async__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ./NewContactModal.async */ "./src/components/main/NewContactModal.async.tsx");
/* harmony import */ var _premium_common_PremiumLimitReachedModal_async__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ./premium/common/PremiumLimitReachedModal.async */ "./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx");
/* harmony import */ var _premium_GiveawayModal_async__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ./premium/GiveawayModal.async */ "./src/components/main/premium/GiveawayModal.async.tsx");
/* harmony import */ var _premium_PremiumMainModal_async__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ./premium/PremiumMainModal.async */ "./src/components/main/premium/PremiumMainModal.async.tsx");
/* harmony import */ var _premium_StarsGiftingPickerModal_async__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ./premium/StarsGiftingPickerModal.async */ "./src/components/main/premium/StarsGiftingPickerModal.async.tsx");
/* harmony import */ var _SafeLinkModal_async__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./SafeLinkModal.async */ "./src/components/main/SafeLinkModal.async.tsx");
/* harmony import */ var _visualEffects_ConfettiContainer__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ./visualEffects/ConfettiContainer */ "./src/components/main/visualEffects/ConfettiContainer.tsx");
/* harmony import */ var _visualEffects_SnapEffectContainer__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! ./visualEffects/SnapEffectContainer */ "./src/components/main/visualEffects/SnapEffectContainer.tsx");
/* harmony import */ var _visualEffects_WaveContainer__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! ./visualEffects/WaveContainer */ "./src/components/main/visualEffects/WaveContainer.tsx");
/* harmony import */ var _Main_scss__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! ./Main.scss */ "./src/components/main/Main.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





































































const APP_OUTDATED_TIMEOUT_MS = 5 * 60 * 1000; // 5 min
const CALL_BUNDLE_LOADING_DELAY_MS = 5000; // 5 sec

let DEBUG_isLogged = false;
const Main = ({
  isMobile,
  isLeftColumnOpen,
  isMiddleColumnOpen,
  isRightColumnOpen,
  isMediaViewerOpen,
  isStoryViewerOpen,
  isForwardModalOpen,
  activeGroupCallId,
  safeLinkModalUrl,
  isHistoryCalendarOpen,
  shouldSkipHistoryAnimations,
  limitReached,
  openedStickerSetShortName,
  openedCustomEmojiSetIds,
  isServiceChatReady,
  withInterfaceAnimations,
  wasTimeFormatSetManually,
  addedSetIds,
  addedCustomEmojiIds,
  isPhoneCallActive,
  newContactUserId,
  newContactByPhoneNumber,
  openedGame,
  gameTitle,
  isRatePhoneCallModalOpen,
  botTrustRequest,
  botTrustRequestBot,
  requestedAttachBotInChat,
  requestedDraft,
  isPremiumModalOpen,
  isGiveawayModalOpen,
  isDeleteMessageModalOpen,
  isStarsGiftingPickerModal,
  isPaymentModalOpen,
  isReceiptModalOpen,
  isReactionPickerOpen,
  isCurrentUserPremium,
  deleteFolderDialog,
  isMasterTab,
  noRightColumnAnimation,
  isSynced,
  currentUserId,
  isAccountFrozen,
  isAppConfigLoaded,
  isFoldersSidebarShown,
  selectedGiftAuction
}) => {
  const {
    initMain,
    loadAnimatedEmojis,
    loadBirthdayNumbersStickers,
    loadRestrictedEmojiStickers,
    loadNotificationSettings,
    loadNotificationExceptions,
    updateIsOnline,
    onTabFocusChange,
    loadTopInlineBots,
    loadEmojiKeywords,
    loadCountryList,
    loadAvailableReactions,
    loadStickerSets,
    loadPremiumGifts,
    loadTonGifts,
    loadStarGifts,
    loadMyUniqueGifts,
    loadDefaultTopicIcons,
    loadAddedStickers,
    loadFavoriteStickers,
    loadDefaultStatusIcons,
    ensureTimeFormat,
    closeStickerSetModal,
    closeCustomEmojiSets,
    checkVersionNotification,
    loadConfig,
    loadAppConfig,
    loadAttachBots,
    loadContactList,
    loadCustomEmojis,
    loadGenericEmojiEffects,
    closePaymentModal,
    clearReceipt,
    checkAppVersion,
    openThread,
    toggleLeftColumn,
    loadRecentEmojiStatuses,
    loadUserCollectibleStatuses,
    updatePageTitle,
    loadTopReactions,
    loadRecentReactions,
    loadDefaultTagReactions,
    loadFeaturedEmojiStickers,
    loadAuthorizations,
    loadPeerColors,
    loadSavedReactionTags,
    loadTimezones,
    loadQuickReplies,
    loadStarStatus,
    loadAvailableEffects,
    loadTopBotApps,
    loadPaidReactionPrivacy,
    loadPasswordInfo,
    loadBotFreezeAppeal,
    loadAllChats,
    loadAllStories,
    loadAllHiddenStories,
    loadContentSettings,
    loadGiftAuction,
    loadPromoData
  } = (0,_global__WEBPACK_IMPORTED_MODULE_3__.getActions)();
  if (_config__WEBPACK_IMPORTED_MODULE_4__.DEBUG && !DEBUG_isLogged) {
    DEBUG_isLogged = true;
    // eslint-disable-next-line no-console
    console.log('>>> RENDER MAIN');
  }
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_21__["default"])();

  // Preload Calls bundle to initialize sounds for iOS
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    void (0,_util_moduleLoader__WEBPACK_IMPORTED_MODULE_13__.loadBundle)(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_13__.Bundles.Calls);
  }, CALL_BUNDLE_LOADING_DELAY_MS);
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)();
  const leftColumnRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)();
  const {
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_19__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!isLeftColumnOpen && !isMiddleColumnOpen && !isDesktop) {
      // Always display at least one column
      toggleLeftColumn();
    } else if (isLeftColumnOpen && isMiddleColumnOpen && isMobile) {
      // Can't have two active columns at the same time
      toggleLeftColumn();
    }
  }, [isDesktop, isLeftColumnOpen, isMiddleColumnOpen, isMobile, toggleLeftColumn]);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_16__["default"])(checkAppVersion, isMasterTab ? APP_OUTDATED_TIMEOUT_MS : undefined, true);

  // Initial API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced) {
      updateIsOnline({
        isOnline: true
      });
      loadConfig();
      loadAppConfig();
      loadPeerColors();
      initMain();
      loadContactList();
      checkAppVersion();
      loadAuthorizations();
      loadPasswordInfo();
    }
  }, [isMasterTab, isSynced]);

  // Initial API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced && isAppConfigLoaded && !isAccountFrozen) {
      loadAllChats({
        listType: 'saved'
      });
      loadAllStories();
      loadAllHiddenStories();
      loadPromoData();
      loadContentSettings();
      loadRecentReactions();
      loadDefaultTagReactions();
      loadAttachBots();
      loadNotificationSettings();
      loadNotificationExceptions();
      loadTopInlineBots();
      loadTopReactions();
      loadStarStatus();
      loadEmojiKeywords({
        language: _config__WEBPACK_IMPORTED_MODULE_4__.BASE_EMOJI_KEYWORD_LANG
      });
      loadFeaturedEmojiStickers();
      loadSavedReactionTags();
      loadTopBotApps();
      loadPaidReactionPrivacy();
      loadDefaultTopicIcons();
      loadAnimatedEmojis();
      loadAvailableReactions();
      loadUserCollectibleStatuses();
      loadGenericEmojiEffects();
      loadPremiumGifts();
      loadTonGifts();
      loadStarGifts();
      loadMyUniqueGifts();
      loadAvailableEffects();
      loadBirthdayNumbersStickers();
      loadRestrictedEmojiStickers();
      loadQuickReplies();
      loadTimezones();
    }
  }, [isMasterTab, isSynced, isAppConfigLoaded, isAccountFrozen]);

  // Initial Premium API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isCurrentUserPremium && isAppConfigLoaded && !isAccountFrozen) {
      loadDefaultStatusIcons();
      loadRecentEmojiStatuses();
    }
  }, [isCurrentUserPremium, isMasterTab, isAppConfigLoaded, isAccountFrozen]);

  // Language-based API calls
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab) {
      if (lang.code !== _config__WEBPACK_IMPORTED_MODULE_4__.BASE_EMOJI_KEYWORD_LANG) {
        loadEmojiKeywords({
          language: lang.code
        });
      }
      loadCountryList({
        langCode: lang.code
      });
    }
  }, [lang, isMasterTab]);

  // Re-fetch cached saved emoji for `localDb`
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab) {
      loadCustomEmojis({
        ids: Object.keys((0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)().customEmojis.byId),
        ignoreCache: true
      });
    }
  }, [isMasterTab]);

  // Sticker sets
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced && isAppConfigLoaded && !isAccountFrozen) {
      if (!addedSetIds || !addedCustomEmojiIds) {
        loadStickerSets();
        loadFavoriteStickers();
      }
      if (addedSetIds && addedCustomEmojiIds) {
        loadAddedStickers();
      }
    }
  }, [addedSetIds, addedCustomEmojiIds, isMasterTab, isSynced, isAppConfigLoaded, isAccountFrozen]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    loadBotFreezeAppeal();
  }, [isAppConfigLoaded]);

  // Check version when service chat is ready
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isServiceChatReady && isMasterTab) {
      checkVersionNotification();
    }
  }, [isServiceChatReady, isMasterTab]);

  // Ensure time format
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!wasTimeFormatSetManually) {
      ensureTimeFormat();
    }
  }, [wasTimeFormatSetManually]);

  // Parse deep link
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!isSynced) return;
    updatePageTitle();
    const parsedInitialLocationHash = (0,_util_routing__WEBPACK_IMPORTED_MODULE_14__.parseInitialLocationHash)();
    if (parsedInitialLocationHash?.tgaddr) {
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_12__.processDeepLink)(decodeURIComponent(parsedInitialLocationHash.tgaddr));
    }
  }, [isSynced]);
  (0,_hooks_tauri_useTauriEvent__WEBPACK_IMPORTED_MODULE_18__["default"])('deeplink', event => {
    try {
      const url = event.payload || '';
      const decodedUrl = decodeURIComponent(url);
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_12__.processDeepLink)(decodedUrl);
    } catch (e) {
      if (_config__WEBPACK_IMPORTED_MODULE_4__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('Failed to process deep link', e);
      }
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    const parsedLocationHash = (0,_util_routing__WEBPACK_IMPORTED_MODULE_14__.parseLocationHash)(currentUserId);
    if (!parsedLocationHash) return;
    openThread({
      chatId: parsedLocationHash.chatId,
      threadId: parsedLocationHash.threadId,
      type: parsedLocationHash.type
    });
  }, [currentUserId]);

  // Refresh gift auction subscription
  const auctionTimeout = selectedGiftAuction?.state.type === 'active' ? selectedGiftAuction?.timeout : undefined;
  const auctionGiftId = selectedGiftAuction?.gift.id;
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (auctionGiftId) {
      loadGiftAuction({
        giftId: auctionGiftId
      });
    }
  }, auctionTimeout ? auctionTimeout * 1000 : undefined);

  // Restore Transition slide class after async rendering
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useLayoutEffect)(() => {
    const container = containerRef.current;
    if (container.parentNode.childElementCount === 1) {
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_2__.addExtraClass)(container, 'Transition_slide-active');
    }
  }, []);
  (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_24__["default"])({
    ref: containerRef,
    isOpen: isLeftColumnOpen,
    noCloseTransition: shouldSkipHistoryAnimations,
    prefix: 'left-column-'
  });
  const willAnimateLeftColumnRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_20__["default"])();

  // Handle opening middle column
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_25__["default"])(([prevIsLeftColumnOpen]) => {
    if (prevIsLeftColumnOpen === undefined || isLeftColumnOpen === prevIsLeftColumnOpen || !withInterfaceAnimations) {
      return;
    }
    willAnimateLeftColumnRef.current = true;
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_ANDROID) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_5__.requestNextMutation)(() => {
        document.body.classList.toggle('android-left-blackout-open', !isLeftColumnOpen);
      });
    }
    const endHeavyAnimation = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.beginHeavyAnimation)();
    (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__.waitForTransitionEnd)(document.getElementById('MiddleColumn'), () => {
      endHeavyAnimation();
      willAnimateLeftColumnRef.current = false;
      forceUpdate();
    });
  }, [isLeftColumnOpen, withInterfaceAnimations, forceUpdate]);
  (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_24__["default"])({
    ref: containerRef,
    isOpen: isRightColumnOpen,
    noCloseTransition: shouldSkipHistoryAnimations,
    prefix: 'right-column-'
  });
  const willAnimateRightColumnRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);
  const [isNarrowMessageList, setIsNarrowMessageList] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.useState)(isRightColumnOpen);
  const isFullscreen = (0,_hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_28__.useFullscreenStatus)();

  // Handle opening right column
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_25__["default"])(([prevIsMiddleColumnOpen, prevIsRightColumnOpen]) => {
    if (prevIsRightColumnOpen === undefined || isRightColumnOpen === prevIsRightColumnOpen) {
      return;
    }
    if (!prevIsMiddleColumnOpen || noRightColumnAnimation) {
      setIsNarrowMessageList(isRightColumnOpen);
      return;
    }
    willAnimateRightColumnRef.current = true;
    const endHeavyAnimation = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.beginHeavyAnimation)();
    (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__.waitForTransitionEnd)(document.getElementById('RightColumn'), () => {
      endHeavyAnimation();
      willAnimateRightColumnRef.current = false;
      forceUpdate();
      setIsNarrowMessageList(isRightColumnOpen);
    });
  }, [isMiddleColumnOpen, isRightColumnOpen, noRightColumnAnimation, forceUpdate]);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])(willAnimateLeftColumnRef.current && 'left-column-animating', willAnimateRightColumnRef.current && 'right-column-animating', isNarrowMessageList && 'narrow-message-list', shouldSkipHistoryAnimations && 'history-animation-disabled', isFullscreen && 'is-fullscreen', isFoldersSidebarShown && 'folders-sidebar-visible');
  const handleBlur = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_22__["default"])(() => {
    onTabFocusChange({
      isBlurred: true
    });
  });
  const handleFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_22__["default"])(() => {
    onTabFocusChange({
      isBlurred: false
    });
    if (!document.title.includes(_config__WEBPACK_IMPORTED_MODULE_4__.INACTIVE_MARKER)) {
      updatePageTitle();
    }
    (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_15__["default"])(false);
  });
  const handleStickerSetModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_22__["default"])(() => {
    closeStickerSetModal();
  });
  const handleCustomEmojiSetsModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_22__["default"])(() => {
    closeCustomEmojiSets();
  });

  // Online status and browser tab indicators
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_26__["default"])(handleBlur, handleFocus, _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_TAURI);
  (0,_hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_27__["default"])(handleBlur);
  (0,_hooks_usePreventPinchZoomGesture__WEBPACK_IMPORTED_MODULE_23__["default"])(isMediaViewerOpen || isStoryViewerOpen);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsxs)("div", {
    ref: containerRef,
    id: "Main",
    className: className,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_FoldersSidebar__WEBPACK_IMPORTED_MODULE_54__["default"], {
      isMobile: isMobile,
      isActive: isFoldersSidebarShown
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_left_LeftColumn__WEBPACK_IMPORTED_MODULE_37__["default"], {
      ref: leftColumnRef,
      isFoldersSidebarShown: isFoldersSidebarShown
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_middle_MiddleColumn__WEBPACK_IMPORTED_MODULE_41__["default"], {
      leftColumnRef: leftColumnRef,
      isMobile: isMobile
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_right_RightColumn__WEBPACK_IMPORTED_MODULE_46__["default"], {
      isMobile: isMobile
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_mediaViewer_MediaViewer_async__WEBPACK_IMPORTED_MODULE_38__["default"], {
      isOpen: isMediaViewerOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_story_StoryViewer_async__WEBPACK_IMPORTED_MODULE_47__["default"], {
      isOpen: isStoryViewerOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_ForwardRecipientPicker_async__WEBPACK_IMPORTED_MODULE_55__["default"], {
      isOpen: isForwardModalOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_DraftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_53__["default"], {
      requestedDraft: requestedDraft
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_Dialogs__WEBPACK_IMPORTED_MODULE_51__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_middle_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_42__["default"], {
      noUi: true
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_modals_ModalContainer__WEBPACK_IMPORTED_MODULE_43__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_SafeLinkModal_async__WEBPACK_IMPORTED_MODULE_63__["default"], {
      url: safeLinkModalUrl
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_HistoryCalendar_async__WEBPACK_IMPORTED_MODULE_57__["default"], {
      isOpen: isHistoryCalendarOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_common_StickerSetModal_async__WEBPACK_IMPORTED_MODULE_35__["default"], {
      isOpen: Boolean(openedStickerSetShortName),
      onClose: handleStickerSetModalClose,
      stickerSetShortName: openedStickerSetShortName
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_common_CustomEmojiSetsModal_async__WEBPACK_IMPORTED_MODULE_33__["default"], {
      customEmojiSetIds: openedCustomEmojiSetIds,
      onClose: handleCustomEmojiSetsModalClose
    }), activeGroupCallId && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_calls_group_GroupCall_async__WEBPACK_IMPORTED_MODULE_30__["default"], {
      groupCallId: activeGroupCallId
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_calls_ActiveCallHeader_async__WEBPACK_IMPORTED_MODULE_29__["default"], {
      isActive: Boolean(activeGroupCallId || isPhoneCallActive)
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_NewContactModal_async__WEBPACK_IMPORTED_MODULE_58__["default"], {
      isOpen: Boolean(newContactUserId || newContactByPhoneNumber),
      userId: newContactUserId,
      isByPhoneNumber: newContactByPhoneNumber
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_GameModal__WEBPACK_IMPORTED_MODULE_56__["default"], {
      openedGame: openedGame,
      gameTitle: gameTitle
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_DownloadManager__WEBPACK_IMPORTED_MODULE_52__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_visualEffects_ConfettiContainer__WEBPACK_IMPORTED_MODULE_64__["default"], {}), _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_WAVE_TRANSFORM_SUPPORTED && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_visualEffects_WaveContainer__WEBPACK_IMPORTED_MODULE_66__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_visualEffects_SnapEffectContainer__WEBPACK_IMPORTED_MODULE_65__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_calls_phone_PhoneCall_async__WEBPACK_IMPORTED_MODULE_31__["default"], {
      isActive: isPhoneCallActive
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_common_UnreadCounter__WEBPACK_IMPORTED_MODULE_36__["default"], {
      isForAppBadge: true
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_calls_phone_RatePhoneCallModal_async__WEBPACK_IMPORTED_MODULE_32__["default"], {
      isOpen: isRatePhoneCallModalOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_BotTrustModal_async__WEBPACK_IMPORTED_MODULE_49__["default"], {
      bot: botTrustRequestBot,
      type: botTrustRequest?.type,
      shouldRequestWriteAccess: botTrustRequest?.shouldRequestWriteAccess
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_AttachBotRecipientPicker_async__WEBPACK_IMPORTED_MODULE_48__["default"], {
      requestedAttachBotInChat: requestedAttachBotInChat
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_middle_MessageListHistoryHandler__WEBPACK_IMPORTED_MODULE_40__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_premium_PremiumMainModal_async__WEBPACK_IMPORTED_MODULE_61__["default"], {
      isOpen: isPremiumModalOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_premium_GiveawayModal_async__WEBPACK_IMPORTED_MODULE_60__["default"], {
      isOpen: isGiveawayModalOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_premium_StarsGiftingPickerModal_async__WEBPACK_IMPORTED_MODULE_62__["default"], {
      isOpen: isStarsGiftingPickerModal
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_premium_common_PremiumLimitReachedModal_async__WEBPACK_IMPORTED_MODULE_59__["default"], {
      limit: limitReached
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_payment_PaymentModal_async__WEBPACK_IMPORTED_MODULE_44__["default"], {
      isOpen: isPaymentModalOpen,
      onClose: closePaymentModal
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_payment_ReceiptModal_async__WEBPACK_IMPORTED_MODULE_45__["default"], {
      isOpen: isReceiptModalOpen,
      onClose: clearReceipt
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_DeleteFolderDialog_async__WEBPACK_IMPORTED_MODULE_50__["default"], {
      folder: deleteFolderDialog
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_middle_message_reactions_ReactionPicker_async__WEBPACK_IMPORTED_MODULE_39__["default"], {
      isOpen: isReactionPickerOpen
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_68__.jsx)(_common_DeleteMessageModal_async__WEBPACK_IMPORTED_MODULE_34__["default"], {
      isOpen: isDeleteMessageModalOpen
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_3__.withGlobal)((global, {
  isMobile
}) => {
  const {
    currentUserId
  } = global;
  const {
    botTrustRequest,
    requestedAttachBotInChat,
    requestedDraft,
    safeLinkModalUrl,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    shouldSkipHistoryAnimations,
    openedGame,
    isLeftColumnShown,
    historyCalendarSelectedAt,
    newContact,
    ratingPhoneCall,
    premiumModal,
    giveawayModal,
    deleteMessageModal,
    starsGiftingPickerModal,
    isMasterTab,
    payment,
    limitReachedModal,
    deleteFolderDialogModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const selectedGiftAuction = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabSelectedGiftAuction)(global);
  const {
    wasTimeFormatSetManually,
    foldersPosition
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__.selectSharedSettings)(global);
  const gameMessage = openedGame && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessage)(global, openedGame.chatId, openedGame.messageId);
  const gameTitle = gameMessage?.content.game?.title;
  const {
    chatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global) || {};
  const noRightColumnAnimation = !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPerformanceSettingsValue)(global, 'rightColumnAnimations') || !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global);
  const deleteFolderDialog = deleteFolderDialogModal ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFolder)(global, deleteFolderDialogModal) : undefined;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsCurrentUserFrozen)(global);
  return {
    currentUserId,
    isLeftColumnOpen: isLeftColumnShown,
    isMiddleColumnOpen: Boolean(chatId),
    isRightColumnOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isMediaViewerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsMediaViewerOpen)(global),
    isStoryViewerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsStoryViewerOpen)(global),
    isForwardModalOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsForwardModalOpen)(global),
    isReactionPickerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsReactionPickerOpen)(global),
    safeLinkModalUrl,
    isHistoryCalendarOpen: Boolean(historyCalendarSelectedAt),
    shouldSkipHistoryAnimations,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    isServiceChatReady: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsServiceChatReady)(global),
    activeGroupCallId: isMasterTab ? global.groupCalls.activeGroupCallId : undefined,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global),
    wasTimeFormatSetManually,
    isPhoneCallActive: isMasterTab ? Boolean(global.phoneCall) : undefined,
    addedSetIds: global.stickers.added.setIds,
    addedCustomEmojiIds: global.customEmojis.added.setIds,
    newContactUserId: newContact?.userId,
    newContactByPhoneNumber: newContact?.isByPhoneNumber,
    openedGame,
    gameTitle,
    isRatePhoneCallModalOpen: Boolean(ratingPhoneCall),
    botTrustRequest,
    botTrustRequestBot: botTrustRequest && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, botTrustRequest.botId),
    requestedAttachBotInChat,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsCurrentUserPremium)(global),
    isPremiumModalOpen: premiumModal?.isOpen,
    isGiveawayModalOpen: giveawayModal?.isOpen,
    isDeleteMessageModalOpen: Boolean(deleteMessageModal),
    isStarsGiftingPickerModal: starsGiftingPickerModal?.isOpen,
    limitReached: limitReachedModal?.limit,
    isPaymentModalOpen: payment.isPaymentModalOpen,
    isReceiptModalOpen: Boolean(payment.receipt),
    deleteFolderDialog,
    isMasterTab,
    requestedDraft,
    noRightColumnAnimation,
    isSynced: global.isSynced,
    isAccountFrozen,
    isAppConfigLoaded: global.isAppConfigLoaded,
    isFoldersSidebarShown: foldersPosition === _config__WEBPACK_IMPORTED_MODULE_4__.FOLDERS_POSITION_LEFT && !isMobile && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectAreFoldersPresent)(global),
    selectedGiftAuction
  };
})(Main)));

/***/ }),

/***/ "./src/components/main/NewContactModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/main/NewContactModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const NewContactModalAsync = props => {
  const {
    isOpen
  } = props;
  const NewContactModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'NewContactModal', !isOpen);
  return NewContactModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(NewContactModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewContactModalAsync);

/***/ }),

/***/ "./src/components/main/SafeLinkModal.async.tsx":
/*!*****************************************************!*\
  !*** ./src/components/main/SafeLinkModal.async.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const SafeLinkModalAsync = props => {
  const {
    url
  } = props;
  const SafeLinkModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'SafeLinkModal', !url);
  return SafeLinkModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SafeLinkModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SafeLinkModalAsync);

/***/ }),

/***/ "./src/components/main/WebAppsCloseConfirmationModal.async.tsx":
/*!*********************************************************************!*\
  !*** ./src/components/main/WebAppsCloseConfirmationModal.async.tsx ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const WebAppsCloseConfirmationModalAsync = props => {
  const {
    modal
  } = props;
  const WebAppsCloseConfirmationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'WebAppsCloseConfirmationModal', !modal);
  return WebAppsCloseConfirmationModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(WebAppsCloseConfirmationModal, {
    modal: modal
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WebAppsCloseConfirmationModalAsync);

/***/ }),

/***/ "./src/components/main/premium/GiveawayModal.async.tsx":
/*!*************************************************************!*\
  !*** ./src/components/main/premium/GiveawayModal.async.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiveawayModalAsync = props => {
  const {
    isOpen
  } = props;
  const GiveawayModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'GiveawayModal', !isOpen);
  return GiveawayModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiveawayModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiveawayModalAsync);

/***/ }),

/***/ "./src/components/main/premium/PremiumMainModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/main/premium/PremiumMainModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PremiumMainModalAsync = props => {
  const {
    isOpen
  } = props;
  const PremiumMainModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PremiumMainModal', !isOpen);
  return PremiumMainModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PremiumMainModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumMainModalAsync);

/***/ }),

/***/ "./src/components/main/premium/StarsGiftingPickerModal.async.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/main/premium/StarsGiftingPickerModal.async.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarsGiftingPickerModalAsync = props => {
  const {
    isOpen
  } = props;
  const StarsGiftingPickerModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarsGiftingPickerModal', !isOpen);
  return StarsGiftingPickerModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarsGiftingPickerModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsGiftingPickerModalAsync);

/***/ }),

/***/ "./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx":
/*!*******************************************************************************!*\
  !*** ./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PremiumLimitReachedModalAsync = props => {
  const {
    limit
  } = props;
  const PremiumLimitReachedModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PremiumLimitReachedModal', !limit);
  return PremiumLimitReachedModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PremiumLimitReachedModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumLimitReachedModalAsync);

/***/ }),

/***/ "./src/components/main/visualEffects/ConfettiContainer.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/main/visualEffects/ConfettiContainer.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"YUAfqWPN"});

/***/ }),

/***/ "./src/components/main/visualEffects/ConfettiContainer.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/main/visualEffects/ConfettiContainer.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ConfettiContainer.module.scss */ "./src/components/main/visualEffects/ConfettiContainer.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const CONFETTI_FADEOUT_TIMEOUT = 10000;
const DEFAULT_CONFETTI_SIZE = 10;
const CONFETTI_COLORS = ['#E8BC2C', '#D0049E', '#02CBFE', '#5723FD', '#FE8C27', '#6CB859'];
// eslint-disable-next-line @stylistic/max-len
const STAR_PATH = new Path2D('M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z');
const STAR_SIZE_MULTIPLIER = 1.5;
const ConfettiContainer = ({
  confetti
}) => {
  const canvasRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const confettiRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)([]);
  const isRafStartedRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const windowSize = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const defaultConfettiAmount = isMobile ? 50 : 100;
  const {
    lastConfettiTime,
    top,
    width,
    left,
    height,
    style = 'poppers'
  } = confetti || {};
  const generateConfetti = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])((w, h, amount = defaultConfettiAmount) => {
    for (let i = 0; i < amount; i++) {
      const {
        position,
        velocity
      } = generateRandomPositionData(style, w, h, i);
      const size = DEFAULT_CONFETTI_SIZE + randomNumberAroundZero(DEFAULT_CONFETTI_SIZE / 2);
      const randomColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
      confettiRef.current.push({
        pos: position,
        size,
        color: randomColor,
        velocity,
        flicker: size,
        flickerFrequency: Math.random() * 0.2,
        rotation: 0,
        lastDrawnAt: Date.now(),
        frameCount: 0,
        isStar: confetti?.withStars && Math.random() > 0.8
      });
    }
  });
  const updateCanvas = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!canvasRef.current || !isRafStartedRef.current) {
      return;
    }
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    if (!ctx) {
      return;
    }
    const {
      width: canvasWidth,
      height: canvasHeight
    } = canvas;
    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
    const confettiToRemove = [];
    confettiRef.current.forEach((c, i) => {
      const {
        pos,
        velocity,
        size,
        color,
        flicker,
        flickerFrequency,
        rotation,
        lastDrawnAt,
        frameCount
      } = c;
      const diff = (Date.now() - lastDrawnAt) / 1000;
      const newPos = {
        x: pos.x + velocity.x * diff,
        y: pos.y + velocity.y * diff
      };
      const newVelocity = {
        x: velocity.x * 0.5 ** (diff / 1),
        // Air Resistance
        y: velocity.y += diff * 1000 // Gravity
      };
      const newFlicker = size * Math.abs(Math.sin(frameCount * flickerFrequency));
      const newRotation = 5 * frameCount * flickerFrequency * (Math.PI / 180);
      const newFrameCount = frameCount + 1;
      const newLastDrawnAt = Date.now();
      const shouldRemove = newPos.y > canvasHeight + c.size;
      if (shouldRemove) {
        confettiToRemove.push(c);
        return;
      }
      const newConfetti = {
        ...c,
        pos: newPos,
        velocity: newVelocity,
        flicker: newFlicker,
        rotation: newRotation,
        lastDrawnAt: newLastDrawnAt,
        frameCount: newFrameCount
      };
      confettiRef.current[i] = newConfetti;
      ctx.fillStyle = color;
      if (c.isStar) {
        ctx.save();
        ctx.translate(pos.x, pos.y);
        ctx.scale(size / DEFAULT_CONFETTI_SIZE * STAR_SIZE_MULTIPLIER, size / DEFAULT_CONFETTI_SIZE * STAR_SIZE_MULTIPLIER);
        ctx.rotate(rotation);
        ctx.fill(STAR_PATH);
        ctx.restore();
      } else {
        ctx.beginPath();
        ctx.ellipse(pos.x, pos.y, size, flicker, rotation, 0, 2 * Math.PI);
        ctx.fill();
      }
    });
    confettiRef.current = confettiRef.current.filter(c => !confettiToRemove.includes(c));
    if (confettiRef.current.length) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(updateCanvas);
    } else {
      isRafStartedRef.current = false;
    }
  });
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__["default"])(([prevConfettiTime]) => {
    let hideTimeout;
    if (prevConfettiTime !== lastConfettiTime) {
      generateConfetti(width || windowSize.width, height || windowSize.height);
      hideTimeout = setTimeout(forceUpdate, CONFETTI_FADEOUT_TIMEOUT);
      if (!isRafStartedRef.current) {
        isRafStartedRef.current = true;
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(updateCanvas);
      }
    }
    return () => {
      clearTimeout(hideTimeout);
    };
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps -- Old timeout should be cleared only if new confetti is generated
  }, [lastConfettiTime, forceUpdate, updateCanvas]);
  if (!lastConfettiTime || Date.now() - lastConfettiTime > CONFETTI_FADEOUT_TIMEOUT) {
    return undefined;
  }
  const containerStyle = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(Boolean(top) && `top: ${top}px`, Boolean(left) && `left: ${left}px`, Boolean(width) && `width: ${width}px`, Boolean(height) && `height: ${height}px`);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div", {
    id: "Confetti",
    className: _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root,
    style: containerStyle,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("canvas", {
      ref: canvasRef,
      className: _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].canvas,
      width: windowSize.width,
      height: windowSize.height
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.pick)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global), ['confetti']))(ConfettiContainer)));
function generateRandomPositionData(style, containerWidth, containerHeight, index) {
  if (style === 'poppers') {
    const leftSide = index % 2;
    const position = {
      x: containerWidth * (leftSide ? -0.1 : 1.1),
      y: containerHeight * 0.66
    };
    const randomX = Math.random() * containerWidth;
    const randomY = -containerHeight - randomNumberAroundZero(containerHeight * 0.75);
    const velocity = {
      x: leftSide ? randomX : randomX * -1,
      y: randomY
    };
    return {
      position,
      velocity
    };
  } else {
    const position = {
      x: Math.random() * containerWidth,
      y: -DEFAULT_CONFETTI_SIZE * 2
    };
    const randomX = randomNumberAroundZero(containerWidth);
    const randomY = -containerHeight * Math.random() * 1.25;
    const velocity = {
      x: randomX,
      y: randomY
    };
    return {
      position,
      velocity
    };
  }
}
function randomNumberAroundZero(max = 1) {
  return Math.random() * max - max / 2;
}

/***/ }),

/***/ "./src/components/main/visualEffects/WaveContainer.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/main/visualEffects/WaveContainer.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"RMsQzedH","wave":"YLR2Oh2f","waveGrow":"rqfv5Mai"});

/***/ }),

/***/ "./src/components/main/visualEffects/WaveContainer.tsx":
/*!*************************************************************!*\
  !*** ./src/components/main/visualEffects/WaveContainer.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_svgController__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/svgController */ "./src/util/svgController.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _WaveContainer_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./WaveContainer.module.scss */ "./src/components/main/visualEffects/WaveContainer.module.scss");
/* harmony import */ var _assets_wave_ripple_jpg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../assets/wave_ripple.jpg */ "./src/assets/wave_ripple.jpg");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const BASE_SIZE_MULTIPLIER = 1.73;
const FILTER_ID = 'wave-filter';
const FILTER_SCALE = '20';
const WAVE_COUNT_LIMIT = 7;
const WaveContainer = ({
  waveInfo
}) => {
  const [waves, setWaves] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const addWave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(newWave => {
    if (waves.length >= WAVE_COUNT_LIMIT) return;
    setWaves(prevWaves => [...prevWaves, newWave]);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!waveInfo) return;
    const {
      startX,
      startY
    } = waveInfo;
    const {
      width,
      height
    } = _util_windowSize__WEBPACK_IMPORTED_MODULE_7__["default"].get();
    const maxSize = Math.max(width - startX, height - startY, startX, startY);
    const overlaySize = maxSize * BASE_SIZE_MULTIPLIER;
    const top = startY - overlaySize / 2;
    const left = startX - overlaySize / 2;
    addWave({
      startTime: waveInfo.lastWaveTime,
      waveWidth: overlaySize,
      top,
      left
    });
  }, [waveInfo]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    (0,_util_svgController__WEBPACK_IMPORTED_MODULE_6__.addSvgDefinition)((0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("filter", {
      x: "0",
      y: "0",
      width: "1",
      height: "1",
      "color-interpolation-filters": "sRGB",
      xmlns: _config__WEBPACK_IMPORTED_MODULE_2__.SVG_NAMESPACE,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("feImage", {
        href: _assets_wave_ripple_jpg__WEBPACK_IMPORTED_MODULE_10__,
        result: "waveImage"
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("feDisplacementMap", {
        in: "SourceGraphic",
        in2: "waveImage",
        scale: FILTER_SCALE,
        xChannelSelector: "R",
        yChannelSelector: "B"
      })]
    }), FILTER_ID);
    return () => {
      (0,_util_svgController__WEBPACK_IMPORTED_MODULE_6__.removeSvgDefinition)(FILTER_ID);
    };
  }, []);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_WaveContainer_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root),
    teactFastList: true,
    children: waves.map(wave => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _WaveContainer_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].wave,
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(`--wave-width: ${wave.waveWidth}px`, `--wave-pos-top: ${wave.top}px`, `--wave-pos-left: ${wave.left}px`),
      onAnimationEnd: () => setWaves(prevWaves => prevWaves.filter(w => w !== wave))
    }, wave.startTime))
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  return {
    waveInfo: tabState.wave
  };
})(WaveContainer)));

/***/ }),

/***/ "./src/components/mediaViewer/MediaViewer.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/mediaViewer/MediaViewer.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const MediaViewerAsync = ({
  isOpen
}) => {
  const MediaViewer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'MediaViewer', !isOpen);
  return MediaViewer ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MediaViewer, {}) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MediaViewerAsync);

/***/ }),

/***/ "./src/components/middle/ChatLanguageModal.async.tsx":
/*!***********************************************************!*\
  !*** ./src/components/middle/ChatLanguageModal.async.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ChatLanguageModalAsync = props => {
  const {
    isOpen
  } = props;
  const ChatLanguageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ChatLanguageModal', !isOpen);
  return ChatLanguageModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ChatLanguageModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatLanguageModalAsync);

/***/ }),

/***/ "./src/components/middle/EmojiInteractionAnimation.async.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/middle/EmojiInteractionAnimation.async.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const EmojiInteractionAnimationAsync = props => {
  const {
    activeEmojiInteraction
  } = props;
  const EmojiInteractionAnimation = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'EmojiInteractionAnimation', !activeEmojiInteraction);
  return EmojiInteractionAnimation ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(EmojiInteractionAnimation, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmojiInteractionAnimationAsync);

/***/ }),

/***/ "./src/components/middle/FloatingActionButtons.module.scss":
/*!*****************************************************************!*\
  !*** ./src/components/middle/FloatingActionButtons.module.scss ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"VWoOZCD5","hidden":"UMXbiYB3","reactions":"eO_Fz8SD","transform-down":"gn3iLVq1","transformDown":"gn3iLVq1","unread":"u62x81QI","revealed":"iozW83la","no-composer":"yzzjqibi","noComposer":"yzzjqibi","no-extra-shift":"wDwOdyQH","noExtraShift":"wDwOdyQH","hide-scroll-down":"UBa5kAK5","hideScrollDown":"UBa5kAK5","is-symbol-menu-open":"qoyRzwL6","isSymbolMenuOpen":"qoyRzwL6"});

/***/ }),

/***/ "./src/components/middle/FloatingActionButtons.tsx":
/*!*********************************************************!*\
  !*** ./src/components/middle/FloatingActionButtons.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ScrollDownButton__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ScrollDownButton */ "./src/components/middle/ScrollDownButton.tsx");
/* harmony import */ var _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./FloatingActionButtons.module.scss */ "./src/components/middle/FloatingActionButtons.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const FloatingActionButtons = ({
  withScrollDown,
  canPost,
  messageListType,
  chatId,
  threadId,
  unreadCount,
  unreadReactions,
  unreadMentions,
  reactionsCount,
  mentionsCount,
  withExtraShift
}) => {
  const {
    focusNextReply,
    focusNextReaction,
    focusNextMention,
    fetchUnreadReactions,
    readAllMentions,
    readAllReactions,
    fetchUnreadMentions,
    scrollMessageListToBottom
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const elementRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const hasUnreadReactions = Boolean(reactionsCount);
  const hasUnreadMentions = Boolean(mentionsCount);
  const handleReadAllReactions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!chatId) return;
    readAllReactions({
      chatId,
      threadId
    });
  });
  const handleReadAllMentions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!chatId) return;
    readAllMentions({
      chatId,
      threadId
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadReactions && chatId && !unreadReactions?.length) {
      fetchUnreadReactions({
        chatId
      });
    }
  }, [chatId, fetchUnreadReactions, hasUnreadReactions, unreadReactions?.length]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadReactions && chatId) {
      fetchUnreadReactions({
        chatId
      });
    }
  }, [chatId, fetchUnreadReactions, hasUnreadReactions]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadMentions && chatId && !unreadMentions?.length) {
      fetchUnreadMentions({
        chatId
      });
    }
  }, [chatId, fetchUnreadMentions, hasUnreadMentions, unreadMentions?.length]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadMentions && chatId) {
      fetchUnreadMentions({
        chatId
      });
    }
  }, [chatId, fetchUnreadMentions, hasUnreadMentions]);
  const handleScrollDownClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!withScrollDown) {
      return;
    }
    if (messageListType === 'thread') {
      focusNextReply();
    } else {
      scrollMessageListToBottom();
    }
  });
  const fabClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root, (withScrollDown || Boolean(reactionsCount) || Boolean(mentionsCount)) && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].revealed, (Boolean(reactionsCount) || Boolean(mentionsCount)) && !withScrollDown && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].hideScrollDown, !canPost && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].noComposer, !withExtraShift && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].noExtraShift);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
    ref: elementRef,
    className: fabClassName,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_6__["default"], {
      icon: "heart-outline",
      ariaLabelLang: "AccDescrReactionMentionDown",
      onClick: focusNextReaction,
      onReadAll: handleReadAllReactions,
      unreadCount: reactionsCount,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].reactions, !hasUnreadReactions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].hidden, !hasUnreadMentions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].transformDown)
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_6__["default"], {
      icon: "mention",
      ariaLabelLang: "AccDescrMentionDown",
      onClick: focusNextMention,
      onReadAll: handleReadAllMentions,
      unreadCount: mentionsCount,
      className: !hasUnreadMentions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].hidden
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_6__["default"], {
      icon: "arrow-down",
      ariaLabelLang: "AccDescrPageDown",
      onClick: handleScrollDownClick,
      unreadCount: unreadCount,
      className: _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].unread
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global);
  if (!currentMessageList) {
    return {};
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const hasActiveMiddleSearch = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMiddleSearch)(global));
  const shouldShowCount = chat && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && messageListType === 'thread' && !hasActiveMiddleSearch;
  return {
    messageListType,
    chatId,
    threadId,
    reactionsCount: shouldShowCount ? chat.unreadReactionsCount : undefined,
    unreadReactions: shouldShowCount ? chat.unreadReactions : undefined,
    unreadMentions: shouldShowCount ? chat.unreadMentions : undefined,
    mentionsCount: shouldShowCount ? chat.unreadMentionsCount : undefined,
    unreadCount: shouldShowCount ? chat.unreadCount : undefined
  };
})(FloatingActionButtons)));

/***/ }),

/***/ "./src/components/middle/FrozenAccountPlaceholder.module.scss":
/*!********************************************************************!*\
  !*** ./src/components/middle/FrozenAccountPlaceholder.module.scss ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GuZke_HG","title":"oLWeN4mA","subtitle":"ZxTe54MY"});

/***/ }),

/***/ "./src/components/middle/FrozenAccountPlaceholder.tsx":
/*!************************************************************!*\
  !*** ./src/components/middle/FrozenAccountPlaceholder.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./FrozenAccountPlaceholder.module.scss */ "./src/components/middle/FrozenAccountPlaceholder.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






function FrozenAccountPlaceholder() {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const {
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    openFrozenAccountModal();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div", {
    className: _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].root,
    onClick: handleClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div", {
      className: _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].title,
      children: lang('ComposerTitleFrozenAccount')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div", {
      className: _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].subtitle,
      children: lang('ComposerSubtitleFrozenAccount')
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(FrozenAccountPlaceholder));

/***/ }),

/***/ "./src/components/middle/MessageListHistoryHandler.tsx":
/*!*************************************************************!*\
  !*** ./src/components/middle/MessageListHistoryHandler.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






// Actual `MessageList` components are unmounted when deep in the history,
// so we need a separate component just for handling history
const MessageListHistoryHandler = ({
  messageLists
}) => {
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const closeChat = () => {
    openChat({
      id: undefined
    }, {
      forceSyncOnIOs: true
    });
  };
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div", {
    children: messageLists?.map((messageList, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(MessageHistoryRecord, {
      ...messageList,
      onBack: closeChat
    }, `${messageList.chatId}_${messageList.threadId}_${messageList.type}_${i}`))
  });
};
const MessageHistoryRecord = ({
  chatId,
  type,
  threadId,
  onBack
}) => {
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_4__["default"])({
    isActive: true,
    hash: (0,_util_routing__WEBPACK_IMPORTED_MODULE_3__.createLocationHash)(chatId, type, threadId),
    onBack
  });
  return undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    messageLists: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global).messageLists
  };
})(MessageListHistoryHandler)));

/***/ }),

/***/ "./src/components/middle/MessageSelectToolbar.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/middle/MessageSelectToolbar.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const MessageSelectToolbarAsync = props => {
  const {
    isActive
  } = props;
  const MessageSelectToolbar = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'MessageSelectToolbar', !isActive);
  return MessageSelectToolbar ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MessageSelectToolbar, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageSelectToolbarAsync);

/***/ }),

/***/ "./src/components/middle/MiddleColumn.scss":
/*!*************************************************!*\
  !*** ./src/components/middle/MiddleColumn.scss ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/MiddleColumn.tsx":
/*!************************************************!*\
  !*** ./src/components/middle/MiddleColumn.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_resolveTransitionName__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/resolveTransitionName */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./helpers/calculateMiddleFooterTransforms */ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useCustomBackground */ "./src/hooks/useCustomBackground.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/usePrevDuringAnimation */ "./src/hooks/usePrevDuringAnimation.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useResize__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/useResize */ "./src/hooks/useResize.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _hooks_usePinnedMessage__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./hooks/usePinnedMessage */ "./src/components/middle/hooks/usePinnedMessage.ts");
/* harmony import */ var _message_hooks_useFluidBackgroundFilter__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./message/hooks/useFluidBackgroundFilter */ "./src/components/middle/message/hooks/useFluidBackgroundFilter.tsx");
/* harmony import */ var _common_Composer__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../common/Composer */ "./src/components/common/Composer.tsx");
/* harmony import */ var _common_PrivacySettingsNoticeModal_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../common/PrivacySettingsNoticeModal.async */ "./src/components/common/PrivacySettingsNoticeModal.async.tsx");
/* harmony import */ var _common_SeenByModal_async__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../common/SeenByModal.async */ "./src/components/common/SeenByModal.async.tsx");
/* harmony import */ var _common_UnpinAllMessagesModal_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../common/UnpinAllMessagesModal.async */ "./src/components/common/UnpinAllMessagesModal.async.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ChatLanguageModal_async__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./ChatLanguageModal.async */ "./src/components/middle/ChatLanguageModal.async.tsx");
/* harmony import */ var _composer_DropArea__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./composer/DropArea */ "./src/components/middle/composer/DropArea.tsx");
/* harmony import */ var _EmojiInteractionAnimation_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./EmojiInteractionAnimation.async */ "./src/components/middle/EmojiInteractionAnimation.async.tsx");
/* harmony import */ var _FloatingActionButtons__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./FloatingActionButtons */ "./src/components/middle/FloatingActionButtons.tsx");
/* harmony import */ var _FrozenAccountPlaceholder__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./FrozenAccountPlaceholder */ "./src/components/middle/FrozenAccountPlaceholder.tsx");
/* harmony import */ var _MessageList__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./MessageList */ "./src/components/middle/MessageList.tsx");
/* harmony import */ var _MessageSelectToolbar_async__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./MessageSelectToolbar.async */ "./src/components/middle/MessageSelectToolbar.async.tsx");
/* harmony import */ var _MiddleHeader__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./MiddleHeader */ "./src/components/middle/MiddleHeader.tsx");
/* harmony import */ var _MiddleHeaderPanes__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./MiddleHeaderPanes */ "./src/components/middle/MiddleHeaderPanes.tsx");
/* harmony import */ var _PremiumRequiredPlaceholder__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./PremiumRequiredPlaceholder */ "./src/components/middle/PremiumRequiredPlaceholder.tsx");
/* harmony import */ var _ReactorListModal_async__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./ReactorListModal.async */ "./src/components/middle/ReactorListModal.async.tsx");
/* harmony import */ var _search_MiddleSearch_async__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./search/MiddleSearch.async */ "./src/components/middle/search/MiddleSearch.async.tsx");
/* harmony import */ var _MiddleColumn_scss__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./MiddleColumn.scss */ "./src/components/middle/MiddleColumn.scss");
/* harmony import */ var _styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../../styles/_patternBackground.module.scss */ "./src/styles/_patternBackground.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















































function isImage(item) {
  return item.kind === 'file' && item.type && _config__WEBPACK_IMPORTED_MODULE_3__.SUPPORTED_PHOTO_CONTENT_TYPES.has(item.type);
}
function isVideo(item) {
  return item.kind === 'file' && item.type && _config__WEBPACK_IMPORTED_MODULE_3__.SUPPORTED_VIDEO_CONTENT_TYPES.has(item.type);
}
const LAYER_ANIMATION_DURATION_MS = 450 + _config__WEBPACK_IMPORTED_MODULE_3__.ANIMATION_END_DELAY;
function MiddleColumn({
  leftColumnRef,
  chatId,
  threadId,
  isComments,
  messageListType,
  isMobile,
  chat,
  draftReplyInfo,
  isPrivate,
  isPinnedMessageList,
  canPost,
  currentUserBannedRights,
  defaultBannedRights,
  pinnedMessagesCount,
  customBackground,
  theme,
  backgroundColor,
  patternColor,
  actionMessageBg,
  isLeftColumnShown,
  isRightColumnShown,
  isBackgroundBlurred,
  leftColumnWidth,
  hasActiveMiddleSearch,
  isSelectModeActive,
  isSeenByModalOpen,
  isPrivacySettingsNoticeModalOpen,
  isReactorListModalOpen,
  isChatLanguageModalOpen,
  animationLevel,
  withInterfaceAnimations,
  withRightColumnAnimation,
  shouldSkipHistoryAnimations,
  currentTransitionKey,
  isChannel,
  arePeerSettingsLoaded,
  canSubscribe,
  canStartBot,
  canRestartBot,
  activeEmojiInteractions,
  shouldJoinToSend,
  shouldSendJoinRequest,
  shouldLoadFullChat,
  pinnedIds,
  canUnpin,
  canUnblock,
  isSavedDialog,
  canShowOpenChatButton,
  isContactRequirePremium,
  topics,
  paidMessagesStars,
  isAccountFrozen,
  freezeAppealChat,
  shouldBlockSendInMonoforum
}) {
  const {
    openChat,
    openPreviousChat,
    unpinAllMessages,
    loadUser,
    loadPeerSettings,
    exitMessageSelectMode,
    joinChannel,
    sendBotCommand,
    restartBot,
    showNotification,
    loadFullChat,
    setLeftColumnWidth,
    resetLeftColumnWidth,
    unblockUser
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_27__["default"])();
  const {
    isTablet,
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_20__["default"])();
  const [dropAreaState, setDropAreaState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_composer_DropArea__WEBPACK_IMPORTED_MODULE_37__.DropAreaState.None);
  const [isScrollDownNeeded, setIsScrollDownShown] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const isScrollDownShown = isScrollDownNeeded && (!isMobile || !hasActiveMiddleSearch);
  const [isNotchShown, setIsNotchShown] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isUnpinModalOpen, setIsUnpinModalOpen] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    handleIntersectPinnedMessage,
    handleFocusPinnedMessage,
    getCurrentPinnedIndex,
    getLoadingPinnedId
  } = (0,_hooks_usePinnedMessage__WEBPACK_IMPORTED_MODULE_28__["default"])(chatId, threadId, pinnedIds);
  const closeAnimationDuration = isMobile ? LAYER_ANIMATION_DURATION_MS : undefined;
  const renderingChatId = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(chatId, closeAnimationDuration);
  const renderingThreadId = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(threadId, closeAnimationDuration);
  const renderingMessageListType = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(messageListType, closeAnimationDuration);
  const renderingCanSubscribe = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(canSubscribe, closeAnimationDuration);
  const renderingCanStartBot = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(canStartBot, closeAnimationDuration);
  const renderingCanRestartBot = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(canRestartBot, closeAnimationDuration);
  const renderingCanUnblock = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(canUnblock, closeAnimationDuration);
  const renderingCanPost = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(canPost, closeAnimationDuration) && !renderingCanRestartBot && !renderingCanStartBot && !renderingCanSubscribe && !renderingCanUnblock && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.TMP_CHAT_ID && !isContactRequirePremium;
  const renderingIsScrollDownShown = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(isScrollDownShown, closeAnimationDuration) && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.TMP_CHAT_ID;
  const renderingIsChannel = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(isChannel, closeAnimationDuration);
  const renderingShouldJoinToSend = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(shouldJoinToSend, closeAnimationDuration);
  const renderingShouldSendJoinRequest = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(shouldSendJoinRequest, closeAnimationDuration);
  const renderingHandleIntersectPinnedMessage = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_23__["default"])(chatId ? handleIntersectPinnedMessage : undefined, closeAnimationDuration);
  const prevTransitionKey = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_24__["default"])(currentTransitionKey);
  const cleanupExceptionKey = prevTransitionKey !== undefined && prevTransitionKey < currentTransitionKey ? prevTransitionKey : undefined;
  const {
    isReady,
    handleCssTransitionEnd,
    handleSlideTransitionStop
  } = useIsReady(!shouldSkipHistoryAnimations && withInterfaceAnimations, currentTransitionKey, prevTransitionKey, chatId, isMobile);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return chatId ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
      openChat({
        id: undefined
      });
    }) : undefined;
  }, [chatId, openChat]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    setDropAreaState(_composer_DropArea__WEBPACK_IMPORTED_MODULE_37__.DropAreaState.None);
    setIsNotchShown(undefined);
  }, [chatId]);

  // Fix for mobile virtual keyboard
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_IOS && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_ANDROID) {
      return undefined;
    }
    const {
      visualViewport
    } = window;
    if (!visualViewport) {
      return undefined;
    }
    const handleResize = () => {
      const isFixNeeded = visualViewport.height !== document.documentElement.clientHeight;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMutation)(() => {
        document.body.classList.toggle('keyboard-visible', isFixNeeded);
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
          if (!isFixNeeded && visualViewport.offsetTop) {
            (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMutation)(() => {
              window.scrollTo({
                top: 0
              });
            });
          }
        });
      });
    };
    visualViewport.addEventListener('resize', handleResize);
    return () => {
      visualViewport.removeEventListener('resize', handleResize);
    };
  }, []);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPrivate) {
      loadUser({
        userId: chatId
      });
    }
  }, [chatId, isPrivate, loadUser]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!arePeerSettingsLoaded) {
      loadPeerSettings({
        peerId: chatId
      });
    }
  }, [chatId, isPrivate, arePeerSettingsLoaded]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && shouldLoadFullChat && isReady) {
      loadFullChat({
        chatId
      });
    }
  }, [shouldLoadFullChat, chatId, isReady, loadFullChat]);
  const {
    initResize,
    resetResize,
    handleMouseUp
  } = (0,_hooks_useResize__WEBPACK_IMPORTED_MODULE_25__.useResize)(leftColumnRef, n => setLeftColumnWidth({
    leftColumnWidth: n
  }), resetLeftColumnWidth, leftColumnWidth, '--left-column-width');
  const handleDragEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(e => {
    const {
      items
    } = e.dataTransfer || {};
    // In Safari, the e.dataTransfer.items list may be empty during dragenter/dragover events,
    // preventing the ability to determine file types in advance. More details: https://bugs.webkit.org/show_bug.cgi?id=223517
    const shouldDrawQuick = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_SAFARI || items && items.length > 0 && Array.from(items)
    // Filter unnecessary element for drag and drop images in Firefox (https://github.com/Ajaxy/telegram-tt/issues/49)
    // https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/Recommended_drag_types#image
    .filter(item => item.type !== 'text/uri-list').every(item => isImage(item) || isVideo(item));
    setDropAreaState(shouldDrawQuick ? _composer_DropArea__WEBPACK_IMPORTED_MODULE_37__.DropAreaState.QuickFile : _composer_DropArea__WEBPACK_IMPORTED_MODULE_37__.DropAreaState.Document);
  });
  const handleHideDropArea = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    setDropAreaState(_composer_DropArea__WEBPACK_IMPORTED_MODULE_37__.DropAreaState.None);
  });
  const handleOpenUnpinModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    setIsUnpinModalOpen(true);
  });
  const closeUnpinModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    setIsUnpinModalOpen(false);
  });
  const handleOpenChatFromSaved = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    openChat({
      id: String(threadId)
    });
  });
  const handleUnpinAllMessages = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    unpinAllMessages({
      chatId: chatId,
      threadId: threadId
    });
    closeUnpinModal();
    openPreviousChat();
  });
  const handleTabletFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    openChat({
      id: chatId
    });
  });
  const handleSubscribeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    joinChannel({
      chatId: chatId
    });
    if (renderingShouldSendJoinRequest) {
      showNotification({
        message: isChannel ? oldLang('RequestToJoinChannelSentDescription') : oldLang('RequestToJoinGroupSentDescription')
      });
    }
  });
  const handleStartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    sendBotCommand({
      command: '/start'
    });
  });
  const handleRestartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    restartBot({
      chatId: chatId
    });
  });
  const handleUnblock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    unblockUser({
      userId: chatId
    });
  });
  const customBackgroundValue = (0,_hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_17__["default"])(theme, customBackground);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.MASK_IMAGE_DISABLED ? 'mask-image-disabled' : 'mask-image-enabled');
  const bgClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])(_styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__["default"].background, withRightColumnAnimation && _styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__["default"].withTransition, customBackground && _styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__["default"].customBgImage, backgroundColor && _styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__["default"].customBgColor, customBackground && isBackgroundBlurred && _styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__["default"].blurred, isRightColumnShown && _styles_patternBackground_module_scss__WEBPACK_IMPORTED_MODULE_49__["default"].withRightColumn);
  const messagingDisabledClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])('messaging-disabled', !isSelectModeActive && 'shown');
  const messageSendingRestrictionReason = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSendingRestrictionReason)(oldLang, currentUserBannedRights, defaultBannedRights);
  const forumComposerPlaceholder = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getForumComposerPlaceholder)(oldLang, chat, threadId, topics, Boolean(draftReplyInfo));
  const composerRestrictionMessage = messageSendingRestrictionReason || forumComposerPlaceholder || (shouldBlockSendInMonoforum ? lang('MonoforumComposerPlaceholder') : undefined) || (isContactRequirePremium ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_PremiumRequiredPlaceholder__WEBPACK_IMPORTED_MODULE_45__["default"], {
    userId: chatId
  }) : undefined) || (isAccountFrozen && freezeAppealChat?.id !== chatId ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_FrozenAccountPlaceholder__WEBPACK_IMPORTED_MODULE_40__["default"], {}) : undefined);

  // CSS Variables calculation doesn't work properly with transforms, so we calculate transform values in JS
  const {
    composerHiddenScale,
    toolbarHiddenScale,
    composerTranslateX,
    toolbarTranslateX,
    unpinHiddenScale,
    toolbarForUnpinHiddenScale
  } = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_15__["default"])(windowWidth, renderingCanPost), [renderingCanPost, windowWidth]);
  const footerClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])('middle-column-footer', !renderingCanPost && 'no-composer', renderingCanPost && isNotchShown && !isSelectModeActive && 'with-notch');
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_19__["default"])({
    isActive: isSelectModeActive,
    onBack: exitMessageSelectMode
  });

  // Prepare filter beforehand to avoid flickering
  (0,_message_hooks_useFluidBackgroundFilter__WEBPACK_IMPORTED_MODULE_29__["default"])(actionMessageBg);
  const isMessagingDisabled = Boolean(!isPinnedMessageList && !isSavedDialog && !renderingCanPost && !renderingCanRestartBot && !renderingCanStartBot && !renderingCanSubscribe && composerRestrictionMessage) || isAccountFrozen && freezeAppealChat?.id !== chatId;
  const withMessageListBottomShift = Boolean(renderingCanRestartBot || renderingCanSubscribe || renderingShouldSendJoinRequest || renderingCanStartBot || isPinnedMessageList && canUnpin || canShowOpenChatButton || renderingCanUnblock);
  const withExtraShift = Boolean(isMessagingDisabled || isSelectModeActive);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsxs)("div", {
    id: "MiddleColumn",
    className: className,
    onTransitionEnd: handleCssTransitionEnd,
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_11__["default"])(`--composer-hidden-scale: ${composerHiddenScale}`, `--toolbar-hidden-scale: ${toolbarHiddenScale}`, `--unpin-hidden-scale: ${unpinHiddenScale}`, `--toolbar-unpin-hidden-scale: ${toolbarForUnpinHiddenScale}`, `--composer-translate-x: ${composerTranslateX}px`, `--toolbar-translate-x: ${toolbarTranslateX}px`, `--pattern-color: ${patternColor}`, backgroundColor && `--theme-background-color: ${backgroundColor}`),
    onClick: isTablet && isLeftColumnShown ? handleTabletFocus : undefined,
    children: [isDesktop && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
      className: "resize-handle",
      onMouseDown: initResize,
      onMouseUp: handleMouseUp,
      onDoubleClick: resetResize
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
      className: bgClassName,
      style: customBackgroundValue ? `--custom-background: ${customBackgroundValue}` : undefined,
      "data-tauri-drag-region": _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_TAURI && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_MAC_OS && !(renderingChatId && renderingThreadId) ? true : undefined
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
      id: "middle-column-portals"
    }), Boolean(renderingChatId && renderingThreadId) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsxs)("div", {
        className: "messages-layout",
        onDragEnter: renderingCanPost ? handleDragEnter : undefined,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_MiddleHeaderPanes__WEBPACK_IMPORTED_MODULE_44__["default"], {
          chatId: renderingChatId,
          threadId: renderingThreadId,
          messageListType: renderingMessageListType,
          getCurrentPinnedIndex: getCurrentPinnedIndex,
          getLoadingPinnedId: getLoadingPinnedId,
          onFocusPinnedMessage: handleFocusPinnedMessage
        }, renderingChatId), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_MiddleHeader__WEBPACK_IMPORTED_MODULE_43__["default"], {
          chatId: renderingChatId,
          threadId: renderingThreadId,
          messageListType: renderingMessageListType,
          isComments: isComments,
          isMobile: isMobile,
          getCurrentPinnedIndex: getCurrentPinnedIndex,
          getLoadingPinnedId: getLoadingPinnedId,
          onFocusPinnedMessage: handleFocusPinnedMessage
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_35__["default"], {
          name: (0,_util_resolveTransitionName__WEBPACK_IMPORTED_MODULE_14__.resolveTransitionName)('slide', animationLevel, shouldSkipHistoryAnimations || !withInterfaceAnimations),
          activeKey: currentTransitionKey,
          shouldCleanup: true,
          cleanupExceptionKey: cleanupExceptionKey,
          isBlockingAnimation: true,
          onStop: handleSlideTransitionStop,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_MessageList__WEBPACK_IMPORTED_MODULE_41__["default"], {
            chatId: renderingChatId,
            threadId: renderingThreadId,
            type: renderingMessageListType,
            isComments: isComments,
            canPost: renderingCanPost,
            onScrollDownToggle: setIsScrollDownShown,
            onNotchToggle: setIsNotchShown,
            isReady: isReady,
            isContactRequirePremium: isContactRequirePremium,
            paidMessagesStars: paidMessagesStars,
            withBottomShift: withMessageListBottomShift,
            withDefaultBg: Boolean(!customBackground && !backgroundColor),
            onIntersectPinnedMessage: renderingHandleIntersectPinnedMessage
          }, `${renderingChatId}-${renderingThreadId}-${renderingMessageListType}`), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsxs)("div", {
            className: footerClassName,
            children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_FloatingActionButtons__WEBPACK_IMPORTED_MODULE_39__["default"], {
              withScrollDown: renderingIsScrollDownShown,
              canPost: renderingCanPost,
              withExtraShift: withExtraShift
            }), renderingCanPost && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_common_Composer__WEBPACK_IMPORTED_MODULE_30__["default"], {
              type: "messageList",
              chatId: renderingChatId,
              threadId: renderingThreadId,
              messageListType: renderingMessageListType,
              dropAreaState: dropAreaState,
              onDropHide: handleHideDropArea,
              isReady: isReady,
              isMobile: isMobile,
              editableInputId: _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_ID,
              editableInputCssSelector: _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_CSS_SELECTOR,
              inputId: "message-input-text"
            }), isPinnedMessageList && canUnpin && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                color: "secondary",
                className: "composer-button unpin-all-button",
                onClick: handleOpenUnpinModal,
                iconName: "unpin",
                children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("span", {
                  children: oldLang('Chat.Pinned.UnpinAll', pinnedMessagesCount, 'i')
                })
              })
            }), canShowOpenChatButton && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                color: "secondary",
                className: "composer-button open-chat-button",
                onClick: handleOpenChatFromSaved,
                children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("span", {
                  children: oldLang('SavedOpenChat')
                })
              })
            }), isMessagingDisabled && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: messagingDisabledClassName,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
                className: "messaging-disabled-inner",
                children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("span", {
                  children: composerRestrictionMessage
                })
              })
            }), isMobile && (renderingCanSubscribe || renderingShouldJoinToSend && !renderingShouldSendJoinRequest) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                ripple: true,
                className: "composer-button join-subscribe-button",
                onClick: handleSubscribeClick,
                children: oldLang(renderingIsChannel ? 'ProfileJoinChannel' : 'ProfileJoinGroup')
              })
            }), isMobile && renderingShouldSendJoinRequest && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                ripple: true,
                className: "composer-button join-subscribe-button",
                onClick: handleSubscribeClick,
                children: oldLang('ChannelJoinRequest')
              })
            }), isMobile && renderingCanStartBot && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                ripple: true,
                className: "composer-button join-subscribe-button",
                onClick: handleStartBot,
                children: oldLang('BotStart')
              })
            }), isMobile && renderingCanRestartBot && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                ripple: true,
                className: "composer-button join-subscribe-button",
                onClick: handleRestartBot,
                children: oldLang('BotRestart')
              })
            }), isMobile && renderingCanUnblock && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
              className: "middle-column-footer-button-container",
              dir: lang.isRtl ? 'rtl' : undefined,
              children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_34__["default"], {
                size: "tiny",
                fluid: true,
                ripple: true,
                className: "composer-button join-subscribe-button",
                onClick: handleUnblock,
                children: oldLang('Unblock')
              })
            }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_MessageSelectToolbar_async__WEBPACK_IMPORTED_MODULE_42__["default"], {
              messageListType: renderingMessageListType,
              isActive: isSelectModeActive,
              canPost: renderingCanPost
            }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_common_SeenByModal_async__WEBPACK_IMPORTED_MODULE_32__["default"], {
              isOpen: isSeenByModalOpen
            }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_common_PrivacySettingsNoticeModal_async__WEBPACK_IMPORTED_MODULE_31__["default"], {
              isOpen: isPrivacySettingsNoticeModalOpen
            }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ReactorListModal_async__WEBPACK_IMPORTED_MODULE_46__["default"], {
              isOpen: isReactorListModalOpen
            }), _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_TRANSLATION_SUPPORTED && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_ChatLanguageModal_async__WEBPACK_IMPORTED_MODULE_36__["default"], {
              isOpen: isChatLanguageModalOpen
            })]
          })]
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_search_MiddleSearch_async__WEBPACK_IMPORTED_MODULE_47__["default"], {
        isActive: Boolean(hasActiveMiddleSearch)
      })]
    }), chatId && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_common_UnpinAllMessagesModal_async__WEBPACK_IMPORTED_MODULE_33__["default"], {
      isOpen: isUnpinModalOpen,
      chatId: chatId,
      pinnedMessagesCount: pinnedMessagesCount,
      onClose: closeUnpinModal,
      onUnpin: handleUnpinAllMessages
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)("div", {
      teactFastList: true,
      children: activeEmojiInteractions?.map((activeEmojiInteraction, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_50__.jsx)(_EmojiInteractionAnimation_async__WEBPACK_IMPORTED_MODULE_38__["default"], {
        teactOrderKey: i,
        activeEmojiInteraction: activeEmojiInteraction
      }, activeEmojiInteraction.id))
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isMobile
}) => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global);
  const {
    isBlurred: isBackgroundBlurred,
    background: customBackground,
    backgroundColor,
    patternColor
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThemeValues)(global, theme) || {};
  const {
    messageLists,
    isLeftColumnShown,
    activeEmojiInteractions,
    seenByModal,
    reactorModal,
    shouldSkipHistoryAnimations,
    chatLanguageModal,
    privacySettingsNoticeModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global);
  const {
    leftColumnWidth
  } = global;
  const state = {
    theme,
    customBackground,
    backgroundColor,
    patternColor,
    actionMessageBg: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectActionMessageBg)(global),
    isLeftColumnShown,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isBackgroundBlurred,
    hasActiveMiddleSearch: Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMiddleSearch)(global)),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsInSelectMode)(global),
    isSeenByModalOpen: Boolean(seenByModal),
    isPrivacySettingsNoticeModalOpen: Boolean(privacySettingsNoticeModal),
    isReactorListModalOpen: Boolean(reactorModal),
    isChatLanguageModalOpen: Boolean(chatLanguageModal),
    animationLevel: (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__.selectSharedSettings)(global).animationLevel,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global),
    withRightColumnAnimation: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateRightColumn)(global),
    currentTransitionKey: Math.max(0, messageLists.length - 1),
    activeEmojiInteractions,
    leftColumnWidth
  };
  if (!currentMessageList) {
    return state;
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  const isPrivate = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_13__.isUserId)(chatId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const bot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectBot)(global, chatId);
  const pinnedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPinnedIds)(global, chatId, threadId);
  const chatFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId) : undefined;
  const userFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserFullInfo)(global, chatId) : undefined;
  const editingId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectEditingId)(global, chatId, threadId);
  const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadInfo)(global, chatId, threadId);
  const isMessageThread = Boolean(!threadInfo?.isCommentsInfo && threadInfo?.fromChannelId);
  const topic = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopic)(global, chatId, threadId);
  const canPost = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanPostInChat)(chat, topic, isMessageThread, chatFullInfo);
  const isBotNotStarted = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatBotNotStarted)(global, chatId);
  const isPinnedMessageList = messageListType === 'pinned';
  const isMainThread = messageListType === 'thread' && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID;
  const isChannel = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat));
  const canSubscribe = Boolean(chat && isMainThread && (isChannel || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatSuperGroup)(chat)) && chat.isNotJoined && !chat.joinRequests && !chat.isMonoforum);
  const shouldJoinToSend = Boolean(chat?.isNotJoined && chat.isJoinToSend);
  const shouldSendJoinRequest = Boolean(chat?.isNotJoined && chat.isJoinRequest);
  const isUserBlocked = isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsUserBlocked)(global, chatId) : false;
  const canRestartBot = Boolean(bot && isUserBlocked);
  const canStartBot = !canRestartBot && isBotNotStarted;
  const canUnblock = isUserBlocked && !bot;
  const shouldLoadFullChat = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat) && !chatFullInfo);
  const draftReplyInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const shouldBlockSendInForum = chat?.isForum ? threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !draftReplyInfo && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopic)(global, chatId, _config__WEBPACK_IMPORTED_MODULE_3__.GENERAL_TOPIC_ID)?.isClosed : false;
  const isMonoforumAdmin = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsMonoforumAdmin)(global, chatId);
  const shouldBlockSendInMonoforum = Boolean(chat?.isMonoforum && !draftReplyInfo && isMonoforumAdmin && !editingId);
  const topics = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopics)(global, chatId);
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const canShowOpenChatButton = isSavedDialog && threadId !== _config__WEBPACK_IMPORTED_MODULE_3__.ANONYMOUS_USER_ID;
  const canUnpin = chat && (isPrivate || chat?.isCreator || !isChannel && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserRightBanned)(chat, 'pinMessages') || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'pinMessages'));
  const userFull = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserFullInfo)(global, chatId);
  const isContactRequirePremium = userFull?.isContactRequirePremium;
  const paidMessagesStars = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeerPaidMessagesStars)(global, chatId);
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsCurrentUserFrozen)(global);
  const botFreezeAppealId = global.botFreezeAppealId;
  const freezeAppealChat = botFreezeAppealId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, botFreezeAppealId) : undefined;
  return {
    ...state,
    chatId,
    threadId,
    messageListType,
    chat,
    draftReplyInfo,
    isPrivate,
    arePeerSettingsLoaded: Boolean(userFullInfo?.settings),
    isComments: isMessageThread,
    canPost: !isPinnedMessageList && (!chat || canPost) && !isBotNotStarted && !(shouldJoinToSend && chat?.isNotJoined) && !shouldBlockSendInForum && !shouldBlockSendInMonoforum && !isSavedDialog && (!isAccountFrozen || freezeAppealChat?.id === chatId),
    isPinnedMessageList,
    currentUserBannedRights: chat?.currentUserBannedRights,
    defaultBannedRights: chat?.defaultBannedRights,
    pinnedMessagesCount: pinnedIds ? pinnedIds.length : 0,
    shouldSkipHistoryAnimations,
    isChannel,
    canSubscribe,
    canStartBot,
    canRestartBot,
    shouldJoinToSend,
    shouldSendJoinRequest,
    shouldLoadFullChat,
    pinnedIds,
    canUnpin,
    canUnblock,
    isSavedDialog,
    canShowOpenChatButton,
    isContactRequirePremium,
    topics,
    paidMessagesStars,
    isAccountFrozen,
    freezeAppealChat,
    shouldBlockSendInMonoforum
  };
})(MiddleColumn)));
function useIsReady(withAnimations, currentTransitionKey, prevTransitionKey, chatId, isMobile) {
  const [isReady, setIsReady] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isMobile);
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const willSwitchMessageList = prevTransitionKey !== undefined && prevTransitionKey !== currentTransitionKey;
  if (willSwitchMessageList) {
    if (withAnimations) {
      setIsReady(false);

      // Make sure to end even if end callback was not called (which was some hardly-reproducible bug)
      setTimeout(() => {
        setIsReady(true);
      }, LAYER_ANIMATION_DURATION_MS);
    } else {
      forceUpdate();
    }
  }
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    if (!withAnimations) {
      setIsReady(true);
    }
  }, [withAnimations]);
  function handleCssTransitionEnd(e) {
    if (e.propertyName === 'transform' && e.target === e.currentTarget) {
      setIsReady(Boolean(chatId));
    }
  }
  function handleSlideTransitionStop() {
    setIsReady(true);
  }
  return {
    isReady: isReady && !willSwitchMessageList,
    handleCssTransitionEnd: withAnimations ? handleCssTransitionEnd : undefined,
    handleSlideTransitionStop: withAnimations ? handleSlideTransitionStop : undefined
  };
}

/***/ }),

/***/ "./src/components/middle/MiddleHeader.scss":
/*!*************************************************!*\
  !*** ./src/components/middle/MiddleHeader.scss ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/MiddleHeader.tsx":
/*!************************************************!*\
  !*** ./src/components/middle/MiddleHeader.tsx ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLongPress__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useLongPress */ "./src/hooks/useLongPress.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _common_UnreadCounter__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../common/UnreadCounter */ "./src/components/common/UnreadCounter.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _HeaderActions__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./HeaderActions */ "./src/components/middle/HeaderActions.tsx");
/* harmony import */ var _panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./panes/AudioPlayer */ "./src/components/middle/panes/AudioPlayer.tsx");
/* harmony import */ var _panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./panes/HeaderPinnedMessage */ "./src/components/middle/panes/HeaderPinnedMessage.tsx");
/* harmony import */ var _MiddleHeader_scss__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./MiddleHeader.scss */ "./src/components/middle/MiddleHeader.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




























const BACK_BUTTON_INACTIVE_TIME = 450;
const EMOJI_STATUS_SIZE = 22;
const SEARCH_LONGTAP_THRESHOLD = 500;
const MiddleHeader = ({
  chatId,
  threadId,
  messageListType,
  isMobile,
  typingStatus,
  isSelectModeActive,
  isLeftColumnShown,
  audioMessage,
  chat,
  messagesCount,
  isComments,
  isChatWithSelf,
  shouldSkipHistoryAnimations,
  currentTransitionKey,
  connectionState,
  isSyncing,
  isFetchingDifference,
  getCurrentPinnedIndex,
  getLoadingPinnedId,
  emojiStatusSticker,
  emojiStatusSlug,
  isSavedDialog,
  onFocusPinnedMessage
}) => {
  const {
    openThreadWithInfo,
    openChat,
    openPreviousChat,
    toggleLeftColumn,
    exitMessageSelectMode,
    openPremiumModal,
    openStickerSet,
    updateMiddleSearch,
    openUniqueGiftBySlug
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const isBackButtonActive = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const {
    isDesktop,
    isTablet
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const isLeftColumnHideable = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_4__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN;
  const shouldShowCloseButton = isTablet && isLeftColumnShown;
  const componentRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const handleOpenSearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    updateMiddleSearch({
      chatId,
      threadId,
      update: {}
    });
  });
  const handleOpenChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(event => {
    if (event.target.closest('.title > .custom-emoji')) return;

    // Force close My Profile if clicked on Saved Messages header
    openThreadWithInfo({
      chatId,
      threadId,
      isOwnProfile: false
    });
  });
  const {
    onMouseDown: handleLongPressMouseDown,
    onMouseUp: handleLongPressMouseUp,
    onMouseLeave: handleLongPressMouseLeave,
    onTouchStart: handleLongPressTouchStart,
    onTouchEnd: handleLongPressTouchEnd
  } = (0,_hooks_useLongPress__WEBPACK_IMPORTED_MODULE_14__["default"])({
    onStart: handleOpenSearch,
    onClick: handleOpenChat,
    threshold: SEARCH_LONGTAP_THRESHOLD
  });
  const setBackButtonActive = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    setTimeout(() => {
      isBackButtonActive.current = true;
    }, BACK_BUTTON_INACTIVE_TIME);
  });
  const handleUserStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (emojiStatusSlug) {
      openUniqueGiftBySlug({
        slug: emojiStatusSlug
      });
      return;
    }
    openPremiumModal({
      fromUserId: chatId
    });
  });
  const handleChannelStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (emojiStatusSlug) {
      openUniqueGiftBySlug({
        slug: emojiStatusSlug
      });
      return;
    }
    openStickerSet({
      stickerSetInfo: emojiStatusSticker.stickerSetInfo
    });
  });
  const handleBackClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    if (!isBackButtonActive.current) return;

    // Workaround for missing UI when quickly clicking the Back button
    isBackButtonActive.current = false;
    if (isMobile) {
      const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_4__.EDITABLE_INPUT_CSS_SELECTOR);
      messageInput?.blur();
    }
    if (isSelectModeActive) {
      exitMessageSelectMode();
      setBackButtonActive();
      return;
    }
    if (messageListType === 'thread' && currentTransitionKey === 0) {
      if (!isTablet || shouldShowCloseButton) {
        e.stopPropagation(); // Stop propagation to prevent chat re-opening on tablets
        openChat({
          id: undefined
        }, {
          forceOnHeavyAnimation: true
        });
      } else {
        toggleLeftColumn();
      }
      setBackButtonActive();
      return;
    }
    openPreviousChat();
    setBackButtonActive();
  });
  const prevTransitionKey = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__["default"])(currentTransitionKey);
  const cleanupExceptionKey = prevTransitionKey !== undefined && prevTransitionKey < currentTransitionKey ? prevTransitionKey : undefined;
  const isAudioPlayerActive = Boolean(audioMessage);
  const isAudioPlayerRendering = isDesktop && isAudioPlayerActive;
  const isPinnedMessagesFullWidth = isAudioPlayerActive || !isDesktop;
  const {
    connectionStatusText
  } = (0,_hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_12__["default"])(lang, connectionState, isSyncing || isFetchingDifference, true);
  function renderInfo() {
    if (messageListType === 'thread') {
      if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || isSavedDialog || chat?.isForum) {
        return renderChatInfo();
      }
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
      children: [renderBackButton(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
        children: messagesCount !== undefined ? messageListType === 'thread' ? messagesCount ? lang(isComments ? 'Comments' : 'Replies', messagesCount, 'i') : lang(isComments ? 'CommentsTitle' : 'RepliesTitle') : messageListType === 'pinned' ? lang('PinnedMessagesCount', messagesCount, 'i') : messageListType === 'scheduled' ? isChatWithSelf ? lang('Reminders') : lang('messages', messagesCount, 'i') : undefined : lang('Loading')
      })]
    });
  }
  function renderChatInfo() {
    // TODO Implement count
    const savedMessagesStatus = isSavedDialog ? lang('SavedMessages') : undefined;
    const realChatId = isSavedDialog ? String(threadId) : chatId;
    const displayChatId = chat?.isMonoforum ? chat.linkedMonoforumId : realChatId;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
      children: [(isLeftColumnHideable || currentTransitionKey > 0) && renderBackButton(shouldShowCloseButton, !isSavedDialog), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
        className: "chat-info-wrapper",
        onMouseDown: handleLongPressMouseDown,
        onMouseUp: handleLongPressMouseUp,
        onMouseLeave: handleLongPressMouseLeave,
        onTouchStart: handleLongPressTouchStart,
        onTouchEnd: handleLongPressTouchEnd,
        children: (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_10__.isUserId)(displayChatId) ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_19__["default"], {
          userId: displayChatId,
          threadId: !isSavedDialog ? threadId : undefined,
          typingStatus: typingStatus,
          status: connectionStatusText || savedMessagesStatus,
          withDots: Boolean(connectionStatusText),
          withFullInfo: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
          withMediaViewer: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
          withStory: !isChatWithSelf,
          withUpdatingStatus: true,
          isSavedDialog: isSavedDialog,
          storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.MiddleHeaderAvatar,
          emojiStatusSize: EMOJI_STATUS_SIZE,
          noRtl: true,
          onEmojiStatusClick: handleUserStatusClick
        }, displayChatId) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_18__["default"], {
          chatId: displayChatId,
          threadId: !isSavedDialog ? threadId : undefined,
          typingStatus: typingStatus,
          withMonoforumStatus: chat?.isMonoforum,
          status: connectionStatusText || savedMessagesStatus,
          withDots: Boolean(connectionStatusText),
          withMediaViewer: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
          withFullInfo: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
          withUpdatingStatus: true,
          withStory: true,
          isSavedDialog: isSavedDialog,
          storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.MiddleHeaderAvatar,
          emojiStatusSize: EMOJI_STATUS_SIZE,
          onEmojiStatusClick: handleChannelStatusClick,
          noRtl: true
        }, displayChatId)
      })]
    });
  }
  function renderBackButton(asClose = false, withUnreadCounter = false) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
      className: "back-button",
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
        round: true,
        size: "smaller",
        color: "translucent",
        onClick: handleBackClick,
        ariaLabel: lang(asClose ? 'Close' : 'Back'),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('animated-close-icon', !asClose && 'state-back')
        })
      }), withUnreadCounter && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_UnreadCounter__WEBPACK_IMPORTED_MODULE_20__["default"], {})]
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
    className: "MiddleHeader",
    ref: componentRef,
    "data-tauri-drag-region": _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_TAURI && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_MAC_OS ? true : undefined,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_22__["default"], {
      name: shouldSkipHistoryAnimations ? 'none' : 'slideFade',
      activeKey: currentTransitionKey,
      shouldCleanup: true,
      cleanupExceptionKey: cleanupExceptionKey,
      children: renderInfo()
    }), !isPinnedMessagesFullWidth && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_25__["default"], {
      chatId: chatId,
      threadId: threadId,
      messageListType: messageListType,
      onFocusPinnedMessage: onFocusPinnedMessage,
      getLoadingPinnedId: getLoadingPinnedId,
      getCurrentPinnedIndex: getCurrentPinnedIndex
    }, chatId), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
      className: "header-tools",
      children: [isAudioPlayerRendering && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_24__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_HeaderActions__WEBPACK_IMPORTED_MODULE_23__["default"], {
        chatId: chatId,
        threadId: threadId,
        messageListType: messageListType,
        isMobile: isMobile,
        canExpandActions: !isAudioPlayerRendering
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  messageListType,
  isMobile
}) => {
  const {
    isLeftColumnShown,
    shouldSkipHistoryAnimations,
    audioPlayer,
    messageLists
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, chatId);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  let messagesCount;
  if (messageListType === 'pinned') {
    const pinnedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPinnedIds)(global, chatId, threadId);
    messagesCount = pinnedIds?.length;
  } else if (messageListType === 'scheduled') {
    const scheduledIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectScheduledIds)(global, chatId, threadId);
    messagesCount = scheduledIds?.length;
  } else if (messageListType === 'thread' && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID) {
    const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadInfo)(global, chatId, threadId);
    messagesCount = threadInfo?.messagesCount || 0;
  }
  const typingStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadParam)(global, chatId, threadId, 'typingStatus');
  const emojiStatus = peer?.emojiStatus;
  const emojiStatusSticker = emojiStatus && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCustomEmoji)(global, emojiStatus.documentId);
  const emojiStatusSlug = emojiStatus?.type === 'collectible' ? emojiStatus.slug : undefined;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  return {
    typingStatus,
    isLeftColumnShown,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsInSelectMode)(global),
    audioMessage,
    chat,
    messagesCount,
    isChatWithSelf: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatWithSelf)(global, chatId),
    shouldSkipHistoryAnimations,
    currentTransitionKey: Math.max(0, messageLists.length - 1),
    connectionState: global.connectionState,
    isSyncing: global.isSyncing,
    isFetchingDifference: global.isFetchingDifference,
    emojiStatusSticker,
    emojiStatusSlug,
    isSavedDialog
  };
})(MiddleHeader)));

/***/ }),

/***/ "./src/components/middle/MiddleHeaderPanes.module.scss":
/*!*************************************************************!*\
  !*** ./src/components/middle/MiddleHeaderPanes.module.scss ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"oCUr3DTX","root_withRightColumnAnimation":"YPrc0luK","rootWithRightColumnAnimation":"YPrc0luK"});

/***/ }),

/***/ "./src/components/middle/MiddleHeaderPanes.tsx":
/*!*****************************************************!*\
  !*** ./src/components/middle/MiddleHeaderPanes.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useEffectOnce */ "./src/hooks/useEffectOnce.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useSignalEffect */ "./src/hooks/useSignalEffect.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../calls/group/GroupCallTopPane */ "./src/components/calls/group/GroupCallTopPane.tsx");
/* harmony import */ var _panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./panes/AudioPlayer */ "./src/components/middle/panes/AudioPlayer.tsx");
/* harmony import */ var _panes_BotAdPane__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./panes/BotAdPane */ "./src/components/middle/panes/BotAdPane.tsx");
/* harmony import */ var _panes_BotVerificationPane__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./panes/BotVerificationPane */ "./src/components/middle/panes/BotVerificationPane.tsx");
/* harmony import */ var _panes_ChatReportPane__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./panes/ChatReportPane */ "./src/components/middle/panes/ChatReportPane.tsx");
/* harmony import */ var _panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./panes/HeaderPinnedMessage */ "./src/components/middle/panes/HeaderPinnedMessage.tsx");
/* harmony import */ var _panes_PaidMessageChargePane__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./panes/PaidMessageChargePane */ "./src/components/middle/panes/PaidMessageChargePane.tsx");
/* harmony import */ var _MiddleHeaderPanes_module_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./MiddleHeaderPanes.module.scss */ "./src/components/middle/MiddleHeaderPanes.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




















const FALLBACK_PANE_STATE = {
  height: 0
};
const MiddleHeaderPanes = ({
  className,
  chatId,
  threadId,
  messageListType,
  chat,
  userFullInfo,
  getCurrentPinnedIndex,
  getLoadingPinnedId,
  isAudioPlayerRendered,
  isMiddleSearchOpen,
  withRightColumnAnimation,
  onFocusPinnedMessage
}) => {
  const {
    settings
  } = userFullInfo || {};
  const {
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [getAudioPlayerState, setAudioPlayerState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getPinnedState, setPinnedState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getGroupCallState, setGroupCallState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getChatReportState, setChatReportState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getBotAdState, setBotAdState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getBotVerificationState, setBotVerificationState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getPaidMessageChargeState, setPaidMessageChargeState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const isPinnedMessagesFullWidth = isAudioPlayerRendered || !isDesktop;
  const isFirstRenderRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const {
    shouldRender,
    ref
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isOpen: !isMiddleSearchOpen,
    withShouldRender: true,
    noMountTransition: true
  });
  (0,_hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    isFirstRenderRef.current = false;
  });
  (0,_hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__.useSignalEffect)(() => {
    const audioPlayerState = getAudioPlayerState();
    const botVerificationState = getBotVerificationState();
    const pinnedState = getPinnedState();
    const groupCallState = getGroupCallState();
    const chatReportState = getChatReportState();
    const botAdState = getBotAdState();
    const paidMessageState = getPaidMessageChargeState();

    // Keep in sync with the order of the panes in the DOM
    const stateArray = [audioPlayerState, groupCallState, chatReportState, botVerificationState, pinnedState, botAdState, paidMessageState];
    const isFirstRender = isFirstRenderRef.current;
    const totalHeight = stateArray.reduce((acc, state) => acc + state.height, 0);
    const middleColumn = document.getElementById('MiddleColumn');
    if (!middleColumn) return;
    (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__.applyAnimationState)({
      list: stateArray,
      noTransition: isFirstRender
    });
    (0,_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.setExtraStyles)(middleColumn, {
      '--middle-header-panes-height': `${totalHeight}px`
    });
  }, [getAudioPlayerState, getGroupCallState, getPinnedState, getChatReportState, getBotAdState, getBotVerificationState, getPaidMessageChargeState]);
  if (!shouldRender) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_MiddleHeaderPanes_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].root, withRightColumnAnimation && _MiddleHeaderPanes_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].root_withRightColumnAnimation, className),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_12__["default"], {
      isFullWidth: true,
      onPaneStateChange: setAudioPlayerState,
      isHidden: isDesktop
    }), threadId === _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID && !chat?.isForum && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_11__["default"], {
      chatId: chatId,
      onPaneStateChange: setGroupCallState
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_panes_ChatReportPane__WEBPACK_IMPORTED_MODULE_15__["default"], {
      chatId: chatId,
      canAddContact: settings?.canAddContact,
      canBlockContact: settings?.canBlockContact,
      canReportSpam: settings?.canReportSpam,
      isAutoArchived: settings?.isAutoArchived,
      onPaneStateChange: setChatReportState
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_panes_BotVerificationPane__WEBPACK_IMPORTED_MODULE_14__["default"], {
      peerId: chatId,
      onPaneStateChange: setBotVerificationState
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_panes_PaidMessageChargePane__WEBPACK_IMPORTED_MODULE_17__["default"], {
      peerId: chatId,
      onPaneStateChange: setPaidMessageChargeState
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_16__["default"], {
      chatId: chatId,
      threadId: threadId,
      messageListType: messageListType,
      onFocusPinnedMessage: onFocusPinnedMessage,
      getLoadingPinnedId: getLoadingPinnedId,
      getCurrentPinnedIndex: getCurrentPinnedIndex,
      onPaneStateChange: setPinnedState,
      isFullWidth: true,
      shouldHide: !isPinnedMessagesFullWidth
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_panes_BotAdPane__WEBPACK_IMPORTED_MODULE_13__["default"], {
      chatId: chatId,
      messageListType: messageListType,
      onPaneStateChange: setBotAdState
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)((global, {
  chatId
}) => {
  const {
    audioPlayer
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserFullInfo)(global, chatId);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  const isMiddleSearchOpen = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMiddleSearch)(global));
  return {
    chat,
    userFullInfo,
    isAudioPlayerRendered: Boolean(audioMessage),
    isMiddleSearchOpen,
    withRightColumnAnimation: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanAnimateRightColumn)(global)
  };
})(MiddleHeaderPanes)));

/***/ }),

/***/ "./src/components/middle/PinnedMessageNavigation.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/middle/PinnedMessageNavigation.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"pinned-message-border":"L5TQCriM","pinnedMessageBorder":"L5TQCriM","pinned-message-border-wrapper-1":"v5sJGzfS","pinnedMessageBorderWrapper1":"v5sJGzfS","pinned-message-border-wrapper":"p6PQhvds","pinnedMessageBorderWrapper":"p6PQhvds","pinned-message-border-mark":"M2PQZgBd","pinnedMessageBorderMark":"M2PQZgBd"});

/***/ }),

/***/ "./src/components/middle/PinnedMessageNavigation.tsx":
/*!***********************************************************!*\
  !*** ./src/components/middle/PinnedMessageNavigation.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PinnedMessageNavigation.module.scss */ "./src/components/middle/PinnedMessageNavigation.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const BORDER_MASK_LEVEL = 4;
const PinnedMessageNavigation = ({
  count,
  index
}) => {
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const markupParams = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return calculateMarkup(count, index);
  }, [count, index]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!containerRef.current) {
      return;
    }
    const {
      trackHeight,
      trackTranslateY,
      markHeight,
      markTranslateY,
      clipPathId,
      clipPath
    } = markupParams;
    const firstChild = containerRef.current.firstElementChild;
    if (containerRef?.current) {
      const currentElement = containerRef.current;
      const {
        style
      } = currentElement;
      style.height = `${trackHeight}px`;
      style.transform = `translateY(-${trackTranslateY}px)`;
      style.clipPath = `url("#${clipPathId}")`;
      const svg = currentElement.querySelector('svg');
      const div = currentElement.querySelector('div');
      const defs = currentElement.querySelector('defs');
      if (!svg) {
        if (firstChild) {
          firstChild.innerHTML = `<svg height="0" width="0"><defs> ${clipPath} </defs></svg>`;
        }
      }
      if (defs) {
        defs.innerHTML = clipPath;
      }
      if (div) {
        div.style.height = `${markHeight}px`;
        div.style.transform = `translateY(${markTranslateY}px)`;
      }
    }
  }, [markupParams]);
  if (count === 1) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div", {
      className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorder,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div", {
        className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderWrapper1,
        ref: containerRef
      })
    });
  }
  const {
    trackHeight,
    trackTranslateY,
    markHeight,
    markTranslateY,
    clipPathId
  } = markupParams;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorder, count > BORDER_MASK_LEVEL && _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderMask),
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div", {
      className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderWrapper,
      ref: containerRef,
      style: `clip-path: url("#${clipPathId}"); width: 2px;
          height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span", {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div", {
        className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderMark,
        style: `--height: ${markHeight}px; --translate-y: ${markTranslateY}px; ` + `--translate-track: ${trackTranslateY}px;`
      })]
    })
  });
};
function calculateMarkup(count, index) {
  const reverseIndex = count - index - 1;
  const barHeight = getBarHeight(count);
  const markHeight = getMarkHeight(count, reverseIndex);
  const trackHeight = getTrackHeight(count, barHeight);
  const clipPathId = `clipPath${count}`;
  const clipPath = getClipPath(clipPathId, barHeight, count);
  const markTranslateY = getMarkTranslateY(reverseIndex, barHeight, count);
  const trackTranslateY = getTrackTranslateY(reverseIndex, count, barHeight, trackHeight);
  return {
    markHeight,
    clipPath,
    markTranslateY,
    trackTranslateY,
    trackHeight,
    clipPathId
  };
}
function getBarHeight(count) {
  let barHeight = 8;
  if (count === 1) {
    barHeight = 36;
  } else if (count === 2) {
    barHeight = 17;
  } else if (count === 3) {
    barHeight = 11;
  } else if (count === 4) {
    barHeight = 7.5;
  } else if (count > 3) {
    barHeight = 7.5;
  }
  return barHeight;
}
function getMarkHeight(count, index) {
  let barHeight = 36;
  if (count === 1) {
    barHeight = 36;
  } else if (count === 2) {
    barHeight = 17;
  } else if (count === 3) {
    barHeight = index === 1 ? 12 : 11;
  } else if (count === 4) {
    barHeight = 7.5;
  } else if (count > 3) {
    barHeight = 7.5;
  }
  return barHeight;
}
function getTrackHeight(count, barHeight) {
  return count <= 3 ? 36 : barHeight * count + 2 * (count - 1);
}
function getClipPath(id, barHeight, count) {
  const radius = 1;
  let d = '';
  if (count === 3) {
    d = drawRect(0, 0, 2, barHeight, radius) + drawRect(0, 12, 2, barHeight + 1, radius) + drawRect(0, 25, 2, barHeight, radius);
  } else {
    for (let i = 0; i < count; i++) {
      d += drawRect(0, (barHeight + 2) * i, 2, barHeight, radius);
    }
  }
  return `<clipPath id="${id}">
      <path d="${d}" />
    </clipPath>`;
}
function drawRect(x, y, width, height, radius) {
  return `M${x},${y + radius}a${radius},${radius},0,0,1,
  ${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;
}
function getMarkTranslateY(index, barHeight, count) {
  if (count === 1) {
    return 0;
  } else if (count === 2) {
    return index === 0 ? 0 : barHeight + 2;
  }
  if (count === 3) {
    if (index === 0) {
      return 0;
    } else if (index === 1) {
      return 12;
    }
    return 25;
  } else {
    return (barHeight + 2) * index;
  }
}
function getTrackTranslateY(index, count, barHeight, trackHeight) {
  if (count <= 4) {
    return 0;
  }
  if (index <= 1) {
    return 0;
  } else if (index >= count - 2) {
    return trackHeight - 36;
  }
  return (barHeight + 4) / 2 + (index - 2) * (barHeight + 2);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PinnedMessageNavigation));

/***/ }),

/***/ "./src/components/middle/PremiumRequiredPlaceholder.tsx":
/*!**************************************************************!*\
  !*** ./src/components/middle/PremiumRequiredPlaceholder.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");








function PremiumRequiredPlaceholder({
  userName
}) {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    openPremiumModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleOpenPremiumModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => openPremiumModal());
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div", {
      children: lang('Chat.MessagingRestrictedPlaceholder', userName)
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_6__["default"], {
      isPrimary: true,
      onClick: handleOpenPremiumModal,
      children: lang('Chat.MessagingRestrictedPlaceholderAction')
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  userId
}) => {
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  return {
    userName: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user)
  };
})(PremiumRequiredPlaceholder)));

/***/ }),

/***/ "./src/components/middle/ReactorListModal.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/middle/ReactorListModal.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ReactorListModalAsync = props => {
  const {
    isOpen
  } = props;
  const ReactorListModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ReactorListModal', !isOpen);
  return ReactorListModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ReactorListModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReactorListModalAsync);

/***/ }),

/***/ "./src/components/middle/ScrollDownButton.module.scss":
/*!************************************************************!*\
  !*** ./src/components/middle/ScrollDownButton.module.scss ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Y2NKrpKj","button":"cxwA6gDO","icon":"F4zNUFhH","unread-count":"GovSzpfQ","unreadCount":"GovSzpfQ"});

/***/ }),

/***/ "./src/components/middle/ScrollDownButton.tsx":
/*!****************************************************!*\
  !*** ./src/components/middle/ScrollDownButton.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ScrollDownButton.module.scss */ "./src/components/middle/ScrollDownButton.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const ScrollDownButton = ({
  icon,
  ariaLabelLang,
  unreadCount,
  onClick,
  onReadAll,
  className
}) => {
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, !onReadAll);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root, className),
    ref: ref,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_6__["default"], {
      color: "secondary",
      round: true,
      className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].button,
      onClick: onClick,
      onContextMenu: handleContextMenu,
      ariaLabel: oldLang(ariaLabelLang),
      iconName: icon,
      iconClassName: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].icon
    }), Boolean(unreadCount) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div", {
      className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].unreadCount,
      children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_2__.formatIntegerCompact)(lang, unreadCount)
    }), onReadAll && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_7__["default"], {
      isOpen: isContextMenuOpen,
      onClose: handleContextMenuClose,
      onCloseAnimationEnd: handleContextMenuHide,
      autoClose: true,
      positionX: "right",
      positionY: "bottom",
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_8__["default"], {
        icon: "readchats",
        onClick: onReadAll,
        children: oldLang('MarkAllAsRead')
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ScrollDownButton));

/***/ }),

/***/ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts":
/*!**************************************************************************!*\
  !*** ./src/components/middle/helpers/calculateMiddleFooterTransforms.ts ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MIN_LEFT_COLUMN_WIDTH: () => (/* binding */ MIN_LEFT_COLUMN_WIDTH),
/* harmony export */   SIDE_COLUMN_MAX_WIDTH: () => (/* binding */ SIDE_COLUMN_MAX_WIDTH),
/* harmony export */   "default": () => (/* binding */ calculateMiddleFooterTransforms)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");


const MAX_TOOLBAR_WIDTH = 32 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const MAX_MESSAGES_LIST_WIDTH = 45.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const SIDE_COLUMN_MAX_WIDTH = 26.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const MIN_LEFT_COLUMN_WIDTH = 16 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const UNPIN_BUTTON_WIDTH = 16.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
function calculateMiddleFooterTransforms(windowWidth, canPost) {
  const sidePadding = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM : 2 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
  const messageListWidth = getMessageListWidth(windowWidth);
  const sendButtonWidth = 3 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
  const composerWidth = canPost ? messageListWidth - sidePadding - sendButtonWidth : messageListWidth - sidePadding;
  const toolbarWidth = windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? Math.min(messageListWidth - sidePadding, MAX_TOOLBAR_WIDTH) : messageListWidth - sidePadding;
  const composerHiddenScale = toolbarWidth / composerWidth;
  const toolbarHiddenScale = composerWidth / toolbarWidth;
  const unpinHiddenScale = toolbarWidth / UNPIN_BUTTON_WIDTH;
  const toolbarForUnpinHiddenScale = UNPIN_BUTTON_WIDTH / toolbarWidth;
  const composerTranslateX = canPost ? sendButtonWidth / 2 * toolbarHiddenScale : 0;
  const toolbarTranslateX = canPost ? sendButtonWidth / 2 * -1 * composerHiddenScale : 0;
  return {
    composerHiddenScale,
    toolbarHiddenScale,
    composerTranslateX,
    toolbarTranslateX,
    unpinHiddenScale,
    toolbarForUnpinHiddenScale
  };
}
function getMessageListWidth(windowWidth) {
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN) {
    const leftColumnWidth = Math.min(Math.max(windowWidth * 0.25, MIN_LEFT_COLUMN_WIDTH), SIDE_COLUMN_MAX_WIDTH);
    const rightColumnWidth = Math.min(windowWidth * 0.25, SIDE_COLUMN_MAX_WIDTH);
    return Math.min(windowWidth - leftColumnWidth - rightColumnWidth, MAX_MESSAGES_LIST_WIDTH);
  }
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN) {
    const leftColumnWidth = Math.min(Math.max(windowWidth * 0.4, MIN_LEFT_COLUMN_WIDTH), SIDE_COLUMN_MAX_WIDTH);
    return Math.min(windowWidth - leftColumnWidth, MAX_MESSAGES_LIST_WIDTH);
  }
  if (windowWidth > MAX_MESSAGES_LIST_WIDTH) {
    return MAX_MESSAGES_LIST_WIDTH;
  }
  return windowWidth;
}

/***/ }),

/***/ "./src/components/middle/hooks/usePinnedMessage.ts":
/*!*********************************************************!*\
  !*** ./src/components/middle/hooks/usePinnedMessage.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePinnedMessage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");







let viewportPinnedIds;
let lastFocusedId;
function usePinnedMessage(chatId, threadId, pinnedIds) {
  const [getPinnedIndexByKey, setPinnedIndexByKey] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)({});
  const [getLoadingPinnedId, setLoadingPinnedId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();
  const key = chatId ? `${chatId}_${threadId}` : undefined;
  const getCurrentPinnedIndex = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_5__["default"])(() => getPinnedIndexByKey()[key] ?? 0, [getPinnedIndexByKey, key]);

  // Reset when switching chat
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    viewportPinnedIds = undefined;
    setLoadingPinnedId(undefined);
  }, [chatId, setPinnedIndexByKey, setLoadingPinnedId, threadId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!key) return;
    const currentPinnedIndex = getPinnedIndexByKey()[key];
    const pinnedLength = pinnedIds?.length || 0;
    if (currentPinnedIndex >= pinnedLength) {
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(pinnedLength - 1)
      });
    }
  }, [getPinnedIndexByKey, key, pinnedIds?.length, setPinnedIndexByKey]);
  const handleIntersectPinnedMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(({
    viewportPinnedIdsToAdd = [],
    viewportPinnedIdsToRemove = [],
    shouldCancelWaiting
  }) => {
    if (!chatId || !threadId || !key || !pinnedIds?.length) return;
    if (shouldCancelWaiting) {
      lastFocusedId = undefined;
      setLoadingPinnedId(undefined);
      return;
    }
    const loadingPinnedId = getLoadingPinnedId();
    if (loadingPinnedId) {
      const newPinnedIndex = pinnedIds.indexOf(loadingPinnedId);
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(newPinnedIndex)
      });
      setLoadingPinnedId(undefined);
    }
    viewportPinnedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)((viewportPinnedIds?.filter(id => !viewportPinnedIdsToRemove.includes(id)) ?? []).concat(viewportPinnedIdsToAdd));

    // Sometimes this callback is called after focus has been reset in global, so we leverage `lastFocusedId`
    const focusedMessageId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectFocusedMessageId)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), chatId) || lastFocusedId;
    if (lastFocusedId && viewportPinnedIds.includes(lastFocusedId)) {
      lastFocusedId = undefined;
    }
    if (focusedMessageId) {
      const pinnedIndexAboveFocused = pinnedIds.findIndex(id => id < focusedMessageId);
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(pinnedIndexAboveFocused)
      });
    } else if (viewportPinnedIds.length) {
      const maxViewportPinnedId = Math.max(...viewportPinnedIds);
      const newIndex = pinnedIds.indexOf(maxViewportPinnedId);
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(newIndex)
      });
    }
  });
  const handleFocusPinnedMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(messageId => {
    // Focusing on a post in comments
    if (!chatId || !threadId || !pinnedIds?.length) {
      return;
    }
    lastFocusedId = messageId;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const listedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectListedIds)(global, chatId, threadId);
    const isMessageLoaded = listedIds?.includes(messageId) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectOutlyingListByMessageId)(global, chatId, threadId, messageId);
    const currentIndex = pinnedIds.indexOf(messageId);
    const newIndex = (0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_3__["default"])(pinnedIds.length, currentIndex + 1);
    if (isMessageLoaded) {
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: newIndex
      });
    } else {
      setLoadingPinnedId(pinnedIds[newIndex]);
    }
  });
  return {
    handleIntersectPinnedMessage,
    handleFocusPinnedMessage,
    getCurrentPinnedIndex,
    getLoadingPinnedId
  };
}
function clampIndex(id) {
  return Math.max(0, id);
}

/***/ }),

/***/ "./src/components/middle/message/reactions/ReactionPicker.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/middle/message/reactions/ReactionPicker.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ReactionPickerAsync = props => {
  const {
    isOpen
  } = props;
  const ReactionPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ReactionPicker', !isOpen);
  return ReactionPicker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ReactionPicker, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReactionPickerAsync);

/***/ }),

/***/ "./src/components/middle/panes/AudioPlayer.scss":
/*!******************************************************!*\
  !*** ./src/components/middle/panes/AudioPlayer.scss ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/panes/AudioPlayer.tsx":
/*!*****************************************************!*\
  !*** ./src/components/middle/panes/AudioPlayer.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _util_audioPlayer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/audioPlayer */ "./src/util/audioPlayer.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useAudioPlayer */ "./src/hooks/useAudioPlayer.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMessageMediaMetadata__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useMessageMediaMetadata */ "./src/hooks/useMessageMediaMetadata.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_RangeSlider__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../ui/RangeSlider */ "./src/components/ui/RangeSlider.tsx");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _AudioPlayer_scss__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./AudioPlayer.scss */ "./src/components/middle/panes/AudioPlayer.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");































const PLAYBACK_RATES = {
  0.5: 0.66,
  0.75: 0.8,
  1: 1,
  1.5: 1.4,
  2: 1.8
};
const PLAYBACK_RATE_VALUES = Object.keys(PLAYBACK_RATES).sort().map(Number);
const REGULAR_PLAYBACK_RATE = 1;
const DEFAULT_FAST_PLAYBACK_RATE = 2;
const AudioPlayer = ({
  message,
  mediaDuration,
  className,
  noUi,
  sender,
  chat,
  volume,
  playbackRate,
  isPlaybackRateActive,
  isMuted,
  isFullWidth,
  timestamp,
  onPaneStateChange
}) => {
  const {
    setAudioPlayerVolume,
    setAudioPlayerPlaybackRate,
    setAudioPlayerMuted,
    focusMessage,
    closeAudioPlayer
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_20__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const renderingMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_16__["default"])(message);
  const {
    audio,
    voice,
    video
  } = renderingMessage ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageContent)(renderingMessage) : {};
  const isVoice = Boolean(voice || video);
  const shouldRenderPlaybackButton = isVoice || (audio?.duration || 0) > _config__WEBPACK_IMPORTED_MODULE_2__.PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION;
  const senderName = sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, sender) : undefined;
  const playableMedia = voice || video || audio;
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_12__["default"])(renderingMessage, 'inline');
  const mediaFormat = playableMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaFormat)(playableMedia, 'inline');
  const mediaData = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_18__["default"])(mediaHash, false, mediaFormat);
  const mediaMetadata = (0,_hooks_useMessageMediaMetadata__WEBPACK_IMPORTED_MODULE_19__["default"])(renderingMessage, sender, chat);
  const {
    playPause,
    stop,
    isPlaying,
    requestNextTrack,
    requestPreviousTrack,
    isFirst,
    isLast,
    setVolume,
    toggleMuted,
    setPlaybackRate,
    setCurrentTime
  } = (0,_hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_14__["default"])(message && (0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_7__.makeTrackId)(message), mediaDuration || 0, isVoice ? 'voice' : 'audio', mediaData, undefined, mediaMetadata, undefined, true, undefined, undefined, message && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isMessageLocal)(message), true);
  const isOpen = Boolean(message);
  const {
    ref: transitionRef
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__["default"])({
    isOpen,
    shouldForceOpen: isFullWidth // Use pane animation instead
  });
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_22__["default"])({
    isOpen,
    isDisabled: !isFullWidth,
    ref: transitionRef,
    onStateChange: onPaneStateChange
  });
  const {
    isContextMenuOpen,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_15__["default"])(transitionRef, !shouldRender);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (timestamp) {
      setCurrentTime(timestamp);
    }
  }, [timestamp, setCurrentTime]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPlaying && message?.isDeleting) {
      playPause();
    }
  }, [isPlaying, message?.isDeleting, playPause]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    const {
      chatId,
      id
    } = renderingMessage;
    focusMessage({
      chatId,
      messageId: id
    });
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!stop) {
      return;
    }
    if (isPlaying) {
      playPause();
    }
    closeAudioPlayer();
    (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_10__.clearMediaSession)();
    stop();
  });
  const handleVolumeChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(value => {
    if (!setVolume) {
      return;
    }
    setAudioPlayerVolume({
      volume: value / 100
    });
    setVolume(value / 100);
  });
  const handleVolumeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_TOUCH_ENV && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_IOS) return;
    if (!toggleMuted) {
      return;
    }
    toggleMuted();
    setAudioPlayerMuted({
      isMuted: !isMuted
    });
  });
  const updatePlaybackRate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])((newRate, isActive = true) => {
    if (!setPlaybackRate) {
      return;
    }
    const rate = PLAYBACK_RATES[newRate];
    const shouldBeActive = newRate !== REGULAR_PLAYBACK_RATE && isActive;
    setAudioPlayerPlaybackRate({
      playbackRate: rate,
      isPlaybackRateActive: shouldBeActive
    });
    setPlaybackRate(shouldBeActive ? rate : REGULAR_PLAYBACK_RATE);
  });
  const handlePlaybackClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    handleContextMenuClose();
    const oldRate = Number(Object.entries(PLAYBACK_RATES).find(([, rate]) => rate === playbackRate)?.[0]) || REGULAR_PLAYBACK_RATE;
    const newIsActive = !isPlaybackRateActive;
    updatePlaybackRate(newIsActive && oldRate === REGULAR_PLAYBACK_RATE ? DEFAULT_FAST_PLAYBACK_RATE : oldRate, newIsActive);
  });
  const PlaybackRateButton = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    const displayRate = Object.entries(PLAYBACK_RATES).find(([, rate]) => rate === playbackRate)?.[0] || REGULAR_PLAYBACK_RATE;
    const text = `${playbackRate === REGULAR_PLAYBACK_RATE ? DEFAULT_FAST_PLAYBACK_RATE : displayRate}`;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
      className: "playback-wrapper",
      children: [isContextMenuOpen && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
        className: "playback-backdrop",
        onClick: handleContextMenuClose
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
        round: true,
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('playback-button', isPlaybackRateActive && 'applied', isContextMenuOpen && 'on-top'),
        color: "translucent",
        size: "smaller",
        ariaLabel: "Playback Rate",
        ripple: !isMobile,
        onMouseEnter: handleContextMenu,
        onClick: handlePlaybackClick,
        onMouseDown: handleBeforeContextMenu,
        onContextMenu: handleContextMenu,
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("span", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('playback-button-inner', text.length === 4 && 'small', text.length === 5 && 'tiny'),
          children: text
        })
      })]
    });
  });
  const volumeIcon = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (volume === 0 || isMuted) return 'muted';
    if (volume < 0.3) return 'volume-1';
    if (volume < 0.6) return 'volume-2';
    return 'volume-3';
  }, [volume, isMuted]);
  if (noUi || !shouldRender) {
    return undefined;
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('AudioPlayer', isFullWidth ? 'full-width-player' : 'mini-player', className),
    dir: lang.isRtl ? 'rtl' : undefined,
    ref: ref,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
      className: "AudioPlayer-content",
      onClick: handleClick,
      children: [audio ? renderAudio(audio) : renderVoice(lang('AttachAudio'), senderName), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_28__["default"], {})]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
      round: true,
      ripple: !isMobile,
      color: "translucent",
      size: "smaller",
      className: "player-button",
      disabled: isFirst?.(),
      onClick: requestPreviousTrack,
      ariaLabel: "Previous track",
      iconName: "skip-previous"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
      round: true,
      ripple: !isMobile,
      color: "translucent",
      size: "smaller",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('toggle-play', 'player-button', isPlaying ? 'pause' : 'play'),
      onClick: playPause,
      ariaLabel: isPlaying ? 'Pause audio' : 'Play audio',
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
        name: "play"
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
        name: "pause"
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
      round: true,
      ripple: !isMobile,
      color: "translucent",
      size: "smaller",
      className: "player-button",
      disabled: isLast?.(),
      onClick: requestNextTrack,
      ariaLabel: "Next track",
      iconName: "skip-next"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
      className: "volume-button-wrapper",
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
        round: true,
        className: "player-button volume-button",
        color: "translucent",
        size: "smaller",
        ariaLabel: "Volume",
        onClick: handleVolumeClick,
        ripple: !isMobile,
        iconName: volumeIcon
      }), !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_IOS && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)("div", {
        className: "volume-slider-wrapper",
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
          className: "volume-slider-spacer"
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
          className: "volume-slider",
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_RangeSlider__WEBPACK_IMPORTED_MODULE_27__["default"], {
            bold: true,
            value: isMuted ? 0 : volume * 100,
            onChange: handleVolumeChange
          })
        })]
      })]
    }), shouldRenderPlaybackButton && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_25__["default"], {
      forceOpen: isContextMenuOpen,
      positionX: "right",
      positionY: "top",
      className: "playback-rate-menu",
      trigger: PlaybackRateButton,
      onClose: handleContextMenuClose,
      onHide: handleContextMenuHide,
      onMouseEnterBackdrop: handleContextMenuClose,
      children: PLAYBACK_RATE_VALUES.map(rate => {
        return renderPlaybackRateMenuItem(rate, playbackRate, updatePlaybackRate, isPlaybackRateActive);
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
      round: true,
      className: "player-close",
      color: "translucent",
      size: "smaller",
      onClick: handleClose,
      ariaLabel: "Close player",
      iconName: "close"
    })]
  });
};
function renderAudio(audio) {
  const {
    title,
    performer,
    fileName
  } = audio;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.Fragment, {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: "title",
      dir: "auto",
      children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(title || fileName)
    }), performer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: "subtitle",
      dir: "auto",
      children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(performer)
    })]
  });
}
function renderVoice(subtitle, senderName) {
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.Fragment, {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: "title",
      dir: "auto",
      children: senderName && (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(senderName)
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)("div", {
      className: "subtitle",
      dir: "auto",
      children: subtitle
    })]
  });
}
function renderPlaybackRateMenuItem(rate, currentRate, onClick, isPlaybackRateActive) {
  const isSelected = currentRate === PLAYBACK_RATES[rate] && isPlaybackRateActive || rate === REGULAR_PLAYBACK_RATE && !isPlaybackRateActive;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_26__["default"], {
    onClick: () => onClick(rate),
    icon: isSelected ? 'check' : undefined,
    customIcon: !isSelected ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_30__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
      name: "placeholder"
    }) : undefined,
    children: [rate, "X"]
  }, rate);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isHidden
}) => {
  const {
    audioPlayer
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const {
    chatId,
    messageId
  } = audioPlayer;
  const message = !isHidden && chatId && messageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessage)(global, chatId, messageId) : undefined;
  const sender = message && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectSender)(global, message);
  const chat = message && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, message.chatId);
  const {
    playbackRate,
    isMuted,
    isPlaybackRateActive,
    timestamp
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global).audioPlayer;
  const {
    volume
  } = global.audioPlayer;
  const mediaDuration = message ? (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_6__.selectMessageMediaDuration)(global, message) : undefined;
  return {
    message,
    sender,
    chat,
    volume,
    playbackRate,
    isPlaybackRateActive,
    isMuted,
    timestamp,
    mediaDuration
  };
})(AudioPlayer));

/***/ }),

/***/ "./src/components/middle/panes/BotAdPane.module.scss":
/*!***********************************************************!*\
  !*** ./src/components/middle/panes/BotAdPane.module.scss ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"yMkfzjus","content":"__w9Ejd3","info":"wdU19Be7","avatar":"AQFE1t4V","title":"u2vIptvT","text":"SVG6BaX3","aboutAd":"SrgXYpPk"});

/***/ }),

/***/ "./src/components/middle/panes/BotAdPane.tsx":
/*!***************************************************!*\
  !*** ./src/components/middle/panes/BotAdPane.tsx ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _message_SponsoredContextMenuContainer__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../message/SponsoredContextMenuContainer */ "./src/components/middle/message/SponsoredContextMenuContainer.tsx");
/* harmony import */ var _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./BotAdPane.module.scss */ "./src/components/middle/panes/BotAdPane.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");















const BotAdPane = ({
  chatId,
  isBot,
  messageListType,
  sponsoredMessage,
  onPaneStateChange
}) => {
  const {
    viewSponsored,
    openUrl,
    clickSponsored,
    openAboutAdsModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(isBot && sponsoredMessage && messageListType === 'thread');
  const renderingSponsoredMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(sponsoredMessage);
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isOpen,
    withResizeObserver: true,
    onStateChange: onPaneStateChange
  });
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(ref, !shouldRender, true);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (!sponsoredMessage) return;
    clickSponsored({
      randomId: sponsoredMessage.randomId
    });
    openUrl({
      url: sponsoredMessage.url,
      shouldSkipModal: true
    });
  });
  const handleAboutClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(e => {
    if (!sponsoredMessage) return;
    const {
      randomId,
      additionalInfo,
      canReport,
      sponsorInfo
    } = sponsoredMessage;
    e.stopPropagation();
    openAboutAdsModal({
      randomId,
      additionalInfo,
      canReport,
      sponsorInfo
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldRender && renderingSponsoredMessage) {
      viewSponsored({
        randomId: renderingSponsoredMessage.randomId
      });
    }
  }, [shouldRender, renderingSponsoredMessage, chatId]);
  if (!shouldRender || !renderingSponsoredMessage) {
    return undefined;
  }
  const {
    randomId,
    canReport,
    additionalInfo,
    sponsorInfo
  } = renderingSponsoredMessage;
  const {
    peerColor,
    content,
    photo,
    title
  } = renderingSponsoredMessage;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment, {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div", {
      ref: ref,
      className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].root,
      onClick: handleClick,
      onMouseDown: handleBeforeContextMenu,
      onContextMenu: handleContextMenu,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_11__["default"], {
        peerColor: peerColor,
        noBar: true,
        className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].content,
        children: [photo && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_9__["default"], {
          size: "medium",
          photo: photo,
          className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].avatar
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("div", {
          className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].contentInner,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("span", {
            className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].info,
            children: [lang('SponsoredMessageAd'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_10__["default"], {
              onClick: handleAboutClick,
              className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].aboutAd,
              children: lang('SponsoredMessageAdWhatIsThis')
            })]
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div", {
            className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].title,
            children: title
          }), content.text && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div", {
            className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].text,
            children: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_3__.renderTextWithEntities)({
              text: content.text.text,
              entities: content.text.entities
            })
          })]
        })]
      })
    }), contextMenuAnchor && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_message_SponsoredContextMenuContainer__WEBPACK_IMPORTED_MODULE_12__["default"], {
      isOpen: isContextMenuOpen,
      anchor: contextMenuAnchor,
      triggerRef: ref,
      randomId: randomId,
      additionalInfo: additionalInfo,
      canReport: canReport,
      sponsorInfo: sponsorInfo,
      onClose: handleContextMenuClose,
      onCloseAnimationEnd: handleContextMenuHide
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const bot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectBot)(global, chatId);
  const sponsoredMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectSponsoredMessage)(global, chatId);
  return {
    isBot: Boolean(bot),
    sponsoredMessage
  };
})(BotAdPane)));

/***/ }),

/***/ "./src/components/middle/panes/BotVerificationPane.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/middle/panes/BotVerificationPane.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"sAWttcxl","icon":"tK9d2y8u"});

/***/ }),

/***/ "./src/components/middle/panes/BotVerificationPane.tsx":
/*!*************************************************************!*\
  !*** ./src/components/middle/panes/BotVerificationPane.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _BotVerificationPane_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./BotVerificationPane.module.scss */ "./src/components/middle/panes/BotVerificationPane.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const BOT_VERIFICATION_ICON_SIZE = 16;
const DISPLAY_DURATION_MS = 5000; // 5 sec

const BotVerificationPane = ({
  peerId,
  wasShown,
  botVerification,
  onPaneStateChange
}) => {
  const isOpen = Boolean(!wasShown && botVerification);
  const {
    markBotVerificationInfoShown
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_5__["default"])({
    isOpen,
    onStateChange: onPaneStateChange
  });
  const markAsShowed = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    markBotVerificationInfoShown({
      peerId
    });
  });
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_3__["default"])(markAsShowed, !wasShown ? DISPLAY_DURATION_MS : undefined);
  if (!shouldRender || !botVerification) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
    ref: ref,
    className: _BotVerificationPane_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("span", {
      className: _BotVerificationPane_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].icon,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_6__["default"], {
        documentId: botVerification.iconId,
        size: BOT_VERIFICATION_ICON_SIZE
      })
    }), botVerification.description]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const peerFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeerFullInfo)(global, peerId);
  const botVerification = peerFullInfo?.botVerification;
  const wasShown = global.settings.botVerificationShownPeerIds.includes(peerId);
  return {
    botVerification,
    wasShown
  };
})(BotVerificationPane)));

/***/ }),

/***/ "./src/components/middle/panes/ChatReportPane.scss":
/*!*********************************************************!*\
  !*** ./src/components/middle/panes/ChatReportPane.scss ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/middle/panes/ChatReportPane.tsx":
/*!********************************************************!*\
  !*** ./src/components/middle/panes/ChatReportPane.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ChatReportPane_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ChatReportPane.scss */ "./src/components/middle/panes/ChatReportPane.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
















const ChatReportPane = ({
  chatId,
  className,
  isAutoArchived,
  canReportSpam,
  canAddContact,
  canBlockContact,
  peer,
  currentUserId,
  onPaneStateChange
}) => {
  const {
    openAddContactDialog,
    blockUser,
    reportSpam,
    deleteChat,
    leaveChannel,
    deleteChatUser,
    deleteHistory,
    toggleChatArchived,
    hidePeerSettingsBar
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isBlockUserModalOpen, openBlockUserModal, closeBlockUserModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [shouldReportSpam, setShouldReportSpam] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [shouldDeleteChat, setShouldDeleteChat] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const renderingPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(peer);
  const chat = renderingPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerChat)(renderingPeer) ? renderingPeer : undefined;
  const user = renderingPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(renderingPeer) ? renderingPeer : undefined;
  const isBasicGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatBasicGroup)(chat);
  const renderingCanAddContact = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(canAddContact);
  const renderingCanBlockContact = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(canBlockContact);
  const renderingCanReportSpam = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(canReportSpam);
  const renderingIsAutoArchived = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(isAutoArchived);
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openAddContactDialog({
      userId: chatId
    });
    if (renderingIsAutoArchived) {
      toggleChatArchived({
        id: chatId
      });
    }
  });
  const handleConfirmBlock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    closeBlockUserModal();
    blockUser({
      userId: chatId
    });
    if (renderingCanReportSpam && shouldReportSpam) {
      reportSpam({
        chatId
      });
    }
    if (shouldDeleteChat) {
      deleteChat({
        chatId
      });
    }
  });
  const handleCloseReportPane = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    hidePeerSettingsBar({
      peerId: chatId
    });
  });
  const handleChatReportSpam = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    closeBlockUserModal();
    reportSpam({
      chatId
    });
    if (isBasicGroup) {
      deleteChatUser({
        chatId,
        userId: currentUserId
      });
      deleteHistory({
        chatId,
        shouldDeleteForAll: false
      });
    } else {
      leaveChannel({
        chatId
      });
    }
  });
  const hasAnyButton = canAddContact || canBlockContact || canReportSpam;
  const isRendering = Boolean(hasAnyButton && peer);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isRendering) {
      closeBlockUserModal();
    }
  }, [isRendering]);
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__["default"])({
    isOpen: isRendering,
    onStateChange: onPaneStateChange
  });
  if (!shouldRender) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ChatReportPane', className),
    dir: lang.isRtl ? 'rtl' : undefined,
    children: [renderingCanAddContact && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
      isText: true,
      fluid: true,
      size: "tiny",
      className: "ChatReportPane--Button",
      onClick: handleAddContact,
      children: lang('lng_new_contact_add')
    }), renderingCanBlockContact && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
      color: "danger",
      isText: true,
      fluid: true,
      size: "tiny",
      className: "ChatReportPane--Button",
      onClick: openBlockUserModal,
      children: lang('lng_new_contact_block')
    }), renderingCanReportSpam && !renderingCanBlockContact && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
      color: "danger",
      isText: true,
      fluid: true,
      size: "tiny",
      className: "ChatReportPane--Button",
      onClick: openBlockUserModal,
      children: lang('lng_report_spam_and_leave')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
      round: true,
      ripple: true,
      size: "smaller",
      color: "translucent",
      onClick: handleCloseReportPane,
      ariaLabel: lang('Close'),
      iconName: "close"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_13__["default"], {
      isOpen: isBlockUserModalOpen,
      onClose: closeBlockUserModal,
      title: lang('BlockUserTitle', user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, chat)),
      text: user ? lang('UserInfo.BlockConfirmationTitle', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user)) : lang('Chat.Confirm.ReportSpam.Channel'),
      confirmIsDestructive: true,
      confirmLabel: lang('Block'),
      confirmHandler: user ? handleConfirmBlock : handleChatReportSpam,
      children: [user && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: "dialog-checkbox",
        label: lang('DeleteThisChat'),
        checked: shouldDeleteChat,
        onCheck: setShouldDeleteChat
      }), user && canReportSpam && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: "ChatReportPane--Checkbox dialog-checkbox",
        label: lang('ReportChat'),
        checked: shouldReportSpam,
        onCheck: setShouldReportSpam
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => ({
  currentUserId: global.currentUserId,
  peer: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, chatId)
}))(ChatReportPane)));

/***/ }),

/***/ "./src/components/middle/panes/HeaderPinnedMessage.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/middle/panes/HeaderPinnedMessage.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"tE8PJzpv","mini":"lrBhOgvf","fullWidth":"gutn4asD","pinnedMessage":"ayLUtX1S","messageText":"ETMw73qH","loading":"yvd9_9PF","pinListIcon":"LFRysfVa","pinListIconHidden":"E_C4DXKN","no-hover":"WVjde2rq","noHover":"WVjde2rq","messageTextTransition":"mA1i07pG","withMedia":"BWZytkCB","title":"IWpRWVBg","summary":"k19QLKaH","inlineButton":"fpQMpARI","pictogramTransition":"Gp431jU4","pinnedThumb":"XjjZeOUy","pinnedThumbImage":"ljzqevcj"});

/***/ }),

/***/ "./src/components/middle/panes/HeaderPinnedMessage.tsx":
/*!*************************************************************!*\
  !*** ./src/components/middle/panes/HeaderPinnedMessage.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../composer/helpers/renderKeyboardButtonText */ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useEnsureMessage */ "./src/hooks/useEnsureMessage.ts");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../right/hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _common_MessageSummary__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../common/MessageSummary */ "./src/components/common/MessageSummary.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _PinnedMessageNavigation__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../PinnedMessageNavigation */ "./src/components/middle/PinnedMessageNavigation.tsx");
/* harmony import */ var _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./HeaderPinnedMessage.module.scss */ "./src/components/middle/panes/HeaderPinnedMessage.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





































const MAX_LENGTH = 256;
const SHOW_LOADER_DELAY = 450;
const EMOJI_SIZE = 1.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__.REM;
const HeaderPinnedMessage = ({
  chatId,
  threadId,
  canUnpin,
  getLoadingPinnedId,
  pinnedMessageIds,
  messagesById,
  isFullWidth,
  topMessageSender,
  getCurrentPinnedIndex,
  className,
  chat,
  isSynced,
  shouldHide,
  onPaneStateChange,
  onFocusPinnedMessage
}) => {
  const {
    clickBotInlineButton,
    focusMessage,
    openThread,
    pinMessage,
    loadPinnedMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const currentPinnedIndex = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_15__["default"])(getCurrentPinnedIndex);
  const pinnedMessageId = Array.isArray(pinnedMessageIds) ? pinnedMessageIds[currentPinnedIndex] : pinnedMessageIds;
  const pinnedMessage = messagesById && pinnedMessageId ? messagesById[pinnedMessageId] : undefined;
  const pinnedMessagesCount = Array.isArray(pinnedMessageIds) ? pinnedMessageIds.length : pinnedMessageIds ? 1 : 0;
  const pinnedMessageNumber = Math.max(pinnedMessagesCount - currentPinnedIndex, 1);
  const topMessageTitle = topMessageSender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, topMessageSender) : undefined;
  const video = pinnedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageVideo)(pinnedMessage);
  const gif = video?.isGif ? video : undefined;
  const isVideoThumbnail = Boolean(gif && !gif.previewPhotoSizes?.length);
  const mediaThumbnail = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_13__["default"])(pinnedMessage);
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_12__["default"])(pinnedMessage, isVideoThumbnail ? 'full' : 'pictogram');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_21__["default"])(mediaHash);
  const isSpoiler = pinnedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageIsSpoiler)(pinnedMessage);
  const isLoading = Boolean((0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_15__["default"])(getLoadingPinnedId));
  const canRenderLoader = (0,_right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_23__["default"])([isLoading], SHOW_LOADER_DELAY);
  const shouldShowLoader = canRenderLoader && isLoading;
  const renderingPinnedMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__["default"])(pinnedMessage, true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isSynced && (threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || chat?.isForum)) {
      loadPinnedMessages({
        chatId,
        threadId
      });
    }
  }, [chatId, threadId, isSynced, chat?.isForum]);
  (0,_hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_16__["default"])(chatId, pinnedMessageId, pinnedMessage);
  const isOpen = Boolean(pinnedMessage) && !shouldHide;
  const {
    ref: transitionRef
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_22__["default"])({
    isOpen,
    noOpenTransition: true,
    shouldForceOpen: isFullWidth // Use pane animation instead
  });
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_24__["default"])({
    isOpen,
    isDisabled: !isFullWidth,
    ref: transitionRef,
    onStateChange: onPaneStateChange
  });
  const [isUnpinDialogOpen, openUnpinDialog, closeUnpinDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const handleUnpinMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    closeUnpinDialog();
    pinMessage({
      chatId,
      messageId: pinnedMessage.id,
      isUnpin: true
    });
  });
  const inlineButton = pinnedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageSingleInlineButton)(pinnedMessage);
  const handleInlineButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    if (inlineButton) {
      clickBotInlineButton({
        chatId: pinnedMessage.chatId,
        messageId: pinnedMessage.id,
        button: inlineButton
      });
    }
  });
  const handleAllPinnedClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    openThread({
      chatId,
      threadId,
      type: 'pinned'
    });
  });
  const handleMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(e => {
    const nextMessageId = e.shiftKey && Array.isArray(pinnedMessageIds) ? pinnedMessageIds[(0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_8__["default"])(pinnedMessageIds.length, pinnedMessageIds.indexOf(pinnedMessageId) - 2)] : pinnedMessageId;
    if (!getLoadingPinnedId()) {
      focusMessage({
        chatId,
        threadId,
        messageId: nextMessageId,
        noForumTopicPanel: true
      });
      onFocusPinnedMessage(nextMessageId);
    }
  });
  const [noHoverColor, markNoHoverColor, unmarkNoHoverColor] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_17__.useFastClick)(handleMessageClick);
  function renderPictogram(thumbDataUri, blobUrl, isFullVideo, asSpoiler) {
    const {
      width,
      height
    } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__.getPictogramDimensions)();
    const srcUrl = blobUrl || thumbDataUri;
    const shouldRenderVideo = isFullVideo && blobUrl;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsxs)("div", {
      className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedThumb,
      children: [thumbDataUri && !asSpoiler && !shouldRenderVideo && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)("img", {
        className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedThumbImage,
        src: srcUrl,
        width: width,
        height: height,
        alt: "",
        draggable: false
      }), shouldRenderVideo && !asSpoiler && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)("video", {
        src: blobUrl,
        width: width,
        height: height,
        playsInline: true,
        disablePictureInPicture: true,
        className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedThumbImage
      }), thumbDataUri && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_27__["default"], {
        thumbDataUri: srcUrl,
        isVisible: Boolean(asSpoiler),
        width: width,
        height: height
      })]
    });
  }
  if (!shouldRender || !renderingPinnedMessage) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('HeaderPinnedMessageWrapper', _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].root, isFullWidth ? _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].fullWidth : _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].mini, className),
    children: [(pinnedMessagesCount > 1 || shouldShowLoader) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
      round: true,
      size: "smaller",
      color: "translucent",
      ariaLabel: lang('EventLogFilterPinnedMessages'),
      onClick: !shouldShowLoader ? handleAllPinnedClick : undefined,
      children: [isLoading && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_Spinner__WEBPACK_IMPORTED_MODULE_32__["default"], {
        color: "blue",
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].loading, _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIcon, !shouldShowLoader && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIconHidden)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_26__["default"], {
        name: "pin-list",
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIcon, shouldShowLoader && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIconHidden)
      })]
    }), canUnpin && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
      round: true,
      size: "smaller",
      color: "translucent",
      ariaLabel: lang('UnpinMessageAlertTitle'),
      onClick: openUnpinDialog,
      iconName: "close"
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_30__["default"], {
      isOpen: isUnpinDialogOpen,
      onClose: closeUnpinDialog,
      text: lang('PinnedConfirmUnpin'),
      confirmLabel: lang('DialogUnpin'),
      confirmHandler: handleUnpinMessage
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedMessage, noHoverColor && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].noHover),
      onClick: handleClick,
      onMouseDown: handleMouseDown,
      dir: lang.isRtl ? 'rtl' : undefined,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_PinnedMessageNavigation__WEBPACK_IMPORTED_MODULE_34__["default"], {
        count: pinnedMessagesCount,
        index: currentPinnedIndex
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_33__["default"], {
        activeKey: renderingPinnedMessage.id,
        name: "slideVertical",
        className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pictogramTransition,
        children: renderPictogram(mediaThumbnail, mediaBlobUrl, isVideoThumbnail, isSpoiler)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].messageText, mediaThumbnail && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].withMedia),
        dir: lang.isRtl ? 'rtl' : undefined,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsxs)("div", {
          className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].title,
          dir: lang.isRtl ? 'rtl' : undefined,
          children: [!topMessageTitle && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_25__["default"], {
            text: pinnedMessagesCount === 1 ? lang('PinnedMessageTitleSingle') : lang('PinnedMessageTitle', {
              index: pinnedMessageNumber
            }, {
              pluralValue: pinnedMessagesCount
            })
          }), topMessageTitle && (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(topMessageTitle)]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_33__["default"], {
          activeKey: renderingPinnedMessage.id,
          name: "slideVerticalFade",
          className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].messageTextTransition,
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)("p", {
            dir: "auto",
            className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].summary,
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_common_MessageSummary__WEBPACK_IMPORTED_MODULE_28__["default"], {
              message: renderingPinnedMessage,
              truncateLength: MAX_LENGTH,
              noEmoji: Boolean(mediaThumbnail),
              emojiSize: EMOJI_SIZE
            })
          })
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_31__["default"], {}), inlineButton && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_36__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
        size: "tiny",
        className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].inlineButton,
        onClick: handleInlineButtonClick,
        shouldStopPropagation: true,
        onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV ? markNoHoverColor : undefined,
        onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV ? unmarkNoHoverColor : undefined,
        children: (0,_composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang, inlineButton)
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  messageListType
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, chatId);
  const isSynced = global.isSynced;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessages)(global, chatId);
  const state = {
    chat,
    isSynced
  };
  if (messageListType !== 'thread' || !messagesById) {
    return state;
  }
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !isSavedDialog && !chat?.isForum) {
    const pinnedMessageId = Number(threadId);
    const message = pinnedMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessage)(global, chatId, pinnedMessageId) : undefined;
    const topMessageSender = message ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectForwardedSender)(global, message) : undefined;
    return {
      ...state,
      pinnedMessageIds: pinnedMessageId,
      messagesById,
      canUnpin: false,
      topMessageSender
    };
  }
  const pinnedMessageIds = !isSavedDialog ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPinnedIds)(global, chatId, threadId) : undefined;
  if (pinnedMessageIds?.length) {
    const firstPinnedMessage = messagesById[pinnedMessageIds[0]];
    const {
      canUnpin = false
    } = firstPinnedMessage && pinnedMessageIds.length === 1 && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectAllowedMessageActionsSlow)(global, firstPinnedMessage, threadId) || {};
    return {
      ...state,
      pinnedMessageIds,
      messagesById,
      canUnpin
    };
  }
  return state;
})(HeaderPinnedMessage)));

/***/ }),

/***/ "./src/components/middle/panes/PaidMessageChargePane.module.scss":
/*!***********************************************************************!*\
  !*** ./src/components/middle/panes/PaidMessageChargePane.module.scss ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"xqcWnBH4","message":"CJhqoyif","messageStars":"sZR8zqEk","messageStarIcon":"AKXOpk8S"});

/***/ }),

/***/ "./src/components/middle/panes/PaidMessageChargePane.tsx":
/*!***************************************************************!*\
  !*** ./src/components/middle/panes/PaidMessageChargePane.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./PaidMessageChargePane.module.scss */ "./src/components/middle/panes/PaidMessageChargePane.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");







// import useTimeout from '../../../hooks/schedulers/useTimeout';




// import CustomEmoji from '../../common/CustomEmoji';


const PaidMessageChargePane = ({
  chargedPaidMessageStars,
  chat,
  peerId,
  onPaneStateChange
}) => {
  const isOpen = Boolean(chargedPaidMessageStars);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    openChatRefundModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isOpen,
    onStateChange: onPaneStateChange
  });
  const handleRefund = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openChatRefundModal({
      userId: peerId
    });
  });
  if (!shouldRender || !chargedPaidMessageStars) return undefined;
  const peerName = chat ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, chat) : undefined;
  const message = lang('PaneMessagePaidMessageCharge', {
    peer: peerName,
    amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_5__.formatStarsAsIcon)(lang, chargedPaidMessageStars, {
      asFont: true,
      className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].messageStarIcon,
      containerClassName: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].messageStars
    })
  }, {
    withMarkdown: true,
    withNodes: true
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    ref: ref,
    className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].message,
      children: message
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      isText: true,
      noForcedUpperCase: true,
      pill: true,
      fluid: true,
      size: "tiny",
      className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].button,
      onClick: handleRefund,
      children: lang('RemoveFeeTitle')
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, peerId);
  const peerFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserFullInfo)(global, peerId);
  const chargedPaidMessageStars = peerFullInfo?.settings?.chargedPaidMessageStars;
  return {
    chargedPaidMessageStars,
    chat
  };
})(PaidMessageChargePane)));

/***/ }),

/***/ "./src/components/middle/search/MiddleSearch.async.tsx":
/*!*************************************************************!*\
  !*** ./src/components/middle/search/MiddleSearch.async.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const MiddleSearchAsync = props => {
  const {
    isActive
  } = props;
  const MiddleSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'MiddleSearch', !isActive, true);
  return MiddleSearch ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MiddleSearch, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MiddleSearchAsync);

/***/ }),

/***/ "./src/components/modals/ModalContainer.tsx":
/*!**************************************************!*\
  !*** ./src/components/modals/ModalContainer.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_VerificationMonetizationModal_async__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/VerificationMonetizationModal.async */ "./src/components/common/VerificationMonetizationModal.async.tsx");
/* harmony import */ var _main_WebAppsCloseConfirmationModal_async__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../main/WebAppsCloseConfirmationModal.async */ "./src/components/main/WebAppsCloseConfirmationModal.async.tsx");
/* harmony import */ var _aboutAds_AboutAdsModal_async__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./aboutAds/AboutAdsModal.async */ "./src/components/modals/aboutAds/AboutAdsModal.async.tsx");
/* harmony import */ var _ageVerification_AgeVerificationModal_async__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ageVerification/AgeVerificationModal.async */ "./src/components/modals/ageVerification/AgeVerificationModal.async.tsx");
/* harmony import */ var _attachBotInstall_AttachBotInstallModal_async__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./attachBotInstall/AttachBotInstallModal.async */ "./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx");
/* harmony import */ var _birthday_BirthdaySetupModal_async__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./birthday/BirthdaySetupModal.async */ "./src/components/modals/birthday/BirthdaySetupModal.async.tsx");
/* harmony import */ var _boost_BoostModal_async__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./boost/BoostModal.async */ "./src/components/modals/boost/BoostModal.async.tsx");
/* harmony import */ var _chatInvite_ChatInviteModal_async__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./chatInvite/ChatInviteModal.async */ "./src/components/modals/chatInvite/ChatInviteModal.async.tsx");
/* harmony import */ var _chatlist_ChatlistModal_async__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./chatlist/ChatlistModal.async */ "./src/components/modals/chatlist/ChatlistModal.async.tsx");
/* harmony import */ var _collectible_CollectibleInfoModal_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./collectible/CollectibleInfoModal.async */ "./src/components/modals/collectible/CollectibleInfoModal.async.tsx");
/* harmony import */ var _deleteAccount_DeleteAccountModal_async__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./deleteAccount/DeleteAccountModal.async */ "./src/components/modals/deleteAccount/DeleteAccountModal.async.tsx");
/* harmony import */ var _emojiStatusAccess_EmojiStatusAccessModal_async__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./emojiStatusAccess/EmojiStatusAccessModal.async */ "./src/components/modals/emojiStatusAccess/EmojiStatusAccessModal.async.tsx");
/* harmony import */ var _frozenAccount_FrozenAccountModal_async__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./frozenAccount/FrozenAccountModal.async */ "./src/components/modals/frozenAccount/FrozenAccountModal.async.tsx");
/* harmony import */ var _gift_AboutStarGiftModal_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./gift/AboutStarGiftModal.async */ "./src/components/modals/gift/AboutStarGiftModal.async.tsx");
/* harmony import */ var _gift_auction_GiftAuctionAcquiredModal_async__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./gift/auction/GiftAuctionAcquiredModal.async */ "./src/components/modals/gift/auction/GiftAuctionAcquiredModal.async.tsx");
/* harmony import */ var _gift_auction_GiftAuctionBidModal_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./gift/auction/GiftAuctionBidModal.async */ "./src/components/modals/gift/auction/GiftAuctionBidModal.async.tsx");
/* harmony import */ var _gift_auction_GiftAuctionChangeRecipientModal_async__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./gift/auction/GiftAuctionChangeRecipientModal.async */ "./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.async.tsx");
/* harmony import */ var _gift_auction_GiftAuctionInfoModal_async__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./gift/auction/GiftAuctionInfoModal.async */ "./src/components/modals/gift/auction/GiftAuctionInfoModal.async.tsx");
/* harmony import */ var _gift_auction_GiftAuctionModal_async__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./gift/auction/GiftAuctionModal.async */ "./src/components/modals/gift/auction/GiftAuctionModal.async.tsx");
/* harmony import */ var _gift_GiftModal_async__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./gift/GiftModal.async */ "./src/components/modals/gift/GiftModal.async.tsx");
/* harmony import */ var _gift_info_GiftInfoModal_async__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./gift/info/GiftInfoModal.async */ "./src/components/modals/gift/info/GiftInfoModal.async.tsx");
/* harmony import */ var _gift_locked_GiftLockedModal_async__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./gift/locked/GiftLockedModal.async */ "./src/components/modals/gift/locked/GiftLockedModal.async.tsx");
/* harmony import */ var _gift_message_GiftDescriptionRemoveModal_async__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./gift/message/GiftDescriptionRemoveModal.async */ "./src/components/modals/gift/message/GiftDescriptionRemoveModal.async.tsx");
/* harmony import */ var _gift_recipient_GiftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./gift/recipient/GiftRecipientPicker.async */ "./src/components/modals/gift/recipient/GiftRecipientPicker.async.tsx");
/* harmony import */ var _gift_resale_GiftResalePriceComposerModal_async__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./gift/resale/GiftResalePriceComposerModal.async */ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.async.tsx");
/* harmony import */ var _gift_StarGiftPriceDecreaseInfoModal_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./gift/StarGiftPriceDecreaseInfoModal.async */ "./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.async.tsx");
/* harmony import */ var _gift_status_GiftStatusInfoModal_async__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./gift/status/GiftStatusInfoModal.async */ "./src/components/modals/gift/status/GiftStatusInfoModal.async.tsx");
/* harmony import */ var _gift_transfer_GiftTransferConfirmModal_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./gift/transfer/GiftTransferConfirmModal.async */ "./src/components/modals/gift/transfer/GiftTransferConfirmModal.async.tsx");
/* harmony import */ var _gift_transfer_GiftTransferModal_async__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./gift/transfer/GiftTransferModal.async */ "./src/components/modals/gift/transfer/GiftTransferModal.async.tsx");
/* harmony import */ var _gift_upgrade_GiftUpgradeModal_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./gift/upgrade/GiftUpgradeModal.async */ "./src/components/modals/gift/upgrade/GiftUpgradeModal.async.tsx");
/* harmony import */ var _gift_value_GiftInfoValueModal_async__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./gift/value/GiftInfoValueModal.async */ "./src/components/modals/gift/value/GiftInfoValueModal.async.tsx");
/* harmony import */ var _gift_withdraw_GiftWithdrawModal_async__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./gift/withdraw/GiftWithdrawModal.async */ "./src/components/modals/gift/withdraw/GiftWithdrawModal.async.tsx");
/* harmony import */ var _giftcode_GiftCodeModal_async__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./giftcode/GiftCodeModal.async */ "./src/components/modals/giftcode/GiftCodeModal.async.tsx");
/* harmony import */ var _inviteViaLink_InviteViaLinkModal_async__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./inviteViaLink/InviteViaLinkModal.async */ "./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx");
/* harmony import */ var _locationAccess_LocationAccessModal_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./locationAccess/LocationAccessModal.async */ "./src/components/modals/locationAccess/LocationAccessModal.async.tsx");
/* harmony import */ var _map_MapModal_async__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./map/MapModal.async */ "./src/components/modals/map/MapModal.async.tsx");
/* harmony import */ var _oneTimeMedia_OneTimeMediaModal_async__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./oneTimeMedia/OneTimeMediaModal.async */ "./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx");
/* harmony import */ var _paidReaction_PaidReactionModal_async__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./paidReaction/PaidReactionModal.async */ "./src/components/modals/paidReaction/PaidReactionModal.async.tsx");
/* harmony import */ var _passkey_PasskeyModal_async__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./passkey/PasskeyModal.async */ "./src/components/modals/passkey/PasskeyModal.async.tsx");
/* harmony import */ var _preparedMessage_PreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./preparedMessage/PreparedMessageModal.async */ "./src/components/modals/preparedMessage/PreparedMessageModal.async.tsx");
/* harmony import */ var _priceConfirm_PriceConfirmModal_async__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./priceConfirm/PriceConfirmModal.async */ "./src/components/modals/priceConfirm/PriceConfirmModal.async.tsx");
/* harmony import */ var _profileRating_ProfileRatingModal_async__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./profileRating/ProfileRatingModal.async */ "./src/components/modals/profileRating/ProfileRatingModal.async.tsx");
/* harmony import */ var _quickPreview_QuickPreviewModal_async__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./quickPreview/QuickPreviewModal.async */ "./src/components/modals/quickPreview/QuickPreviewModal.async.tsx");
/* harmony import */ var _reportAd_ReportAdModal_async__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./reportAd/ReportAdModal.async */ "./src/components/modals/reportAd/ReportAdModal.async.tsx");
/* harmony import */ var _reportModal_ReportModal_async__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./reportModal/ReportModal.async */ "./src/components/modals/reportModal/ReportModal.async.tsx");
/* harmony import */ var _sharePreparedMessage_SharePreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./sharePreparedMessage/SharePreparedMessageModal.async */ "./src/components/modals/sharePreparedMessage/SharePreparedMessageModal.async.tsx");
/* harmony import */ var _stars_chatRefund_ChatRefundModal_async__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./stars/chatRefund/ChatRefundModal.async */ "./src/components/modals/stars/chatRefund/ChatRefundModal.async.tsx");
/* harmony import */ var _stars_gift_StarsGiftModal_async__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./stars/gift/StarsGiftModal.async */ "./src/components/modals/stars/gift/StarsGiftModal.async.tsx");
/* harmony import */ var _stars_StarsBalanceModal_async__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./stars/StarsBalanceModal.async */ "./src/components/modals/stars/StarsBalanceModal.async.tsx");
/* harmony import */ var _stars_StarsPaymentModal_async__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./stars/StarsPaymentModal.async */ "./src/components/modals/stars/StarsPaymentModal.async.tsx");
/* harmony import */ var _stars_subscription_StarsSubscriptionModal_async__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./stars/subscription/StarsSubscriptionModal.async */ "./src/components/modals/stars/subscription/StarsSubscriptionModal.async.tsx");
/* harmony import */ var _stars_transaction_StarsTransactionModal_async__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./stars/transaction/StarsTransactionModal.async */ "./src/components/modals/stars/transaction/StarsTransactionModal.async.tsx");
/* harmony import */ var _storyStealthMode_StealthModeModal_async__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./storyStealthMode/StealthModeModal.async */ "./src/components/modals/storyStealthMode/StealthModeModal.async.tsx");
/* harmony import */ var _suggestedPostApproval_SuggestedPostApprovalModal_async__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ./suggestedPostApproval/SuggestedPostApprovalModal.async */ "./src/components/modals/suggestedPostApproval/SuggestedPostApprovalModal.async.tsx");
/* harmony import */ var _suggestedStatus_SuggestedStatusModal_async__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ./suggestedStatus/SuggestedStatusModal.async */ "./src/components/modals/suggestedStatus/SuggestedStatusModal.async.tsx");
/* harmony import */ var _suggestMessage_SuggestMessageModal_async__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ./suggestMessage/SuggestMessageModal.async */ "./src/components/modals/suggestMessage/SuggestMessageModal.async.tsx");
/* harmony import */ var _urlAuth_UrlAuthModal_async__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ./urlAuth/UrlAuthModal.async */ "./src/components/modals/urlAuth/UrlAuthModal.async.tsx");
/* harmony import */ var _webApp_WebAppModal_async__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ./webApp/WebAppModal.async */ "./src/components/modals/webApp/WebAppModal.async.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");































































// `Pick` used only to provide tab completion

const MODALS = {
  giftCodeModal: _giftcode_GiftCodeModal_async__WEBPACK_IMPORTED_MODULE_36__["default"],
  boostModal: _boost_BoostModal_async__WEBPACK_IMPORTED_MODULE_10__["default"],
  chatlistModal: _chatlist_ChatlistModal_async__WEBPACK_IMPORTED_MODULE_12__["default"],
  urlAuth: _urlAuth_UrlAuthModal_async__WEBPACK_IMPORTED_MODULE_60__["default"],
  oneTimeMediaModal: _oneTimeMedia_OneTimeMediaModal_async__WEBPACK_IMPORTED_MODULE_40__["default"],
  inviteViaLinkModal: _inviteViaLink_InviteViaLinkModal_async__WEBPACK_IMPORTED_MODULE_37__["default"],
  requestedAttachBotInstall: _attachBotInstall_AttachBotInstallModal_async__WEBPACK_IMPORTED_MODULE_8__["default"],
  reportAdModal: _reportAd_ReportAdModal_async__WEBPACK_IMPORTED_MODULE_47__["default"],
  reportModal: _reportModal_ReportModal_async__WEBPACK_IMPORTED_MODULE_48__["default"],
  webApps: _webApp_WebAppModal_async__WEBPACK_IMPORTED_MODULE_61__["default"],
  collectibleInfoModal: _collectible_CollectibleInfoModal_async__WEBPACK_IMPORTED_MODULE_13__["default"],
  mapModal: _map_MapModal_async__WEBPACK_IMPORTED_MODULE_39__["default"],
  starsPayment: _stars_StarsPaymentModal_async__WEBPACK_IMPORTED_MODULE_53__["default"],
  starsBalanceModal: _stars_StarsBalanceModal_async__WEBPACK_IMPORTED_MODULE_52__["default"],
  starsTransactionModal: _stars_transaction_StarsTransactionModal_async__WEBPACK_IMPORTED_MODULE_55__["default"],
  chatInviteModal: _chatInvite_ChatInviteModal_async__WEBPACK_IMPORTED_MODULE_11__["default"],
  paidReactionModal: _paidReaction_PaidReactionModal_async__WEBPACK_IMPORTED_MODULE_41__["default"],
  suggestMessageModal: _suggestMessage_SuggestMessageModal_async__WEBPACK_IMPORTED_MODULE_59__["default"],
  suggestedPostApprovalModal: _suggestedPostApproval_SuggestedPostApprovalModal_async__WEBPACK_IMPORTED_MODULE_57__["default"],
  starsSubscriptionModal: _stars_subscription_StarsSubscriptionModal_async__WEBPACK_IMPORTED_MODULE_54__["default"],
  starsGiftModal: _stars_gift_StarsGiftModal_async__WEBPACK_IMPORTED_MODULE_51__["default"],
  giftModal: _gift_GiftModal_async__WEBPACK_IMPORTED_MODULE_23__["default"],
  isGiftRecipientPickerOpen: _gift_recipient_GiftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_27__["default"],
  isWebAppsCloseConfirmationModalOpen: _main_WebAppsCloseConfirmationModal_async__WEBPACK_IMPORTED_MODULE_5__["default"],
  giftInfoModal: _gift_info_GiftInfoModal_async__WEBPACK_IMPORTED_MODULE_24__["default"],
  giftInfoValueModal: _gift_value_GiftInfoValueModal_async__WEBPACK_IMPORTED_MODULE_34__["default"],
  lockedGiftModal: _gift_locked_GiftLockedModal_async__WEBPACK_IMPORTED_MODULE_25__["default"],
  giftResalePriceComposerModal: _gift_resale_GiftResalePriceComposerModal_async__WEBPACK_IMPORTED_MODULE_28__["default"],
  suggestedStatusModal: _suggestedStatus_SuggestedStatusModal_async__WEBPACK_IMPORTED_MODULE_58__["default"],
  emojiStatusAccessModal: _emojiStatusAccess_EmojiStatusAccessModal_async__WEBPACK_IMPORTED_MODULE_15__["default"],
  locationAccessModal: _locationAccess_LocationAccessModal_async__WEBPACK_IMPORTED_MODULE_38__["default"],
  aboutAdsModal: _aboutAds_AboutAdsModal_async__WEBPACK_IMPORTED_MODULE_6__["default"],
  giftUpgradeModal: _gift_upgrade_GiftUpgradeModal_async__WEBPACK_IMPORTED_MODULE_33__["default"],
  giftAuctionModal: _gift_auction_GiftAuctionModal_async__WEBPACK_IMPORTED_MODULE_22__["default"],
  giftAuctionBidModal: _gift_auction_GiftAuctionBidModal_async__WEBPACK_IMPORTED_MODULE_19__["default"],
  giftAuctionInfoModal: _gift_auction_GiftAuctionInfoModal_async__WEBPACK_IMPORTED_MODULE_21__["default"],
  giftAuctionChangeRecipientModal: _gift_auction_GiftAuctionChangeRecipientModal_async__WEBPACK_IMPORTED_MODULE_20__["default"],
  giftAuctionAcquiredModal: _gift_auction_GiftAuctionAcquiredModal_async__WEBPACK_IMPORTED_MODULE_18__["default"],
  starGiftPriceDecreaseInfoModal: _gift_StarGiftPriceDecreaseInfoModal_async__WEBPACK_IMPORTED_MODULE_29__["default"],
  aboutStarGiftModal: _gift_AboutStarGiftModal_async__WEBPACK_IMPORTED_MODULE_17__["default"],
  monetizationVerificationModal: _common_VerificationMonetizationModal_async__WEBPACK_IMPORTED_MODULE_4__["default"],
  giftWithdrawModal: _gift_withdraw_GiftWithdrawModal_async__WEBPACK_IMPORTED_MODULE_35__["default"],
  giftStatusInfoModal: _gift_status_GiftStatusInfoModal_async__WEBPACK_IMPORTED_MODULE_30__["default"],
  preparedMessageModal: _preparedMessage_PreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_43__["default"],
  sharePreparedMessageModal: _sharePreparedMessage_SharePreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_49__["default"],
  giftTransferModal: _gift_transfer_GiftTransferModal_async__WEBPACK_IMPORTED_MODULE_32__["default"],
  giftTransferConfirmModal: _gift_transfer_GiftTransferConfirmModal_async__WEBPACK_IMPORTED_MODULE_31__["default"],
  giftDescriptionRemoveModal: _gift_message_GiftDescriptionRemoveModal_async__WEBPACK_IMPORTED_MODULE_26__["default"],
  chatRefundModal: _stars_chatRefund_ChatRefundModal_async__WEBPACK_IMPORTED_MODULE_50__["default"],
  priceConfirmModal: _priceConfirm_PriceConfirmModal_async__WEBPACK_IMPORTED_MODULE_44__["default"],
  isFrozenAccountModalOpen: _frozenAccount_FrozenAccountModal_async__WEBPACK_IMPORTED_MODULE_16__["default"],
  deleteAccountModal: _deleteAccount_DeleteAccountModal_async__WEBPACK_IMPORTED_MODULE_14__["default"],
  isAgeVerificationModalOpen: _ageVerification_AgeVerificationModal_async__WEBPACK_IMPORTED_MODULE_7__["default"],
  profileRatingModal: _profileRating_ProfileRatingModal_async__WEBPACK_IMPORTED_MODULE_45__["default"],
  quickPreview: _quickPreview_QuickPreviewModal_async__WEBPACK_IMPORTED_MODULE_46__["default"],
  storyStealthModal: _storyStealthMode_StealthModeModal_async__WEBPACK_IMPORTED_MODULE_56__["default"],
  isPasskeyModalOpen: _passkey_PasskeyModal_async__WEBPACK_IMPORTED_MODULE_42__["default"],
  birthdaySetupModal: _birthday_BirthdaySetupModal_async__WEBPACK_IMPORTED_MODULE_9__["default"]
};
const MODAL_KEYS = Object.keys(MODALS);
const MODAL_ENTRIES = Object.entries(MODALS);
const ModalContainer = modalProps => {
  return MODAL_ENTRIES.map(([key, ModalComponent]) =>
  // @ts-ignore -- TS does not preserve tuple types in `map` callbacks
  (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_62__.jsx)(ModalComponent, {
    modal: modalProps[key]
  }, key));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.pick)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global), MODAL_KEYS))(ModalContainer)));

/***/ }),

/***/ "./src/components/modals/aboutAds/AboutAdsModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/aboutAds/AboutAdsModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const AboutAdsModalAsync = props => {
  const {
    modal
  } = props;
  const AboutAdsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'AboutAdsModal', !modal);
  return AboutAdsModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AboutAdsModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AboutAdsModalAsync);

/***/ }),

/***/ "./src/components/modals/ageVerification/AgeVerificationModal.async.tsx":
/*!******************************************************************************!*\
  !*** ./src/components/modals/ageVerification/AgeVerificationModal.async.tsx ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const AgeVerificationModalAsync = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(props => {
  const {
    modal
  } = props;
  const AgeVerificationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AgeVerificationModal', !modal);
  return AgeVerificationModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(AgeVerificationModal, {
    ...props
  }) : undefined;
});
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AgeVerificationModalAsync);

/***/ }),

/***/ "./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx":
/*!********************************************************************************!*\
  !*** ./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const AttachBotInstallModalAsync = props => {
  const {
    modal
  } = props;
  const AttachBotInstallModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'AttachBotInstallModal', !modal);
  return AttachBotInstallModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AttachBotInstallModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachBotInstallModalAsync);

/***/ }),

/***/ "./src/components/modals/birthday/BirthdaySetupModal.async.tsx":
/*!*********************************************************************!*\
  !*** ./src/components/modals/birthday/BirthdaySetupModal.async.tsx ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const BirthdaySetupModalAsync = props => {
  const {
    modal
  } = props;
  const BirthdaySetupModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'BirthdaySetupModal', !modal);
  return BirthdaySetupModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BirthdaySetupModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BirthdaySetupModalAsync);

/***/ }),

/***/ "./src/components/modals/boost/BoostModal.async.tsx":
/*!**********************************************************!*\
  !*** ./src/components/modals/boost/BoostModal.async.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const BoostModalAsync = props => {
  const {
    modal
  } = props;
  const BoostModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'BoostModal', !modal);
  return BoostModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BoostModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BoostModalAsync);

/***/ }),

/***/ "./src/components/modals/chatInvite/ChatInviteModal.async.tsx":
/*!********************************************************************!*\
  !*** ./src/components/modals/chatInvite/ChatInviteModal.async.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ChatInviteModalAsync = props => {
  const {
    modal
  } = props;
  const ChatInviteModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ChatInviteModal', !modal);
  return ChatInviteModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ChatInviteModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatInviteModalAsync);

/***/ }),

/***/ "./src/components/modals/chatlist/ChatlistModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/chatlist/ChatlistModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ChatlistModalAsync = props => {
  const {
    modal
  } = props;
  const ChatlistModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ChatlistModal', !modal);
  return ChatlistModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ChatlistModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatlistModalAsync);

/***/ }),

/***/ "./src/components/modals/collectible/CollectibleInfoModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/collectible/CollectibleInfoModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const CollectibleInfoModalAsync = props => {
  const {
    modal
  } = props;
  const CollectibleInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'CollectibleInfoModal', !modal);
  return CollectibleInfoModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CollectibleInfoModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CollectibleInfoModalAsync);

/***/ }),

/***/ "./src/components/modals/deleteAccount/DeleteAccountModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/deleteAccount/DeleteAccountModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const DeleteAccountModalAsync = props => {
  const {
    modal
  } = props;
  const DeleteAccountModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'DeleteAccountModal', !modal);
  return DeleteAccountModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeleteAccountModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteAccountModalAsync);

/***/ }),

/***/ "./src/components/modals/emojiStatusAccess/EmojiStatusAccessModal.async.tsx":
/*!**********************************************************************************!*\
  !*** ./src/components/modals/emojiStatusAccess/EmojiStatusAccessModal.async.tsx ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const EmojiStatusAccessModalAsync = props => {
  const {
    modal
  } = props;
  const EmojiStatusAccessModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'EmojiStatusAccessModal', !modal);
  return EmojiStatusAccessModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(EmojiStatusAccessModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmojiStatusAccessModalAsync);

/***/ }),

/***/ "./src/components/modals/frozenAccount/FrozenAccountModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/frozenAccount/FrozenAccountModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const FrozenAccountModalAsync = props => {
  const {
    modal
  } = props;
  const FrozenAccountModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'FrozenAccountModal', !modal);
  return FrozenAccountModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(FrozenAccountModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (FrozenAccountModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/AboutStarGiftModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/AboutStarGiftModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const AboutStarGiftModalAsync = props => {
  const {
    modal
  } = props;
  const AboutStarGiftModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'AboutStarGiftModal', !modal);
  return AboutStarGiftModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AboutStarGiftModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AboutStarGiftModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/GiftModal.async.tsx":
/*!********************************************************!*\
  !*** ./src/components/modals/gift/GiftModal.async.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftModalAsync = props => {
  const {
    modal
  } = props;
  const GiftModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftModal', !modal);
  return GiftModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.async.tsx":
/*!*****************************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftPriceDecreaseInfoModal.async.tsx ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarGiftPriceDecreaseInfoModalAsync = props => {
  const {
    modal
  } = props;
  const StarGiftPriceDecreaseInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarGiftPriceDecreaseInfoModal', !modal);
  return StarGiftPriceDecreaseInfoModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarGiftPriceDecreaseInfoModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarGiftPriceDecreaseInfoModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionAcquiredModal.async.tsx":
/*!*******************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionAcquiredModal.async.tsx ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftAuctionAcquiredModalAsync = props => {
  const {
    modal
  } = props;
  const GiftAuctionAcquiredModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftAuctionAcquiredModal', !modal);
  return GiftAuctionAcquiredModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftAuctionAcquiredModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftAuctionAcquiredModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionBidModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionBidModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftAuctionBidModalAsync = props => {
  const {
    modal
  } = props;
  const GiftAuctionBidModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftAuctionBidModal', !modal);
  return GiftAuctionBidModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftAuctionBidModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftAuctionBidModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.async.tsx":
/*!**************************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionChangeRecipientModal.async.tsx ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftAuctionChangeRecipientModalAsync = props => {
  const {
    modal
  } = props;
  const GiftAuctionChangeRecipientModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftAuctionChangeRecipientModal', !modal);
  return GiftAuctionChangeRecipientModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftAuctionChangeRecipientModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftAuctionChangeRecipientModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionInfoModal.async.tsx":
/*!***************************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionInfoModal.async.tsx ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftAuctionInfoModalAsync = props => {
  const {
    modal
  } = props;
  const GiftAuctionInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftAuctionInfoModal', !modal);
  return GiftAuctionInfoModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftAuctionInfoModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftAuctionInfoModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/auction/GiftAuctionModal.async.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/auction/GiftAuctionModal.async.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftAuctionModalAsync = props => {
  const {
    modal
  } = props;
  const GiftAuctionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftAuctionModal', !modal);
  return GiftAuctionModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftAuctionModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftAuctionModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/info/GiftInfoModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/info/GiftInfoModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftInfoModalAsync = props => {
  const {
    modal
  } = props;
  const GiftInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftInfoModal', !modal);
  return GiftInfoModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftInfoModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftInfoModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/locked/GiftLockedModal.async.tsx":
/*!*********************************************************************!*\
  !*** ./src/components/modals/gift/locked/GiftLockedModal.async.tsx ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftLockedModalAsync = props => {
  const {
    modal
  } = props;
  const GiftLockedModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftLockedModal', !modal);
  return GiftLockedModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftLockedModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftLockedModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/message/GiftDescriptionRemoveModal.async.tsx":
/*!*********************************************************************************!*\
  !*** ./src/components/modals/gift/message/GiftDescriptionRemoveModal.async.tsx ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftDescriptionRemoveModalAsync = props => {
  const {
    modal
  } = props;
  const GiftDescriptionRemoveModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftDescriptionRemoveModal', !modal);
  return GiftDescriptionRemoveModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftDescriptionRemoveModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftDescriptionRemoveModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/recipient/GiftRecipientPicker.async.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/gift/recipient/GiftRecipientPicker.async.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftRecipientPickerAsync = props => {
  const {
    modal
  } = props;
  const GiftRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftRecipientPicker', !modal);
  return GiftRecipientPicker ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftRecipientPicker, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftRecipientPickerAsync);

/***/ }),

/***/ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.async.tsx":
/*!**********************************************************************************!*\
  !*** ./src/components/modals/gift/resale/GiftResalePriceComposerModal.async.tsx ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftResalePriceComposerModalAsync = props => {
  const {
    modal
  } = props;
  const GiftResalePriceComposerModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftResalePriceComposerModal', !modal);
  return GiftResalePriceComposerModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftResalePriceComposerModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftResalePriceComposerModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/status/GiftStatusInfoModal.async.tsx":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/status/GiftStatusInfoModal.async.tsx ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftStatusInfoModalAsync = props => {
  const {
    modal
  } = props;
  const GiftStatusInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftStatusInfoModal', !modal);
  return GiftStatusInfoModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftStatusInfoModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftStatusInfoModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/transfer/GiftTransferConfirmModal.async.tsx":
/*!********************************************************************************!*\
  !*** ./src/components/modals/gift/transfer/GiftTransferConfirmModal.async.tsx ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftTransferConfirmModalAsync = props => {
  const {
    modal
  } = props;
  const GiftTransferConfirmModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftTransferConfirmModal', !modal);
  return GiftTransferConfirmModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftTransferConfirmModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftTransferConfirmModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/transfer/GiftTransferModal.async.tsx":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/transfer/GiftTransferModal.async.tsx ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftTransferModalAsync = props => {
  const {
    modal
  } = props;
  const GiftTransferModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftTransferModal', !modal);
  return GiftTransferModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftTransferModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftTransferModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/upgrade/GiftUpgradeModal.async.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/upgrade/GiftUpgradeModal.async.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftUpgradeModalAsync = props => {
  const {
    modal
  } = props;
  const GiftUpgradeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftUpgradeModal', !modal);
  return GiftUpgradeModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftUpgradeModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftUpgradeModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/value/GiftInfoValueModal.async.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/value/GiftInfoValueModal.async.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftInfoValueModalAsync = props => {
  const {
    modal
  } = props;
  const GiftInfoValueModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftInfoValueModal', !modal);
  return GiftInfoValueModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftInfoValueModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftInfoValueModalAsync);

/***/ }),

/***/ "./src/components/modals/gift/withdraw/GiftWithdrawModal.async.tsx":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/withdraw/GiftWithdrawModal.async.tsx ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftWithdrawModalAsync = props => {
  const {
    modal
  } = props;
  const GiftWithdrawModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'GiftWithdrawModal', !modal);
  return GiftWithdrawModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftWithdrawModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftWithdrawModalAsync);

/***/ }),

/***/ "./src/components/modals/giftcode/GiftCodeModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/giftcode/GiftCodeModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const GiftCodeModalAsync = props => {
  const {
    modal
  } = props;
  const GiftCodeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'GiftCodeModal', !modal);
  return GiftCodeModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GiftCodeModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftCodeModalAsync);

/***/ }),

/***/ "./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const InviteViaLinkModalAsync = props => {
  const {
    modal
  } = props;
  const InviteViaLinkModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'InviteViaLinkModal', !modal);
  return InviteViaLinkModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(InviteViaLinkModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InviteViaLinkModalAsync);

/***/ }),

/***/ "./src/components/modals/locationAccess/LocationAccessModal.async.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/locationAccess/LocationAccessModal.async.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const LocationAccessModalAsync = props => {
  const {
    modal
  } = props;
  const LocationAccessModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'LocationAccessModal', !modal);
  return LocationAccessModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LocationAccessModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (LocationAccessModalAsync);

/***/ }),

/***/ "./src/components/modals/map/MapModal.async.tsx":
/*!******************************************************!*\
  !*** ./src/components/modals/map/MapModal.async.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const MapModalAsync = props => {
  const {
    modal
  } = props;
  const MapModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'MapModal', !modal);
  return MapModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MapModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MapModalAsync);

/***/ }),

/***/ "./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx":
/*!************************************************************************!*\
  !*** ./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const OneTimeMediaModalAsync = props => {
  const {
    modal
  } = props;
  const OneTimeMediaModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'OneTimeMediaModal', !modal);
  return OneTimeMediaModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(OneTimeMediaModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (OneTimeMediaModalAsync);

/***/ }),

/***/ "./src/components/modals/paidReaction/PaidReactionModal.async.tsx":
/*!************************************************************************!*\
  !*** ./src/components/modals/paidReaction/PaidReactionModal.async.tsx ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PaidReactionModalAsync = props => {
  const {
    modal
  } = props;
  const PaidReactionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'PaidReactionModal', !modal);
  return PaidReactionModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PaidReactionModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PaidReactionModalAsync);

/***/ }),

/***/ "./src/components/modals/passkey/PasskeyModal.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/modals/passkey/PasskeyModal.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PasskeyModalAsync = props => {
  const {
    modal
  } = props;
  const PasskeyModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PasskeyModal', !modal);
  return PasskeyModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PasskeyModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PasskeyModalAsync);

/***/ }),

/***/ "./src/components/modals/preparedMessage/PreparedMessageModal.async.tsx":
/*!******************************************************************************!*\
  !*** ./src/components/modals/preparedMessage/PreparedMessageModal.async.tsx ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PreparedMessageModalAsync = props => {
  const {
    modal
  } = props;
  const PreparedMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PreparedMessageModal', !modal);
  return PreparedMessageModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PreparedMessageModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PreparedMessageModalAsync);

/***/ }),

/***/ "./src/components/modals/priceConfirm/PriceConfirmModal.async.tsx":
/*!************************************************************************!*\
  !*** ./src/components/modals/priceConfirm/PriceConfirmModal.async.tsx ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PriceConfirmModalAsync = ({
  modal
}) => {
  const PriceConfirmModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'PriceConfirmModal', !modal);
  return PriceConfirmModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PriceConfirmModal, {
    modal: modal
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PriceConfirmModalAsync);

/***/ }),

/***/ "./src/components/modals/profileRating/ProfileRatingModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/profileRating/ProfileRatingModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ProfileRatingModalAsync = props => {
  const {
    modal
  } = props;
  const ProfileRatingModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ProfileRatingModal', !modal);
  return ProfileRatingModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ProfileRatingModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ProfileRatingModalAsync);

/***/ }),

/***/ "./src/components/modals/quickPreview/QuickPreviewModal.async.tsx":
/*!************************************************************************!*\
  !*** ./src/components/modals/quickPreview/QuickPreviewModal.async.tsx ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const QuickPreviewModalAsync = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(props => {
  const {
    modal
  } = props;
  const QuickPreviewModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'QuickPreviewModal', !modal);
  return QuickPreviewModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(QuickPreviewModal, {
    ...props
  }) : undefined;
});
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (QuickPreviewModalAsync);

/***/ }),

/***/ "./src/components/modals/reportAd/ReportAdModal.async.tsx":
/*!****************************************************************!*\
  !*** ./src/components/modals/reportAd/ReportAdModal.async.tsx ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ReportAdModalAsync = props => {
  const {
    modal
  } = props;
  const ReportAdModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ReportAdModal', !modal);
  return ReportAdModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ReportAdModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReportAdModalAsync);

/***/ }),

/***/ "./src/components/modals/reportModal/ReportModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/reportModal/ReportModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ReportModalAsync = props => {
  const {
    modal
  } = props;
  const ReportModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ReportModal', !modal);
  return ReportModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ReportModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReportModalAsync);

/***/ }),

/***/ "./src/components/modals/sharePreparedMessage/SharePreparedMessageModal.async.tsx":
/*!****************************************************************************************!*\
  !*** ./src/components/modals/sharePreparedMessage/SharePreparedMessageModal.async.tsx ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const SharePreparedMessageModalAsync = props => {
  const {
    modal
  } = props;
  const SharePreparedMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'SharePreparedMessageModal', !modal);
  return SharePreparedMessageModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SharePreparedMessageModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SharePreparedMessageModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/StarsBalanceModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarsBalanceModalAsync = props => {
  const {
    modal
  } = props;
  const StarsBalanceModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarsBalanceModal', !modal);
  return StarsBalanceModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarsBalanceModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsBalanceModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/StarsPaymentModal.async.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/stars/StarsPaymentModal.async.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarPaymentModalAsync = props => {
  const {
    modal
  } = props;
  const StarPaymentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarPaymentModal', !modal?.inputInvoice);
  return StarPaymentModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarPaymentModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarPaymentModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/chatRefund/ChatRefundModal.async.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/stars/chatRefund/ChatRefundModal.async.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ChatRefundModalAsync = props => {
  const {
    modal
  } = props;
  const ChatRefundModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'ChatRefundModal', !modal);
  return ChatRefundModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ChatRefundModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatRefundModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/gift/StarsGiftModal.async.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/stars/gift/StarsGiftModal.async.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarsGiftModalAsync = props => {
  const {
    modal
  } = props;
  const StarsGiftModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarsGiftModal', !modal);
  return StarsGiftModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarsGiftModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsGiftModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionModal.async.tsx":
/*!***********************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionModal.async.tsx ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarsSubscriptionModalAsync = props => {
  const {
    modal
  } = props;
  const StarsSubscriptionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarsSubscriptionModal', !modal);
  return StarsSubscriptionModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarsSubscriptionModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsSubscriptionModalAsync);

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionModal.async.tsx":
/*!*********************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionModal.async.tsx ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StarsTransactionModalAsync = props => {
  const {
    modal
  } = props;
  const StarsTransactionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Stars, 'StarsTransactionInfoModal', !modal);
  return StarsTransactionModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StarsTransactionModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsTransactionModalAsync);

/***/ }),

/***/ "./src/components/modals/storyStealthMode/StealthModeModal.async.tsx":
/*!***************************************************************************!*\
  !*** ./src/components/modals/storyStealthMode/StealthModeModal.async.tsx ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const StealthModeModalAsync = props => {
  const {
    modal
  } = props;
  const StealthModeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'StealthModeModal', !modal);
  return StealthModeModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StealthModeModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StealthModeModalAsync);

/***/ }),

/***/ "./src/components/modals/suggestMessage/SuggestMessageModal.async.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/suggestMessage/SuggestMessageModal.async.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const SuggestMessageModalAsync = props => {
  const {
    modal
  } = props;
  const SuggestMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'SuggestMessageModal', !modal);
  return SuggestMessageModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SuggestMessageModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SuggestMessageModalAsync);

/***/ }),

/***/ "./src/components/modals/suggestedPostApproval/SuggestedPostApprovalModal.async.tsx":
/*!******************************************************************************************!*\
  !*** ./src/components/modals/suggestedPostApproval/SuggestedPostApprovalModal.async.tsx ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const SuggestedPostApprovalModalAsync = props => {
  const {
    modal
  } = props;
  const SuggestedPostApprovalModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'SuggestedPostApprovalModal', !modal);
  return SuggestedPostApprovalModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SuggestedPostApprovalModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SuggestedPostApprovalModalAsync);

/***/ }),

/***/ "./src/components/modals/suggestedStatus/SuggestedStatusModal.async.tsx":
/*!******************************************************************************!*\
  !*** ./src/components/modals/suggestedStatus/SuggestedStatusModal.async.tsx ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const SuggestedStatusModalAsync = props => {
  const {
    modal
  } = props;
  const SuggestedStatusModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'SuggestedStatusModal', !modal);
  return SuggestedStatusModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SuggestedStatusModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SuggestedStatusModalAsync);

/***/ }),

/***/ "./src/components/modals/urlAuth/UrlAuthModal.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/modals/urlAuth/UrlAuthModal.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const UrlAuthModalAsync = props => {
  const {
    modal
  } = props;
  const UrlAuthModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'UrlAuthModal', !modal);
  return UrlAuthModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(UrlAuthModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UrlAuthModalAsync);

/***/ }),

/***/ "./src/components/modals/webApp/WebAppModal.async.tsx":
/*!************************************************************!*\
  !*** ./src/components/modals/webApp/WebAppModal.async.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const WebAppModalAsync = props => {
  const {
    modal
  } = props;
  const WebAppModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'WebAppModal', !modal?.isModalOpen);
  return WebAppModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(WebAppModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WebAppModalAsync);

/***/ }),

/***/ "./src/components/payment/PaymentModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/payment/PaymentModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const PaymentModalAsync = props => {
  const {
    isOpen
  } = props;
  const PaymentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PaymentModal', !isOpen);
  return PaymentModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PaymentModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PaymentModalAsync);

/***/ }),

/***/ "./src/components/payment/ReceiptModal.async.tsx":
/*!*******************************************************!*\
  !*** ./src/components/payment/ReceiptModal.async.tsx ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



const ReceiptModalAsync = props => {
  const {
    isOpen
  } = props;
  const ReceiptModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'ReceiptModal', !isOpen);
  return ReceiptModal ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ReceiptModal, {
    ...props
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReceiptModalAsync);

/***/ }),

/***/ "./src/components/right/AddChatMembers.scss":
/*!**************************************************!*\
  !*** ./src/components/right/AddChatMembers.scss ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/AddChatMembers.tsx":
/*!*************************************************!*\
  !*** ./src/components/right/AddChatMembers.tsx ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/FloatingActionButton */ "./src/components/ui/FloatingActionButton.tsx");
/* harmony import */ var _AddChatMembers_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./AddChatMembers.scss */ "./src/components/right/AddChatMembers.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");















const AddChatMembers = ({
  isChannel,
  members,
  onNextStep,
  currentUserId,
  localContactIds,
  isLoading,
  searchQuery,
  isSearching,
  localUserIds,
  globalUserIds,
  onClose,
  isActive
}) => {
  const {
    setUserSearchQuery
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [selectedMemberIds, setSelectedMemberIds] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const prevSelectedMemberIds = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_10__["default"])(selectedMemberIds);
  const noPickerScrollRestore = prevSelectedMemberIds === selectedMemberIds;
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isActive,
    onBack: onClose
  });
  const memberIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return members ? members.map(member => member.userId) : [];
  }, [members]);
  const handleFilterChange = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(query => {
    setUserSearchQuery({
      query
    });
  }, [setUserSearchQuery]);
  const displayedIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    // No need for expensive global updates on users, so we avoid them
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    const filteredIds = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.filterPeersByQuery)({
      ids: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_6__.unique)([...(localContactIds || []), ...(localUserIds || []), ...(globalUserIds || [])]),
      query: searchQuery,
      type: 'user'
    });
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_7__["default"])(filteredIds.filter(userId => {
      const user = usersById[userId];

      // The user can be added to the chat if the following conditions are met:
      // the user has not yet been added to the current chat
      // AND it is not the current user,
      // AND (it is not found (user from global search) OR it is not a bot OR it is a bot,
      // but the current chat is not a channel AND the appropriate permission is set).
      return !memberIds.includes(userId) && userId !== currentUserId && (!user || !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserBot)(user) || !isChannel && user.canBeInvitedToGroup);
    }));
  }, [localContactIds, searchQuery, localUserIds, globalUserIds, currentUserId, memberIds, isChannel]);
  const handleNextStep = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (selectedMemberIds.length) {
      setUserSearchQuery({
        query: ''
      });
      onNextStep(selectedMemberIds);
    }
  }, [selectedMemberIds, setUserSearchQuery, onNextStep]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div", {
    className: "AddChatMembers",
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("div", {
      className: "AddChatMembers-inner",
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_11__["default"], {
        itemIds: displayedIds,
        selectedIds: selectedMemberIds,
        filterValue: searchQuery,
        filterPlaceholder: lang('lng_channel_add_users'),
        searchInputId: "new-members-picker-search",
        isLoading: isSearching,
        onSelectedIdsChange: setSelectedMemberIds,
        onFilterChange: handleFilterChange,
        isSearchable: true,
        withDefaultPadding: true,
        noScrollRestore: noPickerScrollRestore,
        allowMultiple: true,
        withStatus: true,
        itemInputType: "checkbox"
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_12__["default"], {
        isShown: Boolean(selectedMemberIds.length),
        disabled: isLoading,
        ariaLabel: lang('lng_channel_add_users'),
        onClick: handleNextStep,
        iconName: "arrow-right",
        isLoading: isLoading
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, chatId);
  const {
    userIds: localContactIds
  } = global.contactList || {};
  const {
    newChatMembersProgress
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const {
    currentUserId
  } = global;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat);
  const {
    query: searchQuery,
    fetchingStatus,
    globalUserIds,
    localUserIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global).userSearch;
  return {
    isChannel,
    members: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatFullInfo)(global, chatId)?.members,
    currentUserId,
    localContactIds,
    searchQuery,
    isSearching: fetchingStatus,
    isLoading: newChatMembersProgress === _types__WEBPACK_IMPORTED_MODULE_2__.NewChatMembersProgress.Loading,
    globalUserIds,
    localUserIds
  };
})(AddChatMembers)));

/***/ }),

/***/ "./src/components/right/CreateTopic.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/right/CreateTopic.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const CreateTopicAsync = props => {
  const CreateTopic = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'CreateTopic');
  return CreateTopic ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(CreateTopic, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CreateTopicAsync);

/***/ }),

/***/ "./src/components/right/EditTopic.async.tsx":
/*!**************************************************!*\
  !*** ./src/components/right/EditTopic.async.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const EditTopicAsync = props => {
  const EditTopic = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'EditTopic');
  return EditTopic ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(EditTopic, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EditTopicAsync);

/***/ }),

/***/ "./src/components/right/GifSearch.async.tsx":
/*!**************************************************!*\
  !*** ./src/components/right/GifSearch.async.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const GifSearchAsync = props => {
  const {
    isActive
  } = props;
  const GifSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'GifSearch', !isActive);
  return GifSearch ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(GifSearch, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GifSearchAsync);

/***/ }),

/***/ "./src/components/right/PollResults.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/right/PollResults.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const PollResultsAsync = props => {
  const {
    isActive
  } = props;
  const PollResults = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'PollResults', !isActive);
  return PollResults ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(PollResults, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PollResultsAsync);

/***/ }),

/***/ "./src/components/right/Profile.scss":
/*!*******************************************!*\
  !*** ./src/components/right/Profile.scss ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/Profile.tsx":
/*!******************************************!*\
  !*** ./src/components/right/Profile.tsx ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors_payments__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors/payments */ "./src/global/selectors/payments.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_stars__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/helpers/stars */ "./src/global/helpers/stars.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _global_selectors_stories__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../global/selectors/stories */ "./src/global/selectors/stories.ts");
/* harmony import */ var _util_animations_viewTransitionTypes_ts__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/animations/viewTransitionTypes.ts */ "./src/util/animations/viewTransitionTypes.ts");
/* harmony import */ var _util_areDeepEqual__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/areDeepEqual */ "./src/util/areDeepEqual.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _left_search_helpers_getSenderName__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../left/search/helpers/getSenderName */ "./src/components/left/search/helpers/getSenderName.ts");
/* harmony import */ var _hooks_animations_useViewTransition__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/animations/useViewTransition */ "./src/hooks/animations/useViewTransition.ts");
/* harmony import */ var _hooks_animations_useVtn_ts__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/animations/useVtn.ts */ "./src/hooks/animations/useVtn.ts");
/* harmony import */ var _hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/polling/usePeerStoriesPolling */ "./src/hooks/polling/usePeerStoriesPolling.ts");
/* harmony import */ var _hooks_scroll_useTopOverscroll_tsx__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/scroll/useTopOverscroll.tsx */ "./src/hooks/scroll/useTopOverscroll.tsx");
/* harmony import */ var _hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/useCacheBuster */ "./src/hooks/useCacheBuster.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_useSyncEffectWithPrevDeps_ts__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../../hooks/useSyncEffectWithPrevDeps.ts */ "./src/hooks/useSyncEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _hooks_useProfileState__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./hooks/useProfileState */ "./src/components/right/hooks/useProfileState.ts");
/* harmony import */ var _hooks_useProfileViewportIds__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./hooks/useProfileViewportIds */ "./src/components/right/hooks/useProfileViewportIds.ts");
/* harmony import */ var _hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./hooks/useTransitionFixes */ "./src/components/right/hooks/useTransitionFixes.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_gift_SavedGift__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../common/gift/SavedGift */ "./src/components/common/gift/SavedGift.tsx");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_Media__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../common/Media */ "./src/components/common/Media.tsx");
/* harmony import */ var _common_NothingFound__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../common/NothingFound */ "./src/components/common/NothingFound.tsx");
/* harmony import */ var _common_PreviewMedia__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../common/PreviewMedia */ "./src/components/common/PreviewMedia.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _common_profile_ChatExtra__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../common/profile/ChatExtra */ "./src/components/common/profile/ChatExtra.tsx");
/* harmony import */ var _common_profile_ProfileInfo_tsx__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ../common/profile/ProfileInfo.tsx */ "./src/components/common/profile/ProfileInfo.tsx");
/* harmony import */ var _common_WebLink__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ../common/WebLink */ "./src/components/common/WebLink.tsx");
/* harmony import */ var _left_main_ChatList__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ../left/main/ChatList */ "./src/components/left/main/ChatList.tsx");
/* harmony import */ var _story_MediaStory__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ../story/MediaStory */ "./src/components/story/MediaStory.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ../ui/FloatingActionButton */ "./src/components/ui/FloatingActionButton.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _DeleteMemberModal__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ./DeleteMemberModal */ "./src/components/right/DeleteMemberModal.tsx");
/* harmony import */ var _gifts_StarGiftCollectionList__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./gifts/StarGiftCollectionList */ "./src/components/right/gifts/StarGiftCollectionList.tsx");
/* harmony import */ var _stories_StoryAlbumList__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ./stories/StoryAlbumList */ "./src/components/right/stories/StoryAlbumList.tsx");
/* harmony import */ var _Profile_scss__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! ./Profile.scss */ "./src/components/right/Profile.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






const CONTENT_PANEL_SHOW_DELAY = 300;





























































const TABS = [{
  type: 'media',
  key: 'ProfileTabMedia'
}, {
  type: 'documents',
  key: 'ProfileTabFiles'
}, {
  type: 'links',
  key: 'ProfileTabLinks'
}, {
  type: 'audio',
  key: 'ProfileTabMusic'
}, {
  type: 'gif',
  key: 'ProfileTabGifs'
}];
const HIDDEN_RENDER_DELAY = 1000;
const INTERSECTION_THROTTLE = 500;
const VALID_CHANNEL_MAIN_TAB_TYPES = new Set(['stories', 'gifts', 'media', 'documents', 'audio', 'voice', 'links', 'gif']);
const VALID_USER_MAIN_TAB_TYPES = new Set(['stories', 'gifts']);
const SHARED_MEDIA_TYPES = new Set(['media', 'documents', 'links', 'audio', 'voice', 'gif']);
const Profile = ({
  chatId,
  isActive,
  threadId,
  chatInfo,
  profileState,
  theme,
  monoforumChannel,
  isChannel,
  isBot,
  currentUserId,
  messagesById,
  foundIds,
  storyIds,
  pinnedStoryIds,
  archiveStoryIds,
  storyByIds,
  selectedStoryAlbumId,
  activeCollectionId,
  giftsFilter,
  mediaSearchType,
  hasCommonChatsTab,
  hasStoriesTab,
  hasMembersTab,
  hasPreviewMediaTab,
  hasGiftsTab,
  gifts,
  storyAlbums,
  giftCollections,
  botPreviewMedia,
  areMembersHidden,
  canAddMembers,
  canDeleteMembers,
  commonChatIds,
  members,
  adminMembersById,
  usersById,
  userStatusesById,
  chatsById,
  isRightColumnShown,
  isRestricted,
  activeDownloads,
  isChatProtected,
  animationLevel,
  shouldWarnAboutFiles,
  similarChannels,
  similarBots,
  isCurrentUserPremium,
  limitSimilarPeers,
  isTopicInfo,
  isSavedDialog,
  isSavedMessages,
  isSynced,
  hasAvatar,
  peerFullInfo,
  canUpdateMainTab,
  canAutoPlayGifs,
  onProfileStateChange
}) => {
  const {
    setSharedMediaSearchType,
    loadMoreMembers,
    loadCommonChats,
    openChat,
    searchSharedMediaMessages,
    openMediaViewer,
    openAudioPlayer,
    focusMessage,
    setNewChatMembersDialogState,
    loadPeerProfileStories,
    loadStoriesArchive,
    openPremiumModal,
    loadChannelRecommendations,
    loadBotRecommendations,
    loadPreviewMedias,
    loadPeerSavedGifts,
    resetGiftProfileFilter,
    loadStarGiftCollections,
    loadStoryAlbums,
    resetSelectedStoryAlbum,
    changeProfileTab,
    setMainProfileTab
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const shouldSkipTransitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_33__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_31__["default"])();
  const [deletingUserId, setDeletingUserId] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isGiftTransitionEnabled, enableGiftTransition, disableGiftTransition] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_29__["default"])();
  const isClosed = !chatInfo.isOpen;
  const {
    profileTab,
    forceScrollProfileTab,
    isOwnProfile
  } = chatInfo;
  const profileId = isSavedDialog ? String(threadId) : chatId;
  const isGeneralSavedMessages = isSavedMessages && !isSavedDialog;
  const [isProfileExpanded, expandProfile, collapseProfile] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_29__["default"])();
  const [restoreContentHeightKey, setRestoreContentHeightKey] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const isUser = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_18__.isUserId)(chatId);
  const validMainTabTypes = isUser ? VALID_USER_MAIN_TAB_TYPES : VALID_CHANNEL_MAIN_TAB_TYPES;
  const mainTab = peerFullInfo?.mainTab;
  const tabs = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const arr = [];
    if (isGeneralSavedMessages) {
      arr.push({
        type: 'dialogs',
        key: 'ProfileTabSavedDialogs'
      });
    }
    if (hasStoriesTab) {
      arr.push({
        type: 'stories',
        key: 'ProfileTabStories'
      });
    }
    if (hasGiftsTab) {
      arr.push({
        type: 'gifts',
        key: 'ProfileTabGifts'
      });
    }
    if (hasStoriesTab && isOwnProfile) {
      arr.push({
        type: 'storiesArchive',
        key: 'ProfileTabStoriesArchive'
      });
    }
    if (hasMembersTab && !isOwnProfile) {
      arr.push({
        type: 'members',
        key: 'ProfileTabMembers'
      });
    }
    if (hasPreviewMediaTab && !isOwnProfile) {
      arr.push({
        type: 'previewMedia',
        key: 'ProfileTabBotPreview'
      });
    }
    if (!isOwnProfile) {
      arr.push(...TABS);
    }

    // Voice messages filter currently does not work in forum topics. Return it when it's fixed on the server side.
    if (!isTopicInfo && !isOwnProfile) {
      arr.push({
        type: 'voice',
        key: 'ProfileTabVoice'
      });
    }
    if (hasCommonChatsTab && !isOwnProfile) {
      arr.push({
        type: 'commonChats',
        key: 'ProfileTabSharedGroups'
      });
    }
    if (isChannel && similarChannels?.length && !isOwnProfile) {
      arr.push({
        type: 'similarChannels',
        key: 'ProfileTabSimilarChannels'
      });
    }
    if (isBot && similarBots?.length && !isOwnProfile) {
      arr.push({
        type: 'similarBots',
        key: 'ProfileTabSimilarBots'
      });
    }

    // Fallback to prevent errors in edge cases
    // TODO: Handle no tabs case, skip shared media block
    if (!arr.length) {
      arr.push(TABS[0]);
    }
    if (mainTab) {
      const mainTabIndex = arr.findIndex(tab => tab.type === mainTab);
      if (mainTabIndex !== -1) {
        const newFirstTab = arr[mainTabIndex];
        arr.splice(mainTabIndex, 1);
        arr.unshift(newFirstTab);
      }
    }
    return arr.map(tab => {
      const contextActions = canUpdateMainTab && mainTab !== tab.type && validMainTabTypes.has(tab.type) ? [{
        title: lang('ProfileMenuSetMainTab'),
        icon: 'reorder-tabs',
        handler: () => {
          setMainProfileTab({
            chatId,
            tab: tab.type
          });
        }
      }] : undefined;
      return {
        type: tab.type,
        title: lang(tab.key),
        contextActions
      };
    });
  }, [isGeneralSavedMessages, hasStoriesTab, hasGiftsTab, hasMembersTab, hasPreviewMediaTab, isTopicInfo, hasCommonChatsTab, isChannel, isBot, similarChannels?.length, similarBots?.length, lang, isOwnProfile, mainTab, chatId, canUpdateMainTab, validMainTabTypes]);
  const [allowAutoScrollToTabs, startAutoScrollToTabsIfNeeded, stopAutoScrollToTabs] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_29__["default"])(false);
  const setActiveTab = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(type => {
    if (isClosed) return;
    changeProfileTab({
      profileTab: type
    });
    setSharedMediaSearchType({
      mediaType: SHARED_MEDIA_TYPES.has(type) ? type : undefined
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isClosed) return;
    if (profileTab) {
      // Force reset scroll marker
      changeProfileTab({
        profileTab,
        shouldScrollTo: undefined
      });
      return;
    }
    ;
    setActiveTab(tabs[0].type); // Set default tab
  }, [isClosed, profileTab, tabs]);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_28__["default"])(([prevPeerFullInfo]) => {
    if (prevPeerFullInfo || !peerFullInfo?.mainTab) return;
    setActiveTab(peerFullInfo.mainTab); // Only focus when loading full info
  }, [peerFullInfo]);
  const handleSwitchTab = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(index => {
    startAutoScrollToTabsIfNeeded();
    setActiveTab(tabs[index].type);
  }, [tabs]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasPreviewMediaTab && !botPreviewMedia) {
      loadPreviewMedias({
        botId: chatId
      });
    }
  }, [chatId, botPreviewMedia, hasPreviewMediaTab]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isChannel && !similarChannels && isSynced) {
      loadChannelRecommendations({
        chatId
      });
    }
  }, [chatId, isChannel, similarChannels, isSynced]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isBot && !similarBots && isSynced) {
      loadBotRecommendations({
        userId: chatId
      });
    }
  }, [chatId, isBot, similarBots, isSynced]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    resetSelectedStoryAlbum();
  }, [chatId]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_34__["default"])(() => {
    enableGiftTransition();
  }, [giftsFilter]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_34__["default"])(() => {
    disableGiftTransition();
  }, [gifts]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasGiftsTab && isSynced) {
      loadStarGiftCollections({
        peerId: chatId
      });
      loadStoryAlbums({
        peerId: chatId
      });
    }
  }, [chatId, hasGiftsTab, isSynced]);
  const [renderingGifts, setRenderingGifts] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(gifts);
  const {
    startViewTransition
  } = (0,_hooks_animations_useViewTransition__WEBPACK_IMPORTED_MODULE_23__.useViewTransition)();
  const {
    createVtnStyle
  } = (0,_hooks_animations_useVtn_ts__WEBPACK_IMPORTED_MODULE_24__.useVtn)();
  const giftIds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => renderingGifts?.map(gift => (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_7__.getSavedGiftKey)(gift)), [renderingGifts]);
  const activeTabIndex = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const index = tabs.findIndex(({
      type
    }) => type === profileTab);
    return index === -1 ? 0 : index;
  }, [profileTab, tabs]);

  // Reset skip transition flag from previous render
  if (shouldSkipTransitionRef.current) {
    shouldSkipTransitionRef.current = false;
  }
  (0,_hooks_useSyncEffectWithPrevDeps_ts__WEBPACK_IMPORTED_MODULE_35__["default"])(([prevProfileTab, prevActiveTabIndex]) => {
    if (prevProfileTab === profileTab && prevActiveTabIndex !== activeTabIndex) {
      shouldSkipTransitionRef.current = true;
    }
  }, [profileTab, activeTabIndex]);
  const tabType = tabs[activeTabIndex].type;
  const handleLoadCommonChats = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    loadCommonChats({
      userId: chatId
    });
  }, [chatId]);
  const handleLoadPeerStories = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({
    offsetId
  }) => {
    loadPeerProfileStories({
      peerId: chatId,
      offsetId
    });
  }, [chatId]);
  const handleLoadStoriesArchive = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({
    offsetId
  }) => {
    loadStoriesArchive({
      peerId: chatId,
      offsetId
    });
  }, [chatId]);
  const handleLoadGifts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    loadPeerSavedGifts({
      peerId: chatId
    });
  }, [chatId]);
  const handleLoadMoreMembers = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    loadMoreMembers({
      chatId
    });
  }, [chatId, loadMoreMembers]);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_28__["default"])(([prevGifts]) => {
    if ((0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_14__.areDeepEqual)(gifts, prevGifts)) {
      return;
    }
    if (!gifts || !prevGifts || !isGiftTransitionEnabled) {
      setRenderingGifts(gifts);
      return;
    }
    const prevGiftIds = prevGifts.map(gift => (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_7__.getSavedGiftKey)(gift));
    const newGiftIds = gifts.map(gift => (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_7__.getSavedGiftKey)(gift));
    const hasOrderChanged = prevGiftIds.some((id, index) => id !== newGiftIds[index]);
    if (hasOrderChanged) {
      startViewTransition(_util_animations_viewTransitionTypes_ts__WEBPACK_IMPORTED_MODULE_13__.VTT_PROFILE_GIFTS, () => {
        setRenderingGifts(gifts);
      });
    } else {
      setRenderingGifts(gifts);
    }
  }, [gifts, startViewTransition, isGiftTransitionEnabled]);
  const [resultType, viewportIds, getMore, noProfileInfo] = (0,_hooks_useProfileViewportIds__WEBPACK_IMPORTED_MODULE_38__["default"])({
    loadMoreMembers: handleLoadMoreMembers,
    searchMessages: searchSharedMediaMessages,
    loadStories: handleLoadPeerStories,
    loadStoriesArchive: handleLoadStoriesArchive,
    loadMoreGifts: handleLoadGifts,
    loadCommonChats: handleLoadCommonChats,
    tabType,
    mediaSearchType,
    groupChatMembers: members,
    commonChatIds,
    usersById,
    userStatusesById,
    chatsById,
    chatMessages: messagesById,
    foundIds,
    threadId,
    storyIds,
    giftIds,
    pinnedStoryIds,
    archiveStoryIds,
    similarChannels,
    similarBots
  });
  const shouldRenderProfileInfo = !noProfileInfo && !isSavedMessages;
  const isFirstTab = tabs[0].type === resultType;
  const activeKey = tabs.findIndex(({
    type
  }) => type === resultType);
  const [isGiftCollectionsShowed, markGiftCollectionsShowed, unmarkGiftCollectionsShowed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_29__["default"])(false);
  const [isStoryAlbumsShowed, markStoryAlbumsShowed, unmarkStoryAlbums] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_29__["default"])(false);
  const hasGiftsCollections = giftCollections && giftCollections.length > 0;
  const hasStoryAlbums = storyAlbums && storyAlbums.length > 0;
  const isGiftsResult = resultType === 'gifts';
  const isStoriesResult = resultType === 'stories';
  const shouldShowContentPanel = isGiftsResult && hasGiftsCollections || isStoriesResult && hasStoryAlbums;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasGiftsCollections) {
      setTimeout(() => {
        markGiftCollectionsShowed();
      }, CONTENT_PANEL_SHOW_DELAY);
    } else {
      unmarkGiftCollectionsShowed();
    }
    if (hasStoryAlbums) {
      setTimeout(() => {
        markStoryAlbumsShowed();
      }, CONTENT_PANEL_SHOW_DELAY);
    } else {
      unmarkStoryAlbums();
    }
  }, [hasGiftsCollections, hasStoryAlbums, markGiftCollectionsShowed, markStoryAlbumsShowed]);
  (0,_hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_25__["default"])(resultType === 'members' ? viewportIds : undefined);
  const handleStopAutoScrollToTabs = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    stopAutoScrollToTabs();
  });
  const handleExpandProfile = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    if (isProfileExpanded) return;
    startViewTransition(_util_animations_viewTransitionTypes_ts__WEBPACK_IMPORTED_MODULE_13__.VTT_RIGHT_PROFILE_EXPAND, () => {
      expandProfile();
    });
  });
  const handleCollapseProfile = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    if (!isProfileExpanded) return;
    startViewTransition(_util_animations_viewTransitionTypes_ts__WEBPACK_IMPORTED_MODULE_13__.VTT_RIGHT_PROFILE_COLLAPSE, () => {
      collapseProfile();
    });
  });
  const {
    handleScroll
  } = (0,_hooks_useProfileState__WEBPACK_IMPORTED_MODULE_37__["default"])({
    containerRef,
    tabType: resultType,
    profileState,
    forceScrollProfileTab,
    allowAutoScrollToTabs,
    onProfileStateChange,
    handleStopAutoScrollToTabs
  });
  (0,_hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_39__["default"])(containerRef);
  const [cacheBuster, resetCacheBuster] = (0,_hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_27__["default"])();
  const {
    observe: observeIntersectionForMedia
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_30__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  const handleNewMemberDialogOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    setNewChatMembersDialogState({
      newChatMembersProgress: _types__WEBPACK_IMPORTED_MODULE_3__.NewChatMembersProgress.InProgress
    });
  });
  const handleSelectMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(messageId => {
    openMediaViewer({
      chatId: profileId,
      threadId: _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      messageId,
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.MediaViewerOrigin.SharedMedia
    });
  });
  const handleSelectPreviewMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(index => {
    openMediaViewer({
      standaloneMedia: botPreviewMedia?.flatMap(item => item?.content.photo || item?.content.video).filter(Boolean),
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.MediaViewerOrigin.PreviewMedia,
      mediaIndex: index
    });
  });
  const handlePlayAudio = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(messageId => {
    openAudioPlayer({
      chatId: profileId,
      messageId
    });
  });
  const handleMemberClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(id => {
    openChat({
      id
    });
  });
  const handleMessageFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(message => {
    focusMessage({
      chatId: message.chatId,
      messageId: message.id
    });
  });
  const handleDeleteMembersModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    setDeletingUserId(undefined);
  });
  const handleResetGiftsFilter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    resetGiftProfileFilter({
      peerId: chatId
    });
  });
  (0,_hooks_scroll_useTopOverscroll_tsx__WEBPACK_IMPORTED_MODULE_26__["default"])({
    containerRef,
    onOverscroll: handleExpandProfile,
    onReset: handleCollapseProfile,
    isOverscrolled: isProfileExpanded,
    isDisabled: !hasAvatar || !shouldRenderProfileInfo
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!transitionRef.current || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_15__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_17__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.Profile',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_17__.SwipeDirection.Left) {
          const nextIndex = Math.min(activeTabIndex + 1, tabs.length - 1);
          setActiveTab(tabs[nextIndex].type);
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_17__.SwipeDirection.Right) {
          const nextIndex = Math.max(0, activeTabIndex - 1);
          setActiveTab(tabs[nextIndex].type);
          return true;
        }
        return false;
      }
    });
  }, [activeTabIndex, tabs]);
  let renderingDelay;
  // @optimization Used to unparallelize rendering of message list and profile media
  if (isFirstTab) {
    renderingDelay = !isRightColumnShown ? HIDDEN_RENDER_DELAY : 0;
    // @optimization Used to delay first render of secondary tabs while animating
  } else if (!viewportIds && !botPreviewMedia || !gifts?.length && resultType === 'gifts') {
    renderingDelay = _config__WEBPACK_IMPORTED_MODULE_4__.SLIDE_TRANSITION_DURATION;
  }
  const canRenderContent = (0,_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_36__["default"])([chatId, threadId, resultType, activeTabIndex, activeCollectionId, selectedStoryAlbumId], renderingDelay);
  function getMemberContextAction(memberId) {
    return memberId === currentUserId || !canDeleteMembers ? undefined : [{
      title: oldLang('lng_context_remove_from_group'),
      icon: 'stop',
      handler: () => {
        setDeletingUserId(memberId);
      }
    }];
  }
  function renderNothingFoundGiftsWithFilter() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
      className: "nothing-found-gifts",
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_40__["default"], {
        size: 160,
        tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_20__.LOCAL_TGS_URLS.SearchingDuck,
        nonInteractive: true,
        noLoop: true
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
        className: "description",
        children: lang('GiftSearchEmpty')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_57__["default"], {
        className: "date",
        onClick: handleResetGiftsFilter,
        children: lang('GiftSearchReset')
      })]
    });
  }
  function renderContent() {
    if (resultType === 'dialogs') {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_left_main_ChatList__WEBPACK_IMPORTED_MODULE_52__["default"], {
        className: "saved-dialogs",
        folderType: "saved",
        isActive: true
      });
    }
    const noContent = !viewportIds && !botPreviewMedia || !canRenderContent || !messagesById;
    const noSpinner = isFirstTab && !canRenderContent;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
      children: [renderCategories(), renderSpinnerOrContent(noContent, noSpinner)]
    });
  }
  function renderCategories() {
    if (resultType === 'gifts') {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_16__["default"])('contentCategoriesPanel', !shouldShowContentPanel && 'hiddenPanel', isGiftCollectionsShowed && 'noTransition'),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_gifts_StarGiftCollectionList__WEBPACK_IMPORTED_MODULE_63__["default"], {
          peerId: chatId
        })
      });
    }
    if (resultType === 'stories') {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_16__["default"])('contentCategoriesPanel', !shouldShowContentPanel && 'hiddenPanel', isStoryAlbumsShowed && 'noTransition'),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_stories_StoryAlbumList__WEBPACK_IMPORTED_MODULE_64__["default"], {
          peerId: chatId
        })
      });
    }
    return undefined;
  }
  function renderSpinnerOrContentBase(noContent, noSpinner) {
    if (noContent) {
      const forceRenderHiddenMembers = Boolean(resultType === 'members' && areMembersHidden);
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
        className: "content empty-list",
        children: [!noSpinner && !forceRenderHiddenMembers && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Spinner__WEBPACK_IMPORTED_MODULE_59__["default"], {}), forceRenderHiddenMembers && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_NothingFound__WEBPACK_IMPORTED_MODULE_46__["default"], {
          text: lang('ChatMemberListNoAccess')
        })]
      });
    }
    const isViewportIdsEmpty = viewportIds && !viewportIds?.length;
    if (isViewportIdsEmpty && resultType === 'gifts') {
      return renderNothingFoundGiftsWithFilter();
    }
    if (isViewportIdsEmpty) {
      let text;
      switch (resultType) {
        case 'members':
          text = areMembersHidden ? lang('ChatMemberListNoAccess') : lang('NoMembersFound');
          break;
        case 'commonChats':
          text = oldLang('NoGroupsInCommon');
          break;
        case 'documents':
          text = oldLang('lng_media_file_empty');
          break;
        case 'links':
          text = oldLang('lng_media_link_empty');
          break;
        case 'audio':
          text = oldLang('lng_media_song_empty');
          break;
        case 'voice':
          text = oldLang('lng_media_audio_empty');
          break;
        case 'stories':
          text = oldLang('StoryList.SavedEmptyState.Title');
          break;
        case 'storiesArchive':
          text = oldLang('StoryList.ArchivedEmptyState.Title');
          break;
        case 'gif':
          text = oldLang('lng_media_gif_empty');
          break;
        default:
          text = oldLang('SharedMedia.EmptyTitle');
      }
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
        className: "content empty-list",
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_NothingFound__WEBPACK_IMPORTED_MODULE_46__["default"], {
          text: text
        })
      });
    }
    if (!messagesById) {
      // A TypeScript assertion, should never be really reached
      return;
    }
    const noTransition = resultType === 'gifts' ? isGiftCollectionsShowed : resultType === 'stories' ? isStoryAlbumsShowed : false;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_16__["default"])(`content ${resultType}-list`, shouldShowContentPanel && 'showContentPanel', noTransition && 'noTransition'),
      dir: lang.isRtl && (resultType === 'media' || resultType === 'gif') ? 'rtl' : undefined,
      teactFastList: true,
      children: resultType === 'media' || resultType === 'gif' ? viewportIds.map(id => messagesById[id] && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_Media__WEBPACK_IMPORTED_MODULE_45__["default"], {
        message: messagesById[id],
        isProtected: isChatProtected || messagesById[id].isProtected,
        canAutoPlay: canAutoPlayGifs,
        observeIntersection: observeIntersectionForMedia,
        onClick: handleSelectMedia
      }, id)) : resultType === 'stories' || resultType === 'storiesArchive' ? viewportIds.map((id, i) => storyByIds?.[id] && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_story_MediaStory__WEBPACK_IMPORTED_MODULE_53__["default"], {
        teactOrderKey: i,
        story: storyByIds[id],
        isArchive: resultType === 'storiesArchive'
      }, `${resultType}_${id}`)) : resultType === 'documents' ? viewportIds.map(id => messagesById[id] && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_Document__WEBPACK_IMPORTED_MODULE_42__["default"], {
        id: `shared-media${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getMessageHtmlId)(id)}`,
        document: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getMessageDocument)(messagesById[id]),
        datetime: messagesById[id].date,
        smaller: true,
        className: "scroll-item",
        isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsDownloading)(activeDownloads, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getMessageDocument)(messagesById[id])),
        observeIntersection: observeIntersectionForMedia,
        onDateClick: handleMessageFocus,
        message: messagesById[id],
        shouldWarnAboutFiles: shouldWarnAboutFiles,
        onMediaClick: handleSelectMedia
      }, id)) : resultType === 'links' ? viewportIds.map(id => messagesById[id] && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_WebLink__WEBPACK_IMPORTED_MODULE_51__["default"], {
        message: messagesById[id],
        isProtected: isChatProtected || messagesById[id].isProtected,
        observeIntersection: observeIntersectionForMedia,
        onMessageClick: handleMessageFocus
      }, id)) : resultType === 'audio' ? viewportIds.map(id => messagesById[id] && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_Audio__WEBPACK_IMPORTED_MODULE_41__["default"], {
        theme: theme,
        message: messagesById[id],
        origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia,
        date: messagesById[id].date,
        className: "scroll-item",
        onPlay: handlePlayAudio,
        onDateClick: handleMessageFocus,
        canDownload: !isChatProtected && !messagesById[id].isProtected,
        isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsDownloading)(activeDownloads, messagesById[id].content.audio)
      }, id)) : resultType === 'voice' ? viewportIds.map(id => {
        const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
        const message = messagesById[id];
        if (!message) return undefined;
        const media = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_10__.selectMessageDownloadableMedia)(global, message);
        return messagesById[id] && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_Audio__WEBPACK_IMPORTED_MODULE_41__["default"], {
          theme: theme,
          message: message,
          senderTitle: (0,_left_search_helpers_getSenderName__WEBPACK_IMPORTED_MODULE_22__.getSenderName)(oldLang, message, chatsById, usersById),
          origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia,
          date: message.date,
          className: "scroll-item",
          onPlay: handlePlayAudio,
          onDateClick: handleMessageFocus,
          canDownload: !isChatProtected && !message.isProtected,
          isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsDownloading)(activeDownloads, media)
        }, id);
      }) : resultType === 'members' ? viewportIds.map((id, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_58__["default"], {
        teactOrderKey: i,
        className: "chat-item-clickable contact-list-item scroll-item small-icon",
        onClick: () => handleMemberClick(id),
        contextActions: getMemberContextAction(id),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_48__["default"], {
          userId: id,
          adminMember: adminMembersById?.[id],
          forceShowSelf: true,
          withStory: true
        })
      }, id)) : resultType === 'commonChats' ? viewportIds.map((id, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_58__["default"], {
        teactOrderKey: i,
        className: "chat-item-clickable scroll-item small-icon",
        onClick: () => openChat({
          id
        }),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_44__["default"], {
          chatId: id
        })
      }, id)) : resultType === 'previewMedia' ? botPreviewMedia.map((media, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_PreviewMedia__WEBPACK_IMPORTED_MODULE_47__["default"], {
        media: media,
        isProtected: isChatProtected,
        observeIntersection: observeIntersectionForMedia,
        onClick: handleSelectPreviewMedia,
        index: i
      }, media.date)) : resultType === 'similarChannels' ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
        children: [viewportIds.map((channelId, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_58__["default"], {
          teactOrderKey: i,
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_16__["default"])('chat-item-clickable search-result', !isCurrentUserPremium && i === similarChannels.length - 1 && 'blured'),
          onClick: () => openChat({
            id: channelId
          }),
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_44__["default"], {
            avatarSize: "large",
            chatId: channelId,
            withFullInfo: true
          })
        }, channelId)), !isCurrentUserPremium && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_54__["default"], {
            className: "show-more-channels",
            onClick: () => openPremiumModal(),
            iconName: "unlock-badge",
            iconAlignment: "end",
            children: oldLang('UnlockSimilar')
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
            className: "more-similar",
            children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_21__["default"])(oldLang('MoreSimilarText', limitSimilarPeers), ['simple_markdown'])
          })]
        })]
      }, resultType) : resultType === 'similarBots' ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
        children: [viewportIds.map((userId, i) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_58__["default"], {
          teactOrderKey: i,
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_16__["default"])('chat-item-clickable search-result', !isCurrentUserPremium && i === similarBots.length - 1 && 'blured'),
          onClick: () => openChat({
            id: userId
          }),
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_48__["default"], {
            userId: userId,
            avatarSize: "medium"
          })
        }, userId)), !isCurrentUserPremium && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_54__["default"], {
            className: "show-more-bots",
            onClick: () => openPremiumModal(),
            iconName: "unlock-badge",
            children: lang('UnlockMoreSimilarBots')
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)("div", {
            className: "more-similar",
            children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_21__["default"])(lang('MoreSimilarBotsDescription', {
              count: limitSimilarPeers
            }, {
              withNodes: true,
              withMarkdown: true,
              pluralValue: limitSimilarPeers
            }))
          })]
        })]
      }, resultType) : resultType === 'gifts' ? renderingGifts?.map(gift => {
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_gift_SavedGift__WEBPACK_IMPORTED_MODULE_43__["default"], {
          peerId: chatId,
          className: "saved-gift",
          style: createVtnStyle((0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_7__.getSavedGiftKey)(gift)),
          gift: gift,
          observeIntersection: observeIntersectionForMedia
        }, (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_7__.getSavedGiftKey)(gift));
      }) : undefined
    });
  }
  const shouldUseTransitionForContent = resultType === 'stories' || resultType === 'gifts';
  const contentTransitionKey = (() => {
    if (resultType === 'stories') {
      return selectedStoryAlbumId === 'all' ? 0 : selectedStoryAlbumId;
    }
    if (resultType === 'gifts') {
      return activeCollectionId === 'all' ? 0 : activeCollectionId;
    }
    return 0;
  })();
  const handleOnStop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_32__["default"])(() => {
    setRestoreContentHeightKey(restoreContentHeightKey + 1);
  });
  function renderProfileInfo(peerId, isReady) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
      className: "profile-info",
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_profile_ProfileInfo_tsx__WEBPACK_IMPORTED_MODULE_50__["default"], {
        isExpanded: isProfileExpanded,
        peerId: peerId,
        canPlayVideo: isReady,
        isForMonoforum: Boolean(monoforumChannel),
        onExpand: handleExpandProfile
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_common_profile_ChatExtra__WEBPACK_IMPORTED_MODULE_49__["default"], {
        chatOrUserId: profileId,
        isSavedDialog: isSavedDialog,
        isOwnProfile: isOwnProfile
      })]
    });
  }
  function renderSpinnerOrContent(noContent, noSpinner) {
    const baseContent = renderSpinnerOrContentBase(noContent, noSpinner);
    const isSpinner = noContent && !noSpinner;
    if (shouldUseTransitionForContent) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_61__["default"], {
        className: `${resultType}-list`,
        activeKey: contentTransitionKey,
        name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_19__.resolveTransitionName)('slideOptimized', animationLevel, undefined, lang.isRtl),
        shouldCleanup: true,
        shouldRestoreHeight: true,
        restoreHeightKey: restoreContentHeightKey,
        contentSelector: ".Transition > .Transition_slide-active > .content",
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_61__["default"], {
          activeKey: isSpinner ? 0 : 1,
          name: "fade",
          shouldCleanup: true,
          shouldRestoreHeight: true,
          restoreHeightKey: restoreContentHeightKey,
          contentSelector: ".content",
          onStop: handleOnStop,
          children: baseContent
        })
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_61__["default"], {
      activeKey: isSpinner ? 0 : 1,
      name: "fade",
      shouldCleanup: true,
      shouldRestoreHeight: true,
      children: baseContent
    });
  }
  const activeListSelector = `.shared-media-transition > .Transition_slide-active`;
  // eslint-disable-next-line @stylistic/max-len
  const nestedSelector = `${activeListSelector} > .Transition > .Transition_slide-active > .Transition > .Transition_slide-active`;
  const itemSelector = !shouldUseTransitionForContent ? `${activeListSelector} .${resultType}-list > .scroll-item` : `${nestedSelector} > .${resultType}-list > .scroll-item`;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_56__["default"], {
    ref: containerRef,
    className: "Profile custom-scroll",
    itemSelector: itemSelector,
    items: canRenderContent ? viewportIds : undefined,
    cacheBuster: cacheBuster,
    sensitiveArea: _config__WEBPACK_IMPORTED_MODULE_4__.PROFILE_SENSITIVE_AREA,
    preloadBackwards: canRenderContent ? resultType === 'members' ? _config__WEBPACK_IMPORTED_MODULE_4__.MEMBERS_SLICE : _config__WEBPACK_IMPORTED_MODULE_4__.SHARED_MEDIA_SLICE : 0
    // To prevent scroll jumps caused by reordering member list
    ,
    noScrollRestoreOnTop: true,
    noFastList: true,
    onLoadMore: getMore,
    onScroll: handleScroll,
    children: [!noProfileInfo && !isSavedMessages && renderProfileInfo(monoforumChannel?.id || profileId, isRightColumnShown && canRenderContent), !isRestricted && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsxs)("div", {
      className: "shared-media",
      style: createVtnStyle('sharedMedia'),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_61__["default"], {
        ref: transitionRef,
        name: shouldSkipTransitionRef.current ? 'none' : (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_19__.resolveTransitionName)('slideOptimized', animationLevel, undefined, lang.isRtl),
        activeKey: activeKey,
        renderCount: tabs.length,
        shouldRestoreHeight: true,
        className: "shared-media-transition",
        onStop: resetCacheBuster,
        restoreHeightKey: shouldUseTransitionForContent ? restoreContentHeightKey : undefined,
        contentSelector: shouldUseTransitionForContent ? '.Transition > .Transition_slide-active > .Transition > .Transition_slide-active > .content' : undefined,
        children: renderContent()
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_TabList__WEBPACK_IMPORTED_MODULE_60__["default"], {
        activeTab: activeTabIndex,
        tabs: tabs,
        onSwitchTab: handleSwitchTab
      })]
    }), canAddMembers && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_55__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_16__["default"])(!isActive && 'hidden'),
      isShown: canRenderContent,
      onClick: handleNewMemberDialogOpen,
      ariaLabel: oldLang('lng_channel_add_users'),
      iconName: "add-user-filled"
    }), canDeleteMembers && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_66__.jsx)(_DeleteMemberModal__WEBPACK_IMPORTED_MODULE_62__["default"], {
      isOpen: Boolean(deletingUserId),
      userId: deletingUserId,
      onClose: handleDeleteMembersModalClose
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  isMobile
}) => {
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, chatId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const chatFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatFullInfo)(global, chatId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUserFullInfo)(global, chatId);
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessages)(global, chatId);
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global);
  const {
    chatInfo,
    savedGifts
  } = tabState;
  const {
    isOwnProfile
  } = chatInfo;
  const {
    animationLevel,
    shouldWarnAboutFiles
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_11__.selectSharedSettings)(global);
  const {
    currentType: mediaSearchType,
    resultsByType
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentSharedMediaSearch)(global) || {};
  const {
    foundIds
  } = resultsByType && mediaSearchType && resultsByType[mediaSearchType] || {};
  const isTopicInfo = Boolean(chat?.isForum && threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const {
    byId: usersById,
    statusesById: userStatusesById
  } = global.users;
  const {
    byId: chatsById
  } = global.chats;
  const isSavedMessages = chatId === global.currentUserId && !isOwnProfile;
  const isSavedDialog = !isOwnProfile ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(chatId, threadId, global.currentUserId) : undefined;
  const isGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatGroup)(chat);
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatChannel)(chat);
  const isBot = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isUserBot)(user);
  const hasMembersTab = !isTopicInfo && !isSavedDialog && isGroup && !chat?.isMonoforum;
  const members = chatFullInfo?.members;
  const adminMembersById = chatFullInfo?.adminMembersById;
  const areMembersHidden = hasMembersTab && chat && (chat.isForbidden || chatFullInfo && !chatFullInfo.canViewMembers);
  const canAddMembers = hasMembersTab && chat && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getHasAdminRight)(chat, 'inviteUsers') || !isChannel && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isUserRightBanned)(chat, 'inviteUsers') || chat.isCreator);
  const canDeleteMembers = hasMembersTab && chat && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getHasAdminRight)(chat, 'banUsers') || chat.isCreator);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectActiveDownloads)(global);
  const {
    similarChannelIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectSimilarChannelIds)(global, chatId) || {};
  const {
    similarBotsIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectSimilarBotsIds)(global, chatId) || {};
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserPremium)(global);
  const peer = user || chat;
  const peerFullInfo = userFullInfo || chatFullInfo;
  const hasCommonChatsTab = user && !user.isSelf && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isUserBot)(user) && !isSavedMessages && Boolean(userFullInfo?.commonChatsCount);
  const commonChats = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUserCommonChats)(global, chatId);
  const hasPreviewMediaTab = userFullInfo?.botInfo?.hasPreviewMedia;
  const botPreviewMedia = global.users.previewMediaByBotId[chatId];
  const hasStoriesTab = peer && (user?.isSelf || !peer.areStoriesHidden && peerFullInfo?.hasPinnedStories) && !isSavedMessages;
  const peerStories = hasStoriesTab ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peer.id) : undefined;
  const selectedStoryAlbumId = (0,_global_selectors_stories__WEBPACK_IMPORTED_MODULE_12__.selectActiveStoriesCollectionId)(global);
  const storyIds = selectedStoryAlbumId !== 'all' ? peerStories?.idsByAlbumId?.[selectedStoryAlbumId]?.ids : peerStories?.profileIds;
  const pinnedStoryIds = peerStories?.pinnedIds;
  const storyByIds = peerStories?.byId;
  const archiveStoryIds = peerStories?.archiveIds;
  const hasGiftsTab = Boolean(peerFullInfo?.starGiftCount) && !isSavedMessages;
  const activeCollectionId = (0,_global_selectors_payments__WEBPACK_IMPORTED_MODULE_5__.selectActiveGiftsCollectionId)(global, chatId);
  const peerGifts = savedGifts.collectionsByPeerId[chatId]?.[activeCollectionId];
  const storyAlbums = global.stories.albumsByPeerId?.[chatId];
  const giftCollections = global.starGiftCollections?.byPeerId?.[chatId];
  const monoforumChannel = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectMonoforumChannel)(global, chatId);
  const isRestricted = chat && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatRestricted)(global, chat.id);
  const hasAvatar = Boolean(peer?.avatarPhotoId);
  const canAutoPlayGifs = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPerformanceSettingsValue)(global, 'autoplayGifs');
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTheme)(global),
    isChannel,
    isBot,
    messagesById,
    foundIds,
    mediaSearchType,
    hasCommonChatsTab,
    hasStoriesTab,
    hasMembersTab,
    hasPreviewMediaTab,
    areMembersHidden,
    canAddMembers,
    canDeleteMembers,
    currentUserId: global.currentUserId,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsRightColumnShown)(global, isMobile),
    isRestricted,
    activeDownloads,
    usersById,
    userStatusesById,
    chatsById,
    storyIds,
    hasGiftsTab,
    gifts: peerGifts?.gifts,
    storyAlbums,
    giftCollections,
    pinnedStoryIds,
    archiveStoryIds,
    storyByIds,
    selectedStoryAlbumId,
    activeCollectionId,
    giftsFilter: savedGifts.filter,
    isChatProtected: chat?.isProtected,
    chatInfo,
    animationLevel,
    shouldWarnAboutFiles,
    similarChannels: similarChannelIds,
    similarBots: similarBotsIds,
    botPreviewMedia,
    isCurrentUserPremium,
    isTopicInfo,
    isSavedDialog,
    isSavedMessages,
    isSynced: global.isSynced,
    limitSimilarPeers: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_9__.selectPremiumLimit)(global, 'recommendedChannels'),
    members: hasMembersTab ? members : undefined,
    adminMembersById: hasMembersTab ? adminMembersById : undefined,
    commonChatIds: commonChats?.ids,
    monoforumChannel,
    hasAvatar,
    peerFullInfo,
    canUpdateMainTab: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanUpdateMainTab)(global, chatId),
    canAutoPlayGifs
  };
})(Profile)));

/***/ }),

/***/ "./src/components/right/RightColumn.scss":
/*!***********************************************!*\
  !*** ./src/components/right/RightColumn.scss ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/RightColumn.tsx":
/*!**********************************************!*\
  !*** ./src/components/right/RightColumn.tsx ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useScrollNotch_ts__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useScrollNotch.ts */ "./src/hooks/useScrollNotch.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _AddChatMembers__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./AddChatMembers */ "./src/components/right/AddChatMembers.tsx");
/* harmony import */ var _CreateTopic_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./CreateTopic.async */ "./src/components/right/CreateTopic.async.tsx");
/* harmony import */ var _EditTopic_async__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./EditTopic.async */ "./src/components/right/EditTopic.async.tsx");
/* harmony import */ var _GifSearch_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./GifSearch.async */ "./src/components/right/GifSearch.async.tsx");
/* harmony import */ var _management_Management_async__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./management/Management.async */ "./src/components/right/management/Management.async.tsx");
/* harmony import */ var _PollResults_async__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./PollResults.async */ "./src/components/right/PollResults.async.tsx");
/* harmony import */ var _Profile__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./Profile */ "./src/components/right/Profile.tsx");
/* harmony import */ var _RightHeader__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./RightHeader */ "./src/components/right/RightHeader.tsx");
/* harmony import */ var _statistics_BoostStatistics__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./statistics/BoostStatistics */ "./src/components/right/statistics/BoostStatistics.tsx");
/* harmony import */ var _statistics_MessageStatistics_async__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./statistics/MessageStatistics.async */ "./src/components/right/statistics/MessageStatistics.async.tsx");
/* harmony import */ var _statistics_MonetizationStatistics__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./statistics/MonetizationStatistics */ "./src/components/right/statistics/MonetizationStatistics.tsx");
/* harmony import */ var _statistics_Statistics_async__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./statistics/Statistics.async */ "./src/components/right/statistics/Statistics.async.tsx");
/* harmony import */ var _statistics_StoryStatistics_async__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./statistics/StoryStatistics.async */ "./src/components/right/statistics/StoryStatistics.async.tsx");
/* harmony import */ var _StickerSearch_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./StickerSearch.async */ "./src/components/right/StickerSearch.async.tsx");
/* harmony import */ var _RightColumn_scss__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./RightColumn.scss */ "./src/components/right/RightColumn.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
































const ANIMATION_DURATION = 450 + _config__WEBPACK_IMPORTED_MODULE_3__.ANIMATION_END_DELAY;
const MAIN_SCREENS_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent).length / 2;
const MANAGEMENT_SCREENS_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens).length / 2;
function blurSearchInput() {
  const searchInput = document.querySelector('.RightHeader .SearchInput input');
  if (searchInput) {
    searchInput.blur();
  }
}
const RightColumn = ({
  contentKey,
  chatId,
  threadId,
  isMobile,
  isChatSelected,
  animationLevel,
  shouldSkipHistoryAnimations,
  nextManagementScreen,
  shouldCloseRightColumn,
  isSavedMessages,
  isSavedDialog,
  isOwnProfile
}) => {
  const {
    toggleChatInfo,
    toggleManagement,
    setStickerSearchQuery,
    setGifSearchQuery,
    closePollResults,
    addChatMembers,
    setNewChatMembersDialogState,
    setEditingExportedInvite,
    toggleStatistics,
    toggleMessageStatistics,
    toggleStoryStatistics,
    setOpenedInviteInfo,
    requestNextManagementScreen,
    closeCreateTopicPanel,
    closeEditTopicPanel,
    closeBoostStatistics,
    setShouldCloseRightColumn,
    closeMonetizationStatistics
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const [profileState, setProfileState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(isSavedMessages && !isSavedDialog ? _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.SavedDialogs : _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
  const [managementScreen, setManagementScreen] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
  const [selectedChatMemberId, setSelectedChatMemberId] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isPromotedByCurrentUser, setIsPromotedByCurrentUser] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const isScrolledDown = profileState !== _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile;
  const isOpen = contentKey !== undefined;
  const isProfile = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo;
  const isManagement = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management;
  const isStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics;
  const isMessageStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics;
  const isStoryStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics;
  const isBoostStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics;
  const isMonetizationStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MonetizationStatistics;
  const isStickerSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch;
  const isGifSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch;
  const isPollResults = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults;
  const isAddingChatMembers = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers;
  const isCreatingTopic = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic;
  const isEditingTopic = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic;
  const isOverlaying = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_3__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN;
  const [shouldSkipTransition, setShouldSkipTransition] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isOpen);
  const renderingContentKey = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__["default"])(contentKey, true, !isChatSelected) ?? -1;
  (0,_hooks_useScrollNotch_ts__WEBPACK_IMPORTED_MODULE_13__["default"])({
    containerRef,
    selector: ':scope .custom-scroll, :scope .panel-content'
  }, [contentKey, managementScreen, chatId, threadId]);
  const close = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])((shouldScrollUp = true) => {
    switch (contentKey) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers:
        setNewChatMembersDialogState({
          newChatMembersProgress: _types__WEBPACK_IMPORTED_MODULE_2__.NewChatMembersProgress.Closed
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo:
        if (isScrolledDown && shouldScrollUp && !isSavedMessages) {
          setProfileState(_types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
          break;
        }
        toggleChatInfo({
          force: false
        }, {
          forceSyncOnIOs: true
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management:
        {
          switch (managementScreen) {
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial:
              toggleManagement();
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatPrivacyType:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Discussion:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupPermissions:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupType:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdministrators:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChannelSubscribers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupMembers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Invites:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Reactions:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.JoinRequests:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChannelRemovedUsers:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupUserPermissionsCreate:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupRemovedUsers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupUserPermissions:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupPermissions);
              setSelectedChatMemberId(undefined);
              setIsPromotedByCurrentUser(undefined);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.NewDiscussionGroup:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Discussion);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdminRights:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatNewAdminRights:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupAddAdmins:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupRecentActions:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdministrators);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.EditInvite:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.InviteInfo:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Invites);
              setOpenedInviteInfo({
                chatId: chatId,
                invite: undefined
              });
              setEditingExportedInvite({
                chatId: chatId,
                invite: undefined
              });
              break;
          }
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics:
        toggleMessageStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics:
        toggleStoryStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics:
        toggleStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics:
        closeBoostStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MonetizationStatistics:
        closeMonetizationStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch:
        blurSearchInput();
        setStickerSearchQuery({
          query: undefined
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch:
        {
          blurSearchInput();
          setGifSearchQuery({
            query: undefined
          });
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults:
        closePollResults();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic:
        closeCreateTopicPanel();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic:
        closeEditTopicPanel();
        break;
    }
  });
  const handleSelectChatMember = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])((memberId, isPromoted) => {
    setSelectedChatMemberId(memberId);
    setIsPromotedByCurrentUser(isPromoted);
  });
  const handleAppendingChatMembers = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(memberIds => {
    addChatMembers({
      chatId: chatId,
      memberIds
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isOpen && chatId ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_7__["default"])(close) : undefined, [isOpen, close, chatId]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setTimeout(() => {
      setShouldSkipTransition(!isOpen);
    }, ANIMATION_DURATION);
  }, [isOpen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (nextManagementScreen) {
      setManagementScreen(nextManagementScreen);
      requestNextManagementScreen(undefined);
    }
  }, [nextManagementScreen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldCloseRightColumn) {
      close();
      setShouldCloseRightColumn({
        value: undefined
      });
    }
  }, [shouldCloseRightColumn]);

  // Close Right Column when it transforms into overlayed state on screen resize
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen && isOverlaying) {
      close();
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [isOverlaying]);

  // We need to clear profile state and management screen state, when changing chats
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__["default"])(([prevChatId, prevThreadId]) => {
    if (prevChatId !== chatId || prevThreadId !== threadId) {
      setProfileState(isSavedMessages && !isSavedDialog ? _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.SavedDialogs : _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
      setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
    }
  }, [chatId, threadId, isSavedDialog, isSavedMessages]);
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_10__["default"])({
    isActive: isChatSelected && (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic),
    onBack: () => close(false)
  });
  function renderContent(isActive) {
    if (renderingContentKey === -1) {
      return undefined;
    }
    switch (renderingContentKey) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_AddChatMembers__WEBPACK_IMPORTED_MODULE_16__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive,
          onNextStep: handleAppendingChatMembers,
          onClose: close
        }, `add_chat_members_${chatId}`);
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_Profile__WEBPACK_IMPORTED_MODULE_22__["default"], {
          chatId: chatId,
          threadId: threadId,
          profileState: profileState,
          isMobile: isMobile,
          isActive: isOpen && isActive,
          onProfileStateChange: setProfileState
        }, `profile_${chatId}_${threadId}_${Boolean(isOwnProfile)}`);
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_management_Management_async__WEBPACK_IMPORTED_MODULE_20__["default"], {
          chatId: chatId,
          currentScreen: managementScreen,
          isPromotedByCurrentUser: isPromotedByCurrentUser,
          selectedChatMemberId: selectedChatMemberId,
          isActive: isOpen && isActive,
          onScreenSelect: setManagementScreen,
          onChatMemberSelect: handleSelectChatMember,
          onClose: close
        }, `management_${chatId}_${managementScreen}`);
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_statistics_Statistics_async__WEBPACK_IMPORTED_MODULE_27__["default"], {
          chatId: chatId
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_statistics_BoostStatistics__WEBPACK_IMPORTED_MODULE_24__["default"], {});
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MonetizationStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_statistics_MonetizationStatistics__WEBPACK_IMPORTED_MODULE_26__["default"], {});
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_statistics_MessageStatistics_async__WEBPACK_IMPORTED_MODULE_25__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_statistics_StoryStatistics_async__WEBPACK_IMPORTED_MODULE_28__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_StickerSearch_async__WEBPACK_IMPORTED_MODULE_29__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_GifSearch_async__WEBPACK_IMPORTED_MODULE_19__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_PollResults_async__WEBPACK_IMPORTED_MODULE_21__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_CreateTopic_async__WEBPACK_IMPORTED_MODULE_17__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_EditTopic_async__WEBPACK_IMPORTED_MODULE_18__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
    }
    return undefined; // Unreachable
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsxs)("div", {
    id: "RightColumn-wrapper",
    className: !isChatSelected ? 'is-hidden' : undefined,
    children: [isOverlaying && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)("div", {
      className: "overlay-backdrop",
      onClick: close
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsxs)("div", {
      id: "RightColumn",
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_RightHeader__WEBPACK_IMPORTED_MODULE_23__["default"], {
        chatId: chatId,
        threadId: threadId,
        isColumnOpen: isOpen,
        isProfile: isProfile,
        isManagement: isManagement,
        isStatistics: isStatistics,
        isBoostStatistics: isBoostStatistics,
        isMonetizationStatistics: isMonetizationStatistics,
        isMessageStatistics: isMessageStatistics,
        isStoryStatistics: isStoryStatistics,
        isStickerSearch: isStickerSearch,
        isGifSearch: isGifSearch,
        isPollResults: isPollResults,
        isCreatingTopic: isCreatingTopic,
        isEditingTopic: isEditingTopic,
        isAddingChatMembers: isAddingChatMembers,
        profileState: profileState,
        managementScreen: managementScreen,
        onClose: close,
        onScreenSelect: setManagementScreen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_31__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_15__["default"], {
        ref: containerRef,
        name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__.resolveTransitionName)('layers', animationLevel, shouldSkipTransition || shouldSkipHistoryAnimations),
        renderCount: MAIN_SCREENS_COUNT + MANAGEMENT_SCREENS_COUNT,
        activeKey: isManagement ? MAIN_SCREENS_COUNT + managementScreen : renderingContentKey,
        shouldCleanup: true,
        cleanupExceptionKey: renderingContentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics || renderingContentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics ? _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics : undefined,
        children: renderContent
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isMobile
}) => {
  const {
    chatId,
    threadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global) || {};
  const areActiveChatsLoaded = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectAreActiveChatsLoaded)(global);
  const {
    animationLevel
  } = (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_6__.selectSharedSettings)(global);
  const {
    management,
    shouldSkipHistoryAnimations,
    shouldCloseRightColumn,
    chatInfo
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const nextManagementScreen = chatId ? management.byChatId[chatId]?.nextScreen : undefined;
  const isOwnProfile = chatInfo?.isOwnProfile;
  const isSavedMessages = chatId && !isOwnProfile ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsChatWithSelf)(global, chatId) : undefined;
  const isSavedDialog = chatId ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getIsSavedDialog)(chatId, threadId, global.currentUserId) : undefined;
  return {
    contentKey: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectRightColumnContentKey)(global, isMobile),
    chatId,
    threadId,
    isChatSelected: Boolean(chatId && areActiveChatsLoaded),
    animationLevel,
    shouldSkipHistoryAnimations,
    nextManagementScreen,
    shouldCloseRightColumn,
    isSavedMessages,
    isSavedDialog,
    isOwnProfile
  };
})(RightColumn)));

/***/ }),

/***/ "./src/components/right/RightHeader.scss":
/*!***********************************************!*\
  !*** ./src/components/right/RightHeader.scss ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/right/RightHeader.tsx":
/*!**********************************************!*\
  !*** ./src/components/right/RightHeader.tsx ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _hooks_animations_useVtn__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/animations/useVtn */ "./src/hooks/animations/useVtn.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _RightHeader_scss__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./RightHeader.scss */ "./src/components/right/RightHeader.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




























const COLUMN_ANIMATION_DURATION = 450 + _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_END_DELAY;
var HeaderContent = /*#__PURE__*/function (HeaderContent) {
  HeaderContent[HeaderContent["Profile"] = 0] = "Profile";
  HeaderContent[HeaderContent["MemberList"] = 1] = "MemberList";
  HeaderContent[HeaderContent["GiftList"] = 2] = "GiftList";
  HeaderContent[HeaderContent["SharedMedia"] = 3] = "SharedMedia";
  HeaderContent[HeaderContent["StoryList"] = 4] = "StoryList";
  HeaderContent[HeaderContent["Search"] = 5] = "Search";
  HeaderContent[HeaderContent["Statistics"] = 6] = "Statistics";
  HeaderContent[HeaderContent["MessageStatistics"] = 7] = "MessageStatistics";
  HeaderContent[HeaderContent["StoryStatistics"] = 8] = "StoryStatistics";
  HeaderContent[HeaderContent["BoostStatistics"] = 9] = "BoostStatistics";
  HeaderContent[HeaderContent["MonetizationStatistics"] = 10] = "MonetizationStatistics";
  HeaderContent[HeaderContent["Management"] = 11] = "Management";
  HeaderContent[HeaderContent["ManageInitial"] = 12] = "ManageInitial";
  HeaderContent[HeaderContent["ManageChannelSubscribers"] = 13] = "ManageChannelSubscribers";
  HeaderContent[HeaderContent["ManageChatAdministrators"] = 14] = "ManageChatAdministrators";
  HeaderContent[HeaderContent["ManageChatPrivacyType"] = 15] = "ManageChatPrivacyType";
  HeaderContent[HeaderContent["ManageDiscussion"] = 16] = "ManageDiscussion";
  HeaderContent[HeaderContent["ManageGroupPermissions"] = 17] = "ManageGroupPermissions";
  HeaderContent[HeaderContent["ManageGroupRemovedUsers"] = 18] = "ManageGroupRemovedUsers";
  HeaderContent[HeaderContent["ManageChannelRemovedUsers"] = 19] = "ManageChannelRemovedUsers";
  HeaderContent[HeaderContent["ManageGroupUserPermissionsCreate"] = 20] = "ManageGroupUserPermissionsCreate";
  HeaderContent[HeaderContent["ManageGroupUserPermissions"] = 21] = "ManageGroupUserPermissions";
  HeaderContent[HeaderContent["ManageGroupRecentActions"] = 22] = "ManageGroupRecentActions";
  HeaderContent[HeaderContent["ManageGroupAdminRights"] = 23] = "ManageGroupAdminRights";
  HeaderContent[HeaderContent["ManageGroupNewAdminRights"] = 24] = "ManageGroupNewAdminRights";
  HeaderContent[HeaderContent["ManageGroupMembers"] = 25] = "ManageGroupMembers";
  HeaderContent[HeaderContent["ManageGroupAddAdmins"] = 26] = "ManageGroupAddAdmins";
  HeaderContent[HeaderContent["StickerSearch"] = 27] = "StickerSearch";
  HeaderContent[HeaderContent["GifSearch"] = 28] = "GifSearch";
  HeaderContent[HeaderContent["PollResults"] = 29] = "PollResults";
  HeaderContent[HeaderContent["AddingMembers"] = 30] = "AddingMembers";
  HeaderContent[HeaderContent["ManageInvites"] = 31] = "ManageInvites";
  HeaderContent[HeaderContent["ManageEditInvite"] = 32] = "ManageEditInvite";
  HeaderContent[HeaderContent["ManageReactions"] = 33] = "ManageReactions";
  HeaderContent[HeaderContent["ManageInviteInfo"] = 34] = "ManageInviteInfo";
  HeaderContent[HeaderContent["ManageJoinRequests"] = 35] = "ManageJoinRequests";
  HeaderContent[HeaderContent["CreateTopic"] = 36] = "CreateTopic";
  HeaderContent[HeaderContent["EditTopic"] = 37] = "EditTopic";
  HeaderContent[HeaderContent["SavedDialogs"] = 38] = "SavedDialogs";
  HeaderContent[HeaderContent["NewDiscussionGroup"] = 39] = "NewDiscussionGroup";
  return HeaderContent;
}(HeaderContent || {});
const RightHeader = ({
  chatId,
  threadId,
  isColumnOpen,
  isProfile,
  isManagement,
  isStatistics,
  isMessageStatistics,
  isStoryStatistics,
  isMonetizationStatistics,
  isBoostStatistics,
  isStickerSearch,
  isGifSearch,
  isPollResults,
  isCreatingTopic,
  isEditingTopic,
  isAddingChatMembers,
  profileState,
  managementScreen,
  canAddContact,
  userId,
  isSelf,
  canManage,
  isChannel,
  stickerSearchQuery,
  gifSearchQuery,
  isEditingInvite,
  canViewStatistics,
  currentInviteInfo,
  shouldSkipHistoryAnimations,
  isBot,
  isInsideTopic,
  canEditTopic,
  isSavedMessages,
  canEditBot,
  giftProfileFilter,
  canUseGiftFilter,
  canUseGiftAdminFilter,
  isOwnProfile,
  onClose,
  onScreenSelect
}) => {
  const {
    setStickerSearchQuery,
    setGifSearchQuery,
    toggleManagement,
    openAddContactDialog,
    toggleStatistics,
    setEditingExportedInvite,
    deleteExportedChatInvite,
    openEditTopicPanel,
    updateGiftProfileFilter,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isDeleteDialogOpen, openDeleteDialog, closeDeleteDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    createVtnStyle
  } = (0,_hooks_animations_useVtn__WEBPACK_IMPORTED_MODULE_11__.useVtn)();
  const {
    sortType: giftsSortType,
    shouldIncludeUnlimited: shouldIncludeUnlimitedGifts,
    shouldIncludeLimited: shouldIncludeLimitedGifts,
    shouldIncludeUpgradable: shouldIncludeUpgradableGifts,
    shouldIncludeUnique: shouldIncludeUniqueGifts,
    shouldIncludeDisplayed: shouldIncludeDisplayedGifts,
    shouldIncludeHidden: shouldIncludeHiddenGifts
  } = giftProfileFilter;
  const foldersChatCount = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_15__.useFolderManagerForChatsCount)();
  const handleEditInviteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    setEditingExportedInvite({
      chatId: chatId,
      invite: currentInviteInfo
    });
    onScreenSelect(_types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.EditInvite);
  });
  const handleDeleteInviteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    deleteExportedChatInvite({
      chatId: chatId,
      link: currentInviteInfo.link
    });
    onScreenSelect(_types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Invites);
    closeDeleteDialog();
  });
  const handleStickerSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(query => {
    setStickerSearchQuery({
      query
    });
  });
  const handleGifSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(query => {
    setGifSearchQuery({
      query
    });
  });
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    openAddContactDialog({
      userId
    });
  });
  const toggleEditTopic = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!chatId || !threadId) return;
    openEditTopicPanel({
      chatId,
      topicId: Number(threadId)
    });
  });
  const handleToggleManagement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    toggleManagement();
  });
  const handleToggleStatistics = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    toggleStatistics();
  });
  const handleEditProfile = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_3__.SettingsScreens.EditProfile
    });
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    onClose(!isSavedMessages);
  });
  const [shouldSkipTransition, setShouldSkipTransition] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isColumnOpen);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setTimeout(() => {
      setShouldSkipTransition(!isColumnOpen);
    }, COLUMN_ANIMATION_DURATION);
  }, [isColumnOpen]);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const contentKey = isProfile ? profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.Profile ? HeaderContent.Profile : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.SharedMedia ? HeaderContent.SharedMedia : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.MemberList ? HeaderContent.MemberList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.GiftList ? HeaderContent.GiftList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.StoryList ? HeaderContent.StoryList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.SavedDialogs ? HeaderContent.SavedDialogs : -1 // Never reached
  : isPollResults ? HeaderContent.PollResults : isStickerSearch ? HeaderContent.StickerSearch : isGifSearch ? HeaderContent.GifSearch : isAddingChatMembers ? HeaderContent.AddingMembers : isManagement ? managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Initial ? HeaderContent.ManageInitial : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatPrivacyType ? HeaderContent.ManageChatPrivacyType : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Discussion ? HeaderContent.ManageDiscussion : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChannelSubscribers ? HeaderContent.ManageChannelSubscribers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupPermissions ? HeaderContent.ManageGroupPermissions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatAdministrators ? HeaderContent.ManageChatAdministrators : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupRemovedUsers ? HeaderContent.ManageGroupRemovedUsers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChannelRemovedUsers ? HeaderContent.ManageChannelRemovedUsers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupUserPermissionsCreate ? HeaderContent.ManageGroupUserPermissionsCreate : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupUserPermissions ? HeaderContent.ManageGroupUserPermissions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupRecentActions ? HeaderContent.ManageGroupRecentActions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatAdminRights ? HeaderContent.ManageGroupAdminRights : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatNewAdminRights ? HeaderContent.ManageGroupNewAdminRights : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupMembers ? HeaderContent.ManageGroupMembers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Invites ? HeaderContent.ManageInvites : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.EditInvite ? HeaderContent.ManageEditInvite : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupAddAdmins ? HeaderContent.ManageGroupAddAdmins : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Reactions ? HeaderContent.ManageReactions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.InviteInfo ? HeaderContent.ManageInviteInfo : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.JoinRequests ? HeaderContent.ManageJoinRequests : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.NewDiscussionGroup ? HeaderContent.NewDiscussionGroup : undefined // Never reached
  : isStatistics ? HeaderContent.Statistics : isMessageStatistics ? HeaderContent.MessageStatistics : isStoryStatistics ? HeaderContent.StoryStatistics : isBoostStatistics ? HeaderContent.BoostStatistics : isCreatingTopic ? HeaderContent.CreateTopic : isEditingTopic ? HeaderContent.EditTopic : isMonetizationStatistics ? HeaderContent.MonetizationStatistics : undefined; // When column is closed

  const renderingContentKey = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(contentKey, true) ?? -1;
  function getHeaderTitle() {
    if (isOwnProfile) {
      return lang('MyProfileHeader');
    }
    if (isSavedMessages) {
      return oldLang('SavedMessages');
    }
    if (isInsideTopic) {
      return oldLang('AccDescrTopic');
    }
    if (isChannel) {
      return oldLang('Channel.TitleInfo');
    }
    if (userId) {
      return oldLang(isBot ? 'lng_info_bot_title' : 'lng_info_user_title');
    }
    return oldLang('GroupInfo.Title');
  }
  const PrimaryLinkMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
      round: true,
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: isOpen ? 'active' : '',
      onClick: onTrigger,
      ariaLabel: lang('AriaLabelOpenMenu'),
      iconName: "more"
    });
  }, [isMobile, lang]);
  function renderHeaderContent() {
    if (renderingContentKey === -1) {
      return undefined;
    }
    switch (renderingContentKey) {
      case HeaderContent.PollResults:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('PollResults')
        });
      case HeaderContent.AddingMembers:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang(isChannel ? 'ChannelAddSubscribers' : 'GroupAddMembers')
        });
      case HeaderContent.ManageInitial:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Edit')
        });
      case HeaderContent.ManageChatPrivacyType:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang(isChannel ? 'ChannelTypeHeader' : 'GroupTypeHeader')
        });
      case HeaderContent.ManageDiscussion:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Discussion')
        });
      case HeaderContent.ManageChatAdministrators:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('ChannelAdministrators')
        });
      case HeaderContent.ManageGroupRecentActions:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Group.Info.AdminLog')
        });
      case HeaderContent.ManageGroupAdminRights:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('EditAdminRights')
        });
      case HeaderContent.ManageGroupNewAdminRights:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('SetAsAdmin')
        });
      case HeaderContent.ManageGroupPermissions:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('ChannelPermissions')
        });
      case HeaderContent.ManageGroupRemovedUsers:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('BlockedUsers')
        });
      case HeaderContent.ManageChannelRemovedUsers:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('ChannelBlockedUsers')
        });
      case HeaderContent.ManageGroupUserPermissionsCreate:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('ChannelAddException')
        });
      case HeaderContent.ManageGroupUserPermissions:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('UserRestrictions')
        });
      case HeaderContent.ManageInvites:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('lng_group_invite_title')
        });
      case HeaderContent.ManageEditInvite:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: isEditingInvite ? oldLang('EditLink') : oldLang('NewLink')
        });
      case HeaderContent.ManageInviteInfo:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
            className: "title",
            children: oldLang('InviteLink')
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("section", {
            className: "tools",
            children: [currentInviteInfo && !currentInviteInfo.isRevoked && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: oldLang('Edit'),
              onClick: handleEditInviteClick,
              iconName: "edit"
            }), currentInviteInfo && currentInviteInfo.isRevoked && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
              children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
                round: true,
                color: "danger",
                size: "smaller",
                ariaLabel: oldLang('Delete'),
                onClick: openDeleteDialog,
                iconName: "delete"
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_20__["default"], {
                isOpen: isDeleteDialogOpen,
                onClose: closeDeleteDialog,
                title: oldLang('DeleteLink'),
                text: oldLang('DeleteLinkHelp'),
                confirmIsDestructive: true,
                confirmLabel: oldLang('Delete'),
                confirmHandler: handleDeleteInviteClick
              })]
            })]
          })]
        });
      case HeaderContent.ManageJoinRequests:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: isChannel ? oldLang('SubscribeRequests') : oldLang('MemberRequests')
        });
      case HeaderContent.ManageGroupAddAdmins:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Channel.Management.AddModerator')
        });
      case HeaderContent.StickerSearch:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_24__["default"], {
          value: stickerSearchQuery,
          placeholder: oldLang('SearchStickersHint'),
          autoFocusSearch: true,
          onChange: handleStickerSearchQueryChange
        });
      case HeaderContent.GifSearch:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_24__["default"], {
          value: gifSearchQuery,
          placeholder: oldLang('SearchGifsTitle'),
          autoFocusSearch: true,
          onChange: handleGifSearchQueryChange
        });
      case HeaderContent.Statistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang(isChannel ? 'ChannelStats.Title' : 'GroupStats.Title')
        });
      case HeaderContent.MessageStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Stats.MessageTitle')
        });
      case HeaderContent.StoryStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Stats.StoryTitle')
        });
      case HeaderContent.BoostStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Boosts')
        });
      case HeaderContent.MonetizationStatistics:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('lng_channel_earn_title')
        });
      case HeaderContent.SharedMedia:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('SharedMedia')
        });
      case HeaderContent.ManageChannelSubscribers:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('ChannelSubscribers')
        });
      case HeaderContent.MemberList:
      case HeaderContent.ManageGroupMembers:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('GroupMembers')
        });
      case HeaderContent.StoryList:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang(isSelf ? 'Settings.MyStories' : 'PeerInfo.PaneStories')
        });
      case HeaderContent.SavedDialogs:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
          className: "header",
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
            className: "title",
            children: oldLang('SavedMessagesTab')
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
            className: "subtitle",
            children: oldLang('Chats', foldersChatCount[_config__WEBPACK_IMPORTED_MODULE_4__.SAVED_FOLDER_ID])
          })]
        });
      case HeaderContent.ManageReactions:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('Reactions')
        });
      case HeaderContent.CreateTopic:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('NewTopic')
        });
      case HeaderContent.EditTopic:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('EditTopic')
        });
      case HeaderContent.GiftList:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
            className: "title",
            children: lang('ProfileTabGifts')
          }), canUseGiftFilter && chatId && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("section", {
            className: "tools",
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_21__["default"], {
              trigger: PrimaryLinkMenuButton,
              positionX: "right",
              autoClose: false,
              children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                icon: giftsSortType === 'byDate' ? 'cash-circle' : 'calendar-filter',
                onClick: () => updateGiftProfileFilter({
                  peerId: chatId,
                  filter: {
                    sortType: giftsSortType === 'byDate' ? 'byValue' : 'byDate'
                  }
                }),
                children: lang(giftsSortType === 'byDate' ? 'GiftSortByValue' : 'GiftSortByDate')
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_23__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                icon: shouldIncludeUnlimitedGifts ? 'check' : 'placeholder',
                onClick: () => updateGiftProfileFilter({
                  peerId: chatId,
                  filter: {
                    shouldIncludeUnlimited: !shouldIncludeUnlimitedGifts
                  }
                }),
                children: lang('GiftFilterUnlimited')
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                icon: shouldIncludeLimitedGifts ? 'check' : 'placeholder',
                onClick: () => updateGiftProfileFilter({
                  peerId: chatId,
                  filter: {
                    shouldIncludeLimited: !shouldIncludeLimitedGifts
                  }
                }),
                children: lang('GiftFilterLimited')
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                icon: shouldIncludeUpgradableGifts ? 'check' : 'placeholder',
                onClick: () => updateGiftProfileFilter({
                  peerId: chatId,
                  filter: {
                    shouldIncludeUpgradable: !shouldIncludeUpgradableGifts
                  }
                }),
                children: lang('GiftFilterUpgradable')
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                icon: shouldIncludeUniqueGifts ? 'check' : 'placeholder',
                onClick: () => updateGiftProfileFilter({
                  peerId: chatId,
                  filter: {
                    shouldIncludeUnique: !shouldIncludeUniqueGifts
                  }
                }),
                children: lang('GiftFilterUnique')
              }), canUseGiftAdminFilter && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
                children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_23__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                  icon: shouldIncludeDisplayedGifts ? 'check' : 'placeholder',
                  onClick: () => updateGiftProfileFilter({
                    peerId: chatId,
                    filter: {
                      shouldIncludeDisplayed: !shouldIncludeDisplayedGifts
                    }
                  }),
                  children: lang('GiftFilterDisplayed')
                }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                  icon: shouldIncludeHiddenGifts ? 'check' : 'placeholder',
                  onClick: () => updateGiftProfileFilter({
                    peerId: chatId,
                    filter: {
                      shouldIncludeHidden: !shouldIncludeHiddenGifts
                    }
                  }),
                  children: lang('GiftFilterHidden')
                })]
              })]
            })
          })]
        });
      case HeaderContent.NewDiscussionGroup:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
          className: "title",
          children: oldLang('NewGroup')
        });
      default:
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
            className: "title",
            children: getHeaderTitle()
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("section", {
            className: "tools",
            children: [canAddContact && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: oldLang('AddContact'),
              onClick: handleAddContact,
              iconName: "add-user"
            }), canManage && !isInsideTopic && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: oldLang('Edit'),
              onClick: handleToggleManagement,
              iconName: "edit"
            }), canEditBot && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: oldLang('Edit'),
              onClick: handleToggleManagement,
              iconName: "edit"
            }), canEditTopic && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: oldLang('EditTopic'),
              onClick: toggleEditTopic,
              iconName: "edit"
            }), canViewStatistics && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: oldLang('Statistics'),
              onClick: handleToggleStatistics,
              iconName: "stats"
            }), isOwnProfile && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
              round: true,
              color: "translucent",
              size: "smaller",
              ariaLabel: lang('Edit'),
              onClick: handleEditProfile,
              iconName: "edit"
            })]
          })]
        });
    }
  }
  const isBackButton = isMobile || !isSavedMessages && (contentKey === HeaderContent.SharedMedia || contentKey === HeaderContent.GiftList || contentKey === HeaderContent.MemberList || contentKey === HeaderContent.StoryList || contentKey === HeaderContent.AddingMembers || contentKey === HeaderContent.MessageStatistics || contentKey === HeaderContent.StoryStatistics || isManagement);
  const buttonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('animated-close-icon', isBackButton && 'state-back', (shouldSkipTransition || shouldSkipHistoryAnimations) && 'no-transition');
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
    className: "RightHeader",
    "data-tauri-drag-region": _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_TAURI && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_MAC_OS ? true : undefined,
    style: createVtnStyle('rightHeader', true),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_19__["default"], {
      className: "close-button",
      round: true,
      color: "translucent",
      size: "smaller",
      onClick: handleClose,
      ariaLabel: isBackButton ? oldLang('Common.Back') : oldLang('Common.Close'),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
        className: buttonClassName
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_25__["default"], {
      name: shouldSkipTransition || shouldSkipHistoryAnimations ? 'none' : 'slideFade',
      activeKey: renderingContentKey,
      children: renderHeaderContent()
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  isProfile,
  isManagement,
  threadId
}) => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const {
    query: stickerSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentStickerSearch)(global) || {};
  const {
    query: gifSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentGifSearch)(global) || {};
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId) : undefined;
  const user = isProfile && chatId && (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_10__.isUserId)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, chatId) : undefined;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const isInsideTopic = chat?.isForum && Boolean(threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const topic = isInsideTopic ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopic)(global, chatId, threadId) : undefined;
  const canEditTopic = isInsideTopic && topic && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanManageTopic)(chat, topic);
  const isBot = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserBot)(user);
  const isOwnProfile = tabState.chatInfo?.isOwnProfile;
  const isSavedMessages = chatId && !isOwnProfile ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatWithSelf)(global, chatId) : undefined;
  const canEditBot = isBot && user?.canEditBot;
  const canAddContact = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanAddContact)(user);
  const canManage = Boolean(!isManagement && isProfile && chatId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanManage)(global, chatId));
  const isEditingInvite = Boolean(chatId && tabState.management.byChatId[chatId]?.editingInvite);
  const canViewStatistics = !isInsideTopic && chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId)?.canViewStatistics : undefined;
  const currentInviteInfo = chatId ? tabState.management.byChatId[chatId]?.inviteInfo?.invite : undefined;
  const giftProfileFilter = tabState.savedGifts.filter;
  const canUseGiftFilter = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanUseGiftProfileFilter)(global, chatId) : false;
  const canUseGiftAdminFilter = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanUseGiftProfileAdminFilter)(global, chatId) : false;
  return {
    canManage,
    canAddContact,
    canViewStatistics,
    isChannel,
    isBot,
    isInsideTopic,
    canEditTopic,
    userId: user?.id,
    isSelf: user?.isSelf,
    stickerSearchQuery,
    gifSearchQuery,
    isEditingInvite,
    currentInviteInfo,
    isSavedMessages,
    shouldSkipHistoryAnimations: tabState.shouldSkipHistoryAnimations,
    canEditBot,
    giftProfileFilter,
    canUseGiftFilter,
    canUseGiftAdminFilter,
    isOwnProfile
  };
})(RightHeader));

/***/ }),

/***/ "./src/components/right/StickerSearch.async.tsx":
/*!******************************************************!*\
  !*** ./src/components/right/StickerSearch.async.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const StickerSearchAsync = props => {
  const {
    isActive
  } = props;
  const StickerSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'StickerSearch', !isActive);
  return StickerSearch ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(StickerSearch, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerSearchAsync);

/***/ }),

/***/ "./src/components/right/gifts/StarGiftCollectionList.module.scss":
/*!***********************************************************************!*\
  !*** ./src/components/right/gifts/StarGiftCollectionList.module.scss ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"tabList":"pvf61Tbm"});

/***/ }),

/***/ "./src/components/right/gifts/StarGiftCollectionList.tsx":
/*!***************************************************************!*\
  !*** ./src/components/right/gifts/StarGiftCollectionList.tsx ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedTabList__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedTabList */ "./src/components/common/AnimatedTabList.tsx");
/* harmony import */ var _StarGiftCollectionList_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./StarGiftCollectionList.module.scss */ "./src/components/right/gifts/StarGiftCollectionList.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");










const StarGiftCollectionList = ({
  peerId,
  className,
  collections,
  activeCollectionId,
  animationLevel
}) => {
  const {
    updateSelectedGiftCollection,
    resetSelectedGiftCollection
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleItemSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(itemId => {
    if (itemId === 'all') {
      resetSelectedGiftCollection({
        peerId
      });
    } else {
      const collectionId = Number(itemId);
      updateSelectedGiftCollection({
        peerId,
        collectionId
      });
    }
  });
  if (!collections || collections.length === 0) {
    return undefined;
  }
  const items = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => [{
    id: 'all',
    title: lang('AllGiftsCategory')
  }, ...collections.map(collection => ({
    id: String(collection.collectionId),
    title: collection.title,
    sticker: collection.icon
  }))], [collections, lang]);
  const selectedItemId = activeCollectionId ? String(activeCollectionId) : 'all';
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_AnimatedTabList__WEBPACK_IMPORTED_MODULE_7__["default"], {
    items: items,
    selectedItemId: selectedItemId,
    animationLevel: animationLevel,
    onItemSelect: handleItemSelect,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarGiftCollectionList_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].tabList, className)
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const {
    starGiftCollections
  } = global;
  const collections = starGiftCollections?.byPeerId?.[peerId];
  const activeCollectionId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectActiveGiftsCollectionId)(global, peerId);
  return {
    collections,
    activeCollectionId,
    animationLevel: (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_3__.selectSharedSettings)(global).animationLevel
  };
})(StarGiftCollectionList)));

/***/ }),

/***/ "./src/components/right/hooks/useProfileState.ts":
/*!*******************************************************!*\
  !*** ./src/components/right/hooks/useProfileState.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useProfileState)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");






const TRANSITION_DURATION = 300;
const PROGRAMMATIC_SCROLL_TIMEOUT_MS = 350;
const runThrottledForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.throttle)(cb => cb(), 250, false);
let isScrollingProgrammatically = false;
function useProfileState({
  containerRef,
  tabType,
  profileState,
  onProfileStateChange,
  forceScrollProfileTab = false,
  allowAutoScrollToTabs = false,
  handleStopAutoScrollToTabs
}) {
  // Scroll to tabs if needed
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__["default"])(([prevTabType]) => {
    if (prevTabType && prevTabType !== tabType && allowAutoScrollToTabs || tabType && forceScrollProfileTab) {
      const container = containerRef.current;
      const tabsEl = container.querySelector('.TabList');
      handleStopAutoScrollToTabs();
      if (container.scrollTop < tabsEl.offsetTop) {
        onProfileStateChange(getStateFromTabType(tabType));
        isScrollingProgrammatically = true;
        (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_2__["default"])({
          container,
          element: tabsEl,
          position: 'start',
          forceDuration: TRANSITION_DURATION
        });
        setTimeout(() => {
          isScrollingProgrammatically = false;
        }, PROGRAMMATIC_SCROLL_TIMEOUT_MS);
      }
    }
  }, [tabType, onProfileStateChange, containerRef, forceScrollProfileTab, allowAutoScrollToTabs, handleStopAutoScrollToTabs]);

  // Scroll to top
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__["default"])(([prevProfileState]) => {
    if (profileState !== _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.Profile || profileState === prevProfileState) {
      return;
    }
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const tabListEl = container.querySelector('.TabList');
    if (!tabListEl || tabListEl.offsetTop > container.scrollTop) {
      return;
    }
    isScrollingProgrammatically = true;
    (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_2__["default"])({
      container,
      element: container.firstElementChild,
      position: 'start',
      maxDistance: container.offsetHeight * 2
    });
    setTimeout(() => {
      isScrollingProgrammatically = false;
    }, PROGRAMMATIC_SCROLL_TIMEOUT_MS);
  }, [profileState, containerRef]);
  const determineProfileState = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const tabListEl = container.querySelector('.TabList');
    if (!tabListEl) {
      return;
    }
    let state = _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.Profile;
    if (Math.ceil(container.scrollTop) >= tabListEl.offsetTop) {
      state = getStateFromTabType(tabType);
    }
    if (state !== profileState) {
      onProfileStateChange(state);
    }
  });

  // Determine profile state when switching tabs
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isScrollingProgrammatically) {
      return;
    }
    determineProfileState();
  }, [determineProfileState, tabType]);

  // Determine profile state when scrolling
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (isScrollingProgrammatically) {
      return;
    }
    runThrottledForScroll(determineProfileState);
  });
  return {
    handleScroll
  };
}
function getStateFromTabType(tabType) {
  switch (tabType) {
    case 'members':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.MemberList;
    case 'gifts':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.GiftList;
    case 'stories':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.StoryList;
    case 'dialogs':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.SavedDialogs;
    default:
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.SharedMedia;
  }
}

/***/ }),

/***/ "./src/components/right/hooks/useProfileViewportIds.ts":
/*!*************************************************************!*\
  !*** ./src/components/right/hooks/useProfileViewportIds.ts ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useProfileViewportIds)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");






function useProfileViewportIds({
  loadMoreMembers,
  loadCommonChats,
  searchMessages,
  loadStories,
  loadStoriesArchive,
  loadMoreGifts,
  tabType,
  mediaSearchType,
  groupChatMembers,
  commonChatIds,
  usersById,
  userStatusesById,
  chatsById,
  chatMessages,
  foundIds,
  threadId,
  storyIds,
  giftIds,
  pinnedStoryIds,
  archiveStoryIds,
  similarChannels,
  similarBots
}) {
  const resultType = tabType === 'members' || !mediaSearchType ? tabType : mediaSearchType;
  const memberIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!groupChatMembers || !usersById || !userStatusesById) {
      return undefined;
    }
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.sortUserIds)(groupChatMembers.map(({
      userId
    }) => userId), usersById, userStatusesById);
  }, [groupChatMembers, usersById, userStatusesById]);
  const chatIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!commonChatIds || !chatsById) {
      return undefined;
    }
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_3__["default"])(commonChatIds, true);
  }, [chatsById, commonChatIds]);
  const [memberViewportIds, getMoreMembers, noProfileInfoForMembers] = useInfiniteScrollForLoadableItems(loadMoreMembers, memberIds);
  const [mediaViewportIds, getMoreMedia, noProfileInfoForMedia] = useInfiniteScrollForSharedMedia('media', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [gifViewportIds, getMoreGifs, noProfileInfoForGifs] = useInfiniteScrollForSharedMedia('gif', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [documentViewportIds, getMoreDocuments, noProfileInfoForDocuments] = useInfiniteScrollForSharedMedia('documents', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [linkViewportIds, getMoreLinks, noProfileInfoForLinks] = useInfiniteScrollForSharedMedia('links', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [audioViewportIds, getMoreAudio, noProfileInfoForAudio] = useInfiniteScrollForSharedMedia('audio', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [voiceViewportIds, getMoreVoices, noProfileInfoForVoices] = useInfiniteScrollForSharedMedia('voice', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [commonChatViewportIds, getMoreCommonChats, noProfileInfoForCommonChats] = useInfiniteScrollForLoadableItems(loadCommonChats, chatIds);
  const sortedStoryIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!storyIds?.length) return storyIds;
    const pinnedStoryIdsSet = new Set(pinnedStoryIds);
    return storyIds.slice().sort((a, b) => {
      const aIsPinned = pinnedStoryIdsSet.has(a);
      const bIsPinned = pinnedStoryIdsSet.has(b);
      if (aIsPinned && !bIsPinned) return -1;
      if (!aIsPinned && bIsPinned) return 1;
      return b - a;
    });
  }, [storyIds, pinnedStoryIds]);
  const [storyViewportIds, getMoreStories, noProfileInfoForStories] = useInfiniteScrollForLoadableItems(loadStories, sortedStoryIds);
  const [archiveStoryViewportIds, getMoreStoriesArchive, noProfileInfoForStoriesArchive] = useInfiniteScrollForLoadableItems(loadStoriesArchive, archiveStoryIds);
  let viewportIds;
  let getMore;
  let noProfileInfo = false;
  switch (resultType) {
    case 'members':
      viewportIds = memberViewportIds;
      getMore = getMoreMembers;
      noProfileInfo = noProfileInfoForMembers;
      break;
    case 'commonChats':
      viewportIds = commonChatViewportIds;
      getMore = getMoreCommonChats;
      noProfileInfo = noProfileInfoForCommonChats;
      break;
    case 'media':
      viewportIds = mediaViewportIds;
      getMore = getMoreMedia;
      noProfileInfo = noProfileInfoForMedia;
      break;
    case 'gif':
      viewportIds = gifViewportIds;
      getMore = getMoreGifs;
      noProfileInfo = noProfileInfoForGifs;
      break;
    case 'documents':
      viewportIds = documentViewportIds;
      getMore = getMoreDocuments;
      noProfileInfo = noProfileInfoForDocuments;
      break;
    case 'links':
      viewportIds = linkViewportIds;
      getMore = getMoreLinks;
      noProfileInfo = noProfileInfoForLinks;
      break;
    case 'audio':
      viewportIds = audioViewportIds;
      getMore = getMoreAudio;
      noProfileInfo = noProfileInfoForAudio;
      break;
    case 'voice':
      viewportIds = voiceViewportIds;
      getMore = getMoreVoices;
      noProfileInfo = noProfileInfoForVoices;
      break;
    case 'stories':
      viewportIds = storyViewportIds;
      getMore = getMoreStories;
      noProfileInfo = noProfileInfoForStories;
      break;
    case 'storiesArchive':
      viewportIds = archiveStoryViewportIds;
      getMore = getMoreStoriesArchive;
      noProfileInfo = noProfileInfoForStoriesArchive;
      break;
    case 'similarChannels':
      viewportIds = similarChannels;
      break;
    case 'similarBots':
      viewportIds = similarBots;
      break;
    case 'gifts':
      viewportIds = giftIds;
      getMore = loadMoreGifts;
      break;
    case 'dialogs':
      noProfileInfo = true;
      break;
  }
  return [resultType, viewportIds, getMore, noProfileInfo];
}
function useInfiniteScrollForLoadableItems(handleLoadMore, itemIds) {
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(handleLoadMore, itemIds, undefined, _config__WEBPACK_IMPORTED_MODULE_1__.MEMBERS_SLICE);
  const isOnTop = !viewportIds || !itemIds || viewportIds[0] === itemIds[0];
  return [viewportIds, getMore, !isOnTop];
}
function useInfiniteScrollForSharedMedia(forSharedMediaType, currentResultType, handleLoadMore, chatMessages, foundIds, threadId) {
  const messageIdsRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    messageIdsRef.current = undefined;
  }, [threadId]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (currentResultType === forSharedMediaType && chatMessages && foundIds) {
      messageIdsRef.current = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageContentIds)(chatMessages, foundIds, forSharedMediaType);
    }
  }, [chatMessages, foundIds, currentResultType, forSharedMediaType]);
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(handleLoadMore, messageIdsRef.current, undefined, forSharedMediaType === 'media' ? _config__WEBPACK_IMPORTED_MODULE_1__.SHARED_MEDIA_SLICE : _config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_SEARCH_SLICE);
  const isOnTop = !viewportIds || !messageIdsRef.current || viewportIds[0] === messageIdsRef.current[0];
  return [viewportIds, getMore, !isOnTop];
}

/***/ }),

/***/ "./src/components/right/hooks/useTransitionFixes.ts":
/*!**********************************************************!*\
  !*** ./src/components/right/hooks/useTransitionFixes.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTransitionFixes)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");


function useTransitionFixes(containerRef, transitionElSelector = '.Transition.shared-media-transition') {
  // Set `min-height` for shared media container to prevent jumping when switching tabs
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    function setMinHeight() {
      const container = containerRef.current;
      const transitionEl = container.querySelector(transitionElSelector);
      const tabsEl = container.querySelector('.TabList');
      if (transitionEl && tabsEl) {
        const newHeight = container.clientHeight - tabsEl.offsetHeight;
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
          transitionEl.style.minHeight = `${newHeight}px`;
        });
      }
    }
    setMinHeight();
    window.addEventListener('resize', setMinHeight, false);
    return () => {
      window.removeEventListener('resize', setMinHeight, false);
    };
  }, [containerRef, transitionElSelector]);
}

/***/ }),

/***/ "./src/components/right/management/Management.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/right/management/Management.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const ManagementAsync = props => {
  const Management = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'Management');
  return Management ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(Management, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ManagementAsync);

/***/ }),

/***/ "./src/components/right/statistics/BoostStatistics.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/right/statistics/BoostStatistics.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"gk6pIryJ","noResults":"WP4wRUbm","section-header":"LWcgK3OX","sectionHeader":"LWcgK3OX","section":"C8KF95yU","user":"oMy5KOFr","stats":"GOzrl0zF","down":"QuLtxDUV","loadMoreSpinner":"ln5zB7KK","status":"r3zLiaXx","info":"Eo1qQlxx","month":"McSPvm0N","quantity":"s1yf_GJa","floatingBadge":"oSCjRZtx","floatingBadgeButtonColor":"duVpAT_e","floatingBadgeWarning":"DsJMXNNk","floatingBadgeButton":"urrWJVYB","floatingBadgeIcon":"hcA9VPeV","floatingBadgeValue":"hHkCO4Ge","content":"SG00REIA","boostSection":"ETgjBS4d","giveawayButton":"wOCtp5Kk","giveawayIcon":"B9GF4NDB","primaryLink":"GXmXwIbx","copy":"rB0gc1GX","boostInfo":"BhoA3MT6"});

/***/ }),

/***/ "./src/components/right/statistics/BoostStatistics.tsx":
/*!*************************************************************!*\
  !*** ./src/components/right/statistics/BoostStatistics.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_boostInfo__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/boostInfo */ "./src/components/common/helpers/boostInfo.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_LinkField__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/LinkField */ "./src/components/common/LinkField.tsx");
/* harmony import */ var _common_PremiumProgress__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PremiumProgress */ "./src/components/common/PremiumProgress.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _StatisticsOverview__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./StatisticsOverview */ "./src/components/right/statistics/StatisticsOverview.tsx");
/* harmony import */ var _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./BoostStatistics.module.scss */ "./src/components/right/statistics/BoostStatistics.module.scss");
/* harmony import */ var _assets_premium_GiftBlueRound_svg__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../assets/premium/GiftBlueRound.svg */ "./src/assets/premium/GiftBlueRound.svg");
/* harmony import */ var _assets_premium_GiftGreenRound_svg__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../assets/premium/GiftGreenRound.svg */ "./src/assets/premium/GiftGreenRound.svg");
/* harmony import */ var _assets_premium_GiftRedRound_svg__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../assets/premium/GiftRedRound.svg */ "./src/assets/premium/GiftRedRound.svg");
/* harmony import */ var _assets_premium_GiftStar_svg__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../../assets/premium/GiftStar.svg */ "./src/assets/premium/GiftStar.svg");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





























const GIVEAWAY_IMG_LIST = {
  3: _assets_premium_GiftGreenRound_svg__WEBPACK_IMPORTED_MODULE_25__,
  6: _assets_premium_GiftBlueRound_svg__WEBPACK_IMPORTED_MODULE_24__,
  12: _assets_premium_GiftRedRound_svg__WEBPACK_IMPORTED_MODULE_26__
};
const CUSTOM_PEER_STAR_TEMPLATE = {
  isCustomPeer: true,
  avatarIcon: 'star',
  peerColorId: 1
};
const CUSTOM_PEER_TO_BE_DISTRIBUTED = {
  isCustomPeer: true,
  titleKey: 'BoostingToBeDistributed',
  avatarIcon: 'user',
  withPremiumGradient: true
};
const BoostStatistics = ({
  boostStatistics,
  isGiveawayAvailable,
  chatId,
  giveawayBoostsPerPremium,
  isChannel,
  animationLevel
}) => {
  const {
    openChat,
    loadMoreBoosters,
    closeBoostStatistics,
    openGiveawayModal,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const transitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isLoaded = boostStatistics?.boostStatus;
  const status = isLoaded ? boostStatistics.boostStatus : undefined;
  const isGiftListEqual = boostStatistics && boostStatistics?.boosts?.count === boostStatistics?.giftedBoosts?.count;
  const shouldDisplayGiftList = !isGiftListEqual && boostStatistics?.giftedBoosts && boostStatistics?.giftedBoosts?.list?.length > 0;
  const {
    currentLevel,
    hasNextLevel,
    boosts,
    levelProgress,
    remainingBoosts
  } = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!status) {
      return {
        currentLevel: 0,
        hasNextLevel: false,
        boosts: 0,
        levelProgress: 0,
        remainingBoosts: 0,
        prepaidGiveaways: []
      };
    }
    return (0,_common_helpers_boostInfo__WEBPACK_IMPORTED_MODULE_10__.getBoostProgressInfo)(status);
  }, [status]);
  const statsOverview = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!status) return undefined;
    return {
      level: currentLevel,
      boosts,
      premiumSubscribers: status.premiumSubscribers,
      remainingBoosts,
      prepaidGiveaways: status.prepaidGiveaways
    };
  }, [status, boosts, currentLevel, remainingBoosts]);
  const tabs = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (shouldDisplayGiftList) {
      return [{
        type: 'boostList',
        title: lang('BoostingBoostsCount', boostStatistics?.boosts?.count, 'i')
      }, {
        type: 'giftedBoostList',
        title: lang('BoostingGiftsCount', boostStatistics?.giftedBoosts?.count, 'i')
      }];
    }
    return [];
  }, [shouldDisplayGiftList, lang, boostStatistics?.boosts?.count, boostStatistics?.giftedBoosts?.count]);
  const initialTab = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return boostStatistics?.boosts && boostStatistics.boosts?.list.length > 0 ? 1 : 0;
  }, [boostStatistics]);
  const [activeTab, setActiveTab] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(initialTab);
  const renderingActiveTab = activeTab > tabs.length - 1 ? tabs.length - 1 : activeTab;
  const tabType = tabs[renderingActiveTab]?.type;
  const activeKey = tabs.findIndex(({
    type
  }) => type === tabType);
  const boostersToLoadCount = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!boostStatistics) return undefined;
    const list = shouldDisplayGiftList ? tabType === 'boostList' ? boostStatistics.boosts : boostStatistics.giftedBoosts : boostStatistics.boosts;
    if (!list?.count) return undefined;
    const loadedBoostsCount = list.list.reduce((total, boost) => {
      return total + (boost.multiplier || 1);
    }, 0);
    const totalCount = list.count;
    const toLoadCount = totalCount - loadedBoostsCount;
    return toLoadCount > 0 ? toLoadCount : undefined;
  }, [shouldDisplayGiftList, boostStatistics, tabType]);
  const renderBoostIcon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(multiplier => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].quantity,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadge, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButtonColor),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        name: "boost",
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeIcon
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeValue,
        children: multiplier
      })]
    })
  }));
  const renderBoostTypeIcon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(boost => {
    if (!boost.isFromGiveaway && !boost.isGift) {
      return undefined;
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].quantity,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadge, !boost.isFromGiveaway && _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeWarning, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButtonColor, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButton),
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
          name: "gift",
          className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeIcon
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
          className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeValue,
          children: lang(boost.isFromGiveaway ? 'BoostingGiveaway' : 'BoostingGift')
        })]
      })
    });
  });
  const handleBoosterClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(userId => {
    if (!userId) {
      showNotification({
        message: lang('BoostingRecipientWillBeSelected')
      });
      return;
    }
    openChat({
      id: userId
    });
    closeBoostStatistics();
  });
  const renderBoostList = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(boost => {
    const hasStars = Boolean(boost?.stars);
    let customPeer;
    if (hasStars) {
      customPeer = {
        ...CUSTOM_PEER_STAR_TEMPLATE,
        title: lang('Stars', boost.stars)
      };
    }
    if (!boost.userId) {
      customPeer = CUSTOM_PEER_TO_BE_DISTRIBUTED;
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].boostInfo, 'chat-item-clickable'),
      onClick: () => handleBoosterClick(boost.userId),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].user,
        userId: boost.userId,
        customPeer: customPeer,
        status: lang('BoostExpireOn', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateAtTime)(lang, boost.expires * 1000)),
        noEmojiStatus: true,
        forceShowSelf: true,
        noFake: true,
        noVerified: true,
        iconElement: boost.multiplier ? renderBoostIcon(boost.multiplier) : undefined,
        rightElement: renderBoostTypeIcon(boost)
      })
    });
  });
  const handleGiveawayClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openGiveawayModal({
      chatId
    });
  });
  const handleLoadMore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    e.preventDefault();
    loadMoreBoosters({
      isGifts: tabType === 'giftedBoostList'
    });
  });
  const launchPrepaidGiveawayHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(prepaidGiveaway => {
    openGiveawayModal({
      chatId,
      prepaidGiveaway
    });
  });
  function renderContent() {
    let listToRender;
    if (tabType === 'boostList') {
      listToRender = boostStatistics?.boosts?.list;
    } else if (tabType === 'giftedBoostList') {
      listToRender = boostStatistics?.giftedBoosts?.list;
    }
    if (listToRender && !listToRender?.length) {
      return undefined;
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
      children: listToRender?.map(boost => renderBoostList(boost))
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].root, 'panel-content custom-scroll'),
    children: [!isLoaded && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_18__["default"], {}), isLoaded && statsOverview && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_PremiumProgress__WEBPACK_IMPORTED_MODULE_15__["default"], {
          leftText: lang('BoostsLevel', currentLevel),
          rightText: hasNextLevel ? lang('BoostsLevel', currentLevel + 1) : undefined,
          progress: levelProgress,
          floatingBadgeText: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_9__.formatInteger)(boosts),
          floatingBadgeIcon: "boost"
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_StatisticsOverview__WEBPACK_IMPORTED_MODULE_22__["default"], {
          className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].stats,
          statistics: statsOverview,
          type: "boost"
        })]
      }), statsOverview.prepaidGiveaways && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("h4", {
          className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionHeader,
          dir: lang.isRtl ? 'rtl' : undefined,
          children: lang('BoostingPreparedGiveaways')
        }), statsOverview?.prepaidGiveaways?.map(prepaidGiveaway => {
          const isStarsGiveaway = 'stars' in prepaidGiveaway;
          return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
            className: "chat-item-clickable",
            onClick: () => launchPrepaidGiveawayHandler(prepaidGiveaway),
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
              className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].status, 'status-clickable'),
              children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
                children: isStarsGiveaway ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("img", {
                  src: _assets_premium_GiftStar_svg__WEBPACK_IMPORTED_MODULE_27__,
                  className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giveawayIcon,
                  alt: lang('GiftStar')
                }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("img", {
                  src: GIVEAWAY_IMG_LIST[prepaidGiveaway.months] || GIVEAWAY_IMG_LIST[3],
                  className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giveawayIcon,
                  alt: lang('Giveaway')
                })
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
                className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].info,
                children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("h3", {
                  children: isStarsGiveaway ? lang('Giveaway.Stars.Prepaid.Title', prepaidGiveaway.stars) : lang('BoostingTelegramPremiumCountPlural', prepaidGiveaway.quantity)
                }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("p", {
                  className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].month,
                  children: isStarsGiveaway ? lang('Giveaway.Stars.Prepaid.Desc', prepaidGiveaway.quantity) : lang('PrepaidGiveawayMonths', prepaidGiveaway.months)
                })]
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
                className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].quantity,
                children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
                  className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadge, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButtonColor, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButton),
                  children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
                    name: "boost",
                    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeIcon
                  }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
                    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeValue,
                    dir: lang.isRtl ? 'rtl' : undefined,
                    children: isStarsGiveaway ? prepaidGiveaway.boosts : prepaidGiveaway.quantity * (giveawayBoostsPerPremium ?? _config__WEBPACK_IMPORTED_MODULE_2__.GIVEAWAY_BOOST_PER_PREMIUM)
                  })]
                })
              })]
            })
          }, prepaidGiveaway.id);
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("p", {
          className: "text-muted hint",
          children: lang('BoostingSelectPaidGiveaway')
        }, "links-hint")]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        children: [shouldDisplayGiftList ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].boostSection, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].content),
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
            ref: transitionRef,
            name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__.resolveTransitionName)('slideOptimized', animationLevel, undefined, lang.isRtl),
            activeKey: activeKey,
            renderCount: tabs.length,
            shouldRestoreHeight: true,
            children: renderContent()
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_TabList__WEBPACK_IMPORTED_MODULE_20__["default"], {
            activeTab: renderingActiveTab,
            tabs: tabs,
            onSwitchTab: setActiveTab
          })]
        }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("h4", {
            className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionHeader,
            dir: lang.isRtl ? 'rtl' : undefined,
            children: lang('BoostingBoostsCount', boostStatistics?.boosts?.count)
          }), !boostStatistics?.boosts?.list?.length && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div", {
            className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].noResults,
            children: lang(isChannel ? 'NoBoostersHint' : 'NoBoostersGroupHint')
          }), boostStatistics?.boosts?.list?.map(boost => renderBoostList(boost))]
        }), Boolean(boostersToLoadCount) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
          className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].showMore,
          disabled: boostStatistics?.isLoadingBoosters,
          onClick: handleLoadMore,
          children: [boostStatistics?.isLoadingBoosters ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_Spinner__WEBPACK_IMPORTED_MODULE_19__["default"], {
            className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].loadMoreSpinner
          }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
            name: "down",
            className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].down
          }), lang('ShowVotes', boostersToLoadCount, 'i')]
        }, "load-more")]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_common_LinkField__WEBPACK_IMPORTED_MODULE_14__["default"], {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        link: status.boostUrl,
        withShare: true,
        title: lang('LinkForBoosting')
      }), isGiveawayAvailable && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div", {
        className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
          icon: "gift",
          onClick: handleGiveawayClick,
          className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giveawayButton,
          children: lang('BoostingGetBoostsViaGifts')
        }, "load-more"), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("p", {
          className: "text-muted hint",
          children: lang(isChannel ? 'BoostingGetMoreBoosts' : 'BoostingGetMoreBoostsGroup')
        }, "links-hint")]
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const boostStatistics = tabState.boostStatistics;
  const isGiveawayAvailable = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsGiveawayGiftsPurchaseAvailable)(global);
  const chatId = boostStatistics && boostStatistics.chatId;
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId) : undefined;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat);
  const giveawayBoostsPerPremium = global.appConfig.giveawayBoostsPerPremium;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_5__.selectSharedSettings)(global);
  return {
    boostStatistics,
    isGiveawayAvailable,
    chatId: chatId,
    giveawayBoostsPerPremium,
    isChannel,
    animationLevel
  };
})(BoostStatistics)));

/***/ }),

/***/ "./src/components/right/statistics/MessageStatistics.async.tsx":
/*!*********************************************************************!*\
  !*** ./src/components/right/statistics/MessageStatistics.async.tsx ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const MessageStatisticsAsync = props => {
  const MessageStatistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'MessageStatistics');
  return MessageStatistics ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(MessageStatistics, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageStatisticsAsync);

/***/ }),

/***/ "./src/components/right/statistics/MonetizationStatistics.module.scss":
/*!****************************************************************************!*\
  !*** ./src/components/right/statistics/MonetizationStatistics.module.scss ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"vBPv6lUS","graph":"EbPbvB1I","hidden":"nsPIlLYL","ready":"s6qyDhkE","section":"cB2IkwY6","topText":"FLOpxZd1","availableReward":"emE6bAD8","rewardValue":"eyDAxGDU","decimalPart":"jkRV_L7b","integer":"xE9kfGi7","decimalUsdPart":"hWMnYdxX","toncoinIcon":"ubDl9CvS","textBottom":"P3qZJJzF"});

/***/ }),

/***/ "./src/components/right/statistics/MonetizationStatistics.tsx":
/*!********************************************************************!*\
  !*** ./src/components/right/statistics/MonetizationStatistics.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_isGraph__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/isGraph */ "./src/components/right/statistics/helpers/isGraph.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AboutMonetizationModal_async__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/AboutMonetizationModal.async */ "./src/components/common/AboutMonetizationModal.async.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _StatisticsOverview__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./StatisticsOverview */ "./src/components/right/statistics/StatisticsOverview.tsx");
/* harmony import */ var _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./MonetizationStatistics.module.scss */ "./src/components/right/statistics/MonetizationStatistics.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






















let lovelyChartPromise;
let LovelyChart;
async function ensureLovelyChart() {
  if (!lovelyChartPromise) {
    lovelyChartPromise = __webpack_require__.e(/*! import() */ "src_lib_lovely-chart_LovelyChart_js").then(__webpack_require__.bind(__webpack_require__, /*! ../../../lib/lovely-chart/LovelyChart */ "./src/lib/lovely-chart/LovelyChart.js"));
    LovelyChart = await lovelyChartPromise;
  }
  return lovelyChartPromise;
}
const MONETIZATION_GRAPHS_TITLES = {
  topHoursGraph: 'ChannelStats.Graph.ViewsByHours',
  revenueGraph: 'lng_channel_earn_chart_revenue'
};
const MONETIZATION_GRAPHS = Object.keys(MONETIZATION_GRAPHS_TITLES);
const MonetizationStatistics = ({
  chatId,
  dcId,
  statistics,
  isCreator,
  isChannelRevenueWithdrawalEnabled,
  hasPassword
}) => {
  const {
    loadChannelMonetizationStatistics,
    openMonetizationVerificationModal,
    loadPasswordInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isReady, setIsReady] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const loadedCharts = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Set());
  const errorCharts = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Set());
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [isAboutMonetizationModalOpen, openAboutMonetizationModal, closeAboutMonetizationModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])(false);
  const [isConfirmPasswordDialogOpen, openConfirmPasswordDialogOpen, closeConfirmPasswordDialogOpen] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const availableBalance = statistics?.balances?.availableBalance;
  const isWithdrawalEnabled = statistics?.balances?.isWithdrawalEnabled;
  const canWithdraw = isCreator && isChannelRevenueWithdrawalEnabled && Boolean(availableBalance) && isWithdrawalEnabled;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId) {
      loadChannelMonetizationStatistics({
        peerId: chatId
      });
      loadPasswordInfo();
    }
  }, [chatId, loadChannelMonetizationStatistics]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    (async () => {
      await ensureLovelyChart();
      if (!isReady) {
        setIsReady(true);
        return;
      }
      if (containerRef.current) {
        Array.from(containerRef.current.children).forEach(child => {
          child.innerHTML = '';
          child.classList.add(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].hidden);
        });
      }
      loadedCharts.current.clear();
      errorCharts.current.clear();
      if (!statistics || !containerRef.current) {
        return;
      }
      MONETIZATION_GRAPHS.forEach((name, index) => {
        const graph = statistics[name];
        if (!(0,_helpers_isGraph__WEBPACK_IMPORTED_MODULE_6__.isGraph)(graph)) {
          return;
        }
        const isAsync = graph.graphType === 'async';
        const isError = graph.graphType === 'error';
        if (isAsync || loadedCharts.current.has(name)) {
          return;
        }
        if (isError) {
          loadedCharts.current.add(name);
          errorCharts.current.add(name);
          return;
        }
        LovelyChart.create(containerRef.current.children[index], {
          title: oldLang(MONETIZATION_GRAPHS_TITLES[name]),
          ...graph
        });
        loadedCharts.current.add(name);
        containerRef.current.children[index].classList.remove(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].hidden);
      });
      forceUpdate();
    })();
  }, [isReady, statistics, oldLang, chatId, dcId, forceUpdate]);
  function renderAvailableReward() {
    const tonAmount = availableBalance ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_4__.convertTonFromNanos)(availableBalance.amount) : 0;
    const [integerTonPart, decimalTonPart] = tonAmount.toFixed(4).split('.');
    const [integerUsdPart, decimalUsdPart] = availableBalance && statistics?.usdRate ? (tonAmount * statistics.usdRate).toFixed(2).split('.') : [0];
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].availableReward,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
        className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].toncoin,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
          className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].toncoinIcon,
          name: "toncoin"
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("b", {
          className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].rewardValue,
          children: [integerTonPart, decimalTonPart ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("span", {
            className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].decimalPart,
            children: [".", decimalTonPart]
          }) : undefined]
        })]
      }), ' ', (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("span", {
        className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].integer,
        children: ["\u2248 $", integerUsdPart, decimalUsdPart ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("span", {
          className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].decimalUsdPart,
          children: [".", decimalUsdPart]
        }) : undefined]
      })]
    });
  }
  const topText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const linkText = oldLang('LearnMore');
    return lang('ChannelEarnAbout', {
      link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)(_ui_Link__WEBPACK_IMPORTED_MODULE_17__["default"], {
        isPrimary: true,
        onClick: openAboutMonetizationModal,
        children: [linkText, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
          name: "next"
        })]
      })
    }, {
      withNodes: true
    });
  }, [lang, oldLang]);
  const rewardsText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const linkText = oldLang('LearnMore');
    return lang('MonetizationBalanceZeroInfo', {
      link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_14__["default"], {
        url: oldLang('MonetizationProceedsInfoLink'),
        text: linkText,
        children: [linkText, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
          name: "next"
        })]
      })
    }, {
      withNodes: true
    });
  }, [lang, oldLang]);
  const verificationMonetizationHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (hasPassword) {
      openMonetizationVerificationModal({
        chatId
      });
    } else {
      openConfirmPasswordDialogOpen();
    }
  });
  if (!isReady || !statistics) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_18__["default"], {});
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].root, 'custom-scroll', isReady && _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].ready),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section, _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].topText),
      children: topText
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_StatisticsOverview__WEBPACK_IMPORTED_MODULE_19__["default"], {
      statistics: statistics,
      isToncoin: true,
      type: "monetization",
      title: oldLang('MonetizationOverview'),
      subtitle: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
        className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].textBottom,
        children: oldLang('MonetizationProceedsTONInfo')
      })
    }), !loadedCharts.current.size && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_18__["default"], {}), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
      ref: containerRef,
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section,
      children: MONETIZATION_GRAPHS.filter(Boolean).map(graph => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].graph, _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].hidden)
      }, graph))
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section,
      children: [oldLang('lng_channel_earn_balance_title'), renderAvailableReward(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
        type: "button",
        onClick: verificationMonetizationHandler,
        disabled: !canWithdraw,
        children: oldLang('MonetizationWithdraw')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
        className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].textBottom,
        children: rewardsText
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_AboutMonetizationModal_async__WEBPACK_IMPORTED_MODULE_12__["default"], {
      isOpen: isAboutMonetizationModalOpen,
      onClose: closeAboutMonetizationModal
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_16__["default"], {
      isOnlyConfirm: true,
      isOpen: isConfirmPasswordDialogOpen,
      onClose: closeConfirmPasswordDialogOpen,
      confirmHandler: closeConfirmPasswordDialogOpen,
      confirmLabel: lang('OK'),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("p", {
        children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(oldLang('Monetization.Withdraw.Error.Text'), ['br'])
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const {
    settings: {
      byKey: {
        hasPassword
      }
    }
  } = global;
  const monetizationStatistics = tabState.monetizationStatistics;
  const chatId = monetizationStatistics && monetizationStatistics.chatId;
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId) : undefined;
  const dcId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatFullInfo)(global, chatId)?.statisticsDcId;
  const isCreator = Boolean(chat?.isCreator);
  const statistics = tabState.statistics.monetization;
  const isChannelRevenueWithdrawalEnabled = global.appConfig.isChannelRevenueWithdrawalEnabled;
  return {
    chatId: chatId,
    dcId,
    statistics,
    isCreator,
    isChannelRevenueWithdrawalEnabled,
    hasPassword
  };
})(MonetizationStatistics)));

/***/ }),

/***/ "./src/components/right/statistics/Statistics.async.tsx":
/*!**************************************************************!*\
  !*** ./src/components/right/statistics/Statistics.async.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const StatisticsAsync = props => {
  const Statistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'Statistics');
  return Statistics ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(Statistics, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StatisticsAsync);

/***/ }),

/***/ "./src/components/right/statistics/StoryStatistics.async.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/right/statistics/StoryStatistics.async.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const StoryStatisticsAsync = props => {
  const StoryStatistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_1__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_0__.Bundles.Extra, 'StoryStatistics');
  return StoryStatistics ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(StoryStatistics, {
    ...props
  }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_ui_Loading__WEBPACK_IMPORTED_MODULE_2__["default"], {});
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StoryStatisticsAsync);

/***/ }),

/***/ "./src/components/right/stories/StoryAlbumList.module.scss":
/*!*****************************************************************!*\
  !*** ./src/components/right/stories/StoryAlbumList.module.scss ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"tabList":"GgK8T6WN"});

/***/ }),

/***/ "./src/components/right/stories/StoryAlbumList.tsx":
/*!*********************************************************!*\
  !*** ./src/components/right/stories/StoryAlbumList.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _global_selectors_stories__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors/stories */ "./src/global/selectors/stories.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedTabList__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedTabList */ "./src/components/common/AnimatedTabList.tsx");
/* harmony import */ var _StoryAlbumList_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./StoryAlbumList.module.scss */ "./src/components/right/stories/StoryAlbumList.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");










const StoryAlbumList = ({
  peerId,
  className,
  albums,
  selectedAlbumId,
  animationLevel
}) => {
  const {
    selectStoryAlbum,
    resetSelectedStoryAlbum
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleItemSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(itemId => {
    if (itemId === 'all') {
      resetSelectedStoryAlbum();
    } else {
      const albumId = Number(itemId);
      selectStoryAlbum({
        peerId,
        albumId
      });
    }
  });
  if (!albums?.length) {
    return undefined;
  }
  const items = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => [{
    id: 'all',
    title: lang('AllStoriesCategory')
  }, ...albums.map(album => ({
    id: String(album.albumId),
    title: album.title
  }))], [albums, lang]);
  const selectedItemId = selectedAlbumId ? String(selectedAlbumId) : 'all';
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_AnimatedTabList__WEBPACK_IMPORTED_MODULE_7__["default"], {
    items: items,
    selectedItemId: selectedItemId,
    animationLevel: animationLevel,
    onItemSelect: handleItemSelect,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StoryAlbumList_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].tabList, className)
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const {
    stories
  } = global;
  const albums = stories?.albumsByPeerId?.[peerId];
  const selectedAlbumId = (0,_global_selectors_stories__WEBPACK_IMPORTED_MODULE_3__.selectActiveStoriesCollectionId)(global);
  return {
    albums,
    selectedAlbumId,
    animationLevel: (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_2__.selectSharedSettings)(global).animationLevel
  };
})(StoryAlbumList)));

/***/ }),

/***/ "./src/components/story/MediaStory.module.scss":
/*!*****************************************************!*\
  !*** ./src/components/story/MediaStory.module.scss ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"kxMIqtqr","wrapper":"D6Yajvjx","media":"cV_QL3N5","mainIcon":"XHW5o0B8","overlayIcon":"NOCaj4mx","pinnedIcon":"GTWFQyJx","viewsCount":"g09Rb4Ps","duration":"lM_2MMyQ","contextMenu":"UAfI9izT"});

/***/ }),

/***/ "./src/components/story/MediaStory.tsx":
/*!*********************************************!*\
  !*** ./src/components/story/MediaStory.tsx ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../middle/helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./mediaArea/MediaAreaOverlay */ "./src/components/story/mediaArea/MediaAreaOverlay.tsx");
/* harmony import */ var _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./MediaStory.module.scss */ "./src/components/story/MediaStory.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















function MediaStory({
  story,
  isProtected,
  isArchive,
  isPinned,
  canPin
}) {
  const {
    openStoryViewer,
    loadPeerSkippedStories,
    toggleStoryInProfile,
    toggleStoryPinnedToTop,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => containerRef.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => document.body);
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => document.querySelector('#portals .story-context-menu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => ({
    withPortal: true,
    isDense: true
  }));
  const peerId = story && story.peerId;
  const isFullyLoaded = story && 'content' in story;
  const isOwn = isFullyLoaded && story.isOut;
  const isDeleted = story && 'isDeleted' in story;
  const isUnsupportedStory = isFullyLoaded && Object.keys(story.content).length === 0;
  const video = isFullyLoaded ? story.content.video : undefined;
  const duration = video && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatMediaDuration)(video.duration);
  const imageHash = isFullyLoaded ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story) : undefined;
  const imgBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])(imageHash);
  const thumbUrl = imgBlobUrl || video?.thumbnail?.dataUri;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (story && !(isFullyLoaded || isDeleted)) {
      loadPeerSkippedStories({
        peerId: story.peerId
      });
    }
  }, [isDeleted, isFullyLoaded, story]);
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__["default"])(containerRef, !isOwn);
  const handleClick = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSinglePeer: true,
      isPrivate: true,
      isArchive
    });
  }, [isArchive, story.id, story.peerId]);
  const handleMouseDown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    (0,_middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_7__.preventMessageInputBlurWithBubbling)(e);
    handleBeforeContextMenu(e);
  });
  const handleUnarchiveClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
    toggleStoryInProfile({
      peerId,
      storyId: story.id,
      isInProfile: true
    });
    showNotification({
      message: oldLang('Story.ToastSavedToProfileText')
    });
    handleContextMenuClose();
  });
  const handleArchiveClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
    toggleStoryInProfile({
      peerId,
      storyId: story.id,
      isInProfile: false
    });
    showNotification({
      message: oldLang('Story.ToastRemovedFromProfileText')
    });
    handleContextMenuClose();
  });
  const handleTogglePinned = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    toggleStoryPinnedToTop({
      peerId,
      storyId: story.id
    });
    handleContextMenuClose();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
    ref: containerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].root, 'scroll-item'),
    onMouseDown: handleMouseDown,
    onClick: handleClick,
    onContextMenu: handleContextMenu,
    children: [isDeleted && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span", {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].mainIcon,
        name: "story-expired"
      }), oldLang('ExpiredStory')]
    }), isUnsupportedStory && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span", {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].mainIcon,
        name: "warning"
      }), lang('StoryUnsupported')]
    }), isPinned && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].pinnedIcon),
      name: "pin-badge"
    }), isFullyLoaded && Boolean(story.views?.viewsCount) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].viewsCount),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
        name: "eye"
      }), story.views.viewsCount]
    }), duration && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].duration),
      children: duration
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
      className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].wrapper,
      children: [thumbUrl && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("img", {
        src: thumbUrl,
        alt: "",
        className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].media,
        draggable: false
      }), isFullyLoaded && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_16__["default"], {
        story: story
      }), isProtected && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span", {
        className: "protector"
      })]
    }), contextMenuAnchor !== undefined && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_ui_Menu__WEBPACK_IMPORTED_MODULE_14__["default"], {
      isOpen: isContextMenuOpen,
      anchor: contextMenuAnchor,
      getTriggerElement: getTriggerElement,
      getRootElement: getRootElement,
      getMenuElement: getMenuElement,
      getLayout: getLayout,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].contextMenu, 'story-context-menu'),
      autoClose: true,
      onClose: handleContextMenuClose,
      onCloseAnimationEnd: handleContextMenuHide,
      withPortal: true,
      children: [isArchive && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
        icon: "archive",
        onClick: handleUnarchiveClick,
        children: oldLang('StoryList.SaveToProfile')
      }), !isArchive && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
        icon: "archive",
        onClick: handleArchiveClick,
        children: oldLang('Story.Context.RemoveFromProfile')
      }), !isArchive && !isPinned && canPin && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
        icon: "pin",
        onClick: handleTogglePinned,
        children: oldLang('StoryList.ItemAction.Pin')
      }), !isArchive && isPinned && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_15__["default"], {
        icon: "unpin",
        onClick: handleTogglePinned,
        children: oldLang('StoryList.ItemAction.Unpin')
      })]
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  story
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, story.peerId);
  const isProtected = chat?.isProtected;
  const {
    maxPinnedStoriesCount
  } = global.appConfig;
  const isOwn = 'isOut' in story && story.isOut;
  const pinnedStories = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPinnedStories)(global, story.peerId);
  const isPinned = pinnedStories?.some(pinnedStory => pinnedStory.id === story.id);
  const canPinMore = isOwn && (!maxPinnedStoriesCount || (pinnedStories?.length || 0) < maxPinnedStoriesCount);
  return {
    isProtected,
    isPinned,
    canPin: canPinMore
  };
})(MediaStory)));

/***/ }),

/***/ "./src/components/story/StoryViewer.async.tsx":
/*!****************************************************!*\
  !*** ./src/components/story/StoryViewer.async.tsx ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




const StoryViewerAsync = ({
  isOpen
}) => {
  const StoryViewer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StoryViewer', !isOpen);
  return StoryViewer ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(StoryViewer, {}) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StoryViewerAsync));

/***/ }),

/***/ "./src/global/actions/all.ts":
/*!***********************************!*\
  !*** ./src/global/actions/all.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_initial__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./api/initial */ "./src/global/actions/api/initial.ts");
/* harmony import */ var _api_chats__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api/chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./api/messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _api_symbols__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./api/symbols */ "./src/global/actions/api/symbols.ts");
/* harmony import */ var _api_globalSearch__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./api/globalSearch */ "./src/global/actions/api/globalSearch.ts");
/* harmony import */ var _api_middleSearch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./api/middleSearch */ "./src/global/actions/api/middleSearch.ts");
/* harmony import */ var _api_management__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./api/management */ "./src/global/actions/api/management.ts");
/* harmony import */ var _api_sync__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./api/sync */ "./src/global/actions/api/sync.ts");
/* harmony import */ var _api_accounts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./api/accounts */ "./src/global/actions/api/accounts.ts");
/* harmony import */ var _api_users__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./api/users */ "./src/global/actions/api/users.ts");
/* harmony import */ var _api_bots__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./api/bots */ "./src/global/actions/api/bots.ts");
/* harmony import */ var _api_settings__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./api/settings */ "./src/global/actions/api/settings.ts");
/* harmony import */ var _api_twoFaSettings__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./api/twoFaSettings */ "./src/global/actions/api/twoFaSettings.ts");
/* harmony import */ var _api_payments__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./api/payments */ "./src/global/actions/api/payments.ts");
/* harmony import */ var _api_stars__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./api/stars */ "./src/global/actions/api/stars.ts");
/* harmony import */ var _api_reactions__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./api/reactions */ "./src/global/actions/api/reactions.ts");
/* harmony import */ var _api_statistics__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./api/statistics */ "./src/global/actions/api/statistics.ts");
/* harmony import */ var _api_stories__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./api/stories */ "./src/global/actions/api/stories.ts");
/* harmony import */ var _ui_initial__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./ui/initial */ "./src/global/actions/ui/initial.ts");
/* harmony import */ var _ui_chats__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./ui/chats */ "./src/global/actions/ui/chats.ts");
/* harmony import */ var _ui_bots__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ui/bots */ "./src/global/actions/ui/bots.ts");
/* harmony import */ var _ui_messages__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ui/messages */ "./src/global/actions/ui/messages.ts");
/* harmony import */ var _ui_globalSearch__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./ui/globalSearch */ "./src/global/actions/ui/globalSearch.ts");
/* harmony import */ var _ui_middleSearch__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ui/middleSearch */ "./src/global/actions/ui/middleSearch.ts");
/* harmony import */ var _ui_stickerSearch__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./ui/stickerSearch */ "./src/global/actions/ui/stickerSearch.ts");
/* harmony import */ var _ui_account__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./ui/account */ "./src/global/actions/ui/account.ts");
/* harmony import */ var _ui_users__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./ui/users */ "./src/global/actions/ui/users.ts");
/* harmony import */ var _ui_settings__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ui/settings */ "./src/global/actions/ui/settings.ts");
/* harmony import */ var _ui_misc__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./ui/misc */ "./src/global/actions/ui/misc.ts");
/* harmony import */ var _ui_payments__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ui/payments */ "./src/global/actions/ui/payments.ts");
/* harmony import */ var _ui_calls__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ui/calls */ "./src/global/actions/ui/calls.ts");
/* harmony import */ var _ui_mediaViewer__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ui/mediaViewer */ "./src/global/actions/ui/mediaViewer.ts");
/* harmony import */ var _ui_passcode__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./ui/passcode */ "./src/global/actions/ui/passcode.ts");
/* harmony import */ var _ui_stars__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./ui/stars */ "./src/global/actions/ui/stars.ts");
/* harmony import */ var _ui_reactions__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./ui/reactions */ "./src/global/actions/ui/reactions.ts");
/* harmony import */ var _ui_stories__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./ui/stories */ "./src/global/actions/ui/stories.ts");
/* harmony import */ var _ui_statistics__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./ui/statistics */ "./src/global/actions/ui/statistics.ts");
/* harmony import */ var _apiUpdaters_initial__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./apiUpdaters/initial */ "./src/global/actions/apiUpdaters/initial.ts");
/* harmony import */ var _apiUpdaters_chats__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./apiUpdaters/chats */ "./src/global/actions/apiUpdaters/chats.ts");
/* harmony import */ var _apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./apiUpdaters/messages */ "./src/global/actions/apiUpdaters/messages.ts");
/* harmony import */ var _apiUpdaters_users__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./apiUpdaters/users */ "./src/global/actions/apiUpdaters/users.ts");
/* harmony import */ var _apiUpdaters_symbols__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./apiUpdaters/symbols */ "./src/global/actions/apiUpdaters/symbols.ts");
/* harmony import */ var _apiUpdaters_misc__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./apiUpdaters/misc */ "./src/global/actions/apiUpdaters/misc.ts");
/* harmony import */ var _apiUpdaters_settings__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./apiUpdaters/settings */ "./src/global/actions/apiUpdaters/settings.ts");
/* harmony import */ var _apiUpdaters_twoFaSettings__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./apiUpdaters/twoFaSettings */ "./src/global/actions/apiUpdaters/twoFaSettings.ts");
/* harmony import */ var _apiUpdaters_calls__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./apiUpdaters/calls */ "./src/global/actions/apiUpdaters/calls.ts");
/* harmony import */ var _apiUpdaters_payments__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./apiUpdaters/payments */ "./src/global/actions/apiUpdaters/payments.ts");
















































/***/ }),

/***/ "./src/global/actions/api/accounts.ts":
/*!********************************************!*\
  !*** ./src/global/actions/api/accounts.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('reportPeer', async (global, actions, payload) => {
  const {
    chatId,
    reason,
    description,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('reportPeer', {
    peer: chat,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('reportProfilePhoto', async (global, actions, payload) => {
  const {
    chatId,
    reason,
    description,
    photo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  if (!chat || !photo) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('reportProfilePhoto', {
    peer: chat,
    photo,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('loadAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('fetchAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      byHash: result.authorizations,
      orderedHashes: Object.keys(result.authorizations),
      ttlDays: result.ttlDays
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateAuthorization', async (global, actions, payload) => {
  const {
    hash
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateAuthorization', hash);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const {
    [hash]: removedSessions,
    ...newSessions
  } = global.activeSessions.byHash;
  global = {
    ...global,
    activeSessions: {
      byHash: newSessions,
      orderedHashes: global.activeSessions.orderedHashes.filter(el => el !== hash)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateAllAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateAllAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const currentSessionHash = global.activeSessions.orderedHashes.find(hash => global.activeSessions.byHash[hash].isCurrent);
  if (!currentSessionHash) {
    return;
  }
  const currentSession = global.activeSessions.byHash[currentSessionHash];
  global = {
    ...global,
    activeSessions: {
      byHash: {
        [currentSessionHash]: currentSession
      },
      orderedHashes: [currentSessionHash]
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('changeSessionSettings', async (global, actions, payload) => {
  const {
    hash,
    areCallsEnabled,
    areSecretChatsEnabled,
    isConfirmed
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('changeSessionSettings', {
    hash,
    areCallsEnabled,
    areSecretChatsEnabled,
    isConfirmed
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      ...global.activeSessions,
      byHash: {
        ...global.activeSessions.byHash,
        [hash]: {
          ...global.activeSessions.byHash[hash],
          ...(areCallsEnabled !== undefined ? {
            areCallsEnabled
          } : undefined),
          ...(areSecretChatsEnabled !== undefined ? {
            areSecretChatsEnabled
          } : undefined),
          ...(isConfirmed && {
            isUnconfirmed: undefined
          })
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('changeSessionTtl', async (global, actions, payload) => {
  const {
    days
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('changeSessionTtl', {
    days
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      ...global.activeSessions,
      ttlDays: days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('loadWebAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('fetchWebAuthorizations');
  if (!result) {
    return;
  }
  const {
    webAuthorizations
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeWebSessions: {
      byHash: webAuthorizations,
      orderedHashes: Object.keys(webAuthorizations)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateWebAuthorization', async (global, actions, payload) => {
  const {
    hash
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateWebAuthorization', hash);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const {
    [hash]: removedSessions,
    ...newSessions
  } = global.activeWebSessions.byHash;
  global = {
    ...global,
    activeWebSessions: {
      byHash: newSessions,
      orderedHashes: global.activeWebSessions.orderedHashes.filter(el => el !== hash)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateAllWebAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateAllWebAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeWebSessions: {
      byHash: {},
      orderedHashes: []
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('loadAccountDaysTtl', async (global, actions, payload) => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('fetchAccountTTL');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    settings: {
      ...global.settings,
      accountDaysTtl: result.days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('setAccountTTL', async (global, actions, payload) => {
  const {
    days,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  if (!days) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('setAccountTTL', {
    days
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    settings: {
      ...global.settings,
      accountDaysTtl: days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
  actions.closeDeleteAccountModal({
    tabId
  });
});

/***/ }),

/***/ "./src/global/actions/api/bots.ts":
/*!****************************************!*\
  !*** ./src/global/actions/api/bots.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   checkIfOpenOrActivate: () => (/* binding */ checkIfOpenOrActivate),
/* harmony export */   isWepAppOpened: () => (/* binding */ isWepAppOpened)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees_ts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/iteratees.ts */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/requestActionTimeout */ "./src/util/requestActionTimeout.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_bots__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../reducers/bots */ "./src/global/reducers/bots.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_sharedState__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");


























const TOP_PEERS_REQUEST_COOLDOWN = 60; // 1 min
const runDebouncedForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_11__.debounce)(cb => cb(), 500, false);
let botFatherId;
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('clickSuggestedMessageButton', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    button,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    buttonType
  } = button;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessage)(global, chatId, messageId);
  switch (buttonType) {
    case 'suggestChanges':
      if (!message) break;
      actions.initDraftFromSuggestedMessage({
        chatId,
        messageId,
        tabId
      });
      break;
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('clickBotInlineButton', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    threadId,
    button,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  switch (button.type) {
    case 'command':
      actions.sendBotCommand({
        command: button.text,
        tabId
      });
      break;
    case 'url':
      {
        const {
          url
        } = button;
        actions.openUrl({
          url,
          tabId,
          linkContext: {
            type: 'message',
            chatId,
            messageId,
            threadId
          }
        });
        break;
      }
    case 'copy':
      {
        (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyTextToClipboard)(button.copyText);
        actions.showNotification({
          message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('ExactTextCopied', button.copyText),
          tabId
        });
        break;
      }
    case 'callback':
      {
        void answerCallbackButton(global, actions, chat, messageId, threadId, button.data, undefined, tabId);
        break;
      }
    case 'requestPoll':
      actions.openPollModal({
        isQuiz: button.isQuiz,
        tabId
      });
      break;
    case 'requestPhone':
      {
        const user = global.currentUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, global.currentUserId) : undefined;
        if (!user) {
          return;
        }
        actions.showDialog({
          data: {
            phoneNumber: user.phoneNumber,
            firstName: user.firstName || '',
            lastName: user.lastName || '',
            userId: user.id
          },
          tabId
        });
        break;
      }
    case 'receipt':
      {
        const {
          receiptMessageId
        } = button;
        actions.getReceipt({
          chatId: chat.id,
          messageId: receiptMessageId,
          tabId
        });
        break;
      }
    case 'buy':
      {
        actions.openInvoice({
          type: 'message',
          chatId: chat.id,
          messageId,
          tabId
        });
        break;
      }
    case 'game':
      {
        void answerCallbackButton(global, actions, chat, messageId, threadId, undefined, true, tabId);
        break;
      }
    case 'switchBotInline':
      {
        const {
          query,
          isSamePeer
        } = button;
        actions.switchBotInline({
          query,
          isSamePeer,
          messageId,
          tabId
        });
        break;
      }
    case 'userProfile':
      {
        const {
          userId
        } = button;
        actions.openChatWithInfo({
          id: userId,
          tabId
        });
        break;
      }
    case 'simpleWebView':
      {
        const {
          url
        } = button;
        const sender = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSender)(global, message);
        if (!sender) {
          return;
        }
        const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_13__.extractCurrentThemeParams)();
        actions.requestSimpleWebView({
          url,
          botId: sender.id,
          theme,
          buttonText: button.text,
          tabId
        });
        break;
      }
    case 'webView':
      {
        const {
          url
        } = button;
        const sender = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSender)(global, message);
        const botId = message.viaBotId || sender?.id;
        if (!botId) {
          return;
        }
        const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_13__.extractCurrentThemeParams)();
        actions.requestWebView({
          url,
          botId,
          peerId: chat.id,
          theme,
          buttonText: button.text,
          tabId
        });
        break;
      }
    case 'urlAuth':
      {
        const {
          url
        } = button;
        actions.requestBotUrlAuth({
          chatId: chat.id,
          messageId,
          buttonId: button.buttonId,
          url,
          tabId
        });
        break;
      }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('sendBotCommand', (global, actions, payload) => {
  const {
    command,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!chat || !currentMessageList) {
    return;
  }
  const {
    threadId
  } = currentMessageList;
  actions.resetDraftReplyInfo({
    tabId
  });
  actions.clearWebPagePreview({
    tabId
  });
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, chat.id);
  void sendBotCommand(chat, command, (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectDraft)(global, chat.id, threadId)?.replyInfo, (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSendAs)(global, chat.id), lastMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('restartBot', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    currentUserId
  } = global;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  const bot = currentUserId && (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectBot)(global, chatId);
  if (!currentUserId || !chat || !bot) {
    return;
  }
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, chat.id);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('unblockUser', {
    user: bot
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.removeBlockedUser)(global, bot.id);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  void sendBotCommand(chat, '/start', undefined, (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSendAs)(global, chatId), lastMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('loadTopInlineBots', async global => {
  const {
    lastRequestedAt
  } = global.topInlineBots;
  if (lastRequestedAt && (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)() - lastRequestedAt < TOP_PEERS_REQUEST_COOLDOWN) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchTopInlineBots');
  if (!result) {
    return;
  }
  const {
    ids
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = {
    ...global,
    topInlineBots: {
      ...global.topInlineBots,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('loadTopBotApps', async global => {
  const {
    lastRequestedAt
  } = global.topBotApps;
  if (lastRequestedAt && (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)() - lastRequestedAt < TOP_PEERS_REQUEST_COOLDOWN) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchTopBotApps');
  if (!result) {
    return;
  }
  const {
    ids
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = {
    ...global,
    topBotApps: {
      ...global.topBotApps,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('queryInlineBot', async (global, actions, payload) => {
  const {
    chatId,
    username,
    query,
    offset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let inlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  if (inlineBotData === false) {
    return;
  }
  if (inlineBotData === undefined) {
    const {
      user: inlineBot,
      chat
    } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchInlineBot', {
      username
    })) || {};
    global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
    if (!inlineBot || !chat) {
      global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotSettings)(global, username, false, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
      return;
    }
    inlineBotData = {
      id: inlineBot.id,
      query: '',
      offset: '',
      switchPm: undefined,
      canLoadMore: true,
      results: [],
      cacheTime: 0
    };
    global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotSettings)(global, username, inlineBotData, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  }
  if (query === inlineBotData.query && !inlineBotData.canLoadMore) {
    return;
  }
  void runDebouncedForSearch(() => {
    searchInlineBot(global, {
      username,
      inlineBotData,
      chatId,
      query,
      offset
    }, tabId);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('switchBotInline', (global, actions, payload) => {
  const {
    query,
    isSamePeer,
    messageId,
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let {
    botId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return undefined;
  }
  if (!botId && messageId) {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessage)(global, chat.id, messageId);
    if (!message) {
      return undefined;
    }
    const sender = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSender)(global, message);
    botId = message.viaBotId || sender?.id;
  }
  if (!botId) {
    return undefined;
  }
  const botSender = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!botSender) {
    return undefined;
  }
  actions.openChatWithDraft({
    text: {
      text: `@${(0,_helpers__WEBPACK_IMPORTED_MODULE_15__.getMainUsername)(botSender)} ${query}`
    },
    chatId: isSamePeer ? chat.id : undefined,
    filter,
    tabId
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('sendInlineBotApiResult', async (global, actions, payload) => {
  const {
    chat,
    id,
    queryId,
    replyInfo,
    sendAs,
    isSilent,
    scheduledAt,
    allowPaidStars
  } = payload;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendInlineBotResult', {
    chat,
    resultId: id,
    queryId,
    replyInfo,
    sendAs,
    isSilent,
    scheduleDate: scheduledAt,
    allowPaidStars
  });
  if (allowPaidStars) actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('sendInlineBotResult', async (global, actions, payload) => {
  const {
    id,
    queryId,
    isSilent,
    scheduledAt,
    threadId,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (!id) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  const draftReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo);
  actions.resetDraftReplyInfo({
    tabId
  });
  actions.clearWebPagePreview({
    tabId
  });
  const starsForOneMessage = await (0,_messages__WEBPACK_IMPORTED_MODULE_23__.getPeerStarsForMessage)(global, chatId);
  const params = {
    chat,
    id,
    queryId,
    replyInfo,
    sendAs: (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSendAs)(global, chatId),
    isSilent,
    scheduledAt,
    allowPaidStars: starsForOneMessage
  };
  if (!starsForOneMessage) {
    actions.sendInlineBotApiResult(params);
    return;
  }
  actions.sendInlineBotApiResult({
    ...params
  });
  actions.showNotification({
    localId: queryId,
    title: {
      key: 'MessageSentPaidToastTitle',
      variables: {
        count: 1
      },
      options: {
        pluralValue: 1
      }
    },
    message: {
      key: 'MessageSentPaidToastText',
      variables: {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsText)((0,_util_localization__WEBPACK_IMPORTED_MODULE_7__.getTranslationFn)(), starsForOneMessage)
      }
    },
    icon: 'star',
    shouldUseCustomIcon: true,
    type: 'paidMessage',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('resetInlineBot', (global, actions, payload) => {
  const {
    username,
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let inlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  if (!inlineBotData) {
    return;
  }
  if (!force && Date.now() < inlineBotData.cacheTime) return;
  inlineBotData = {
    id: inlineBotData.id,
    query: '',
    offset: '',
    switchPm: undefined,
    canLoadMore: true,
    results: [],
    cacheTime: 0
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotSettings)(global, username, inlineBotData, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('resetAllInlineBots', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  const inlineBots = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).inlineBots.byUsername;
  Object.keys(inlineBots).forEach(username => {
    actions.resetInlineBot({
      username,
      tabId
    });
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('startBot', async (global, actions, payload) => {
  const {
    botId,
    param
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) {
    return;
  }
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUserFullInfo)(global, botId);
  if (!fullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchFullUser', {
      id: bot.id,
      accessHash: bot.accessHash
    });
    fullInfo = result?.fullInfo;
  }
  if (fullInfo?.isBlocked) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('unblockUser', {
      user: bot
    });
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('startBot', {
    bot,
    startParam: param
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('sharePhoneWithBot', async (global, actions, payload) => {
  const {
    botId
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) {
    return;
  }
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUserFullInfo)(global, botId);
  if (!fullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchFullUser', {
      id: bot.id,
      accessHash: bot.accessHash
    });
    fullInfo = result?.fullInfo;
  }
  if (fullInfo?.isBlocked) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('unblockUser', {
      user: bot
    });
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, botId);
  const currentUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, global.currentUserId);
  if (!chat) return;
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, chat.id);
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendMessage', {
    chat,
    contact: {
      mediaType: 'contact',
      firstName: currentUser.firstName || '',
      lastName: currentUser.lastName || '',
      phoneNumber: currentUser.phoneNumber || '',
      userId: currentUser.id
    },
    lastMessageId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('requestSimpleWebView', async (global, actions, payload) => {
  const {
    url,
    botId,
    theme,
    buttonText,
    isFromSideMenu,
    isFromSwitchWebView,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (checkIfOpenOrActivate(global, botId, tabId, url)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'webApp',
        onConfirm: {
          action: 'requestSimpleWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    return;
  }
  const webViewUrl = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestSimpleWebView', {
    url,
    bot,
    theme,
    startParam,
    isFromSideMenu,
    isFromSwitchWebView
  });
  if (!webViewUrl) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const newActiveApp = {
    requestUrl: url,
    appName: bot.firstName,
    url: webViewUrl,
    botId,
    buttonText
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('requestWebView', async (global, actions, payload) => {
  const {
    url,
    botId,
    peerId,
    theme,
    isSilent,
    buttonText,
    isFromBotMenu,
    startParam,
    isFullscreen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (checkIfOpenOrActivate(global, botId, tabId, url)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectPeer)(global, peerId);
  if (!peer) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'webApp',
        onConfirm: {
          action: 'requestWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    return;
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = currentMessageList || {};
  const draftReplyInfo = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectDraft)(global, chatId, threadId)?.replyInfo : undefined;
  const replyInfo = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo) : undefined;
  const sendAs = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSendAs)(global, chatId) : undefined;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestWebView', {
    url,
    bot,
    peer,
    theme,
    isSilent,
    replyInfo,
    isFromBotMenu,
    startParam,
    sendAs,
    isFullscreen
  });
  if (!result) {
    return;
  }
  const {
    url: webViewUrl,
    queryId,
    isFullScreen
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const newActiveApp = {
    requestUrl: url,
    url: webViewUrl,
    appName: bot.firstName,
    botId,
    peerId,
    queryId,
    replyInfo,
    buttonText
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  if (isFullScreen && (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_24__.getIsWebAppsFullscreenSupported)()) {
    actions.changeWebAppModalState({
      state: 'fullScreen',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('requestMainWebView', async (global, actions, payload) => {
  const {
    botId,
    peerId,
    theme,
    startParam,
    mode,
    shouldMarkBotTrusted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return;
  }
  if (checkIfOpenOrActivate(global, botId, tabId)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectPeer)(global, peerId);
  if (!peer) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsTrustedBot)(global, botId)) {
    if (shouldMarkBotTrusted) {
      actions.markBotTrusted({
        botId,
        isWriteAllowed: true,
        tabId
      });
    } else {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
        botTrustRequest: {
          botId,
          type: 'webApp',
          onConfirm: {
            action: 'requestMainWebView',
            payload
          }
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
      return;
    }
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestMainWebView', {
    bot,
    peer,
    theme,
    startParam,
    mode
  });
  if (!result) {
    return;
  }
  const {
    url: webViewUrl,
    queryId,
    isFullscreen
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const newActiveApp = {
    url: webViewUrl,
    appName: bot.firstName,
    botId,
    peerId,
    queryId,
    buttonText: ''
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  if (isFullscreen && (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_24__.getIsWebAppsFullscreenSupported)()) {
    actions.changeWebAppModalState({
      state: 'fullScreen',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('loadPreviewMedias', async (global, actions, payload) => {
  const {
    botId
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  const medias = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchPreviewMedias', {
    bot
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  if (medias) {
    global = {
      ...global,
      users: {
        ...global.users,
        previewMediaByBotId: {
          ...global.users.previewMediaByBotId,
          [botId]: medias
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('openWebAppsCloseConfirmationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    isWebAppsCloseConfirmationModalOpen: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('closeWebAppsCloseConfirmationModal', (global, actions, payload) => {
  const {
    shouldSkipInFuture,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateSharedSettings)(global, {
    shouldSkipWebAppCloseConfirmation: Boolean(shouldSkipInFuture)
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    isWebAppsCloseConfirmationModalOpen: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('requestAppWebView', async (global, actions, payload) => {
  const {
    botId,
    appName,
    startApp,
    mode,
    theme,
    isWriteAllowed,
    isFromConfirm,
    shouldSkipBotTrustRequest,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (checkIfOpenOrActivate(global, botId, tabId, appName)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;

  // Native clients require to install attach bots before using their named mini apps
  const isAttachBotInstalled = Boolean(global.attachMenu.bots[bot.id]);
  if (bot.isAttachBot && !isFromConfirm && !isAttachBotInstalled) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('loadAttachBot', {
      bot
    });
    if (result) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
      const attachBot = result.bot;
      const shouldAskForTos = attachBot.isDisclaimerNeeded || attachBot.isForAttachMenu || attachBot.isForSideMenu;
      if (shouldAskForTos) {
        global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
          requestedAttachBotInstall: {
            bot: attachBot,
            onConfirm: {
              action: 'requestAppWebView',
              payload: {
                ...payload,
                isFromConfirm: true
              }
            }
          }
        }, tabId);
        (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
        return;
      }
    }
  }
  const botApp = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchBotApp', {
    bot,
    appName
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  if (!botApp) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_9__.oldTranslate)('lng_username_app_not_found'),
      tabId
    });
    return;
  }
  const shouldRequestBotTrust = !shouldSkipBotTrustRequest && (botApp.isInactive || !(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsTrustedBot)(global, botId));
  if (shouldRequestBotTrust) {
    payload.shouldSkipBotTrustRequest = true;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        shouldRequestWriteAccess: botApp.shouldRequestWriteAccess,
        type: 'botApp',
        onConfirm: {
          action: 'requestAppWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    return;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  const {
    url,
    isFullscreen
  } = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestAppWebView', {
    peer: peer || bot,
    app: botApp,
    startParam: startApp,
    mode,
    isWriteAllowed,
    theme
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  if (!url) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const peerId = peer ? peer.id : bot.id;
  const newActiveApp = {
    url,
    appName: appName && bot.firstName,
    peerId,
    botId,
    buttonText: ''
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  if (isFullscreen && (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_24__.getIsWebAppsFullscreenSupported)()) {
    actions.changeWebAppModalState({
      state: 'fullScreen',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('prolongWebView', async (global, actions, payload) => {
  const {
    botId,
    peerId,
    isSilent,
    replyInfo,
    queryId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, peerId);
  if (!peer) return;
  const sendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSendAs)(global, peerId);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('prolongWebView', {
    bot,
    peer,
    isSilent,
    replyInfo,
    queryId,
    sendAs
  });
  if (!result) {
    actions.closeActiveWebApp({
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('sendWebViewData', (global, actions, payload) => {
  const {
    bot,
    data,
    buttonText
  } = payload;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendWebViewData', {
    bot,
    data,
    buttonText
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('loadAttachBots', async global => {
  await loadAttachBots(global);
  (0,_util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_10__["default"])({
    action: 'loadAttachBots',
    payload: undefined
  }, _config__WEBPACK_IMPORTED_MODULE_2__.GENERAL_REFETCH_INTERVAL);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('toggleAttachBot', async (global, actions, payload) => {
  const {
    botId,
    isWriteAllowed,
    isEnabled
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('toggleAttachBot', {
    bot,
    isWriteAllowed,
    isEnabled
  });
});
function isWepAppOpened(global, webApp, tabId) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_15__.getWebAppKey)(webApp);
  if (!key) return false;
  return openedWebApps[key];
}
function checkIfOpenOrActivate(global, botId, tabId, requestUrl, webAppName) {
  const webAppForCheck = {
    botId,
    requestUrl,
    webAppName
  };
  if (isWepAppOpened(global, webAppForCheck, tabId)) {
    const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_15__.getWebAppKey)(webAppForCheck);
    if (key) {
      global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.activateWebAppIfOpen)(global, key, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    }
    return true;
  }
  return false;
}
async function loadAttachBots(global, hash) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('loadAttachBots', {
    hash
  });
  if (!result) {
    return undefined;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = {
    ...global,
    attachMenu: {
      hash: result.hash,
      bots: result.bots
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  return result;
}
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('callAttachBot', (global, actions, payload) => {
  const {
    bot,
    startParam,
    isFromConfirm,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const isFromSideMenu = 'isFromSideMenu' in payload && payload.isFromSideMenu;
  const isFromBotMenu = !bot;
  const shouldDisplayDisclaimer = !isFromBotMenu && !global.attachMenu.bots[bot.id] || bot?.isInactive || bot?.isDisclaimerNeeded;
  if (!isFromConfirm && shouldDisplayDisclaimer) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      requestedAttachBotInstall: {
        bot,
        onConfirm: {
          action: 'callAttachBot',
          payload: {
            ...payload,
            isFromConfirm: true
          }
        }
      }
    }, tabId);
  }
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_13__.extractCurrentThemeParams)();
  if (isFromSideMenu) {
    actions.requestSimpleWebView({
      botId: bot.id,
      buttonText: '',
      isFromSideMenu: true,
      startParam,
      theme,
      tabId
    });
  }
  if ('chatId' in payload) {
    const {
      chatId,
      threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
      url
    } = payload;
    actions.openThread({
      chatId,
      threadId,
      tabId
    });
    actions.requestWebView({
      url,
      peerId: chatId,
      botId: isFromBotMenu ? chatId : bot.id,
      theme,
      buttonText: '',
      isFromBotMenu,
      startParam,
      tabId
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('confirmAttachBotInstall', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    requestedAttachBotInstall
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  const {
    bot,
    onConfirm
  } = requestedAttachBotInstall;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    requestedAttachBotInstall: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  const botUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, bot.id);
  if (!botUser) return;
  actions.markBotTrusted({
    botId: bot.id,
    isWriteAllowed,
    tabId
  });
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('toggleAttachBot', {
    bot: botUser,
    isWriteAllowed,
    isEnabled: true
  });
  if (onConfirm) {
    const {
      action,
      payload: actionPayload
    } = onConfirm;
    // @ts-ignore
    actions[action](actionPayload);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('requestBotUrlAuth', async (global, actions, payload) => {
  const {
    chatId,
    buttonId,
    messageId,
    url,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestBotUrlAuth', {
    chat,
    buttonId,
    messageId
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    urlAuth: {
      url,
      button: {
        buttonId,
        messageId,
        chatId: chat.id
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('acceptBotUrlAuth', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.urlAuth?.button) return;
  const {
    button,
    url
  } = tabState.urlAuth;
  const {
    chatId,
    messageId,
    buttonId
  } = button;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('acceptBotUrlAuth', {
    chat,
    messageId,
    buttonId,
    isWriteAllowed
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('requestLinkUrlAuth', async (global, actions, payload) => {
  const {
    url,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestLinkUrlAuth', {
    url
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    urlAuth: {
      url
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('acceptLinkUrlAuth', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.urlAuth?.url) return;
  const {
    url
  } = tabState.urlAuth;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('acceptLinkUrlAuth', {
    url,
    isWriteAllowed
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('closeUrlAuthModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    urlAuth: undefined
  }, tabId);
});
function handleUrlAuthResult(global, actions, url, result, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()]) {
  if (result.type === 'request') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
    const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
    if (!tabState.urlAuth) return;
    const {
      domain,
      bot,
      shouldRequestWriteAccess
    } = result;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      urlAuth: {
        ...tabState.urlAuth,
        request: {
          domain,
          botId: bot.id,
          shouldRequestWriteAccess
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    return;
  }
  const siteUrl = result.type === 'accepted' ? result.url : url;
  window.open(siteUrl, '_blank', 'noopener');
  actions.closeUrlAuthModal({
    tabId
  });
}
async function searchInlineBot(global, {
  username,
  inlineBotData,
  chatId,
  query,
  offset
}, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()]) {
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, inlineBotData.id);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  if (!bot || !chat) {
    return;
  }
  const shouldReplaceSettings = inlineBotData.query !== query;
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotsIsLoading)(global, true, tabId);
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotSettings)(global, username, {
    ...inlineBotData,
    query,
    ...(shouldReplaceSettings && {
      offset: undefined,
      results: []
    })
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchInlineBotResults', {
    bot,
    chat,
    query,
    offset: shouldReplaceSettings ? undefined : offset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  const currentInlineBotSettings = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotsIsLoading)(global, false, tabId);
  if (!result || !currentInlineBotSettings || query !== currentInlineBotSettings.query) {
    (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    return;
  }
  const currentIds = new Set((currentInlineBotSettings.results || []).map(data => data.id));
  const newResults = result.results.filter(data => !currentIds.has(data.id));
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_18__.replaceInlineBotSettings)(global, username, {
    ...currentInlineBotSettings,
    ...(0,_util_iteratees_ts__WEBPACK_IMPORTED_MODULE_6__.pick)(result, ['help', 'switchPm', 'switchWebview']),
    cacheTime: Date.now() + result.cacheTime * 1000,
    ...(newResults.length && {
      isGallery: result.isGallery
    }),
    canLoadMore: result.results.length > 0 && Boolean(result.nextOffset),
    results: currentInlineBotSettings.offset === '' || currentInlineBotSettings.offset === result.nextOffset ? result.results : (currentInlineBotSettings.results || []).concat(newResults),
    offset: newResults.length ? result.nextOffset : ''
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
}
async function sendBotCommand(chat, command, replyInfo, sendAs, lastMessageId) {
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendMessage', {
    chat,
    replyInfo,
    text: command,
    sendAs,
    lastMessageId
  });
}
async function answerCallbackButton(global, actions, chat, messageId, threadId, data, isGame = false, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()]) {
  const {
    showDialog,
    showNotification,
    openUrl,
    openGame
  } = actions;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('answerCallbackButton', {
    chatId: chat.id,
    accessHash: chat.accessHash,
    messageId,
    data,
    isGame
  });
  if (!result) {
    return;
  }
  const {
    message,
    alert: isError,
    url
  } = result;
  if (isError) {
    showDialog({
      data: {
        message: message || 'Error'
      },
      tabId
    });
  } else if (message) {
    showNotification({
      message,
      tabId
    });
  } else if (url) {
    if (isGame) {
      openGame({
        url,
        chatId: chat.id,
        messageId,
        tabId
      });
    } else {
      openUrl({
        url,
        tabId,
        linkContext: {
          type: 'message',
          chatId: chat.id,
          messageId,
          threadId
        }
      });
    }
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('setBotInfo', async (global, actions, payload) => {
  const {
    bot,
    name,
    description: about,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let {
    langCode
  } = payload;
  if (!langCode) langCode = (0,_selectors_sharedState__WEBPACK_IMPORTED_MODULE_21__.selectSharedSettings)(global).language;
  const {
    currentUserId
  } = global;
  if (!currentUserId || !bot) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_1__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
  if (name || about) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('setBotInfo', {
      bot,
      langCode,
      name,
      about
    });
    if (result) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateUser)(global, bot.id, {
        firstName: name
      });
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateUserFullInfo)(global, bot.id, {
        bio: about
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_1__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('toggleUserEmojiStatusPermission', async (global, actions, payload) => {
  const {
    botId,
    isEnabled,
    isBotAccessEmojiGranted
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectBot)(global, botId);
  if (!botId || !bot) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('toggleUserEmojiStatusPermission', {
    bot,
    isEnabled
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateUserFullInfo)(global, botId, {
    isBotCanManageEmojiStatus: isEnabled,
    isBotAccessEmojiGranted
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('toggleUserLocationPermission', (global, actions, payload) => {
  const {
    botId,
    isAccessGranted
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectUser)(global, botId);
  if (!bot) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_17__.updateBotAppPermissions)(global, bot.id, {
    geolocation: isAccessGranted
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('startBotFatherConversation', async (global, actions, payload) => {
  const {
    param,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (!botFatherId) {
    const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_22__.fetchChatByUsername)(global, _config__WEBPACK_IMPORTED_MODULE_2__.BOT_FATHER_USERNAME);
    if (!chat) {
      return;
    }
    botFatherId = chat.id;
  }
  if (param) {
    actions.startBot({
      botId: botFatherId,
      param
    });
  }
  actions.openChat({
    id: botFatherId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_16__.addActionHandler)('loadBotFreezeAppeal', async global => {
  const botUrl = global.appConfig.freezeAppealUrl;
  if (!botUrl) return;
  const botAppealUsername = botUrl ? (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_4__.getUsernameFromDeepLink)(botUrl) : undefined;
  if (!botAppealUsername) return;
  const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_22__.fetchChatByUsername)(global, botAppealUsername);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_16__.getGlobal)();
  global = {
    ...global,
    botFreezeAppealId: chat?.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_16__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/globalSearch.ts":
/*!************************************************!*\
  !*** ./src/global/actions/api/globalSearch.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers_chats__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helpers/chats */ "./src/global/helpers/chats.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");















const searchThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_8__.throttle)(cb => cb(), 500, false);
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('setGlobalSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch;
  if (query && !chatId) {
    void searchThrottled(async () => {
      const [searchResult, sponsoredResult] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('searchChats', {
        query
      }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('fetchSponsoredPeer', {
        query
      })]);
      global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
      const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentGlobalSearchQuery)(global, tabId);
      if (!searchResult || !currentSearchQuery || query !== currentSearchQuery) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
          chats: false
        }, tabId);
        (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        return;
      }
      const {
        accountResultIds,
        globalResultIds
      } = searchResult;
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
        chats: false
      }, tabId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearch)(global, {
        localResults: {
          peerIds: accountResultIds
        },
        globalResults: {
          ...(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch.globalResults,
          peerIds: globalResultIds
        },
        sponsoredPeer: sponsoredResult
      }, tabId);
      (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
    });
  }
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('setGlobalSearchDate', (global, actions, payload) => {
  const {
    date,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const maxDate = date ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.timestampPlusDay)(date) : date;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearch)(global, {
    minDate: date,
    maxDate,
    query: '',
    resultsByType: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch.resultsByType,
      text: {
        totalCount: undefined,
        foundIds: [],
        nextOffsetId: 0
      }
    }
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  actions.searchMessagesGlobal({
    type: 'text',
    tabId
  });
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('searchMessagesGlobal', (global, actions, payload) => {
  const {
    type,
    context,
    shouldResetResultsByType,
    shouldCheckFetchingMessagesStatus,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (shouldCheckFetchingMessagesStatus) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
      messages: true
    }, tabId);
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
    global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  }
  const {
    query,
    resultsByType,
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch;
  const {
    totalCount,
    foundIds,
    nextOffsetId,
    nextOffsetPeerId,
    nextOffsetRate
  } = !shouldResetResultsByType && resultsByType?.[type] || {};

  // Stop loading if we have all the messages or server returned 0
  if (totalCount !== undefined && (!totalCount || foundIds && foundIds.length >= totalCount)) {
    return;
  }
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPeer)(global, chatId) : undefined;
  const offsetPeer = nextOffsetPeerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPeer)(global, nextOffsetPeerId) : undefined;
  searchMessagesGlobal(global, {
    query,
    type,
    context,
    shouldResetResultsByType,
    offsetRate: nextOffsetRate,
    offsetId: nextOffsetId,
    offsetPeer,
    peer: chat,
    tabId
  });
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('searchPopularBotApps', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  const popularBotApps = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch.popularBotApps;
  const offset = popularBotApps?.nextOffset;
  if (popularBotApps?.peerIds && !offset) return; // Already fetched all

  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
    botApps: true
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('fetchPopularAppBots', {
    offset
  });
  global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
      botApps: false
    }, tabId);
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearch)(global, {
    popularBotApps: {
      peerIds: [...(popularBotApps?.peerIds || []), ...result.peerIds],
      nextOffset: result.nextOffset
    }
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
    botApps: false
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('checkSearchPostsFlood', async (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('checkSearchPostsFlood', query);
  global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  if (!result) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearch)(global, {
    searchFlood: result
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
});
async function searchMessagesGlobal(global, params) {
  const {
    query = '',
    type,
    context,
    offsetRate,
    offsetId,
    offsetPeer,
    peer,
    maxDate,
    minDate,
    shouldResetResultsByType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = params;
  if (type === 'publicPosts') {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
      publicPosts: true
    }, tabId);
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  }
  let result;
  let messageLink;
  const previousSearchFlood = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch.searchFlood;
  if (peer) {
    const inChatResultRequest = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('searchMessagesInChat', {
      peer,
      query,
      type,
      limit: _config__WEBPACK_IMPORTED_MODULE_1__.GLOBAL_SEARCH_SLICE,
      offsetId,
      minDate,
      maxDate
    });
    const isChat = (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_11__.isApiPeerChat)(peer);
    const topicsRequest = isChat && peer.isForum ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('fetchTopics', {
      chat: peer,
      query,
      limit: _config__WEBPACK_IMPORTED_MODULE_1__.GLOBAL_TOPIC_SEARCH_SLICE
    }) : undefined;
    const [inChatResult, topics] = await Promise.all([inChatResultRequest, topicsRequest]);
    if (inChatResult) {
      const {
        messages,
        totalCount,
        nextOffsetId
      } = inChatResult;
      const {
        topics: localTopics,
        count
      } = topics || {};
      result = {
        topics: localTopics,
        totalTopicsCount: count,
        messages,
        totalCount,
        nextOffsetId
      };
    }
  } else {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('searchMessagesGlobal', {
      query,
      offsetRate,
      offsetId,
      offsetPeer,
      limit: _config__WEBPACK_IMPORTED_MODULE_1__.GLOBAL_SEARCH_SLICE,
      type,
      context,
      maxDate,
      minDate
    });
    if ((0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_3__.isDeepLink)(query)) {
      const link = (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_3__.tryParseDeepLink)(query);
      if (link?.type === 'publicMessageLink') {
        messageLink = await getMessageByPublicLink(global, link);
      } else if (link?.type === 'privateMessageLink') {
        messageLink = await getMessageByPrivateLink(global, link);
      }
    }
  }
  global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  if (shouldResetResultsByType) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearch)(global, {
      resultsByType: {
        ...((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).globalSearch || {}).resultsByType,
        [type]: undefined
      }
    }, tabId);
  }
  const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentGlobalSearchQuery)(global, tabId);
  if (!result || query !== '' && query !== currentSearchQuery) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchFetchingStatus)(global, {
      messages: false,
      publicPosts: false
    }, tabId);
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
    return;
  }
  if (messageLink) {
    result.totalCount = result.messages.unshift(messageLink);
  }
  const {
    messages,
    userStatusesById,
    totalCount,
    nextOffsetRate,
    nextOffsetId,
    nextOffsetPeerId
  } = result;
  const searchFlood = result.searchFlood || previousSearchFlood;
  if (userStatusesById) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUserStatuses)(global, userStatusesById);
  }
  if (messages.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addMessages)(global, messages);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearchResults)(global, messages, totalCount, type, nextOffsetRate, nextOffsetId, nextOffsetPeerId, searchFlood, tabId);
  if (result.topics) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateTopics)(global, peer.id, result.totalTopicsCount, result.topics);
  }
  const sortedTopics = result.topics?.map(({
    id
  }) => id).sort((a, b) => b - a);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateGlobalSearch)(global, {
    foundTopicIds: sortedTopics
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  if (type === 'publicPosts' && searchFlood && !searchFlood.queryIsFree && !offsetId && previousSearchFlood?.remains === 0) {
    const lang = (0,_util_localization__WEBPACK_IMPORTED_MODULE_6__.getTranslationFn)();
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)().showNotification({
      icon: 'star',
      message: {
        key: 'NotificationPaidExtraSearch',
        variables: {
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatStarsAsText)(lang, searchFlood.starsAmount)
        }
      }
    });
  }
}
async function getMessageByPublicLink(global, link) {
  const {
    username,
    messageId
  } = link;
  const localChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatByUsername)(global, username);
  if (localChat) {
    return getChatGroupOrChannelMessage(global, localChat, messageId);
  }
  const {
    chat
  } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('getChatByUsername', username)) ?? {};
  if (!chat) {
    return undefined;
  }
  return getChatGroupOrChannelMessage(global, chat, messageId);
}
function getMessageByPrivateLink(global, link) {
  const {
    channelId,
    messageId
  } = link;
  const internalChannelId = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_4__.toChannelId)(channelId);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, internalChannelId);
  if (!chat) {
    return undefined;
  }
  return getChatGroupOrChannelMessage(global, chat, messageId);
}
async function getChatGroupOrChannelMessage(global, chat, messageId) {
  if (!(0,_helpers_chats__WEBPACK_IMPORTED_MODULE_10__.isChatGroup)(chat) && !(0,_helpers_chats__WEBPACK_IMPORTED_MODULE_10__.isChatChannel)(chat)) {
    return undefined;
  }
  const localMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chat.id, messageId);
  if (localMessage) {
    return localMessage;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('fetchMessage', {
    chat,
    messageId
  });
  return result === 'MESSAGE_DELETED' ? undefined : result?.message;
}

/***/ }),

/***/ "./src/global/actions/api/management.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/api/management.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./chats */ "./src/global/actions/api/chats.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('checkPublicLink', async (global, actions, payload) => {
  const {
    username,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }

  // No need to check the username if already in progress
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.progress === _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    isUsernameAvailable: undefined,
    checkedUsername: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const {
    result,
    error
  } = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('checkChatUsername', {
    username
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, result === true ? _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete : _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    isUsernameAvailable: result === true,
    checkedUsername: username,
    error
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  if (result === undefined) {
    actions.openLimitReachedModal({
      limit: 'channelsPublic',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updatePublicLink', async (global, actions, payload) => {
  const {
    username,
    shouldDisableUsernames,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }
  const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_8__.ensureIsSuperGroup)(global, actions, chatId, tabId);
  if (!chat) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('setChatUsername', {
    chat,
    username
  });
  if (shouldDisableUsernames) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('deactivateAllUsernames', {
      chat
    });
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, result ? _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete : _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chat.id, {
    isUsernameAvailable: undefined,
    checkedUsername: undefined,
    error: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updatePrivateLink', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  const chat = chatId && (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!chatId || !chat) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('updatePrivateLink', {
    chat
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setEditingExportedInvite', (global, actions, payload) => {
  const {
    chatId,
    invite,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    editingInvite: invite
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setOpenedInviteInfo', (global, actions, payload) => {
  const {
    chatId,
    invite,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const update = invite ? {
    inviteInfo: {
      invite
    }
  } : {
    inviteInfo: undefined
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, update, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadExportedChatInvites', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserFrozen)(global)) return;
  const {
    chatId,
    adminId,
    isRevoked,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const admin = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, adminId || global.currentUserId);
  if (!peer || !admin) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchExportedChatInvites', {
    peer,
    admin,
    isRevoked,
    limit
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const {
    invites
  } = result;
  const update = isRevoked ? {
    revokedInvites: invites
  } : {
    invites
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, update, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('editExportedChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    link,
    isRevoked,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('editExportedChatInvite', {
    peer,
    link,
    isRevoked,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title
  });
  if (!result) {
    return;
  }
  const {
    oldInvite,
    newInvite
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const {
    management
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
  const invites = (management.byChatId[chatId].invites || []).filter(current => current.link !== oldInvite.link);
  const revokedInvites = [...(management.byChatId[chatId].revokedInvites || [])];
  if (newInvite.isRevoked) {
    revokedInvites.unshift(newInvite);
  } else {
    invites.push(newInvite);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    invites,
    revokedInvites
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('exportChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('exportChatInvite', {
    peer,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const invites = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId].invites || [];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    invites: [...invites, result]
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('deleteExportedChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    link,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('deleteExportedChatInvite', {
    peer,
    link
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const managementState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    invites: managementState?.invites?.filter(invite => invite.link !== link),
    revokedInvites: managementState?.revokedInvites?.filter(invite => invite.link !== link)
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('deleteRevokedExportedChatInvites', async (global, actions, payload) => {
  const {
    chatId,
    adminId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const admin = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, adminId || global.currentUserId);
  if (!peer || !admin) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('deleteRevokedExportedChatInvites', {
    peer,
    admin
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    revokedInvites: []
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadChatInviteImporters', async (global, actions, payload) => {
  const {
    chatId,
    link,
    offsetDate,
    offsetUserId,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchChatInviteImporters', {
    peer,
    link,
    offsetDate,
    offsetUser,
    limit
  });
  if (!result) {
    return;
  }
  const {
    importers
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const currentInviteInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId]?.inviteInfo;
  if (!currentInviteInfo?.invite || currentInviteInfo.invite.link !== link) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    inviteInfo: {
      ...currentInviteInfo,
      importers
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadChatInviteRequesters', async (global, actions, payload) => {
  const {
    chatId,
    link,
    offsetDate,
    offsetUserId,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchChatInviteImporters', {
    peer,
    link,
    offsetDate,
    offsetUser,
    limit,
    isRequested: true
  });
  if (!result) {
    return;
  }
  const {
    importers
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const currentInviteInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId]?.inviteInfo;
  if (!currentInviteInfo?.invite || currentInviteInfo.invite.link !== link) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    inviteInfo: {
      ...currentInviteInfo,
      requesters: importers
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadChatJoinRequests', async (global, actions, payload) => {
  const {
    chatId,
    offsetDate = 0,
    offsetUserId,
    limit = 0
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchChatInviteImporters', {
    peer,
    offsetDate,
    offsetUser,
    limit,
    isRequested: true
  });
  if (!result) {
    return;
  }
  const {
    importers
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
    joinRequests: importers
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('hideChatJoinRequest', async (global, actions, payload) => {
  const {
    chatId,
    userId,
    isApproved
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, userId);
  if (!peer || !user) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('hideChatJoinRequest', {
    peer,
    user,
    isApproved
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const targetChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!targetChat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
    joinRequests: targetChat.joinRequests?.filter(importer => importer.userId !== userId)
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('hideAllChatJoinRequests', async (global, actions, payload) => {
  const {
    chatId,
    isApproved,
    link
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('hideAllChatJoinRequests', {
    peer,
    isApproved,
    link
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const targetChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!targetChat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
    joinRequests: []
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChatFullInfo)(global, chatId, {
    recentRequesterIds: [],
    requestsPending: 0
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('hidePeerSettingsBar', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, peerId);
  if (!user) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('hidePeerSettingsBar', user);
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateUserFullInfo)(global, peerId, {
    settings: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('uploadContactProfilePhoto', async (global, actions, payload) => {
  const {
    userId,
    file,
    isSuggest,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, userId);
  if (!user) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('uploadContactProfilePhoto', {
    user,
    file,
    isSuggest
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const {
    id,
    accessHash
  } = user;
  const newUser = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchFullUser', {
    id,
    accessHash
  });
  if (!newUser) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
    return;
  }
  actions.loadMoreProfilePhotos({
    peerId: userId,
    shouldInvalidateCache: true
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  if (file && !isSuggest) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate('UserInfo.SetCustomPhoto.SuccessPhotoText', (0,_helpers__WEBPACK_IMPORTED_MODULE_4__.getUserFirstOrLastName)(user)),
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('resetManagementError', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    error: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/api/messages.ts":
/*!********************************************!*\
  !*** ./src/global/actions/api/messages.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getPeerStarsForMessage: () => (/* binding */ getPeerStarsForMessage)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_browser_url__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/url */ "./src/util/browser/url.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../apiUpdaters/messages */ "./src/global/actions/apiUpdaters/messages.ts");
























const AUTOLOGIN_TOKEN_KEY = 'autologin_token';
const uploadProgressCallbacks = new Map();
const runDebouncedForMarkRead = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_13__.debounce)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadViewportMessages', (global, actions, payload) => {
  const {
    direction = _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around,
    isBudgetPreload = false,
    shouldForceRender = false,
    forceLastSlice = false,
    onLoaded,
    onError,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  let {
    chatId,
    threadId
  } = payload || {};
  if (!chatId || !threadId) {
    const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
    if (!currentMessageList) {
      onError?.();
      return;
    }
    chatId = currentMessageList.chatId;
    threadId = currentMessageList.threadId;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const isRestricted = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsChatRestricted)(global, chatId);
  // TODO Revise if `isRestricted` check is needed
  if (!chat || isRestricted) {
    onError?.();
    return;
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectViewportIds)(global, chatId, threadId, tabId);
  const listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectListedIds)(global, chatId, threadId);
  if (!viewportIds || !viewportIds.length || direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around) {
    const offsetId = !forceLastSlice ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectFocusedMessageId)(global, chatId, tabId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectRealLastReadId)(global, chatId, threadId) : undefined;
    const isOutlying = Boolean(offsetId && listedIds && !listedIds.includes(offsetId));
    const historyIds = (isOutlying ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : listedIds) || [];
    const {
      newViewportIds,
      areSomeLocal,
      areAllLocal
    } = getViewportSlice(historyIds, offsetId, _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around);
    if (areSomeLocal) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
    if (!areAllLocal) {
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_13__.onTickEnd)(() => {
        void loadViewportMessages(global, chat, threadId, offsetId, _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around, isOutlying, isBudgetPreload, onLoaded, tabId);
      });
    } else {
      onLoaded?.();
    }
  } else {
    const offsetId = !forceLastSlice ? direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards ? viewportIds[0] : viewportIds[viewportIds.length - 1] : undefined;

    // Prevent requests with local offsets
    if (offsetId && (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__.isLocalMessageId)(offsetId)) return;

    // Prevent unnecessary requests in threads
    if (offsetId === threadId && direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return;
    const isOutlying = Boolean(listedIds && offsetId && !listedIds.includes(offsetId));
    const historyIds = isOutlying ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : listedIds;
    if (historyIds?.length) {
      const {
        newViewportIds,
        areSomeLocal,
        areAllLocal
      } = getViewportSlice(historyIds, offsetId, direction);
      if (areSomeLocal) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
      }
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_13__.onTickEnd)(() => {
        void loadWithBudget(global, actions, areAllLocal, isOutlying, isBudgetPreload, chat, threadId, direction, offsetId, onLoaded, tabId);
      });
    }
    if (isBudgetPreload) {
      return;
    }
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global, {
    forceOnHeavyAnimation: shouldForceRender
  });
});
async function loadWithBudget(global, actions, areAllLocal, isOutlying, isBudgetPreload, chat, threadId, direction, offsetId, onLoaded, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()]) {
  if (!areAllLocal) {
    await loadViewportMessages(global, chat, threadId, offsetId, direction, isOutlying, isBudgetPreload, onLoaded, tabId);
  }
  if (!isBudgetPreload) {
    actions.loadViewportMessages({
      chatId: chat.id,
      threadId,
      direction,
      isBudgetPreload: true,
      onLoaded,
      tabId
    });
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadMessage', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    replyOriginForId,
    threadUpdate
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const message = await loadMessage(global, chat, messageId, replyOriginForId);
  if (message && threadUpdate) {
    const {
      lastMessageId,
      isDeleting
    } = threadUpdate;
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateThreadUnreadFromForwardedMessage)(global, message, chatId, lastMessageId, isDeleting);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadMessagesById', async (global, actions, payload) => {
  const {
    chatId,
    messageIds
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const messages = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchMessagesById', {
    chat,
    messageIds
  });
  if (!messages) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.addChatMessagesById)(global, chatId, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendMessage', async (global, actions, payload) => {
  const {
    messageList,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const {
    storyId,
    peerId: storyPeerId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentViewedStory)(global, tabId);
  const isStoryReply = Boolean(storyId && storyPeerId);
  if (!messageList && !isStoryReply) {
    return;
  }
  let {
    chatId,
    threadId,
    type
  } = messageList || {};
  if (isStoryReply) {
    chatId = storyPeerId;
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
    type = 'thread';
  }
  payload = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.omit)(payload, ['tabId']);
  if (type === 'scheduled' && !payload.scheduledAt) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      contentToBeScheduled: payload
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const draft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  const isForwarding = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).forwardMessages?.messageIds?.length;
  const draftReplyInfo = !isForwarding && !isStoryReply ? draft?.replyInfo : undefined;
  const draftSuggestedPostInfo = !isForwarding && !isStoryReply ? draft?.suggestedPostInfo : undefined;
  const storyReplyInfo = isStoryReply ? {
    type: 'story',
    peerId: storyPeerId,
    storyId: storyId
  } : undefined;
  const messageReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo);
  const replyInfo = storyReplyInfo || messageReplyInfo;
  const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectThreadInfo)(global, chatId, threadId);
  const lastMessageId = threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatLastMessageId)(global, chatId) : threadInfo?.lastMessageId;
  const messagePriceInStars = await getPeerStarsForMessage(global, chatId);
  const suggestedPostPrice = draftSuggestedPostInfo?.price;
  const suggestedPostCurrency = suggestedPostPrice?.currency || _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE;
  const suggestedPostAmount = suggestedPostPrice?.amount || 0;
  if (suggestedPostAmount && !draftReplyInfo) {
    if (suggestedPostCurrency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE) {
      const currentBalance = global.stars?.balance?.amount || 0;
      if (suggestedPostAmount > currentBalance) {
        actions.openStarsBalanceModal({
          topup: {
            balanceNeeded: suggestedPostAmount
          },
          tabId
        });
        return;
      }
    } else if (suggestedPostCurrency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE) {
      const currentTonBalance = global.ton?.balance?.amount || 0;
      if (suggestedPostAmount > currentTonBalance) {
        actions.openStarsBalanceModal({
          currency: _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE,
          tabId
        });
        return;
      }
    }
  }
  const suggestedMessage = draftReplyInfo && draftSuggestedPostInfo ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, draftReplyInfo.replyToMsgId) : undefined;
  let suggestedMedia;
  if (draftSuggestedPostInfo && suggestedMessage?.content) {
    suggestedMedia = suggestedMessage.content;
  }
  if (chat.isBotForum && threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && replyInfo?.type === 'message') {
    const replyMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, replyInfo.replyToMsgId);
    const replyThreadId = replyMessage && (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectThreadIdFromMessage)(global, replyMessage);
    actions.openThread({
      chatId: chatId,
      threadId: replyThreadId || replyInfo?.replyToTopId || replyInfo?.replyToMsgId,
      tabId
    });
  }
  const params = {
    ...payload,
    chat,
    replyInfo,
    suggestedPostInfo: draftSuggestedPostInfo,
    suggestedMedia,
    noWebPage: (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectNoWebPage)(global, chatId, threadId),
    sendAs: (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, chatId),
    lastMessageId,
    messagePriceInStars,
    isStoryReply,
    isPending: messagePriceInStars ? true : undefined,
    ...(suggestedMessage && {
      isInvertedMedia: suggestedMessage?.isInvertedMedia
    })
  };
  if (!isStoryReply) {
    actions.clearWebPagePreview({
      tabId
    });
  }

  // Create new bot forum topic
  if (chat.isBotForum && threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && replyInfo?.type !== 'message') {
    const baseTitle = params.text ?? (0,_util_localization__WEBPACK_IMPORTED_MODULE_10__.getTranslationFn)()('BotForumTopicTitlePlaceholder');
    const title = baseTitle.length > 12 ? `${baseTitle.slice(0, 12)}...` : baseTitle;
    const topic = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('createTopic', {
      chat,
      title,
      isTitleMissing: true,
      sendAs: params.sendAs
    });
    if (topic) {
      params.replyInfo = params.replyInfo?.type === 'message' ? {
        ...params.replyInfo,
        replyToTopId: topic
      } : {
        type: 'message',
        replyToMsgId: topic,
        replyToTopId: topic
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_18__.getActions)().openThread({
        chatId: chat.id,
        threadId: topic
      });
    }
  }
  const isSingle = (!payload.attachments || payload.attachments.length <= 1) && !isForwarding;
  const isGrouped = !isSingle && payload.shouldGroupMessages;
  const localMessages = [];
  if (isSingle) {
    const {
      attachments,
      ...restParams
    } = params;
    const sendParams = {
      ...restParams,
      attachment: attachments ? attachments[0] : undefined,
      wasDrafted: Boolean(draft)
    };
    await sendMessageOrReduceLocal(global, sendParams, localMessages);
  } else if (isGrouped) {
    const {
      text,
      entities,
      attachments,
      ...commonParams
    } = params;
    const byType = splitAttachmentsByType(attachments);
    let hasSentCaption = false;
    for (let groupIndex = 0; groupIndex < byType.length; groupIndex++) {
      const group = byType[groupIndex];
      const groupedAttachments = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.split)(group, _config__WEBPACK_IMPORTED_MODULE_2__.MAX_MEDIA_FILES_FOR_ALBUM);
      for (let i = 0; i < groupedAttachments.length; i++) {
        const groupedId = `${Date.now()}${groupIndex}${i}`;
        const isFirst = i === 0 && groupIndex === 0;
        const isLast = i === groupedAttachments.length - 1 && groupIndex === byType.length - 1;
        if (group[0].quick && !group[0].shouldSendAsFile) {
          const [firstAttachment, ...restAttachments] = groupedAttachments[i];
          let sendParams = {
            ...commonParams,
            text: isFirst && !hasSentCaption ? text : undefined,
            entities: isFirst && !hasSentCaption ? entities : undefined,
            attachment: firstAttachment,
            groupedId: restAttachments.length > 0 ? groupedId : undefined,
            wasDrafted: Boolean(draft)
          };
          await sendMessageOrReduceLocal(global, sendParams, localMessages);
          hasSentCaption = true;
          for (const attachment of restAttachments) {
            sendParams = {
              ...commonParams,
              attachment,
              groupedId
            };
            await sendMessageOrReduceLocal(global, sendParams, localMessages);
          }
        } else {
          const firstAttachments = groupedAttachments[i].slice(0, -1);
          const lastAttachment = groupedAttachments[i][groupedAttachments[i].length - 1];
          for (const attachment of firstAttachments) {
            const sendParams = {
              ...commonParams,
              attachment,
              groupedId
            };
            await sendMessageOrReduceLocal(global, sendParams, localMessages);
          }
          const sendParams = {
            ...commonParams,
            text: isLast && !hasSentCaption ? text : undefined,
            entities: isLast && !hasSentCaption ? entities : undefined,
            attachment: lastAttachment,
            groupedId: firstAttachments.length > 0 ? groupedId : undefined,
            wasDrafted: Boolean(draft)
          };
          await sendMessageOrReduceLocal(global, sendParams, localMessages);
          hasSentCaption = true;
        }
      }
    }
  } else {
    const {
      text,
      entities,
      attachments,
      replyInfo: replyToForFirstMessage,
      ...commonParams
    } = params;
    if (text) {
      const sendParams = {
        ...commonParams,
        text,
        entities,
        replyInfo: replyToForFirstMessage,
        wasDrafted: Boolean(draft)
      };
      await sendMessageOrReduceLocal(global, sendParams, localMessages);
    }
    if (attachments) {
      for (const attachment of attachments) {
        const sendParams = {
          ...commonParams,
          attachment
        };
        await sendMessageOrReduceLocal(global, sendParams, localMessages);
      }
    }
  }
  if (isForwarding) {
    const localForwards = await executeForwardMessages(global, params, tabId);
    if (localForwards) {
      localMessages.push(...localForwards);
    }
  }
  if (localMessages?.length) sendMessagesWithNotification(global, localMessages);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendInviteMessages', async (global, actions, payload) => {
  const {
    chatId,
    userIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatFullInfo)(global, chatId);
  if (!chatFullInfo?.inviteLink) {
    return undefined;
  }
  const userFullNames = [];
  await Promise.all(userIds.map(userId => {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, userId);
    if (!chat) {
      return Promise.resolve(undefined);
    }
    const userFullName = (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.getUserFullName)((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, userId));
    if (userFullName) {
      userFullNames.push(userFullName);
    }
    return sendMessage(global, {
      chat,
      text: chatFullInfo.inviteLink
    });
  }));
  return actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('Conversation.ShareLinkTooltip.Chat.One', userFullNames.join(', ')),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('editMessage', (global, actions, payload) => {
  const {
    messageList,
    text,
    entities,
    attachments,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  if (!messageList) {
    return;
  }
  let currentMessageKey;
  const progressCallback = attachments ? (progress, messageKey) => {
    if (!uploadProgressCallbacks.has(messageKey)) {
      currentMessageKey = messageKey;
      uploadProgressCallbacks.set(messageKey, progressCallback);
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateUploadByMessageKey)(global, messageKey, progress);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  } : undefined;
  const {
    chatId,
    threadId,
    type: messageListType
  } = messageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectEditingMessage)(global, chatId, threadId, messageListType);
  if (!chat || !message) {
    return;
  }
  actions.setEditingId({
    messageId: undefined,
    tabId
  });
  (async () => {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('editMessage', {
      chat,
      message,
      attachment: attachments ? attachments[0] : undefined,
      text,
      entities,
      noWebPage: (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectNoWebPage)(global, chatId, threadId)
    }, progressCallback);
    if (progressCallback && currentMessageKey) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateUploadByMessageKey)(global, currentMessageKey, undefined);
      (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
      uploadProgressCallbacks.delete(currentMessageKey);
    }
  })();
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('editTodo', (global, actions, payload) => {
  const {
    chatId,
    todo,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('editTodo', {
    chat,
    message,
    todo
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('cancelUploadMedia', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const progressCallback = message && uploadProgressCallbacks.get((0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__.getMessageKey)(message));
  if (progressCallback) {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.cancelApiProgress)(progressCallback);
  }
  if ((0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isMessageLocal)(message)) {
    actions.apiUpdate({
      '@type': 'deleteMessages',
      ids: [messageId],
      chatId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('saveDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    text
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!text || !chat) {
    return;
  }
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  if (chat.isMonoforum && !currentDraft?.replyInfo && !currentDraft?.suggestedPostInfo) {
    return; // Monoforum doesn't support drafts outside threads
  }
  const newDraft = {
    text,
    replyInfo: currentDraft?.replyInfo,
    effectId: currentDraft?.effectId,
    suggestedPostInfo: currentDraft?.suggestedPostInfo
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('clearDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    isLocalOnly,
    shouldKeepReply,
    shouldKeepSuggestedPost
  } = payload;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  if (!currentDraft) {
    return;
  }
  const currentReplyInfo = currentDraft.replyInfo;
  const newDraft = shouldKeepReply && currentReplyInfo || shouldKeepSuggestedPost && currentDraft.suggestedPostInfo ? {
    replyInfo: shouldKeepReply ? currentReplyInfo : undefined,
    suggestedPostInfo: shouldKeepSuggestedPost ? currentDraft.suggestedPostInfo : undefined
  } : undefined;
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('updateDraftReplyInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)(),
    ...update
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  const updatedReplyInfo = {
    type: 'message',
    ...currentDraft?.replyInfo,
    ...update
  };
  if (!updatedReplyInfo.replyToMsgId) return;
  const newDraft = {
    ...currentDraft,
    replyInfo: updatedReplyInfo,
    suggestedPostInfo: undefined
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('resetDraftReplyInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  if (chat?.isMonoforum && !currentDraft?.replyInfo && !currentDraft?.suggestedPostInfo) {
    return; // Monoforum doesn't support drafts outside threads
  }
  const newDraft = !currentDraft?.text ? undefined : {
    ...currentDraft,
    replyInfo: undefined
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: Boolean(newDraft)
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('updateDraftSuggestedPostInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)(),
    ...update
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  const updatedSuggestedPostInfo = {
    ...currentDraft?.suggestedPostInfo,
    ...update
  };
  const newDraft = {
    ...currentDraft,
    suggestedPostInfo: updatedSuggestedPostInfo
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('resetDraftSuggestedPostInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  saveDraft({
    global,
    chatId,
    threadId,
    draft: undefined,
    isLocalOnly: false
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('initDraftFromSuggestedMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  if (!message) {
    return;
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    threadId
  } = currentMessageList;
  actions.clearDraft({
    chatId,
    threadId,
    isLocalOnly: true
  });
  actions.updateDraftReplyInfo({
    replyToMsgId: messageId,
    monoforumPeerId: (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSavedDialogIdFromMessage)(global, message),
    tabId
  });
  if (message.suggestedPostInfo) {
    const {
      scheduleDate,
      ...messageSuggestedPost
    } = message.suggestedPostInfo;
    const now = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_14__.getServerTime)();
    const futureMin = global.appConfig.starsSuggestedPostFutureMin;
    const validScheduleDate = scheduleDate && scheduleDate > now + futureMin ? scheduleDate : undefined;
    actions.updateDraftSuggestedPostInfo({
      ...messageSuggestedPost,
      scheduleDate: validScheduleDate,
      tabId
    });
  }
  actions.saveDraft({
    chatId,
    threadId,
    text: message.content.text
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('saveEffectInDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    effectId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId);
  if (chat?.isMonoforum && !currentDraft?.replyInfo && !currentDraft?.suggestedPostInfo) {
    return; // Monoforum doesn't support drafts outside threads
  }
  const newDraft = {
    ...currentDraft,
    effectId
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('updateInsertingPeerIdMention', (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    insertingPeerIdMention: peerId
  }, tabId);
});
async function saveDraft({
  global,
  chatId,
  threadId,
  draft,
  isLocalOnly,
  noLocalTimeUpdate
}) {
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, chatId);
  if (!chat || user && (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isDeletedUser)(user)) return;
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectMessageReplyInfo)(global, chatId, threadId, draft?.replyInfo);
  const newDraft = draft ? {
    ...draft,
    replyInfo,
    date: Math.floor(Date.now() / 1000),
    isLocal: true
  } : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceThreadParam)(global, chatId, threadId, 'draft', newDraft);
  if (!noLocalTimeUpdate) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
      draftDate: newDraft?.date
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  if (isLocalOnly) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('saveDraft', {
    chat,
    draft: newDraft
  });
  if (result && newDraft) {
    newDraft.isLocal = false;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceThreadParam)(global, chatId, threadId, 'draft', newDraft);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
    draftDate: newDraft?.date
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('toggleMessageWebPage', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    noWebPage
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceThreadParam)(global, chatId, threadId, 'noWebPage', noWebPage);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('pinMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    isUnpin,
    isOneSide,
    isSilent
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('pinMessage', {
    chat,
    messageId,
    isUnpin,
    isOneSide,
    isSilent
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('unpinAllMessages', async (global, actions, payload) => {
  const {
    chatId,
    threadId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('unpinAllMessages', {
    chat,
    threadId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const pinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPinnedIds)(global, chatId, threadId);
  pinnedIds?.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, id, {
      isPinned: false
    });
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceThreadParam)(global, chat.id, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'pinnedIds', []);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('deleteMessages', (global, actions, payload) => {
  const {
    messageIds,
    shouldDeleteForAll,
    messageList: payloadMessageList,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  const messageList = payloadMessageList || currentMessageList;
  if (!messageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = messageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const messageIdsToDelete = messageIds.filter(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, id);
    return message && !(0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isMessageLocal)(message);
  });

  // Only local messages
  if (!messageIdsToDelete.length && messageIds.length) {
    (0,_apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_22__.deleteMessages)(global, (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isChatChannel)(chat) || (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isChatSuperGroup)(chat) ? chatId : undefined, messageIds, actions);
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('deleteMessages', {
    chat,
    messageIds: messageIdsToDelete,
    shouldDeleteForAll
  });
  const editingId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectEditingId)(global, chatId, threadId);
  if (editingId && messageIds.includes(editingId)) {
    actions.setEditingId({
      messageId: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('resetLocalPaidMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const notifications = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).notifications;
  if (!notifications || !notifications.length) return global;
  notifications.forEach(notification => {
    if (notification.type === 'paidMessage') {
      const action = notification.dismissAction;
      if (action && !Array.isArray(action)) {
        // @ts-ignore
        actions[action.action](action.payload);
      }
      actions.dismissNotification({
        localId: notification.localId,
        tabId
      });
    }
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('deleteParticipantHistory', (global, actions, payload) => {
  const {
    chatId,
    peerId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeer)(global, peerId);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('deleteParticipantHistory', {
    chat,
    peer
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('deleteScheduledMessages', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('deleteScheduledMessages', {
    chat,
    messageIds
  });
  const editingId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectEditingScheduledId)(global, chatId);
  if (editingId && messageIds.includes(editingId)) {
    actions.setEditingId({
      messageId: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('deleteHistory', async (global, actions, payload) => {
  const {
    chatId,
    shouldDeleteForAll,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('deleteHistory', {
    chat,
    shouldDeleteForAll
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const activeChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (activeChat && activeChat.chatId === chatId) {
    actions.openChat({
      id: undefined,
      tabId
    });
  }

  // Delete chat from folders
  const folders = global.chatFolders.byId;
  Object.values(folders).forEach(folder => {
    if (folder.includedChatIds.includes(chatId) || folder.pinnedChatIds?.includes(chatId)) {
      const newIncludedChatIds = folder.includedChatIds.filter(id => id !== chatId);
      const newPinnedChatIds = folder.pinnedChatIds?.filter(id => id !== chatId);
      const updatedFolder = {
        ...folder,
        includedChatIds: newIncludedChatIds,
        pinnedChatIds: newPinnedChatIds
      };
      (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('editChatFolder', {
        id: folder.id,
        folderUpdate: updatedFolder
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('deleteSavedHistory', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('deleteSavedHistory', {
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const activeChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (activeChat && activeChat.threadId === chatId) {
    actions.openChat({
      id: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('reportMessages', async (global, actions, payload) => {
  const {
    messageIds,
    description = '',
    option = '',
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const response = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('reportMessages', {
    peer: chat,
    messageIds,
    description,
    option
  });
  if (!response) return;
  const {
    result,
    error
  } = response;
  if (error === _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_ID_REQUIRED_ERROR) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('lng_report_please_select_messages'),
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (!result) return;
  if (result.type === 'reported') {
    actions.showNotification({
      message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      reportModal: {
        chatId,
        messageIds,
        description,
        subject: 'message',
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  }
  if (result.type === 'comment') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      isOptional: result.isOptional,
      option: result.option,
      title: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      reportModal: {
        chatId,
        messageIds,
        description,
        subject: 'message',
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendMessageAction', async (global, actions, payload) => {
  const {
    action,
    chatId,
    threadId
  } = payload;
  if (global.connectionState !== 'connectionStateReady') return;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsChatWithSelf)(global, chatId)) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat || chat.isMonoforum) return;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, chatId);
  if (user && ((0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isUserBot)(user) || (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isDeletedUser)(user))) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendMessageAction', {
    peer: chat,
    threadId,
    action
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('reportChannelSpam', (global, actions, payload) => {
  const {
    participantId,
    chatId,
    messageIds
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeer)(global, participantId);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!peer || !chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('reportChannelSpam', {
    peer,
    chat,
    messageIds
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('markMessageListRead', (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserFrozen)(global)) return undefined;
  const {
    maxId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat || (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    return undefined;
  }
  runDebouncedForMarkRead(() => {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('markMessageListRead', {
      chat,
      threadId,
      maxId
    });
  });
  if (chatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID) {
    global = {
      ...global,
      serviceNotifications: global.serviceNotifications.map(notification => {
        return notification.isUnread && notification.id <= maxId ? {
          ...notification,
          isUnread: false
        } : notification;
      })
    };
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectViewportIds)(global, chatId, threadId, tabId);
  const minId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectFirstUnreadId)(global, chatId, threadId);
  const topic = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTopic)(global, chatId, threadId);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && !chat.isForum) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateThreadInfo)(global, chatId, threadId, {
      lastReadInboxMessageId: maxId
    });
    return global;
  }
  if (!viewportIds || !minId || !chat.unreadCount && !topic?.unreadCount) {
    return global;
  }
  const readCount = countSortedIds(viewportIds, minId, maxId);
  if (!readCount) {
    return global;
  }
  if (chat.isForum && topic) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateThreadInfo)(global, chatId, threadId, {
      lastReadInboxMessageId: maxId
    });
    const newTopicUnreadCount = Math.max(0, topic.unreadCount - readCount);
    if (newTopicUnreadCount === 0 && !chat.isBotForum && chat.unreadCount) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
        unreadCount: Math.max(0, chat.unreadCount - 1)
      });
    }
    return (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateTopic)(global, chatId, Number(threadId), {
      unreadCount: newTopicUnreadCount
    });
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
    lastReadInboxMessageId: maxId,
    unreadCount: Math.max(0, (chat.unreadCount || 0) - readCount)
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('markMessagesRead', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)(),
    shouldFetchUnreadReactions
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('markMessagesRead', {
    chat,
    messageIds
  }).then(() => {
    if (shouldFetchUnreadReactions) {
      actions.fetchUnreadReactions({
        chatId: chat.id
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadWebPagePreview', async (global, actions, payload) => {
  const {
    text,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const webPagePreview = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchWebPagePreview', {
    text
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    webPagePreviewId: webPagePreview?.id
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  if (!webPagePreview) return;
  actions.apiUpdate({
    '@type': 'updateWebPage',
    webPage: webPagePreview
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('clearWebPagePreview', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    webPagePreviewId: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendPollVote', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    options
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendPollVote', {
      chat,
      messageId,
      options
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('toggleTodoCompleted', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    completedIds,
    incompletedIds
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  const currentUserId = global.currentUserId;
  const currentTodo = message?.content.todo;
  if (!currentTodo || !currentUserId || !chat) {
    return;
  }
  const currentCompletions = currentTodo.completions || [];
  const currentCompletionIds = currentCompletions.map(c => c.itemId);
  const newCompletions = [...currentCompletions];
  const now = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_14__.getServerTime)();
  completedIds.forEach(itemId => {
    if (!currentCompletionIds.includes(itemId)) {
      newCompletions.push({
        itemId,
        completedBy: currentUserId,
        completedAt: now
      });
    }
  });
  const finalCompletions = newCompletions.filter(c => !incompletedIds.includes(c.itemId));
  const newContent = {
    ...message.content,
    todo: {
      ...currentTodo,
      completions: finalCompletions
    }
  };
  const messageUpdate = {
    ...message,
    content: newContent
  };
  global = (0,_apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_22__.updateWithLocalMedia)(global, chatId, message.id, false, messageUpdate);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('toggleTodoCompleted', {
    chat,
    messageId: message.id,
    completedIds,
    incompletedIds
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('appendTodoList', (global, actions, payload) => {
  const {
    chatId,
    items,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('appendTodoList', {
    chat,
    message,
    items
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('cancelPollVote', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendPollVote', {
      chat,
      messageId,
      options: []
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('closePoll', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  const poll = message && (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPollFromMessage)(global, message);
  if (chat && poll) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('closePoll', {
      chat,
      messageId,
      poll
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadPollOptionResults', async (global, actions, payload) => {
  const {
    chat,
    messageId,
    option,
    offset,
    limit,
    shouldResetVoters,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('loadPollOptionResults', {
    chat,
    messageId,
    option,
    offset,
    limit
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
  const {
    pollResults
  } = tabState;
  const {
    voters
  } = tabState.pollResults;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    pollResults: {
      ...pollResults,
      voters: {
        ...voters,
        [option]: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.unique)([...(!shouldResetVoters && voters?.[option] ? voters[option] : []), ...result.votes.map(vote => vote.peerId)])
      },
      offsets: {
        ...(pollResults.offsets ? pollResults.offsets : {}),
        [option]: result.nextOffset || ''
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadExtendedMedia', (global, actions, payload) => {
  const {
    chatId,
    ids
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchExtendedMedia', {
      chat,
      ids
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadScheduledHistory', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserFrozen)(global)) return;
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchScheduledHistory', {
    chat
  });
  if (!result) {
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number).sort((a, b) => b - a);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateScheduledMessages)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceThreadParam)(global, chat.id, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', ids);
  if (!ids.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updatePeerFullInfo)(global, chat.id, {
      hasScheduledMessages: false
    });
  }
  if (chat?.isForum) {
    const scheduledPerThread = {};
    messages.forEach(message => {
      const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectThreadIdFromMessage)(global, message);
      const scheduledInThread = scheduledPerThread[threadId] || [];
      scheduledInThread.push(message.id);
      scheduledPerThread[threadId] = scheduledInThread;
    });
    Object.entries(scheduledPerThread).forEach(([threadId, scheduledIds]) => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceThreadParam)(global, chat.id, Number(threadId), 'scheduledIds', scheduledIds);
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendScheduledMessages', (global, actions, payload) => {
  const {
    chatId,
    id
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendScheduledMessages', {
    chat,
    ids: [id]
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('rescheduleMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    scheduledAt,
    scheduleRepeatPeriod
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = chat && (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectScheduledMessage)(global, chat.id, messageId);
  if (!chat || !message) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('rescheduleMessage', {
    chat,
    message,
    scheduledAt,
    scheduleRepeatPeriod
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('transcribeAudio', async (global, actions, payload) => {
  const {
    messageId,
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: ''
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('transcribeAudio', {
    chat,
    messageId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: result,
    isTranscriptionError: !result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadCustomEmojis', async (global, actions, payload) => {
  const {
    ids,
    ignoreCache
  } = payload;
  const newCustomEmojiIds = ignoreCache ? ids : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.unique)(ids.filter(documentId => !(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCustomEmoji)(global, documentId)));
  const customEmoji = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchCustomEmoji', {
    documentId: newCustomEmojiIds
  });
  if (!customEmoji) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      byId: {
        ...global.customEmojis.byId,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(customEmoji, 'id')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('forwardMessages', (global, actions, payload) => {
  const {
    isSilent,
    scheduledAt,
    scheduleRepeatPeriod,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const {
    toChatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).forwardMessages;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, toChatId) : undefined;
  if (!toChat) return;
  executeForwardMessages(global, {
    chat: toChat,
    isSilent,
    scheduledAt,
    scheduleRepeatPeriod
  }, tabId);
});
async function executeForwardMessages(global, sendParams, tabId) {
  const {
    fromChatId,
    messageIds,
    toChatId,
    withMyScore,
    noAuthors,
    noCaptions,
    toThreadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).forwardMessages;
  const {
    messagePriceInStars,
    isSilent,
    scheduledAt,
    scheduleRepeatPeriod,
    effectId,
    attachments
  } = sendParams;
  const isForwardOnly = !sendParams.text && !attachments?.length;
  const forwardEffectId = isForwardOnly ? effectId : undefined;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserPremium)(global);
  const isToMainThread = toThreadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const fromChat = fromChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, fromChatId) : undefined;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, toChatId) : undefined;
  const messages = fromChatId && messageIds ? messageIds.sort((a, b) => a - b).map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, fromChatId, id)).filter(Boolean) : undefined;
  if (!fromChat || !toChat || !messages || toThreadId && !isToMainThread && !toChat.isForum) {
    return undefined;
  }
  const sendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, toChatId);
  const draft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, toChatId, toThreadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatLastMessageId)(global, toChat.id);
  const localMessages = [];
  const [realMessages, serviceMessages] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.partition)(messages, m => !(0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isServiceNotificationMessage)(m));
  const forwardableRealMessages = realMessages.filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCanForwardMessage)(global, message));
  if (forwardableRealMessages.length) {
    const messageSlices = global.config?.maxForwardedCount ? (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.splitMessagesForForwarding)(forwardableRealMessages, global.config.maxForwardedCount) : [forwardableRealMessages];
    for (const slice of messageSlices) {
      const forwardParams = {
        fromChat,
        toChat,
        toThreadId,
        messages: slice,
        isSilent,
        scheduledAt,
        scheduleRepeatPeriod,
        sendAs,
        withMyScore,
        noAuthors,
        noCaptions,
        isCurrentUserPremium,
        wasDrafted: Boolean(draft),
        lastMessageId,
        messagePriceInStars,
        effectId: forwardEffectId
      };
      if (!messagePriceInStars) {
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('forwardMessages', forwardParams);
      } else {
        const forwardedLocalMessagesSlice = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('forwardMessagesLocal', forwardParams);
        localMessages.push({
          ...sendParams,
          forwardParams: {
            ...forwardParams,
            forwardedLocalMessagesSlice
          },
          forwardedLocalMessagesSlice
        });
      }
    }
  }
  for (const message of serviceMessages) {
    const {
      text,
      entities
    } = message.content.text || {};
    const {
      sticker
    } = message.content;
    const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectMessageReplyInfo)(global, toChat.id, toThreadId);
    const params = {
      chat: toChat,
      replyInfo,
      text,
      entities,
      sticker,
      isSilent,
      scheduledAt,
      scheduleRepeatPeriod,
      sendAs,
      lastMessageId
    };
    await sendMessageOrReduceLocal(global, params, localMessages);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    forwardMessages: {},
    isShareMessageModalShown: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  return localMessages;
}
async function loadViewportMessages(global, chat, threadId, offsetId, direction, isOutlying = false, isBudgetPreload = false, onLoaded, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()]) {
  const chatId = chat.id;
  let addOffset;
  let sliceSize = _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
  switch (direction) {
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards:
      if (offsetId) {
        addOffset = -1;
        sliceSize += 1;
      } else {
        addOffset = undefined;
      }
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around:
      addOffset = -(Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) + 1);
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards:
      addOffset = -(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE + 1);
      if (offsetId) {
        sliceSize += 1;
      }
      break;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchMessages', {
    chat: (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, realChatId),
    offsetId,
    addOffset,
    limit: sliceSize,
    threadId,
    isSavedDialog
  });
  if (!result) {
    return;
  }
  const {
    messages,
    count
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const localTypingDrafts = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId');
  const typingDraftMessages = localTypingDrafts ? Object.values(localTypingDrafts).map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, id)).filter(Boolean) : [];
  const localMessages = chatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID ? global.serviceNotifications.filter(({
    isDeleted
  }) => !isDeleted).map(({
    message
  }) => message) : typingDraftMessages;
  const allMessages = [].concat(messages, localMessages);
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(allMessages, 'id');
  const ids = Object.keys(byId).map(Number);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && !(0,_helpers__WEBPACK_IMPORTED_MODULE_16__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    const threadFirstMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectFirstMessageId)(global, chatId, threadId);
    if ((!ids[0] || threadFirstMessageId === ids[0]) && threadFirstMessageId !== threadId) {
      ids.unshift(Number(threadId));
    }
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.addChatMessagesById)(global, chatId, byId);
  global = isOutlying ? (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateOutlyingLists)(global, chatId, threadId, ids) : (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateListedIds)(global, chatId, threadId, ids);
  let listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectListedIds)(global, chatId, threadId);
  const outlyingList = offsetId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : undefined;
  if (isOutlying && listedIds && outlyingList) {
    if (!outlyingList.length || (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.areSortedArraysIntersecting)(listedIds, outlyingList)) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateListedIds)(global, chatId, threadId, outlyingList);
      listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectListedIds)(global, chatId, threadId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.removeOutlyingList)(global, chatId, threadId, outlyingList);
      isOutlying = false;
    }
  }
  if (!isBudgetPreload) {
    const historyIds = isOutlying && outlyingList ? outlyingList : listedIds;
    if (historyIds) {
      const {
        newViewportIds
      } = getViewportSlice(historyIds, offsetId, direction);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
  }
  if (count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateThreadInfo)(global, chat.id, threadId, {
      messagesCount: count
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  onLoaded?.();
}
async function loadMessage(global, chat, messageId, replyOriginForId) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchMessage', {
    chat,
    messageId
  });
  if (!result) {
    return undefined;
  }
  if (result === _api_types__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_DELETED) {
    if (replyOriginForId) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
      const replyMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chat.id, replyOriginForId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chat.id, replyOriginForId, {
        ...replyMessage,
        replyInfo: undefined
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    }
    return undefined;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chat.id, messageId, result.message);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  return result.message;
}
function findClosestIndex(sourceIds, offsetId) {
  if (offsetId < sourceIds[0]) {
    return 0;
  }
  if (offsetId > sourceIds[sourceIds.length - 1]) {
    return sourceIds.length - 1;
  }
  return sourceIds.findIndex((id, i) => id === offsetId || id < offsetId && sourceIds[i + 1] > offsetId);
}
function getViewportSlice(sourceIds, offsetId, direction) {
  const {
    length
  } = sourceIds;
  const index = offsetId ? findClosestIndex(sourceIds, offsetId) : -1;
  const isBackwards = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards;
  const isAround = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  const indexForDirection = isBackwards ? index : index + 1 || length;
  const sliceSize = isAround ? Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) : _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
  const from = indexForDirection - sliceSize;
  const to = indexForDirection + sliceSize - 1;
  const newViewportIds = sourceIds.slice(Math.max(0, from), to + 1);
  let areSomeLocal;
  let areAllLocal;
  switch (direction) {
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards:
      areSomeLocal = indexForDirection >= 0;
      areAllLocal = from >= 0;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards:
      areSomeLocal = indexForDirection < length;
      areAllLocal = to <= length - 1;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around:
    default:
      areSomeLocal = newViewportIds.length > 0;
      areAllLocal = newViewportIds.length === _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
      break;
  }
  return {
    newViewportIds,
    areSomeLocal,
    areAllLocal
  };
}
async function getPeerStarsForMessage(global, peerId) {
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeer)(global, peerId);
  if (!peer) return undefined;
  if ((0,_helpers_peers__WEBPACK_IMPORTED_MODULE_17__.isApiPeerChat)(peer)) {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsMonoforumAdmin)(global, peerId)) {
      return undefined;
    }
    return peer.paidMessagesStars;
  }
  if (!peer?.paidMessagesStars) return undefined;
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUserFullInfo)(global, peer.id);
  if (fullInfo) {
    return fullInfo.paidMessagesStars;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchPaidMessagesStarsAmount', peer);
  return result;
}
async function sendMessageOrReduceLocal(global, sendParams, localMessages) {
  if (!sendParams.messagePriceInStars) {
    sendMessage(global, sendParams);
  } else {
    const message = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendMessageLocal', sendParams);
    if (message) {
      localMessages.push({
        ...sendParams,
        localMessage: message
      });
    }
  }
}
async function sendMessage(global, params) {
  // @optimization
  if (params.replyInfo || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_IOS) {
    await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_13__.rafPromise)();
  }
  let currentMessageKey;
  const progressCallback = params.attachment ? (progress, messageKey) => {
    if (!uploadProgressCallbacks.has(messageKey)) {
      currentMessageKey = messageKey;
      uploadProgressCallbacks.set(messageKey, progressCallback);
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateUploadByMessageKey)(global, messageKey, progress);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  } : undefined;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendMessage', params, progressCallback);
  if (progressCallback && currentMessageKey) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateUploadByMessageKey)(global, currentMessageKey, undefined);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    uploadProgressCallbacks.delete(currentMessageKey);
  }
}
async function sendMessagesWithNotification(global, sendParams) {
  const chat = sendParams[0]?.chat;
  if (!chat || !sendParams.length) return;
  const starsForOneMessage = await getPeerStarsForMessage(global, chat.id);
  if (!starsForOneMessage) {
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.getActions)().sendMessages({
      sendParams
    });
    return;
  }
  const messageIdsForUndo = sendParams.reduce((ids, params) => {
    if (params.localMessage?.id) {
      ids.push(params.localMessage.id);
    } else if (params.forwardedLocalMessagesSlice?.localMessages) {
      const forwardedIds = Object.values(params.forwardedLocalMessagesSlice.localMessages).map(forwardedMessage => forwardedMessage.id).filter(Boolean);
      ids.push(...forwardedIds);
    }
    return ids;
  }, []);
  const localForwards = sendParams[0]?.forwardedLocalMessagesSlice?.localMessages;
  const firstMessage = sendParams[0]?.localMessage || localForwards && Object.values(localForwards)[0];
  if (!firstMessage) return;
  const messagesCount = messageIdsForUndo.length;
  const firstSendParam = sendParams[0];
  let storySendMessage;
  if (sendParams.length === 1 && firstSendParam.isStoryReply) {
    const {
      gif,
      sticker,
      isReaction
    } = firstSendParam;
    if (gif) {
      storySendMessage = {
        key: 'MessageSentPaidToastTitle',
        variables: {
          count: 1
        },
        options: {
          pluralValue: 1
        }
      };
    } else if (sticker) {
      storySendMessage = {
        key: 'StoryTooltipStickerSent'
      };
    } else if (isReaction) {
      storySendMessage = {
        key: 'StoryTooltipReactionSent'
      };
    }
  }
  const titleKey = storySendMessage || {
    key: 'MessageSentPaidToastTitle',
    variables: {
      count: messagesCount
    },
    options: {
      pluralValue: messagesCount
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.getActions)().sendMessages({
    sendParams
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.getActions)().showNotification({
    localId: (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__.getMessageKey)(firstMessage),
    title: titleKey,
    message: {
      key: 'MessageSentPaidToastText',
      variables: {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)((0,_util_localization__WEBPACK_IMPORTED_MODULE_10__.getTranslationFn)(), starsForOneMessage * messagesCount)
      }
    },
    icon: 'star',
    shouldUseCustomIcon: true,
    type: 'paidMessage'
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendMessages', async (global, actions, payload) => {
  const {
    sendParams
  } = payload;
  await Promise.all(sendParams.map(async params => {
    if (params.forwardedLocalMessagesSlice && params.forwardParams) {
      await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_13__.rafPromise)();
      await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('forwardApiMessages', params.forwardParams);
    } else {
      await sendMessage(global, params);
    }
  }));
  if (sendParams.length > 0 && sendParams[0].messagePriceInStars) actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadPinnedMessages', async (global, actions, payload) => {
  const {
    chatId,
    threadId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat || (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchPinnedMessages', {
    chat,
    threadId
  });
  if (!result) {
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number).sort((a, b) => b - a);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.safeReplacePinnedIds)(global, chat.id, threadId, ids);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadSeenBy', async (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchSeenBy', {
    chat,
    messageId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, messageId, {
    seenByDates: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('saveDefaultSendAs', (global, actions, payload) => {
  const {
    chatId,
    sendAsId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const sendAsChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, sendAsId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, sendAsId);
  if (!chat || !sendAsChat) {
    return undefined;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('saveDefaultSendAs', {
    sendAs: sendAsChat,
    chat
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatFullInfo)(global, chatId, {
    sendAsId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadSendAs', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchSendAs', {
    chat
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
      sendAsPeerIds: []
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
    sendAsPeerIds: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadSendPaidReactionsAs', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchSendAs', {
    chat,
    isForPaidReactions: true
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
      sendPaidReactionsAsPeerIds: []
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chatId, {
    sendPaidReactionsAsPeerIds: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadSponsoredMessages', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  if ((0,_helpers_peers__WEBPACK_IMPORTED_MODULE_17__.isApiPeerUser)(peer) && (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsChatBotNotStarted)(global, peer.id)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchSponsoredMessages', {
    peer
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateSponsoredMessage)(global, peerId, result.messages[0]);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('viewSponsored', (global, actions, payload) => {
  const {
    randomId
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('viewSponsoredMessage', {
    random: randomId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('clickSponsored', (global, actions, payload) => {
  const {
    randomId,
    isMedia,
    isFullscreen
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('clickSponsoredMessage', {
    random: randomId,
    isMedia,
    isFullscreen
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('reportSponsored', async (global, actions, payload) => {
  const {
    peerId,
    randomId,
    option = '',
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('reportSponsoredMessage', {
    randomId,
    option
  });
  if (!result) return;
  if (result.type === 'premiumRequired') {
    actions.openPremiumModal({
      initialSection: 'no_ads',
      tabId
    });
    actions.closeReportAdModal({
      tabId
    });
    return;
  }
  if (result.type === 'reported' || result.type === 'hidden') {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)(result.type === 'reported' ? 'AdReported' : 'AdHidden'),
      tabId
    });
    actions.closeReportAdModal({
      tabId
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    if (peerId) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.deleteSponsoredMessage)(global, peerId);
    } else {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateGlobalSearch)(global, {
        sponsoredPeer: undefined
      }, tabId);
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).reportAdModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      reportAdModal: {
        chatId: peerId,
        randomId,
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('hideSponsored', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserPremium)(global);
  if (!isCurrentUserPremium) {
    actions.openPremiumModal({
      initialSection: 'no_ads',
      tabId
    });
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('toggleSponsoredMessages', {
    enabled: false
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateUserFullInfo)(global, global.currentUserId, {
    areAdsEnabled: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('AdHidden'),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('fetchUnreadMentions', async (global, actions, payload) => {
  const {
    chatId,
    offsetId
  } = payload;
  await fetchUnreadMentions(global, chatId, offsetId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('approveSuggestedPost', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    scheduleDate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  const isAdmin = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsMonoforumAdmin)(global, chatId);
  if (!isAdmin && message?.suggestedPostInfo?.price?.amount) {
    const neededAmount = message.suggestedPostInfo.price.amount;
    const isCurrencyStars = message.suggestedPostInfo.price.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE;
    if (isCurrencyStars) {
      const currentBalance = global.stars?.balance?.amount || 0;
      if (neededAmount > currentBalance) {
        actions.openStarsBalanceModal({
          topup: {
            balanceNeeded: neededAmount
          },
          tabId
        });
        return;
      }
    } else {
      const currentTonBalance = global.ton?.balance?.amount || 0;
      if (neededAmount > currentTonBalance) {
        actions.openStarsBalanceModal({
          currency: _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE,
          tabId
        });
        return;
      }
    }
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('toggleSuggestedPostApproval', {
    chat,
    messageId,
    reject: false,
    scheduleDate
  });
  if (!result) return;
  actions.showNotification({
    message: {
      key: 'SuggestedPostApproved'
    },
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('rejectSuggestedPost', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    rejectComment,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('toggleSuggestedPostApproval', {
    chat,
    messageId,
    reject: true,
    rejectComment
  });
  if (!result) return;
  actions.showNotification({
    message: {
      key: 'SuggestedPostRejectedNotification'
    },
    tabId
  });
});
async function fetchUnreadMentions(global, chatId, offsetId) {
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchUnreadMentions', {
    chat,
    offsetId
  });
  if (!result) return;
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.addUnreadMentions)(global, chatId, chat, ids);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('markMentionsRead', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.removeUnreadMentions)(global, chatId, chat, messageIds, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  actions.markMessagesRead({
    messageIds,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('focusNextMention', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  let chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  if (!chat) return;
  if (!chat.unreadMentions) {
    await fetchUnreadMentions(global, chat.id);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
    const previousChatId = chat.id;
    chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
    if (!chat?.unreadMentions || previousChatId !== chat.id) return;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId: chat.unreadMentions[0],
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('readAllMentions', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return undefined;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('readAllMentions', {
    chat,
    threadId: threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? undefined : threadId
  });
  if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
    return (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChat)(global, chat.id, {
      unreadMentionsCount: undefined,
      unreadMentions: undefined
    });
  }

  // TODO[Forums]: Support mentions in threads
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('openUrl', (global, actions, payload) => {
  const {
    url,
    shouldSkipModal,
    ignoreDeepLinks,
    linkContext,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const urlWithProtocol = (0,_util_browser_url__WEBPACK_IMPORTED_MODULE_3__.ensureProtocol)(url);
  const parsedUrl = new URL(urlWithProtocol);
  const isMixedScript = (0,_util_browser_url__WEBPACK_IMPORTED_MODULE_3__.isMixedScriptUrl)(urlWithProtocol);
  if (!ignoreDeepLinks && (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_6__.isDeepLink)(urlWithProtocol)) {
    actions.closeStoryViewer({
      tabId
    });
    actions.closePaymentModal({
      tabId
    });
    actions.openTelegramLink({
      url,
      linkContext,
      tabId
    });
    return;
  }
  const {
    appConfig,
    config
  } = global;
  if (config?.autologinToken && appConfig.autologinDomains.includes(parsedUrl.hostname)) {
    parsedUrl.searchParams.set(AUTOLOGIN_TOKEN_KEY, config.autologinToken);
    window.open(parsedUrl.href, '_blank', 'noopener');
    return;
  }
  if (appConfig.urlAuthDomains.includes(parsedUrl.hostname)) {
    actions.closeStoryViewer({
      tabId
    });
    actions.requestLinkUrlAuth({
      url,
      tabId
    });
    return;
  }
  const isWhitelisted = appConfig.whitelistedDomains.includes(parsedUrl.hostname);
  const shouldDisplayModal = !urlWithProtocol.match(_config__WEBPACK_IMPORTED_MODULE_2__.RE_TELEGRAM_LINK) && !shouldSkipModal && !isWhitelisted;
  if (shouldDisplayModal) {
    actions.toggleSafeLinkModal({
      url: isMixedScript ? parsedUrl.toString() : urlWithProtocol,
      tabId
    });
  } else {
    window.open(parsedUrl, '_blank', 'noopener');
  }
});
async function checkIfVoiceMessagesAllowed(global, user, chatId) {
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUserFullInfo)(global, chatId);
  if (!fullInfo) {
    const {
      accessHash
    } = user;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchFullUser', {
      id: chatId,
      accessHash
    });
    fullInfo = result?.fullInfo;
  }
  return Boolean(!fullInfo?.noVoiceMessages);
}
function moveReplyToNewDraft(global, threadId, replyInfo, toChatId) {
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, toChatId, threadId);
  if (!replyInfo.replyToMsgId) return;
  const newDraft = {
    ...currentDraft,
    replyInfo
  };
  saveDraft({
    global,
    chatId: toChatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('openChatOrTopicWithReplyInDraft', (global, actions, payload) => {
  const {
    chatId: toChatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
  const replyingInfo = tabState.replyingMessage;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    isShareMessageModalShown: false,
    replyingMessage: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  const currentThreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId)?.threadId;
  if (!currentChat || !currentThreadId) return;
  const threadId = topicId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const currentChatId = currentChat.id;
  const newReplyInfo = {
    type: 'message',
    replyToMsgId: replyingInfo.messageId,
    replyToTopId: replyingInfo.toThreadId,
    replyToPeerId: currentChatId,
    monoforumPeerId: replyingInfo.toThreadId,
    quoteText: replyingInfo.quoteText,
    quoteOffset: replyingInfo.quoteOffset
  };
  const currentReplyInfo = replyingInfo.messageId ? newReplyInfo : (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, currentChatId, currentThreadId)?.replyInfo;
  if (!currentReplyInfo) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectReplyCanBeSentToChat)(global, toChatId, currentChatId, currentReplyInfo)) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('Chat.SendNotAllowedText'),
      tabId
    });
    return;
  }
  if (!currentReplyInfo.replyToPeerId && toChatId === currentChat.id) return;
  const getPeerId = () => {
    if (!currentReplyInfo?.replyToPeerId) return currentChatId;
    return currentReplyInfo.replyToPeerId === toChatId ? undefined : currentReplyInfo.replyToPeerId;
  };
  const replyToPeerId = getPeerId();
  const newReply = {
    ...currentReplyInfo,
    replyToPeerId,
    type: 'message'
  };
  moveReplyToNewDraft(global, threadId, newReply, toChatId);
  actions.openThread({
    chatId: toChatId,
    threadId,
    tabId
  });
  actions.closeMediaViewer({
    tabId
  });
  actions.exitMessageSelectMode({
    tabId
  });
  actions.clearDraft({
    chatId: currentChatId,
    threadId: currentThreadId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('setForwardChatOrTopic', async (global, actions, payload) => {
  const {
    chatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, chatId);
  const isSelectForwardsContainVoiceMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectForwardsContainVoiceMessages)(global, tabId);
  if (isSelectForwardsContainVoiceMessages && user && !(await checkIfVoiceMessagesAllowed(global, user, chatId))) {
    actions.showDialog({
      data: {
        message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('VoiceMessagesRestrictedByPrivacy', (0,_helpers__WEBPACK_IMPORTED_MODULE_16__.getUserFullName)(user))
      },
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectForwardsCanBeSentToChat)(global, chatId, tabId)) {
    actions.showAllowedMessageTypesNotification({
      chatId,
      tabId
    });
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).forwardMessages,
      toChatId: chatId,
      toThreadId: topicId
    },
    isShareMessageModalShown: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  actions.openThread({
    chatId,
    threadId: topicId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    tabId
  });
  actions.closeMediaViewer({
    tabId
  });
  actions.exitMessageSelectMode({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('forwardToSavedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).forwardMessages,
      toChatId: global.currentUserId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
  actions.exitMessageSelectMode({
    tabId
  });
  actions.forwardMessages({
    isSilent: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('forwardStory', (global, actions, payload) => {
  const {
    toChatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const {
    fromChatId,
    storyId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).forwardMessages;
  const fromChat = fromChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, fromChatId) : undefined;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, toChatId) : undefined;
  const story = fromChatId && storyId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeerStory)(global, fromChatId, storyId) : undefined;
  if (!fromChat || !toChat || !story || 'isDeleted' in story) {
    return;
  }
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatLastMessageId)(global, toChatId);
  const {
    text,
    entities
  } = story.content.text || {};
  void sendMessage(global, {
    chat: toChat,
    text,
    entities,
    story,
    lastMessageId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    forwardMessages: {},
    isShareMessageModalShown: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('requestMessageTranslation', (global, actions, payload) => {
  const {
    chatId,
    id,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTranslationLanguage)(global),
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateRequestedMessageTranslation)(global, chatId, id, toLanguageCode, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceSettings)(global, {
    translationLanguage: toLanguageCode
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('showOriginalMessage', (global, actions, payload) => {
  const {
    chatId,
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.removeRequestedMessageTranslation)(global, chatId, id, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('markMessagesTranslationPending', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectLanguageCode)(global)
  } = payload;
  messageIds.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateMessageTranslation)(global, chatId, id, toLanguageCode, {
      isPending: true
    });
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('translateMessages', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectLanguageCode)(global)
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return undefined;
  actions.markMessagesTranslationPending({
    chatId,
    messageIds,
    toLanguageCode
  });
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('translateText', {
    chat,
    messageIds,
    toLanguageCode
  });
  return global;
});

// https://github.com/telegramdesktop/tdesktop/blob/11906297d82b6ff57b277da5251d2e6eb3d8b6d0/Telegram/SourceFiles/api/api_views.cpp#L22
const SEND_VIEWS_TIMEOUT = 1000;
let viewsIncrementTimeout;
let idsToIncrementViews = {};
function incrementViews() {
  if (viewsIncrementTimeout) {
    clearTimeout(viewsIncrementTimeout);
    viewsIncrementTimeout = undefined;
  }
  const {
    loadMessageViews
  } = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getActions)();
  Object.entries(idsToIncrementViews).forEach(([chatId, ids]) => {
    loadMessageViews({
      chatId,
      ids: Array.from(ids),
      shouldIncrement: true
    });
  });
  idsToIncrementViews = {};
}
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('scheduleForViewsIncrement', (global, actions, payload) => {
  const {
    ids,
    chatId
  } = payload;
  if (!viewsIncrementTimeout) {
    setTimeout(incrementViews, SEND_VIEWS_TIMEOUT);
  }
  if (!idsToIncrementViews[chatId]) {
    idsToIncrementViews[chatId] = new Set();
  }
  ids.forEach(id => {
    idsToIncrementViews[chatId].add(id);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadMessageViews', async (global, actions, payload) => {
  const {
    chatId,
    ids,
    shouldIncrement
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserFrozen)(global)) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchMessageViews', {
    chat,
    ids,
    shouldIncrement
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  result.viewsInfo.forEach(update => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, update.id, {
      viewsCount: update.views,
      forwardsCount: update.forwards
    }, true);
    if (update.threadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateThreadInfo)(global, chatId, update.id, update.threadInfo);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadFactChecks', async (global, actions, payload) => {
  const {
    chatId,
    ids
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchFactChecks', {
    chat,
    ids
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  result.forEach((factCheck, i) => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, ids[i], {
      factCheck
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadPaidReactionPrivacy', () => {
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchPaidReactionPrivacy');
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadOutboxReadDate', async (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return;
  try {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchOutboxReadDate', {
      chat,
      messageId
    });
    if (result?.date) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, messageId, {
        readDate: result.date
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    }
  } catch (error) {
    const {
      message
    } = error;
    if (message === 'USER_PRIVACY_RESTRICTED' || message === 'YOUR_PRIVACY_RESTRICTED') {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
      const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, chatId);
      if (!user) return;
      const userStatus = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUserStatus)(global, chatId);
      if (!userStatus) return;
      const updateStatus = message === 'USER_PRIVACY_RESTRICTED' ? {
        isReadDateRestricted: true
      } : {
        isReadDateRestrictedByMe: true
      };
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.replaceUserStatuses)(global, {
        [chatId]: {
          ...userStatus,
          ...updateStatus
        }
      });
      // Need to reset `readDate` to `undefined` after click on "Show my Read Time" button
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateChatMessage)(global, chatId, messageId, {
        readDate: undefined
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('loadQuickReplies', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchQuickReplies');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateQuickReplyMessages)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(result.messages, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_19__.updateQuickReplies)(global, result.quickReplies);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('sendQuickReply', (global, actions, payload) => {
  const {
    chatId,
    quickReplyId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) return global;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('sendQuickReply', {
    chat,
    shortcutId: quickReplyId
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('copyMessageLink', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    shouldIncludeThread,
    shouldIncludeGrouped,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('ErrorOccurred'),
      tabId
    });
    return;
  }
  const showErrorOccurredNotification = () => actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('ErrorOccurred'),
    tabId
  });
  if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isChatChannel)(chat) && !(0,_helpers__WEBPACK_IMPORTED_MODULE_16__.isChatSuperGroup)(chat)) {
    showErrorOccurredNotification();
    return;
  }
  const showLinkCopiedNotification = () => actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_12__.oldTranslate)('LinkCopied'),
    tabId
  });
  const callApiExportMessageLinkPromise = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('exportMessageLink', {
    chat,
    id: messageId,
    shouldIncludeThread,
    shouldIncludeGrouped
  });
  await (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_5__.copyTextToClipboardFromPromise)(callApiExportMessageLinkPromise, showLinkCopiedNotification, showErrorOccurredNotification);
});
const MESSAGES_TO_REPORT_DELIVERY = new Map();
let reportDeliveryTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('reportMessageDelivery', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const currentIds = MESSAGES_TO_REPORT_DELIVERY.get(chatId) || [];
  currentIds.push(messageId);
  MESSAGES_TO_REPORT_DELIVERY.set(chatId, currentIds);
  if (!reportDeliveryTimeout) {
    // Slightly unsafe in the multitab environment, but there is no better way to do it now.
    // Not critical if user manages to close the tab in a show window before the report is sent.
    reportDeliveryTimeout = window.setTimeout(() => {
      reportDeliveryTimeout = undefined;
      MESSAGES_TO_REPORT_DELIVERY.forEach((messageIds, cId) => {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, cId);
        if (!chat) return;
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('reportMessagesDelivery', {
          chat,
          messageIds
        });
      });
      MESSAGES_TO_REPORT_DELIVERY.clear();
    }, 500);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('openPreparedInlineMessageModal', async (global, actions, payload) => {
  const {
    botId,
    messageId,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_15__.callApi)('fetchPreparedInlineMessage', {
    bot,
    id: messageId
  });
  if (!result) {
    actions.sendWebAppEvent({
      webAppKey,
      event: {
        eventType: 'prepared_message_failed',
        eventData: {
          error: 'MESSAGE_EXPIRED'
        }
      },
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    preparedMessageModal: {
      message: result,
      webAppKey,
      botId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_18__.addActionHandler)('openSharePreparedMessageModal', (global, actions, payload) => {
  const {
    webAppKey,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const supportedFilters = message.peerTypes?.filter(type => type !== 'self');
  global = (0,_index__WEBPACK_IMPORTED_MODULE_18__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    sharePreparedMessageModal: {
      webAppKey,
      filter: supportedFilters,
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_18__.setGlobal)(global);
});
function countSortedIds(ids, from, to) {
  // If ids are outside viewport, we cannot get correct count
  if (ids.length === 0 || from < ids[0] || to > ids[ids.length - 1]) return undefined;
  let count = 0;
  for (let i = 0, l = ids.length; i < l; i++) {
    if (ids[i] >= from && ids[i] <= to) {
      count++;
    }
    if (ids[i] >= to) {
      break;
    }
  }
  return count;
}
function splitAttachmentsByType(attachments) {
  return attachments.reduce((acc, attachment, index, arr) => {
    if (index === 0) {
      acc.push([attachment]);
      return acc;
    }
    const type = getAttachmentType(attachment);
    const previousType = getAttachmentType(arr[index - 1]);
    if (type === previousType) {
      acc[acc.length - 1].push(attachment);
    } else {
      acc.push([attachment]);
    }
    return acc;
  }, []);
}
function getAttachmentType(attachment) {
  const {
    shouldSendAsFile,
    mimeType
  } = attachment;
  if (_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_AUDIO_CONTENT_TYPES.has(mimeType)) return 'audio';
  if (shouldSendAsFile) return 'file';
  if (mimeType === _config__WEBPACK_IMPORTED_MODULE_2__.GIF_MIME_TYPE) return 'gif';
  if (_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_PHOTO_CONTENT_TYPES.has(mimeType) || _config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType)) return 'media';
  if (attachment.voice) return 'voice';
  return 'file';
}

/***/ }),

/***/ "./src/global/actions/api/middleSearch.ts":
/*!************************************************!*\
  !*** ./src/global/actions/api/middleSearch.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_searchResultKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/keys/searchResultKey */ "./src/util/keys/searchResultKey.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const MEDIA_PRELOAD_OFFSET = 9;
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('performMiddleSearch', async (global, actions, payload) => {
  const {
    query,
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  if (!chatId) return;
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const peer = realChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, realChatId) : undefined;
  let currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMiddleSearch)(global, tabId);
  if (!peer) {
    return;
  }
  if (!currentSearch) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, realChatId, threadId, {}, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  }
  currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMiddleSearch)(global, tabId);
  const {
    results,
    savedTag,
    type,
    isHashtag
  } = currentSearch;
  const shouldReuseParams = results?.query === query;
  const offsetId = shouldReuseParams ? results?.nextOffsetId : undefined;
  const offsetRate = shouldReuseParams ? results?.nextOffsetRate : undefined;
  const offsetPeerId = shouldReuseParams ? results?.nextOffsetPeerId : undefined;
  const offsetPeer = shouldReuseParams && offsetPeerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, offsetPeerId) : undefined;
  const shouldHaveQuery = isHashtag || !savedTag;
  if (shouldHaveQuery && !query) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, realChatId, threadId, {
      fetchingQuery: undefined
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, realChatId, threadId, {
    fetchingQuery: query
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  let result;
  if (type === 'chat') {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
      peer,
      type: 'text',
      query: isHashtag ? `#${query}` : query,
      threadId,
      limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_SEARCH_SLICE,
      offsetId,
      isSavedDialog,
      savedTag
    });
  }
  if (type === 'myChats') {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesGlobal', {
      type: 'text',
      query: isHashtag ? `#${query}` : query,
      limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_SEARCH_SLICE,
      offsetId,
      offsetRate,
      offsetPeer
    });
  }
  if (type === 'channels') {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchPublicPosts', {
      hashtag: query,
      limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_SEARCH_SLICE,
      offsetId,
      offsetPeer,
      offsetRate
    });
  }
  if (!result) {
    return;
  }
  const {
    userStatusesById,
    messages,
    totalCount,
    nextOffsetId,
    nextOffsetRate,
    nextOffsetPeerId
  } = result;
  const newFoundIds = messages.map(_util_keys_searchResultKey__WEBPACK_IMPORTED_MODULE_5__.getSearchResultKey);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMiddleSearch)(global, tabId);
  const hasTagChanged = currentSearch?.savedTag && !(0,_helpers__WEBPACK_IMPORTED_MODULE_7__.isSameReaction)(savedTag, currentSearch.savedTag);
  const hasSearchChanged = currentSearch?.fetchingQuery !== query;
  if (!currentSearch || hasSearchChanged || hasTagChanged) {
    return;
  }
  const resultChatId = isSavedDialog ? currentUserId : peer.id;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, userStatusesById);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addMessages)(global, messages);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, resultChatId, threadId, {
    fetchingQuery: undefined
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearchResults)(global, resultChatId, threadId, {
    foundIds: newFoundIds,
    totalCount,
    nextOffsetId,
    nextOffsetRate,
    nextOffsetPeerId,
    query: query || ''
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchHashtag', (global, actions, payload) => {
  const {
    hashtag,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const messageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId);
  if (!messageList) {
    return;
  }
  const cleanQuery = hashtag.replace(/^#/, '');
  actions.updateMiddleSearch({
    chatId: messageList.chatId,
    threadId: messageList.threadId,
    update: {
      isHashtag: true,
      requestedQuery: cleanQuery
    },
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchSharedMediaMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return;
  }
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, realChatId);
  const currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentSharedMediaSearch)(global, tabId);
  if (!peer || !currentSearch) {
    return;
  }
  const {
    currentType: type,
    resultsByType
  } = currentSearch;
  const currentResults = type && resultsByType && resultsByType[type];
  const offsetId = currentResults?.nextOffsetId;
  if (!type) {
    return;
  }
  void searchSharedMedia(global, peer, threadId, type, offsetId, undefined, isSavedDialog, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchChatMediaMessages', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    currentMediaMessageId,
    limit,
    direction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!chatId || !threadId || !currentMediaMessageId) {
    return;
  }
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, realChatId);
  if (!chat) {
    return;
  }
  let currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentChatMediaSearch)(global, tabId);
  if (!currentSearch) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.initializeChatMediaSearchResults)(global, chatId, threadId, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentChatMediaSearch)(global, tabId);
    if (!currentSearch) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  }
  void searchChatMedia(global, chat, threadId, currentMediaMessageId, currentSearch, direction, isSavedDialog, limit, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchMessagesByDate', async (global, actions, payload) => {
  const {
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const messageId = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('findFirstMessageIdAfterDate', {
    chat,
    timestamp
  });
  if (!messageId) {
    return;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId,
    tabId
  });
});
async function searchSharedMedia(global, peer, threadId, type, offsetId, isBudgetPreload = false, isSavedDialog, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()]) {
  const resultChatId = isSavedDialog ? global.currentUserId : peer.id;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
    peer,
    type,
    limit: _config__WEBPACK_IMPORTED_MODULE_2__.SHARED_MEDIA_SLICE * 2,
    threadId,
    offsetId,
    isSavedDialog
  });
  if (!result) {
    return;
  }
  const {
    userStatusesById,
    messages,
    totalCount,
    nextOffsetId
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentSharedMediaSearch)(global, tabId);
  if (!currentSearch) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, userStatusesById);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChatMessagesById)(global, resultChatId, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateSharedMediaSearchResults)(global, resultChatId, threadId, type, newFoundIds, totalCount, nextOffsetId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  if (!isBudgetPreload) {
    void searchSharedMedia(global, peer, threadId, type, nextOffsetId, true, isSavedDialog, tabId);
  }
}
function selectCurrentChatMediaSearchSegment(params, currentMediaMessageId) {
  if ((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.isInsideSortedArrayRange)(currentMediaMessageId, params.currentSegment.foundIds)) {
    return params.currentSegment;
  }
  const index = params.segments.findIndex(segment => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.isInsideSortedArrayRange)(currentMediaMessageId, segment.foundIds));
  if (index === -1) {
    if (params.currentSegment && params.currentSegment.foundIds.length) {
      params.segments.push(params.currentSegment);
    }
    return undefined;
  }
  const result = params.segments.splice(index, 1)[0];
  params.segments.push(params.currentSegment);
  return result;
}
function calcChatMediaSearchAddOffset(direction, limit) {
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return 0;
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards) return -(limit + 1);
  return -(Math.round(limit / 2) + 1);
}
function calcChatMediaSearchOffsetId(direction, currentMessageId, segment) {
  if (!segment) return currentMessageId;
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return segment.foundIds[0];
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards) return segment.foundIds[segment.foundIds.length - 1];
  return currentMessageId;
}
function calcLoadMoreDirection(currentMessageId, currentSegment) {
  if (!currentSegment) return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  const currentSegmentFoundIdsCount = currentSegment.foundIds.length;
  const idIndexInSegment = currentSegment.foundIds.indexOf(currentMessageId);
  if (idIndexInSegment === -1) return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  if (currentSegment.loadingState.areAllItemsLoadedBackwards && currentSegment.loadingState.areAllItemsLoadedForwards) {
    return undefined;
  }
  const halfMediaCount = Math.floor(currentSegmentFoundIdsCount / 2);
  const preloadOffset = MEDIA_PRELOAD_OFFSET > halfMediaCount ? 0 : MEDIA_PRELOAD_OFFSET;
  const lastMediaIndex = currentSegmentFoundIdsCount - 1;
  if (idIndexInSegment <= preloadOffset) {
    if (currentSegment.loadingState.areAllItemsLoadedBackwards) return undefined;
    return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards;
  }
  if (idIndexInSegment >= lastMediaIndex - preloadOffset) {
    if (currentSegment.loadingState.areAllItemsLoadedForwards) return undefined;
    return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards;
  }
  return undefined;
}
function calcLoadingState(direction, limit, newFoundIdsCount, currentSegment) {
  let areAllItemsLoadedForwards = Boolean(currentSegment?.loadingState.areAllItemsLoadedForwards);
  let areAllItemsLoadedBackwards = Boolean(currentSegment?.loadingState.areAllItemsLoadedBackwards);
  if (newFoundIdsCount < limit) {
    if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards) {
      areAllItemsLoadedForwards = true;
    } else if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) {
      areAllItemsLoadedBackwards = true;
    }
  }
  return {
    areAllItemsLoadedForwards,
    areAllItemsLoadedBackwards
  };
}
async function searchChatMedia(global, peer, threadId, currentMediaMessageId, chatMediaSearchParams, direction, isSavedDialog, limit = _config__WEBPACK_IMPORTED_MODULE_2__.CHAT_MEDIA_SLICE, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()]) {
  const {
    isSynced
  } = global;
  if (!isSynced || chatMediaSearchParams.isLoading) {
    return;
  }
  let currentSegment = selectCurrentChatMediaSearchSegment(chatMediaSearchParams, currentMediaMessageId);
  if (direction === undefined) {
    direction = calcLoadMoreDirection(currentMediaMessageId, currentSegment);
  }
  if (direction === undefined) {
    return;
  }
  const offsetId = calcChatMediaSearchOffsetId(direction, currentMediaMessageId, currentSegment);
  const addOffset = calcChatMediaSearchAddOffset(direction, limit);
  const resultChatId = isSavedDialog ? global.currentUserId : peer.id;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.setChatMediaSearchLoading)(global, resultChatId, threadId, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
    peer,
    type: 'media',
    limit,
    threadId,
    offsetId,
    isSavedDialog,
    addOffset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.setChatMediaSearchLoading)(global, resultChatId, threadId, false, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    return;
  }
  const {
    messages,
    userStatusesById
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, userStatusesById);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChatMessagesById)(global, resultChatId, byId);
  const loadingState = calcLoadingState(direction, limit, newFoundIds.length, currentSegment);
  const filteredIds = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getMessageContentIds)(byId, newFoundIds, 'media');
  currentSegment = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.mergeWithChatMediaSearchSegment)(filteredIds, loadingState, currentSegment);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateChatMediaSearchResults)(global, resultChatId, threadId, currentSegment, chatMediaSearchParams, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.setChatMediaSearchLoading)(global, resultChatId, threadId, false, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
}

/***/ }),

/***/ "./src/global/actions/api/payments.ts":
/*!********************************************!*\
  !*** ./src/global/actions/api/payments.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_payments_stripe__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/payments/stripe */ "./src/util/payments/stripe.ts");
/* harmony import */ var _util_requestQuery__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/requestQuery */ "./src/util/requestQuery.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");















const LOCAL_BOOST_COOLDOWN = 86400; // 24 hours

(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('validateRequestedInfo', (global, actions, payload) => {
  const {
    requestInfo,
    saveInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentInputInvoice)(global, tabId);
  if (!inputInvoice) {
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  validateRequestedInfo(global, requestInputInvoice, requestInfo, saveInfo, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openInvoice', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    ...inputInvoice
  } = payload;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_7__.extractCurrentThemeParams)();
  const form = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPaymentForm', requestInputInvoice, theme);
  if (!form) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: false
  }, tabId);
  if ('error' in form) {
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    handlePaymentFormError(form.error, tabId);
    return;
  }
  if (form.type === 'regular') {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      inputInvoice: payload,
      form,
      isPaymentModalOpen: true,
      isExtendedMedia: payload.isExtendedMedia,
      status: undefined
    }, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  }
  if (form.type === 'stars') {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      starsPayment: {
        inputInvoice,
        form,
        status: 'pending'
      }
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendStarGift', (global, actions, payload) => {
  const {
    gift,
    peerId,
    message,
    shouldHideName,
    shouldUpgrade,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = {
    type: 'stargift',
    peerId,
    giftId: gift.id,
    message,
    shouldHideName,
    shouldUpgrade: shouldUpgrade || undefined
  };
  payInputStarInvoice(global, inputInvoice, gift.stars, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('buyStarGift', (global, actions, payload) => {
  const {
    slug,
    peerId,
    price,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = {
    type: 'stargiftResale',
    slug,
    peerId,
    currency: price.currency
  };
  payInputStarInvoice(global, inputInvoice, price.amount, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendPremiumGiftByStars', (global, actions, payload) => {
  const {
    userId,
    months,
    amount,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = {
    type: 'premiumGiftStars',
    userId,
    months,
    message
  };
  payInputStarInvoice(global, inputInvoice, amount, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('getReceipt', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = chatId && (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!messageId || !chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getReceipt', chat, messageId);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (result.receipt.type === 'stars') {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.openStarsTransactionFromReceipt)(global, result.receipt, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setReceipt)(global, result.receipt, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('clearPaymentError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
      error: undefined
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('clearReceipt', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
      receipt: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendCredentialsInfo', (global, actions, payload) => {
  const {
    credentials,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const {
    nativeProvider
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment.form;
  const {
    data
  } = credentials;
  if (nativeProvider === 'stripe') {
    const publishableKey = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectProviderPublishableKey)(global, tabId);
    if (!publishableKey) {
      return;
    }
    void sendStripeCredentials(global, data, publishableKey, tabId);
  } else if (nativeProvider === 'smartglocal') {
    const publicToken = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectProviderPublicToken)(global, tabId);
    if (!publicToken) {
      return;
    }
    void sendSmartGlocalCredentials(global, data, publicToken, tabId);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendPaymentForm', async (global, actions, payload) => {
  const {
    shippingOptionId,
    saveCredentials,
    savedCredentialId,
    tipAmount,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const requestInfoId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentRequestId)(global, tabId);
  const paymentState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment;
  const {
    form,
    temporaryPassword,
    inputInvoice
  } = paymentState;
  if (!inputInvoice || !form) {
    return;
  }
  const {
    nativeProvider,
    formId
  } = form;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'pending'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const credentials = {
    save: saveCredentials,
    data: nativeProvider === 'stripe' ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectStripeCredentials)(global, tabId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSmartGlocalCredentials)(global, tabId)
  };
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('sendPaymentForm', {
    inputInvoice: requestInputInvoice,
    formId,
    credentials,
    requestedInfoId: requestInfoId,
    shippingOptionId,
    savedCredentialId,
    temporaryPassword: temporaryPassword?.value,
    tipAmount
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'paid'
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.closeInvoice)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'updatePaymentStateCompleted',
    paymentState,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendStarPaymentForm', async (global, actions, payload) => {
  const {
    directInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const starPayment = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectStarsPayment)(global, tabId);
  const inputInvoice = starPayment?.inputInvoice || directInfo?.inputInvoice;
  if (!inputInvoice) return;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  const formId = starPayment.form?.formId || starPayment.subscriptionInfo?.subscriptionFormId || directInfo?.formId;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsPayment)(global, {
    status: 'pending'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('sendStarPaymentForm', {
    inputInvoice: requestInputInvoice,
    formId
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsPayment)(global, {
      status: 'failed'
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    actions.closeStarsPaymentModal({
      tabId
    });
    actions.closeGiftModal({
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsPayment)(global, {
    status: 'paid'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.closeStarsPaymentModal({
    tabId
  });
  if ('channelId' in result) {
    actions.openChat({
      id: result.channelId,
      tabId
    });
  }
  actions.apiUpdate({
    '@type': 'updateStarPaymentStateCompleted',
    paymentState: directInfo ? {
      inputInvoice
    } : starPayment,
    tabId
  });
  actions.loadStarStatus();
});
async function sendStripeCredentials(global, data, publishableKey, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const query = (0,_util_requestQuery__WEBPACK_IMPORTED_MODULE_5__.buildQueryString)({
    'card[number]': data.cardNumber,
    'card[exp_month]': data.expiryMonth,
    'card[exp_year]': data.expiryYear,
    'card[cvc]': data.cvv,
    'card[address_zip]': data.zip,
    'card[address_country]': data.country
  });
  const response = await fetch(`https://api.stripe.com/v1/tokens${query}`, {
    method: 'POST',
    credentials: 'same-origin',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      Authorization: `Bearer ${publishableKey}`
    }
  });
  const result = await response.json();
  if (result.error) {
    const error = (0,_util_payments_stripe__WEBPACK_IMPORTED_MODULE_4__.getStripeError)(result.error);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      payment: {
        ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
        status: 'failed',
        error: {
          ...error
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setStripeCardInfo)(global, {
    type: result.type,
    id: result.id
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
async function sendSmartGlocalCredentials(global, data, publicToken, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const params = {
    card: {
      number: data.cardNumber.replace(/\D+/g, ''),
      expiration_month: data.expiryMonth,
      expiration_year: data.expiryYear,
      security_code: data.cvv.replace(/\D+/g, '')
    }
  };
  const tokenizeUrl = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment.form?.nativeParams.tokenizeUrl;
  let url;
  if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG_PAYMENT_SMART_GLOCAL) {
    url = 'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card';
  } else {
    url = 'https://tgb.smart-glocal.com/cds/v1/tokenize/card';
  }
  if (tokenizeUrl?.startsWith('https://') && tokenizeUrl.endsWith('.smart-glocal.com/cds/v1/tokenize/card')) {
    url = tokenizeUrl;
  }
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json',
      'X-PUBLIC-TOKEN': publicToken
    },
    body: JSON.stringify(params)
  });
  const result = await response.json();
  if (result.status !== 'ok') {
    // TODO      getStripeError(result.error);
    const error = {
      descriptionKey: {
        key: 'ErrorUnexpected'
      }
    };
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      payment: {
        ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
        status: 'failed',
        error: {
          ...error
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setSmartGlocalCardInfo)(global, {
    type: 'card',
    token: result.data.token
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setSmartGlocalCardInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    type,
    token
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setSmartGlocalCardInfo)(global, {
    type,
    token
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setPaymentStep', (global, actions, payload) => {
  const {
    step,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, step ?? _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('closePremiumModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.premiumModal) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    premiumModal: {
      promo: tabState.premiumModal.promo,
      // Cache promo
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openPremiumModal', async (global, actions, payload) => {
  const {
    initialSection,
    fromUserId,
    isSuccess,
    isGift,
    daysAmount,
    toUserId,
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  actions.loadPremiumStickers();
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPremiumPromo');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    premiumModal: {
      promo: result.promo,
      initialSection,
      isOpen: true,
      fromUserId,
      toUserId,
      isGift,
      daysAmount,
      isSuccess,
      gift
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.closeReactionPicker({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiveawayModal', async (global, actions, payload) => {
  const {
    chatId,
    prepaidGiveaway,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPremiumGiftCodeOptions', {
    chat
  });
  const starOptions = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarsGiveawayOptions');
  if (!result || !starOptions) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giveawayModal: {
      chatId,
      gifts: result,
      isOpen: true,
      prepaidGiveaway,
      starOptions
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('checkCanSendGift', async (global, actions, payload) => {
  const {
    gift,
    onSuccess,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if (gift.type !== 'starGift' || !gift.lockedUntilDate) {
    onSuccess();
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCheckCanSendGift', {
    giftId: gift.id
  });
  if (!result) return;
  if (result?.canSend) {
    onSuccess();
  } else {
    actions.openLockedGiftModalInfo({
      untilDate: gift.type === 'starGift' ? gift.lockedUntilDate : undefined,
      reason: result.reason,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiftModal', async (global, actions, payload) => {
  const {
    forUserId,
    selectedGift,
    selectedResaleGift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return;
  }
  const gifts = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPremiumGiftCodeOptions', {});
  if (!gifts) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftModal: {
      forPeerId: forUserId,
      gifts,
      selectedResaleGift,
      selectedGift
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openStarsGiftModal', async (global, actions, payload) => {
  const {
    forUserId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return;
  }
  const chat = forUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, forUserId) : undefined;
  if (forUserId && !chat) return;
  const starsGiftOptions = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarsGiftOptions', {
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    starsGiftModal: {
      isOpen: true,
      forUserId,
      starsGiftOptions
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('validatePaymentPassword', async (global, actions, payload) => {
  const {
    password,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchTemporaryPaymentPassword', password);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      error: {
        messageKey: {
          key: 'ErrorUnexpected'
        },
        field: 'password'
      }
    }, tabId);
  } else if ('error' in result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      error: {
        messageKey: result.messageKey,
        field: 'password'
      }
    }, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      temporaryPassword: result,
      step: _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
async function validateRequestedInfo(global, inputInvoice, requestInfo, shouldSave, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('validateRequestedInfo', {
    inputInvoice,
    requestInfo,
    shouldSave
  });
  if (!result) {
    return;
  }
  const {
    id,
    shippingOptions
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setRequestInfoId)(global, id, tabId);
  if (shippingOptions?.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateShippingOptions)(global, shippingOptions, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Shipping, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openBoostModal', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat || !((0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isChatChannel)(chat) || (0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isChatSuperGroup)(chat))) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostStatus', {
    chat
  });
  if (!result) {
    actions.closeBoostModal({
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      chatId,
      boostStatus: result
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const myBoosts = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchMyBoosts');
  if (!myBoosts) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostModal) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      ...tabState.boostModal,
      myBoosts: myBoosts.boosts
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openBoostStatistics', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const [boostListResult, boostListGiftResult, boostStatusResult] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat,
    isGifts: true
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostStatus', {
    chat
  })]);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!boostListResult || !boostListGiftResult || !boostStatusResult) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostStatistics: undefined
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      chatId,
      boostStatus: boostStatusResult,
      nextOffset: boostListResult.nextOffset,
      boosts: {
        count: boostListResult.count,
        list: boostListResult.boostList
      },
      giftedBoosts: {
        count: boostListGiftResult?.count,
        list: boostListGiftResult?.boostList
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openMonetizationStatistics', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    monetizationStatistics: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadMoreBoosters', async (global, actions, payload) => {
  const {
    isGifts,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostStatistics) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, tabState.boostStatistics.chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      ...tabState.boostStatistics,
      isLoadingBoosters: true
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat,
    offset: tabState.boostStatistics.nextOffset,
    isGifts
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostStatistics) return;
  const updatedBoostList = (isGifts ? tabState.boostStatistics.giftedBoosts?.list || [] : tabState.boostStatistics.boosts?.list || []).concat(result.boostList);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      ...tabState.boostStatistics,
      nextOffset: result.nextOffset,
      isLoadingBoosters: false,
      [isGifts ? 'giftedBoosts' : 'boosts']: {
        count: result.count,
        list: updatedBoostList
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('applyBoost', async (global, actions, payload) => {
  const {
    chatId,
    slots,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const oldChatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatFullInfo)(global, chatId);
  const oldBoostsApplied = oldChatFullInfo?.boostsApplied || 0;
  const appliedBoostsCount = slots.length;
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  const oldStatus = tabState.boostModal?.boostStatus;
  if (oldStatus) {
    const boostsPerLevel = oldStatus.nextLevelBoosts ? oldStatus.nextLevelBoosts - oldStatus.currentLevelBoosts : 1;
    const newBoosts = oldStatus.boosts + appliedBoostsCount;
    const isLevelUp = oldStatus.nextLevelBoosts && newBoosts >= oldStatus.nextLevelBoosts;
    const newCurrentLevelBoosts = isLevelUp ? oldStatus.nextLevelBoosts : oldStatus.currentLevelBoosts;
    const newNextLevelBoosts = isLevelUp ? oldStatus.nextLevelBoosts + boostsPerLevel : oldStatus.nextLevelBoosts;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        boostStatus: {
          ...oldStatus,
          level: isLevelUp ? oldStatus.level + 1 : oldStatus.level,
          currentLevelBoosts: newCurrentLevelBoosts,
          nextLevelBoosts: newNextLevelBoosts,
          hasMyBoost: true,
          boosts: newBoosts
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  const oldMyBoosts = tabState.boostModal?.myBoosts;
  if (oldMyBoosts) {
    const unixNow = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_6__.getServerTime)();
    const newMyBoosts = oldMyBoosts.map(boost => {
      if (slots.includes(boost.slot)) {
        return {
          ...boost,
          chatId,
          date: unixNow,
          cooldownUntil: unixNow + LOCAL_BOOST_COOLDOWN // Will be refetched below
        };
      }
      return boost;
    });
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        myBoosts: newMyBoosts
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('applyBoost', {
    slots,
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!result) {
    // Rollback local changes
    const boostModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).boostModal;
    if (boostModal) {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
        boostModal: {
          ...boostModal,
          boostStatus: oldStatus,
          myBoosts: oldMyBoosts
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    }
    return;
  }
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (oldChatFullInfo) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateChatFullInfo)(global, chatId, {
      boostsApplied: oldBoostsApplied + slots.length
    });
  }
  if (tabState.boostModal) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        myBoosts: result.boosts
      }
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('checkGiftCode', async (global, actions, payload) => {
  const {
    slug,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('checkGiftCode', {
    slug
  });
  if (!result) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('lng_gift_link_expired'),
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftCodeModal: {
      slug,
      info: result.code,
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('applyGiftCode', async (global, actions, payload) => {
  const {
    slug,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('applyGiftCode', {
    slug
  });
  if (!result) {
    return;
  }
  actions.requestConfetti({
    withStars: true,
    tabId
  });
  actions.closeGiftCodeModal({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('launchPrepaidGiveaway', async (global, actions, payload) => {
  const {
    chatId,
    giveawayId,
    paymentPurpose,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const additionalChannels = paymentPurpose?.additionalChannelIds?.map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, id)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('launchPrepaidGiveaway', {
    chat,
    giveawayId,
    paymentPurpose: {
      type: 'giveaway',
      chat,
      areWinnersVisible: paymentPurpose?.areWinnersVisible,
      additionalChannels,
      countries: paymentPurpose?.countries,
      prizeDescription: paymentPurpose.prizeDescription,
      untilDate: paymentPurpose.untilDate,
      currency: paymentPurpose.currency,
      amount: paymentPurpose.amount
    }
  });
  if (!result) {
    return;
  }
  actions.openBoostStatistics({
    chatId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('launchPrepaidStarsGiveaway', async (global, actions, payload) => {
  const {
    chatId,
    giveawayId,
    paymentPurpose,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const additionalChannels = paymentPurpose?.additionalChannelIds?.map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, id)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('launchPrepaidGiveaway', {
    chat,
    giveawayId,
    paymentPurpose: {
      type: 'starsgiveaway',
      chat,
      areWinnersVisible: paymentPurpose?.areWinnersVisible,
      additionalChannels,
      countries: paymentPurpose?.countries,
      prizeDescription: paymentPurpose.prizeDescription,
      untilDate: paymentPurpose.untilDate,
      currency: paymentPurpose.currency,
      amount: paymentPurpose.amount,
      stars: paymentPurpose.stars,
      users: paymentPurpose.users
    }
  });
  if (!result) {
    return;
  }
  actions.openBoostStatistics({
    chatId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('upgradeGift', async (global, actions, payload) => {
  const {
    gift,
    shouldKeepOriginalDetails,
    upgradeStars,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const requestSavedGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputSavedStarGift)(global, gift);
  if (!requestSavedGift) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isWaitingForStarGiftUpgrade: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  actions.closeGiftUpgradeModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  if (!upgradeStars) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('upgradeStarGift', {
      inputSavedGift: requestSavedGift,
      shouldKeepOriginalDetails: shouldKeepOriginalDetails || undefined
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    if (result && global.currentUserId) {
      actions.reloadPeerSavedGifts({
        peerId: global.currentUserId
      });
    }
    return;
  }
  const invoice = {
    type: 'stargiftUpgrade',
    inputSavedGift: gift,
    shouldKeepOriginalDetails: shouldKeepOriginalDetails || undefined
  };
  payInputStarInvoice(global, invoice, upgradeStars, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('transferGift', (global, actions, payload) => {
  const {
    gift,
    recipientId,
    transferStars,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, recipientId);
  const requestSavedGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputSavedStarGift)(global, gift);
  if (!peer || !requestSavedGift) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isWaitingForStarGiftTransfer: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  actions.closeGiftTransferModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  if (!transferStars) {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('transferStarGift', {
      inputSavedGift: requestSavedGift,
      toPeer: peer
    });
    return;
  }
  const invoice = {
    type: 'stargiftTransfer',
    inputSavedGift: gift,
    recipientId
  };
  payInputStarInvoice(global, invoice, transferStars, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('removeGiftDescription', (global, actions, payload) => {
  const {
    gift,
    price,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const invoice = {
    type: 'stargiftDropOriginalDetails',
    inputSavedGift: gift
  };
  payInputStarInvoice(global, invoice, price, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('upgradePrepaidGift', (global, actions, payload) => {
  const {
    peerId,
    hash,
    stars,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const invoice = {
    type: 'stargiftPrepaidUpgrade',
    peerId,
    hash
  };
  payInputStarInvoice(global, invoice, stars, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendStarGiftAuctionBid', (global, actions, payload) => {
  const {
    giftId,
    bidAmount,
    peerId,
    message,
    shouldHideName,
    isUpdateBid,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const invoice = {
    type: 'stargiftAuctionBid',
    giftId,
    bidAmount,
    peerId,
    message,
    shouldHideName,
    isUpdateBid
  };
  payInputStarInvoice(global, invoice, bidAmount, tabId);
});
async function payInputStarInvoice(global, inputInvoice, price, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const actions = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getActions)();
  const isTon = inputInvoice.type === 'stargiftResale' && inputInvoice.currency === _config__WEBPACK_IMPORTED_MODULE_1__.TON_CURRENCY_CODE;
  const balance = isTon ? global.ton?.balance : global.stars?.balance;
  const currency = isTon ? _config__WEBPACK_IMPORTED_MODULE_1__.TON_CURRENCY_CODE : _config__WEBPACK_IMPORTED_MODULE_1__.STARS_CURRENCY_CODE;
  if (balance === undefined) return;
  if (balance.amount < price) {
    actions.openStarsBalanceModal({
      currency,
      tabId
    });
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_7__.extractCurrentThemeParams)();
  const form = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPaymentForm', requestInputInvoice, theme);
  if (!form) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  if ('error' in form) {
    handlePaymentFormError(form.error, tabId);
    return;
  }
  const formPrice = form.invoice.totalAmount;
  if (formPrice !== price) {
    actions.openPriceConfirmModal({
      originalAmount: price,
      newAmount: formPrice,
      currency,
      directInfo: {
        inputInvoice,
        formId: form.formId
      },
      tabId
    });
    return;
  }
  actions.sendStarPaymentForm({
    directInfo: {
      inputInvoice,
      formId: form.formId
    },
    tabId
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openUniqueGiftBySlug', async (global, actions, payload) => {
  const {
    slug,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const gift = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchUniqueStarGift', {
    slug
  });
  if (!gift) {
    actions.showNotification({
      message: {
        key: 'GiftWasNotFound'
      },
      tabId
    });
    return;
  }
  actions.openGiftInfoModal({
    gift,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiftAuctionBySlug', async (global, actions, payload) => {
  const {
    slug,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const auctionState = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarGiftAuctionState', {
    slug
  });
  if (!auctionState) {
    actions.showNotification({
      message: {
        key: 'GiftWasNotFound'
      },
      tabId
    });
    return;
  }
  actions.openGiftAuctionModal({
    gift: auctionState.gift,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('processStarGiftWithdrawal', async (global, actions, payload) => {
  const {
    gift,
    password,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  let giftWithdrawModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).giftWithdrawModal;
  if (!giftWithdrawModal) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftWithdrawModal: {
      ...giftWithdrawModal,
      isLoading: true,
      errorKey: undefined
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const inputGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputSavedStarGift)(global, gift);
  if (!inputGift) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarGiftWithdrawalUrl', {
    inputGift,
    password
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  giftWithdrawModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).giftWithdrawModal;
  if (!giftWithdrawModal) return;
  if ('error' in result) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      giftWithdrawModal: {
        ...giftWithdrawModal,
        isLoading: false,
        errorKey: result.messageKey
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  actions.openUrl({
    url: result.url,
    tabId
  });
  actions.closeGiftWithdrawModal({
    tabId
  });
});
function handlePaymentFormError(error, tabId) {
  if (error === 'SLUG_INVALID') {
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.getActions)().showNotification({
      message: {
        key: 'PaymentInvoiceNotFound'
      },
      tabId
    });
    return;
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.getActions)().showDialog({
    data: {
      message: error,
      hasErrorKey: true
    },
    tabId
  });
}

/***/ }),

/***/ "./src/global/actions/api/reactions.ts":
/*!*********************************************!*\
  !*** ./src/global/actions/api/reactions.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/requestActionTimeout */ "./src/util/requestActionTimeout.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");














const INTERACTION_RANDOM_OFFSET = 40;
let interactionLocalId = 0;
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadAvailableReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchAvailableReactions');
  if (!result) {
    return;
  }

  // Preload animations
  result.forEach(availableReaction => {
    if (availableReaction.aroundAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(`sticker${availableReaction.aroundAnimation.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.centerIcon) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(`sticker${availableReaction.centerIcon.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.appearAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(`sticker${availableReaction.appearAnimation.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.selectAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch((0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getDocumentMediaHash)(availableReaction.selectAnimation, 'full'), _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      availableReactions: result
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  (0,_util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_6__["default"])({
    action: 'loadAvailableReactions',
    payload: undefined
  }, _config__WEBPACK_IMPORTED_MODULE_1__.GENERAL_REFETCH_INTERVAL);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadAvailableEffects', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchAvailableEffects');
  if (!result) {
    return;
  }
  const {
    effects,
    emojis,
    stickers
  } = result;
  const reactions = [];
  const effectById = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(effects, 'id');
  for (const effect of effects) {
    if (effect.effectAnimationId) {
      const reaction = {
        type: 'emoji',
        emoticon: effect.emoticon
      };
      reactions.push(reaction);
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    availableEffectById: effectById,
    stickers: {
      ...global.stickers,
      effect: {
        stickers,
        emojis
      }
    },
    reactions: {
      ...global.reactions,
      effectReactions: reactions
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('interactWithAnimatedEmoji', (global, actions, payload) => {
  const {
    emoji,
    x,
    y,
    startSize,
    isReversed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const activeEmojiInteraction = {
    id: interactionLocalId++,
    animatedEffect: emoji,
    x: (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.subtractXForEmojiInteraction)(global, x) + Math.random() * INTERACTION_RANDOM_OFFSET - INTERACTION_RANDOM_OFFSET / 2,
    y: y + Math.random() * INTERACTION_RANDOM_OFFSET - INTERACTION_RANDOM_OFFSET / 2,
    startSize,
    isReversed
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: [...((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).activeEmojiInteractions || []), activeEmojiInteraction]
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendEmojiInteraction', (global, actions, payload) => {
  const {
    messageId,
    chatId,
    emoji,
    interactions
  } = payload;
  if (global.connectionState !== 'connectionStateReady') return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat || !emoji || (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId)) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendEmojiInteraction', {
    chat,
    messageId,
    emoticon: emoji,
    timestamps: interactions
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendDefaultReaction', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const reaction = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectDefaultReaction)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!reaction || !message || (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isMessageLocal)(message)) return;
  actions.toggleReaction({
    chatId,
    messageId,
    reaction,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('toggleReaction', async (global, actions, payload) => {
  const {
    chatId,
    reaction,
    shouldAddToRecent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  let {
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  let message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const isInSaved = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId);
  const isInDocumentGroup = Boolean(message.groupedId) && !message.isInAlbum;
  const documentGroupFirstMessageId = isInDocumentGroup ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectMessageIdsByGroupId)(global, chatId, message.groupedId)[0] : undefined;
  message = isInDocumentGroup ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, documentGroupFirstMessageId) || message : message;
  messageId = message?.id || messageId;
  const userReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getUserReactions)(message);
  const hasReaction = userReactions.some(userReaction => (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(userReaction, reaction));
  const newUserReactions = hasReaction ? userReactions.filter(userReaction => !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(userReaction, reaction)) : [...userReactions, reaction];
  const limit = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectMaxUserReactions)(global);
  const [paidReactions, regularReactions] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.partition)(newUserReactions, r => r.type === 'paid');
  const trimmedRegularReactions = regularReactions.slice(-limit);
  const localReactions = [...paidReactions, ...trimmedRegularReactions];
  const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message);
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) {
    if (hasReaction) {
      actions.stopActiveReaction({
        containerId: messageKey,
        reaction,
        tabId
      });
    } else {
      actions.startActiveReaction({
        containerId: messageKey,
        reaction,
        tabId
      });
    }
  }
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.addMessageReaction)(global, message, localReactions);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  try {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendReaction', {
      chat,
      messageId,
      reactions: trimmedRegularReactions,
      shouldAddToRecent
    });
    if (isInSaved) {
      actions.loadSavedReactionTags();
    }
  } catch (error) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.addMessageReaction)(global, message, userReactions);
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('addLocalPaidReaction', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    count,
    shouldIgnoreDefaultPrivacy = false,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const defaultPrivacy = global.settings.paidReactionPrivacy;
  const isPrivate = !shouldIgnoreDefaultPrivacy ? defaultPrivacy?.type === 'anonymous' : payload.isPrivate;
  const peerId = !shouldIgnoreDefaultPrivacy ? defaultPrivacy?.type === 'peer' ? defaultPrivacy.peerId : undefined : payload.peerId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const currentReactions = message.reactions?.results || [];
  const newReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.addPaidReaction)(currentReactions, count, isPrivate, peerId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChatMessage)(global, message.chatId, message.id, {
    reactions: {
      ...currentReactions,
      results: newReactions
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message);
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) {
    actions.startActiveReaction({
      containerId: messageKey,
      reaction: {
        type: 'paid'
      },
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendPaidReaction', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    forcedAmount,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const paidReaction = message.reactions?.results?.find(r => r.reaction.type === 'paid');
  const count = forcedAmount || paidReaction?.localAmount || 0;
  if (!count) {
    return;
  }
  actions.resetLocalPaidReactions({
    chatId,
    messageId
  });
  try {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendPaidReaction', {
      chat,
      messageId,
      count,
      isPrivate: paidReaction?.localIsPrivate,
      peerId: paidReaction?.localPeerId
    });
  } catch (error) {
    if (error.message === 'BALANCE_TOO_LOW') {
      actions.openStarsBalanceModal({
        originReaction: {
          chatId,
          messageId,
          amount: count
        },
        tabId
      });
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('startActiveReaction', (global, actions, payload) => {
  const {
    containerId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) return undefined;
  const currentActiveReactions = tabState.activeReactions[containerId] || [];
  if (currentActiveReactions.some(active => (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(active, reaction))) {
    return undefined;
  }
  const newActiveReactions = currentActiveReactions.concat(reaction);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeReactions: {
      ...tabState.activeReactions,
      [containerId]: newActiveReactions
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('stopActiveReaction', (global, actions, payload) => {
  const {
    containerId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  const currentActiveReactions = tabState.activeReactions[containerId] || [];
  // Remove all reactions if reaction is not specified
  const newMessageActiveReactions = reaction ? currentActiveReactions.filter(active => !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(active, reaction)) : [];
  const newActiveReactions = newMessageActiveReactions.length ? {
    ...tabState.activeReactions,
    [containerId]: newMessageActiveReactions
  } : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.omit)(tabState.activeReactions, [containerId]);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeReactions: newActiveReactions
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('setDefaultReaction', async (global, actions, payload) => {
  const {
    reaction
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('setDefaultReaction', {
    reaction
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  if (!global.config) {
    actions.loadConfig(); // Refetch new config, if it is somehow not loaded
    return;
  }
  global = {
    ...global,
    config: {
      ...global.config,
      defaultReaction: reaction
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('stopActiveEmojiInteraction', (global, actions, payload) => {
  const {
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).activeEmojiInteractions?.filter(active => active.id !== id)
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadReactors', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) return;
  const {
    chatId,
    messageId,
    reaction
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const offset = message.reactors?.nextOffset;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchMessageReactionsList', {
    reaction,
    chat,
    messageId,
    offset
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChatMessage)(global, chatId, messageId, {
    reactors: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadMessageReactions', (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) return;
  const {
    ids,
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat || global.connectionState !== 'connectionStateReady') {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchMessageReactions', {
    ids,
    chat
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendWatchingEmojiInteraction', (global, actions, payload) => {
  const {
    chatId,
    emoticon,
    x,
    y,
    startSize,
    isReversed,
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  if (!chat || !tabState.activeEmojiInteractions?.some(interaction => interaction.id === id) || (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId)) {
    return undefined;
  }
  if (global.connectionState === 'connectionStateReady') {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendWatchingEmojiInteraction', {
      chat,
      emoticon
    });
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: tabState.activeEmojiInteractions.map(activeEmojiInteraction => {
      if (activeEmojiInteraction.id === id) {
        return {
          ...activeEmojiInteraction,
          x: (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.subtractXForEmojiInteraction)(global, x),
          y,
          startSize,
          isReversed
        };
      }
      return activeEmojiInteraction;
    })
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('fetchUnreadReactions', async (global, actions, payload) => {
  const {
    chatId,
    offsetId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchUnreadReactions', {
    chat,
    offsetId,
    addOffset: offsetId ? -1 : undefined
  });

  // Server side bug, when server returns unread reactions count > 0 for deleted messages
  if (!result || !result.messages.length) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: 0
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chatId, {
    unreadReactions: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.unique)([...(chat.unreadReactions || []), ...ids]).sort((a, b) => b - a)
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('animateUnreadReaction', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat) return undefined;
  if (!chat.unreadReactionsCount) {
    return (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
      unreadReactions: []
    });
  }
  const unreadReactionsCount = Math.max(chat.unreadReactionsCount - messageIds.length, 0);
  const unreadReactions = (chat.unreadReactions || []).filter(id => !messageIds.includes(id));
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
    unreadReactions,
    unreadReactionsCount
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  actions.markMessagesRead({
    messageIds,
    shouldFetchUnreadReactions: true,
    tabId
  });
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) return undefined;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  messageIds.forEach(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chat.id, id);
    if (!message) return;
    const {
      reaction,
      isOwn,
      isUnread
    } = message.reactions?.recentReactions?.[0] ?? {};
    if (reaction && isUnread && !isOwn) {
      const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message);
      actions.startActiveReaction({
        containerId: messageKey,
        reaction,
        tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
      });
    }
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('focusNextReaction', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat?.unreadReactions) {
    if (chat?.unreadReactionsCount) {
      return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChat)(global, chat.id, {
        unreadReactionsCount: 0
      });
    }
    return undefined;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId: chat.unreadReactions[0],
    tabId,
    scrollTargetPosition: 'end'
  });
  actions.markMessagesRead({
    messageIds: [chat.unreadReactions[0]],
    tabId
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('readAllReactions', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat) return undefined;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('readAllReactions', {
    chat,
    threadId: threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? undefined : threadId
  });
  if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
    return (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
      unreadReactionsCount: undefined,
      unreadReactions: undefined
    });
  }

  // TODO[Forums]: Support unread reactions in threads
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadTopReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchTopReactions', {
    hash: global.reactions.hash.topReactions
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      topReactions: result.reactions,
      hash: {
        ...global.reactions.hash,
        topReactions: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadRecentReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchRecentReactions', {
    hash: global.reactions.hash.recentReactions
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      recentReactions: result.reactions,
      hash: {
        ...global.reactions.hash,
        recentReactions: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('clearRecentReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('clearRecentReactions');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      recentReactions: []
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadDefaultTagReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchDefaultTagReactions', {
    hash: global.reactions.hash.defaultTags
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      defaultTags: result.reactions,
      hash: {
        ...global.reactions.hash,
        defaultTags: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadSavedReactionTags', async global => {
  const {
    hash
  } = global.savedReactionTags || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchSavedReactionTags', {
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  const tagsByKey = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByCallback)(result.tags, tag => [(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getReactionKey)(tag.reaction), tag]);
  global = {
    ...global,
    savedReactionTags: {
      hash: result.hash,
      byKey: tagsByKey
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('editSavedReactionTag', async (global, actions, payload) => {
  const {
    reaction,
    title
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('updateSavedReactionTag', {
    reaction,
    title
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  const tagsByKey = global.savedReactionTags?.byKey;
  if (!tagsByKey) return;
  const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getReactionKey)(reaction);
  const tag = tagsByKey[key];
  const newTag = {
    ...tag,
    title
  };
  global = {
    ...global,
    savedReactionTags: {
      ...global.savedReactionTags,
      byKey: {
        ...tagsByKey,
        [key]: newTag
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/stars.ts":
/*!*****************************************!*\
  !*** ./src/global/actions/api/stars.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _limits__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../limits */ "./src/limits.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStarStatus', async global => {
  const currentStarsStatus = global.stars;
  const needsTopupOptions = !currentStarsStatus?.topupOptions;
  const [starsStatus, tonStatus, topupOptions] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarsStatus'), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarsStatus', {
    isTon: true
  }), needsTopupOptions ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarsTopupOptions') : undefined]);
  if (!(starsStatus || tonStatus) || needsTopupOptions && !topupOptions) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (starsStatus && starsStatus.balance.currency === _config__WEBPACK_IMPORTED_MODULE_0__.STARS_CURRENCY_CODE) {
    global = {
      ...global,
      stars: {
        ...currentStarsStatus,
        balance: starsStatus.balance,
        topupOptions: topupOptions || currentStarsStatus.topupOptions,
        history: {
          all: undefined,
          inbound: undefined,
          outbound: undefined
        },
        subscriptions: undefined
      }
    };
    if (starsStatus.history) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.appendStarsTransactions)(global, 'all', starsStatus.history, starsStatus.nextHistoryOffset);
    }
    if (starsStatus.subscriptions) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.appendStarsSubscriptions)(global, starsStatus.subscriptions, starsStatus.nextSubscriptionOffset);
    }
  }
  if (tonStatus?.balance.currency === _config__WEBPACK_IMPORTED_MODULE_0__.TON_CURRENCY_CODE) {
    global = {
      ...global,
      ton: {
        ...tonStatus,
        balance: tonStatus.balance,
        history: {
          all: undefined,
          inbound: undefined,
          outbound: undefined
        }
      }
    };
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStarsBalance)(global, tonStatus.balance);
    if (tonStatus.history) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.appendStarsTransactions)(global, 'all', tonStatus.history, tonStatus.nextHistoryOffset, true);
    }
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStarsTransactions', async (global, actions, payload) => {
  const {
    type,
    isTon
  } = payload;
  const history = isTon ? global.ton?.history[type] : global.stars?.history[type];
  const offset = history?.nextOffset;
  if (history && !offset) return; // Already loaded all

  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarsTransactions', {
    isInbound: type === 'inbound',
    isOutbound: type === 'outbound',
    offset: offset || '',
    isTon
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStarsBalance)(global, result.balance);
  if (result.history) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.appendStarsTransactions)(global, type, result.history, result.nextOffset, isTon);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStarGifts', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGifts');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.gifts, 'id');
  const allStarGiftIds = Object.keys(byId);
  const allStarGifts = Object.values(byId);
  const collectibleStarGiftIds = allStarGifts.map(gift => gift.availabilityResale || gift.isLimited && !gift.isSoldOut ? gift.id : undefined).filter(Boolean);
  global = {
    ...global,
    starGifts: {
      byId,
      idsByCategory: {
        all: allStarGiftIds,
        collectible: collectibleStarGiftIds,
        myUnique: []
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadMyUniqueGifts', async (global, actions, payload) => {
  const {
    shouldRefresh
  } = payload || {};
  const currentUserId = global.currentUserId;
  if (!currentUserId) return;
  const currentMyUniqueGifts = global.myUniqueGifts;
  const localNextOffset = currentMyUniqueGifts?.nextOffset;
  if (currentMyUniqueGifts && !localNextOffset && !shouldRefresh) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, currentUserId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchSavedStarGifts', {
    peer,
    offset: !shouldRefresh ? localNextOffset : undefined,
    filter: {
      sortType: 'byDate',
      shouldIncludeUnique: true,
      shouldIncludeUnlimited: false,
      shouldIncludeUpgradable: false,
      shouldIncludeLimited: false,
      shouldIncludeDisplayed: true,
      shouldIncludeHidden: true
    }
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const gifts = result.gifts;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByCallback)(gifts, savedGift => [savedGift.gift.id, savedGift]);
  const ids = gifts.map(gift => gift.gift.id);
  global = {
    ...global,
    myUniqueGifts: {
      byId: {
        ...(!shouldRefresh && (global.myUniqueGifts?.byId || {})),
        ...byId
      },
      ids: [...(!shouldRefresh ? global.myUniqueGifts?.ids || [] : []), ...ids],
      nextOffset: result.nextOffset
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('updateResaleGiftsFilter', (global, actions, payload) => {
  const {
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    resaleGifts: {
      ...tabState.resaleGifts,
      filter
    }
  }, tabId);
  if (tabState.resaleGifts.giftId) {
    actions.loadResaleGifts({
      giftId: tabState.resaleGifts.giftId,
      shouldRefresh: true,
      tabId
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadResaleGifts', async (global, actions, payload) => {
  const {
    giftId,
    shouldRefresh,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  if (tabState.resaleGifts.isLoading || tabState.resaleGifts.isAllLoaded && !shouldRefresh) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    resaleGifts: {
      ...tabState.resaleGifts,
      isLoading: true,
      ...(shouldRefresh && {
        count: 0,
        nextOffset: undefined,
        isAllLoaded: false
      })
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  const nextOffset = tabState.resaleGifts.nextOffset;
  const attributesHash = tabState.resaleGifts.attributesHash;
  const filter = tabState.resaleGifts.filter;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchResaleGifts', {
    giftId,
    offset: nextOffset,
    limit: _limits__WEBPACK_IMPORTED_MODULE_5__.RESALE_GIFTS_LIMIT,
    attributesHash,
    filter
  });
  if (!result) {
    return;
  }
  ;
  const {
    chats,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  const currentGifts = tabState.resaleGifts.gifts;
  const newGifts = !shouldRefresh ? currentGifts.concat(result.gifts) : result.gifts;
  const currentUpdateIteration = tabState.resaleGifts.updateIteration;
  const shouldUpdateIteration = tabState.resaleGifts.giftId !== giftId || shouldRefresh;
  const updateIteration = shouldUpdateIteration ? currentUpdateIteration + 1 : currentUpdateIteration;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    resaleGifts: {
      ...tabState.resaleGifts,
      giftId,
      count: result.count || tabState.resaleGifts.count,
      gifts: newGifts,
      attributes: result.attributes || tabState.resaleGifts.attributes,
      counters: result.counters || tabState.resaleGifts.counters,
      attributesHash: result.attributesHash,
      nextOffset: result.nextOffset,
      isLoading: false,
      isAllLoaded: !result.nextOffset,
      updateIteration
    }
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(chats, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('resetResaleGifts', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    resaleGifts: {
      updateIteration: tabState.resaleGifts.updateIteration + 1,
      filter: _config__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_RESALE_GIFTS_FILTER_OPTIONS,
      count: 0,
      gifts: []
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPeerSavedGifts', async (global, actions, payload) => {
  const {
    peerId,
    shouldRefresh,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId);
  if (!peer) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const fetchingCollectionId = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectActiveGiftsCollectionId)(global, peerId, tabId);
  const currentGifts = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeerCollectionSavedGifts)(global, peerId, fetchingCollectionId, tabId);
  const localNextOffset = currentGifts?.nextOffset;
  if (!shouldRefresh && currentGifts && !localNextOffset) return; // Already loaded all

  const fetchingFilter = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectGiftProfileFilter)(global, peerId, tabId);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchSavedStarGifts', {
    peer,
    offset: !shouldRefresh ? localNextOffset : '',
    filter: fetchingFilter,
    collectionId: fetchingCollectionId === 'all' ? undefined : fetchingCollectionId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const currentFilter = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectGiftProfileFilter)(global, peerId, tabId);
  const currentCollectionId = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectActiveGiftsCollectionId)(global, peerId, tabId);
  if (!result || currentCollectionId !== fetchingCollectionId || currentFilter !== fetchingFilter) {
    return;
  }
  const newGifts = currentGifts && !shouldRefresh ? currentGifts.gifts.concat(result.gifts) : result.gifts;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replacePeerSavedGifts)(global, peerId, newGifts, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('reloadPeerSavedGifts', (global, actions, payload) => {
  const {
    peerId
  } = payload;
  Object.values(global.byTabId).forEach(tabState => {
    const activeCollectionId = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectActiveGiftsCollectionId)(global, peerId, tabState.id);
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeerCollectionSavedGifts)(global, peerId, activeCollectionId, tabState.id)) {
      actions.loadPeerSavedGifts({
        peerId,
        shouldRefresh: true,
        tabId: tabState.id
      });
    }
  });
  if (peerId === global.currentUserId) {
    actions.loadMyUniqueGifts({
      shouldRefresh: true
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStarsSubscriptions', async global => {
  const subscriptions = global.stars?.subscriptions;
  const offset = subscriptions?.nextOffset;
  if (subscriptions && !offset) return; // Already loaded all

  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStarsSubscriptionLoading)(global, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarsSubscriptions', {
    offset: offset || ''
  });
  if (!result || result.balance.currency !== _config__WEBPACK_IMPORTED_MODULE_0__.STARS_CURRENCY_CODE) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStarsBalance)(global, result.balance);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.appendStarsSubscriptions)(global, result.subscriptions, result.nextOffset);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('changeStarsSubscription', async (global, actions, payload) => {
  const {
    peerId,
    id,
    isCancelled
  } = payload;
  const peer = peerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId) : undefined;
  if (peerId && !peer) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('changeStarsSubscription', {
    peer,
    subscriptionId: id,
    isCancelled
  });
  actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('fulfillStarsSubscription', async (global, actions, payload) => {
  const {
    peerId,
    id
  } = payload;
  const peer = peerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId) : undefined;
  if (peerId && !peer) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fulfillStarsSubscription', {
    peer,
    subscriptionId: id
  });
  actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('changeGiftVisibility', async (global, actions, payload) => {
  const {
    gift,
    shouldUnsave,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peerId = gift.type === 'user' ? global.currentUserId : gift.chatId;
  const requestInputGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_6__.getRequestInputSavedStarGift)(global, gift);
  if (!requestInputGift) return;
  const activeCollectionId = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectActiveGiftsCollectionId)(global, peerId, tabId);
  const oldGifts = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).savedGifts.collectionsByPeerId[peerId]?.[activeCollectionId];
  if (oldGifts?.gifts?.length) {
    const newGifts = oldGifts.gifts.map(g => {
      if (g.inputGift && (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_6__.areInputSavedGiftsEqual)(g.inputGift, gift)) {
        return {
          ...g,
          isUnsaved: shouldUnsave
        };
      }
      return g;
    });
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replacePeerSavedGifts)(global, peerId, newGifts, oldGifts.nextOffset, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('saveStarGift', {
    inputGift: requestInputGift,
    shouldUnsave
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replacePeerSavedGifts)(global, peerId, oldGifts.gifts, oldGifts.nextOffset, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    return;
  }
  actions.reloadPeerSavedGifts({
    peerId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('convertGiftToStars', async (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const requestInputGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_6__.getRequestInputSavedStarGift)(global, gift);
  if (!requestInputGift) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('convertStarGift', {
    inputSavedGift: requestInputGift
  });
  if (!result) {
    return;
  }
  const peerId = gift.type === 'user' ? global.currentUserId : gift.chatId;
  actions.reloadPeerSavedGifts({
    peerId
  });
  actions.openStarsBalanceModal({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('openGiftUpgradeModal', async (global, actions, payload) => {
  const {
    giftId,
    gift,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const preview = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGiftUpgradePreview', {
    giftId
  });
  if (!preview) return;
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)();
  const filteredPrices = preview.prices.filter(price => price.date > serverTime);
  const filteredNextPrices = preview.nextPrices.filter(price => price.date > serverTime);
  const passedPrices = preview.nextPrices.filter(price => price.date <= serverTime);
  const regularGift = gift?.gift.type === 'starGift' ? gift.gift : undefined;
  const currentUpgradeStars = passedPrices.length ? passedPrices[passedPrices.length - 1].upgradeStars : regularGift?.upgradeStars;
  const maxPrice = preview.prices[0]?.upgradeStars;
  const minPrice = preview.prices.at(-1)?.upgradeStars;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    giftUpgradeModal: {
      recipientId: peerId,
      gift,
      sampleAttributes: preview.sampleAttributes,
      prices: filteredPrices,
      nextPrices: filteredNextPrices,
      currentUpgradeStars,
      minPrice,
      maxPrice
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('shiftGiftUpgradeNextPrice', async (global, _actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  const giftUpgradeModal = tabState?.giftUpgradeModal;
  if (!giftUpgradeModal?.nextPrices?.length) return;
  const currentUpgradeStars = giftUpgradeModal.nextPrices[0].upgradeStars;
  const newNextPrices = giftUpgradeModal.nextPrices.slice(1);
  if (newNextPrices.length) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
      giftUpgradeModal: {
        ...giftUpgradeModal,
        nextPrices: newNextPrices,
        currentUpgradeStars
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    return;
  }
  const gift = giftUpgradeModal.gift?.gift;
  const giftId = gift?.type === 'starGift' ? gift.id : undefined;
  if (!giftId) return;
  const preview = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGiftUpgradePreview', {
    giftId
  });
  if (!preview) return;
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)();
  const filteredNextPrices = preview.nextPrices.filter(price => price.date > serverTime);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
  const currentModal = currentTabState?.giftUpgradeModal;
  if (!currentModal) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    giftUpgradeModal: {
      ...currentModal,
      nextPrices: filteredNextPrices,
      currentUpgradeStars
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('openGiftAuctionModal', async (global, _actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const [, preview] = await Promise.all([(0,_index__WEBPACK_IMPORTED_MODULE_7__.getPromiseActions)().loadGiftAuction({
    giftId: gift.id
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGiftUpgradePreview', {
    giftId: gift.id
  })]);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    giftAuctionModal: {
      auctionGiftId: gift.id,
      sampleAttributes: preview?.sampleAttributes
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGiftAuction', async (global, _actions, payload) => {
  const {
    giftId
  } = payload;
  const currentAuction = global.giftAuctionByGiftId?.[giftId];
  const currentVersion = currentAuction?.state.type === 'active' ? currentAuction.state.version : 0;
  const auctionState = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGiftAuctionState', {
    giftId,
    version: currentVersion
  });
  if (!auctionState) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceGiftAuction)(global, auctionState);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleSavedGiftPinned', async (global, actions, payload) => {
  const {
    gift,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId);
  if (!peer) return;
  const savedGifts = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeerSavedGifts)(global, peerId, tabId);
  if (!savedGifts) return;
  const pinLimit = global.appConfig.savedGiftPinLimit;
  const currentPinnedGifts = savedGifts.gifts.filter(g => g.isPinned);
  const newPinnedGifts = gift.isPinned ? currentPinnedGifts.filter(g => g.gift.slug !== gift.gift.slug) : [...currentPinnedGifts, gift];
  const trimmedPinnedGifts = pinLimit ? newPinnedGifts.slice(-pinLimit) : newPinnedGifts;
  const inputSavedGifts = trimmedPinnedGifts.map(g => (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_6__.getRequestInputSavedStarGift)(global, g.inputGift)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleSavedGiftPinned', {
    inputSavedGifts,
    peer
  });
  if (!result) return;
  actions.reloadPeerSavedGifts({
    peerId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('updateStarGiftPrice', async (global, actions, payload) => {
  const {
    gift,
    price
  } = payload;
  const requestSavedGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_6__.getRequestInputSavedStarGift)(global, gift);
  if (!requestSavedGift) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('updateStarGiftPrice', {
    inputSavedGift: requestSavedGift,
    price
  });
  if (!result) return;
  actions.reloadPeerSavedGifts({
    peerId: global.currentUserId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStarGiftCollections', async (global, actions, payload) => {
  const {
    peerId,
    hash
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGiftCollections', {
    peer,
    hash
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updatePeerStarGiftCollections)(global, peerId, result.collections);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('openGiftAuctionAcquiredModal', async (global, actions, payload) => {
  const {
    giftId,
    giftTitle,
    giftSticker,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStarGiftAuctionAcquiredGifts', {
    giftId
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    giftAuctionAcquiredModal: {
      giftId,
      giftTitle,
      giftSticker,
      acquiredGifts: result.gifts
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/api/statistics.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/api/statistics.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStatistics', async (global, actions, payload) => {
  const {
    chatId,
    isGroup,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)(isGroup ? 'fetchGroupStatistics' : 'fetchChannelStatistics', {
    chat,
    dcId: fullInfo.statisticsDcId
  });
  if (!result) {
    return;
  }
  const {
    stats
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStatistics)(global, chatId, stats, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (stats.type === 'channel') {
    const messageInteractions = stats.recentPosts.filter(post => post.type === 'message');
    const storyInteractions = stats.recentPosts.filter(post => post.type === 'story');
    if (messageInteractions.length > 0) {
      actions.loadMessagesById({
        chatId,
        messageIds: messageInteractions.map(interaction => interaction.msgId)
      });
    }
    if (storyInteractions.length > 0) {
      actions.loadPeerStoriesByIds({
        peerId: chatId,
        storyIds: storyInteractions.map(interaction => interaction.storyId)
      });
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadChannelMonetizationStatistics', async (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId);
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, peerId);
  if (!peer) {
    return;
  }
  const dcId = chatFullInfo?.statisticsDcId;
  const stats = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchChannelMonetizationStatistics', {
    peer,
    dcId
  });
  if (!stats) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateChannelMonetizationStatistics)(global, stats, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadMessageStatistics', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  let result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMessageStatistics', {
    chat,
    messageId,
    dcId
  });
  if (!result) {
    result = {};
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const {
    viewsCount,
    forwardsCount,
    reactions
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessages)(global, chatId)[messageId] || {};
  result.viewsCount = viewsCount;
  result.forwardsCount = forwardsCount;
  result.reactionsCount = reactions?.results ? reactions?.results.reduce((acc, reaction) => acc + reaction.count, 0) : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMessageStatistics)(global, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  actions.loadMessagePublicForwards({
    chatId,
    messageId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadMessagePublicForwards', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const stats = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).statistics.currentMessage || {};
  if (stats?.publicForwards && !stats.nextOffset) return;
  const publicForwards = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMessagePublicForwards', {
    chat,
    messageId,
    dcId,
    offset: stats.nextOffset
  });
  const {
    forwards,
    nextOffset,
    count
  } = publicForwards || {};
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMessageStatistics)(global, {
    ...stats,
    publicForwards: count || forwards?.length,
    publicForwardsData: (stats.publicForwardsData || []).concat(forwards || []),
    nextOffset
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStatisticsAsyncGraph', async (global, actions, payload) => {
  const {
    chatId,
    token,
    name,
    isPercentage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchStatisticsAsyncGraph', {
    token,
    dcId,
    isPercentage
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStatisticsGraph)(global, chatId, name, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStoryStatistics', async (global, actions, payload) => {
  const {
    chatId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  let result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchStoryStatistics', {
    chat,
    storyId,
    dcId
  });
  if (!result) {
    result = {};
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerStory)(global, chatId, storyId);
  const {
    forwardsCount = 0,
    viewsCount = 0,
    reactionsCount = 0
  } = story && 'views' in story && story.views ? story.views : {};
  result.viewsCount = viewsCount;
  result.forwardsCount = forwardsCount;
  result.reactionsCount = reactionsCount;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStoryStatistics)(global, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  actions.loadStoryPublicForwards({
    chatId,
    storyId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStoryPublicForwards', async (global, actions, payload) => {
  const {
    chatId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const stats = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).statistics.currentStory || {};
  if (stats?.publicForwards && !stats.nextOffset) return;
  const {
    publicForwards,
    count,
    nextOffset
  } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchStoryPublicForwards', {
    chat,
    storyId,
    dcId,
    offset: stats.nextOffset
  })) || {};
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStoryStatistics)(global, {
    ...stats,
    publicForwards: count || publicForwards?.length,
    publicForwardsData: (stats.publicForwardsData || []).concat(publicForwards || []),
    nextOffset
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('processMonetizationRevenueWithdrawalUrl', async (global, actions, payload) => {
  const {
    peerId,
    currentPassword,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateVerifyMonetizationModal)(global, {
    isLoading: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMonetizationRevenueWithdrawalUrl', {
    peer,
    currentPassword
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateVerifyMonetizationModal)(global, {
    isLoading: false,
    errorKey: 'error' in result ? result.messageKey : undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if ('url' in result) {
    actions.openUrl({
      url: result.url,
      tabId,
      ignoreDeepLinks: true
    });
    actions.closeMonetizationVerificationModal({
      tabId
    });
  }
});

/***/ }),

/***/ "./src/global/actions/api/stories.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/api/stories.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_stories__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors/stories */ "./src/global/selectors/stories.ts");











const INFINITE_LOOP_MARKER = 100;
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadAllStories', async global => {
  let i = 0;
  while (global.stories.hasNext) {
    if (i++ >= INFINITE_LOOP_MARKER) {
      if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('`actions/loadAllStories`: Infinite loop detected');
      }
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const {
      stateHash,
      hasNext
    } = global.stories;
    if (stateHash && !hasNext) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAllStories', {
      isFirstRequest: !stateHash,
      stateHash
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global.stories.stateHash = result.state;
    if ('peerStories' in result) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeersWithStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStealthMode)(global, result.stealthMode);
      global.stories.hasNext = result.hasMore;
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadAllHiddenStories', async global => {
  let i = 0;
  while (global.stories.hasNextInArchive) {
    if (i++ >= INFINITE_LOOP_MARKER) {
      if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('`actions/loadAllHiddenStories`: Infinite loop detected');
      }
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const {
      archiveStateHash,
      hasNextInArchive
    } = global.stories;
    if (archiveStateHash && !hasNextInArchive) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAllStories', {
      isFirstRequest: !archiveStateHash,
      stateHash: archiveStateHash,
      isHidden: true
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global.stories.archiveStateHash = result.state;
    if ('peerStories' in result) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeersWithStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStealthMode)(global, result.stealthMode);
      global.stories.hasNextInArchive = result.hasMore;
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerSkippedStories', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || !peerStories) {
    return;
  }
  const skippedStoryIds = Object.values(peerStories.byId).reduce((acc, story) => {
    if (!('content' in story)) {
      acc.push(story.id);
    }
    return acc;
  }, []);
  if (skippedStoryIds.length === 0) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
    peer,
    ids: skippedStoryIds
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('viewStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  if (!peer || !story || !('content' in story)) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLastViewedStoryForPeer)(global, peerId, storyId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)();
  if (story.expireDate < serverTime && story.isInProfile) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('viewStory', {
      peer,
      storyId
    });
  }
  const isUnread = (global.stories.byPeerId[peerId].lastReadId || 0) < story.id;
  if (!isUnread) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('markStoryRead', {
    peer,
    storyId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLastReadStoryForPeer)(global, peerId, storyId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('deleteStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('deleteStory', {
    peer,
    storyId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.removePeerStory)(global, peerId, storyId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoryInProfile', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    isInProfile
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  const currentIsPinned = story && 'content' in story ? story.isInProfile : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStory)(global, peerId, storyId, {
    isInProfile
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerProfileStory)(global, peerId, storyId, isInProfile);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleStoryInProfile', {
    peer,
    storyId,
    isInProfile
  });
  if (!result?.length) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStory)(global, peerId, storyId, {
      isInProfile: currentIsPinned
    });
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerProfileStory)(global, peerId, storyId, currentIsPinned);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoryPinnedToTop', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || !peerStories) {
    return;
  }
  const oldPinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPinnedStories)(global, peerId)?.map(s => s.id) || [];
  const isRemoving = oldPinnedIds.includes(storyId);
  const newPinnedIds = isRemoving ? oldPinnedIds.filter(id => id !== storyId) : [...oldPinnedIds, storyId];
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = {
    ...global,
    stories: {
      ...global.stories,
      byPeerId: {
        ...global.stories.byPeerId,
        [peerId]: {
          ...peerStories,
          pinnedIds: newPinnedIds.sort((a, b) => b - a)
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleStoryPinnedToTop', {
    peer,
    storyIds: newPinnedIds
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = {
      ...global,
      stories: {
        ...global.stories,
        byPeerId: {
          ...global.stories.byPeerId,
          [peerId]: {
            ...peerStories,
            pinnedIds: oldPinnedIds
          }
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerStories', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStories', {
    peer
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories);
  if (result.lastReadStoryId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLastReadStoryForPeer)(global, peerId, result.lastReadStoryId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerProfileStories', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId,
    offsetId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  let peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || peerStories?.isFullyLoaded) {
    return;
  }
  const selectedAlbumId = (0,_selectors_stories__WEBPACK_IMPORTED_MODULE_10__.selectActiveStoriesCollectionId)(global, tabId);
  if (selectedAlbumId !== 'all') {
    let albumData = peerStories?.idsByAlbumId?.[selectedAlbumId];
    if (albumData?.isFullyLoaded) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAlbumStories', {
      peer,
      albumId: selectedAlbumId,
      offset: offsetId || 0
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds, false, selectedAlbumId);
    peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
    albumData = peerStories?.idsByAlbumId?.[selectedAlbumId];
    if (Object.values(result.stories).length === 0 || albumData?.ids?.length && albumData.ids.length >= result.count) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesFullyLoaded)(global, peerId, true, false, selectedAlbumId);
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerProfileStories', {
    peer,
    offsetId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (Object.values(result.stories).length === 0 || peerStories?.profileIds?.length && peerStories?.profileIds.length >= result.count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesFullyLoaded)(global, peerId, true);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoriesArchive', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId,
    offsetId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  let peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || peerStories?.isArchiveFullyLoaded) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoriesArchive', {
    peer,
    offsetId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, undefined, true);
  peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (Object.values(result.stories).length === 0 || peerStories?.archiveIds?.length && peerStories?.archiveIds.length >= result.count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesFullyLoaded)(global, peerId, true, true);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerStoriesByIds', async (global, actions, payload) => {
  const {
    peerId,
    storyIds
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
    peer,
    ids: storyIds
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoryViews', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoriesViews', {
    peer,
    storyIds: [storyId]
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoryViews)(global, peerId, storyId, result.views);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoryViewList', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    offset,
    areReactionsFirst,
    areJustContacts,
    query,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStoryViewsLoading)(global, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoryViewList', {
    peer,
    storyId,
    offset,
    areReactionsFirst,
    areJustContacts,
    limit,
    query
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStoryViewsLoading)(global, false, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStoryViews)(global, storyId, result.views, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('reportStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    description = '',
    option = '',
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const response = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('reportStory', {
    peer,
    storyId,
    description,
    option
  });
  if (!response) return;
  const {
    result,
    error
  } = response;
  if (error === _config__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_ID_REQUIRED_ERROR) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate)('lng_report_please_select_messages'),
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (!result) return;
  if (result.type === 'reported') {
    actions.showNotification({
      message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
      reportModal: {
        messageIds: [storyId],
        subject: 'story',
        peerId,
        description,
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
  if (result.type === 'comment') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      isOptional: result.isOptional,
      option: result.option,
      title: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
      reportModal: {
        messageIds: [storyId],
        description,
        peerId,
        subject: 'story',
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('editStoryPrivacy', (global, actions, payload) => {
  const {
    peerId,
    storyId,
    privacy
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const allowedIds = [...privacy.allowUserIds, ...privacy.allowChatIds];
  const blockedIds = [...privacy.blockUserIds, ...privacy.blockChatIds];
  const inputPrivacy = (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.buildApiInputPrivacyRules)(global, {
    visibility: privacy.visibility,
    isUnspecified: privacy.isUnspecified,
    allowedIds,
    blockedIds,
    botsPrivacy: 'none'
  });
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('editStoryPrivacy', {
    peer,
    id: storyId,
    privacy: inputPrivacy
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoriesHidden', async (global, actions, payload) => {
  const {
    peerId,
    isHidden
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleStoriesHidden', {
    peer,
    isHidden
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesHidden)(global, peerId, isHidden);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoriesMaxIds', async (global, actions, payload) => {
  const {
    peerIds
  } = payload;
  const peers = peerIds.map(peerId => (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId)).filter(Boolean);
  if (!peers.length) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoriesMaxIds', {
    peers
  });
  if (!result) return;
  const peerIdsToLoad = [];
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  result.forEach((maxId, i) => {
    const peer = peers[i];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeer)(global, peer.id, {
      maxStoryId: maxId.maxId,
      hasStories: Boolean(maxId.maxId)
    });
    if (maxId.maxId && maxId.maxId > 0) {
      peerIdsToLoad.push(peer.id);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  peerIdsToLoad?.forEach(peerId => actions.loadPeerStories({
    peerId
  }));
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('sendStoryReaction', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    containerId,
    reaction,
    shouldAddToRecent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  if (!story || !('content' in story)) return;
  const previousReaction = story.sentReaction;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateSentStoryReaction)(global, peerId, storyId, reaction);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  if (reaction) {
    actions.startActiveReaction({
      containerId,
      reaction,
      tabId
    });
  } else {
    actions.stopActiveReaction({
      containerId,
      tabId
    });
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('sendStoryReaction', {
    peer,
    storyId,
    reaction,
    shouldAddToRecent
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateSentStoryReaction)(global, peerId, storyId, previousReaction);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('activateStealthMode', (global, actions, payload) => {
  const {
    isForPast = true,
    isForFuture = true
  } = payload || {};
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('activateStealthMode', {
    isForPast: isForPast || true,
    isForFuture: isForFuture || true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoryAlbums', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const albums = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAlbums', {
    peer
  });
  if (!albums) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = {
    ...global,
    stories: {
      ...global.stories,
      albumsByPeerId: {
        ...global.stories.albumsByPeerId,
        [peerId]: albums
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('selectStoryAlbum', (global, actions, payload) => {
  const {
    peerId,
    albumId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (albumId && peerId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesFullyLoaded)(global, peerId, false);
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    selectedStoryAlbumId: albumId || undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  actions.loadPeerProfileStories({
    peerId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadAlbumStories', async (global, actions, payload) => {
  const {
    peerId,
    albumId,
    offsetId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAlbumStories', {
    peer,
    albumId,
    offset: offsetId || 0
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('resetSelectedStoryAlbum', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    selectedStoryAlbumId: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/api/symbols.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/api/symbols.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_searchWords__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/searchWords */ "./src/util/searchWords.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_limits__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../selectors/limits */ "./src/global/selectors/limits.ts");













const ADDED_SETS_THROTTLE = 200;
const ADDED_SETS_THROTTLE_CHUNK = 10;
const searchThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickerSets', async (global, actions) => {
  const [addedStickers, addedCustomEmojis] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickerSets', {
    hash: global.stickers.added.hash
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCustomEmojiSets', {
    hash: global.customEmojis.added.hash
  })]);
  if (!addedCustomEmojis || !addedStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'added', addedStickers.hash, addedStickers.sets);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateCustomEmojiSets)(global, addedCustomEmojis.hash, addedCustomEmojis.sets);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  actions.loadCustomEmojis({
    ids: global.recentCustomEmojis
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAddedStickers', async (global, actions) => {
  const {
    added: {
      setIds: addedSetIds = []
    },
    setsById: cached
  } = global.stickers;
  const {
    added: {
      setIds: customEmojiSetIds = []
    }
  } = global.customEmojis;
  const setIdsToLoad = [...addedSetIds, ...customEmojiSetIds];
  if (!setIdsToLoad.length) {
    return;
  }
  for (let i = 0; i < setIdsToLoad.length; i++) {
    const id = setIdsToLoad[i];
    if (cached[id]?.stickers) {
      continue; // Already loaded
    }
    actions.loadStickers({
      stickerSetInfo: {
        id,
        accessHash: cached[id].accessHash
      }
    });
    if (i % ADDED_SETS_THROTTLE_CHUNK === 0 && i > 0) {
      await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.pause)(ADDED_SETS_THROTTLE);
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRecentStickers', global => {
  const {
    hash
  } = global.stickers.recent || {};
  void loadRecentStickers(global, hash);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFavoriteStickers', async global => {
  const {
    hash
  } = global.stickers.favorite || {};
  const favoriteStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFavoriteStickers', {
    hash
  });
  if (!favoriteStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      favorite: favoriteStickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPremiumStickers', async global => {
  const {
    hash
  } = global.stickers.premium || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserFrozen)(global)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
    emoji: '',
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      premium: {
        hash: result.hash,
        stickers: result.stickers
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGreetingStickers', async global => {
  const {
    hash
  } = global.stickers.greeting || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserFrozen)(global)) {
    return;
  }
  const greeting = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
    emoji: '',
    hash
  });
  if (!greeting) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      greeting: {
        hash: greeting.hash,
        stickers: greeting.stickers.filter(sticker => sticker.emoji === '')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFeaturedStickers', async global => {
  const {
    hash
  } = global.stickers.featured || {};
  const featuredStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFeaturedStickers', {
    hash
  });
  if (!featuredStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'featured', featuredStickers.hash, featuredStickers.sets);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPremiumGifts', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchPremiumGifts');
  if (!stickerSet) {
    return;
  }
  const {
    set,
    stickers
  } = stickerSet;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    premiumGifts: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadTonGifts', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchTonGifts');
  if (!stickerSet) {
    return;
  }
  const {
    set,
    stickers
  } = stickerSet;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    tonGifts: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadDefaultTopicIcons', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchDefaultTopicIcons');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  const fullSet = {
    ...set,
    stickers
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, fullSet.id, fullSet);
  global = {
    ...global,
    defaultTopicIconsId: fullSet.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadDefaultStatusIcons', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchDefaultStatusEmojis');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  const fullSet = {
    ...set,
    stickers
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, fullSet.id, fullSet);
  global = {
    ...global,
    defaultStatusIconsId: fullSet.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadUserCollectibleStatuses', async (global, actions) => {
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const {
    hash
  } = global.collectibleEmojiStatuses || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCollectibleEmojiStatuses', {
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    collectibleEmojiStatuses: {
      hash: result.hash,
      statuses: result.statuses
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const documentIds = result.statuses.map(({
    documentId
  }) => documentId);
  actions.loadCustomEmojis({
    ids: documentIds
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickers', (global, actions, payload) => {
  const {
    stickerSetInfo
  } = payload;
  const cachedSet = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo);
  if (cachedSet && cachedSet.count === cachedSet?.stickers?.length) return; // Already fully loaded
  void loadStickers(global, actions, stickerSetInfo);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAnimatedEmojis', async global => {
  const [emojis, effects] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchAnimatedEmojis'), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchAnimatedEmojiEffects')]);
  if (!emojis || !effects) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceAnimatedEmojis)(global, {
    ...emojis.set,
    stickers: emojis.stickers
  });
  global = {
    ...global,
    animatedEmojiEffects: {
      ...effects.set,
      stickers: effects.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadBirthdayNumbersStickers', async global => {
  const emojis = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
    stickerSetInfo: {
      shortName: _config__WEBPACK_IMPORTED_MODULE_0__.BIRTHDAY_NUMBERS_SET
    }
  });
  if (!emojis) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    birthdayNumbers: {
      ...emojis.set,
      stickers: emojis.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRestrictedEmojiStickers', async global => {
  const emojis = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
    stickerSetInfo: {
      shortName: _config__WEBPACK_IMPORTED_MODULE_0__.RESTRICTED_EMOJI_SET
    }
  });
  if (!emojis) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    restrictedEmoji: {
      ...emojis.set,
      stickers: emojis.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGenericEmojiEffects', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchGenericEmojiEffects');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  global = {
    ...global,
    genericEmojiEffects: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadSavedGifs', async global => {
  const {
    hash
  } = global.gifs.saved;
  const savedGifs = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchSavedGifs', {
    hash
  });
  if (!savedGifs) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    gifs: {
      ...global.gifs,
      saved: savedGifs
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('saveGif', async (global, actions, payload) => {
  const {
    gif,
    shouldUnsave,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const length = global.gifs.saved.gifs?.length;
  const limit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectCurrentLimit)(global, 'savedGifs');
  const premiumLimit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectPremiumLimit)(global, 'savedGifs');
  const isPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserPremium)(global);
  if (!shouldUnsave && length && length >= limit) {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifs', limit.toString()),
      message: isPremium ? _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifsSubtitlePremium') : _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifsSubtitle', premiumLimit.toString()),
      ...(!isPremium && {
        action: {
          action: 'openPremiumModal',
          payload: {
            tabId
          }
        }
      }),
      className: 'bold-link',
      tabId
    });
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('saveGif', {
    gif,
    shouldUnsave
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const gifs = global.gifs.saved.gifs?.filter(({
    id
  }) => id !== gif.id) || [];
  const newGifs = shouldUnsave ? gifs : [gif, ...gifs];
  global = {
    ...global,
    gifs: {
      ...global.gifs,
      saved: {
        ...global.gifs.saved,
        gifs: newGifs
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('faveSticker', (global, actions, payload) => {
  const {
    sticker,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const current = global.stickers.favorite.stickers.length;
  const limit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectCurrentLimit)(global, 'stickersFaved');
  const premiumLimit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectPremiumLimit)(global, 'stickersFaved');
  const isPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserPremium)(global);
  if (current >= limit) {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickers', limit.toString()),
      message: isPremium ? _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickersSubtitlePremium') : _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickersSubtitle', premiumLimit.toString()),
      ...(!isPremium && {
        action: {
          action: 'openPremiumModal',
          payload: {
            tabId
          }
        }
      }),
      className: 'bold-link',
      tabId
    });
  }
  if (sticker) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('faveSticker', {
      sticker
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('unfaveSticker', (global, actions, payload) => {
  const {
    sticker
  } = payload;
  if (sticker) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();

    // Remove sticker preemptively to get instant feedback when user removes sticker
    // from favorites while in Sticker Picker
    global = {
      ...global,
      stickers: {
        ...global.stickers,
        favorite: {
          ...global.stickers.favorite,
          stickers: global.stickers.favorite.stickers.filter(({
            id
          }) => id !== sticker.id)
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('faveSticker', {
      sticker,
      unfave: true
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('removeRecentSticker', async (global, actions, payload) => {
  const {
    sticker
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('removeRecentSticker', {
    sticker
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  loadRecentStickers(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearRecentStickers', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('clearRecentStickers');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      recent: {
        stickers: []
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleStickerSet', (global, actions, payload) => {
  const {
    stickerSetId
  } = payload;
  const stickerSet = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetId);
  if (!stickerSet) {
    return;
  }
  const {
    accessHash,
    installedDate,
    isArchived
  } = stickerSet;
  const isInstalled = !isArchived && Boolean(installedDate);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)(!isInstalled ? 'installStickerSet' : 'uninstallStickerSet', {
    stickerSetId,
    accessHash
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadEmojiKeywords', async (global, actions, payload) => {
  const {
    language
  } = payload;
  let currentEmojiKeywords = global.emojiKeywords[language];
  if (currentEmojiKeywords?.isLoading) {
    return;
  }
  global = {
    ...global,
    emojiKeywords: {
      ...global.emojiKeywords,
      [language]: {
        ...currentEmojiKeywords,
        isLoading: true
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const emojiKeywords = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchEmojiKeywords', {
    language,
    fromVersion: currentEmojiKeywords ? currentEmojiKeywords.version : 0
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  currentEmojiKeywords = global.emojiKeywords[language];
  if (!emojiKeywords) {
    global = {
      ...global,
      emojiKeywords: {
        ...global.emojiKeywords,
        [language]: {
          ...currentEmojiKeywords,
          isLoading: false
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    return;
  }
  global = {
    ...global,
    emojiKeywords: {
      ...global.emojiKeywords,
      [language]: {
        isLoading: false,
        version: emojiKeywords.version,
        keywords: {
          ...currentEmojiKeywords?.keywords,
          ...emojiKeywords.keywords
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
async function loadRecentStickers(global, hash) {
  const recentStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchRecentStickers', {
    hash
  });
  if (!recentStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      recent: recentStickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}
async function loadStickers(global, actions, stickerSetInfo) {
  let stickerSet;
  try {
    stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
      stickerSetInfo
    });
  } catch (error) {
    if (error.message === 'STICKERSET_INVALID') {
      Object.values(global.byTabId).forEach(({
        id: tabId
      }) => {
        actions.showNotification({
          message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate)('StickerPack.ErrorNotFound'),
          tabId
        });
        if ('shortName' in stickerSetInfo && (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).openedStickerSetShortName === stickerSetInfo.shortName) {
          global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
            openedStickerSetShortName: undefined
          }, tabId);
          (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        }
      });
      return;
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!stickerSet) {
    // TODO handle this case when sticker cache is implemented
    return;
  }
  const {
    set,
    stickers,
    packs
  } = stickerSet;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, set.id, {
    ...set,
    stickers,
    packs
  });
  const currentEmoji = global.stickers.forEmoji.emoji;
  if (currentEmoji && packs[currentEmoji]) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.rebuildStickersForEmoji)(global);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setStickerSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (query) {
    void searchThrottled(async () => {
      const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchStickers', {
        query
      });
      if (!result) {
        return;
      }
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      const {
        setsById,
        added
      } = global.stickers;
      const resultIds = result.sets.map(({
        id
      }) => id);
      if (added.setIds) {
        added.setIds.forEach(id => {
          if (!resultIds.includes(id)) {
            const {
              title
            } = setsById[id] || {};
            if (title && (0,_util_searchWords__WEBPACK_IMPORTED_MODULE_5__["default"])(title, query)) {
              resultIds.unshift(id);
            }
          }
        });
      }
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'search', result.hash, result.sets);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSearch)(global, result.hash, resultIds, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setGifSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (typeof query === 'string') {
    void searchThrottled(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      searchGifs(global, query, global.config?.gifSearchUsername, undefined, tabId);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('searchMoreGifs', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    query,
    offset
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).gifSearch;
  if (typeof query === 'string') {
    void searchThrottled(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      searchGifs(global, query, global.config?.gifSearchUsername, offset, tabId);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickersForEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  const {
    hash
  } = global.stickers.forEmoji;
  void searchThrottled(async () => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      stickers: {
        ...global.stickers,
        forEmoji: {
          ...global.stickers.forEmoji,
          emoji
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
      emoji,
      hash
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    if (!result || global.stickers.forEmoji.emoji !== emoji) {
      return;
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickersForEmoji)(global, emoji, result.stickers, result.hash);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearStickersForEmoji', global => {
  return {
    ...global,
    stickers: {
      ...global.stickers,
      forEmoji: {}
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadCustomEmojiForEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateCustomEmojiForEmoji)(global, emoji);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearCustomEmojiForEmoji', global => {
  return {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      forEmoji: {}
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFeaturedEmojiStickers', async global => {
  const featuredStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFeaturedEmojiStickers', {});
  if (!featuredStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      featuredIds: featuredStickers.sets.map(({
        id
      }) => id),
      byId: {
        ...global.customEmojis.byId,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(featuredStickers.sets.flatMap(set => set.stickers || []), 'id')
      }
    },
    stickers: {
      ...global.stickers,
      setsById: {
        ...global.stickers.setsById,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(featuredStickers.sets, 'id')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('openStickerSet', async (global, actions, payload) => {
  const {
    stickerSetInfo,
    shouldIgnoreCache,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (shouldIgnoreCache || !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo)) {
    await loadStickers(global, actions, stickerSetInfo);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const set = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo);
  if (!set?.shortName) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    openedStickerSetShortName: set.shortName
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRecentEmojiStatuses', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchRecentEmojiStatuses');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateRecentStatusCustomEmojis)(global, result.hash, result.emojiStatuses);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
async function searchGifs(global, query, botUsername, offset, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()]) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchGifs', {
    query,
    offset,
    username: botUsername
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateGifSearch)(global, !offset, result.gifs, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}

/***/ }),

/***/ "./src/global/actions/api/sync.ts":
/*!****************************************!*\
  !*** ./src/global/actions/api/sync.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const RELEASE_STATUS_TIMEOUT = 15000; // 15 sec;

let releaseStatusTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('sync', (global, actions) => {
  if (_config__WEBPACK_IMPORTED_MODULE_2__.DEBUG) {
    // eslint-disable-next-line no-console
    console.log('>>> START SYNC');
  }
  if (releaseStatusTimeout) {
    clearTimeout(releaseStatusTimeout);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    isSyncing: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);

  // Workaround for `isSyncing = true` sometimes getting stuck for some reason
  releaseStatusTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      isSyncing: false
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    releaseStatusTimeout = undefined;
  }, RELEASE_STATUS_TIMEOUT);
  const {
    loadAllChats,
    preloadTopChatMessages
  } = actions;
  (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_3__.init)();
  loadAllChats({
    listType: 'active',
    whenFirstBatchDone: async () => {
      await loadAndReplaceMessages(global, actions);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      global = {
        ...global,
        isSyncing: false,
        isSynced: true,
        isFetchingDifference: false
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
      if (_config__WEBPACK_IMPORTED_MODULE_2__.DEBUG) {
        // eslint-disable-next-line no-console
        console.log('>>> FINISH SYNC');
      }
      loadAllChats({
        listType: 'archived'
      });
      preloadTopChatMessages();
    }
  });
});
async function loadAndReplaceMessages(global, actions) {
  let areMessagesLoaded = false;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  let wasReset = false;

  // Memoize drafts
  const draftChatIds = Object.keys(global.messages.byChatId);
  const draftsByChatId = draftChatIds.reduce((acc, chatId) => {
    acc[chatId] = Object.keys(global.messages.byChatId[chatId].threadsById).reduce((acc2, threadId) => {
      acc2[Number(threadId)] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.omitUndefined)({
        draft: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectDraft)(global, chatId, Number(threadId)),
        editingId: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectEditingId)(global, chatId, Number(threadId)),
        editingDraft: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectEditingDraft)(global, chatId, Number(threadId))
      });
      return acc2;
    }, {});
    return acc;
  }, {});

  // Memoize last messages
  const lastMessages = Object.entries(global.chats.lastMessageIds.all || {}).map(([chatId, messageId]) => (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, chatId, Number(messageId))).filter(Boolean);
  const savedLastMessages = Object.values(global.chats.lastMessageIds.saved || {}).map(messageId => (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, global.currentUserId, Number(messageId))).filter(Boolean);

  // Memoize thread infos for last messages
  const lastMessagesThreadInfos = [];
  lastMessages.forEach(message => {
    const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadInfo)(global, message.chatId, message.id);
    if (threadInfo) {
      lastMessagesThreadInfos.push({
        chatId: message.chatId,
        messageId: message.id,
        threadInfo
      });
    }
  });
  for (const {
    id: tabId
  } of Object.values(global.byTabId)) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    const {
      chatId: currentChatId,
      threadId: currentThreadId
    } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
    const activeThreadId = currentThreadId || _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID;
    const threadInfo = currentChatId && currentThreadId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadInfo)(global, currentChatId, currentThreadId) : undefined;
    const currentChat = currentChatId ? global.chats.byId[currentChatId] : undefined;
    if (currentChatId && currentChat) {
      const [result, resultDiscussion] = await Promise.all([loadTopMessages(global, currentChatId, activeThreadId), activeThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID && !currentChat.isForum && !(0,_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(currentChat.id, activeThreadId, global.currentUserId) ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchDiscussionMessage', {
        chat: currentChat,
        messageId: Number(activeThreadId)
      }) : undefined]);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      const {
        chatId: newCurrentChatId
      } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
      if (result && newCurrentChatId === currentChatId) {
        const currentChatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessages)(global, currentChatId);
        const localMessages = currentChatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID ? global.serviceNotifications.filter(({
          isDeleted
        }) => !isDeleted).map(({
          message
        }) => message) : [];
        const topics = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTopics)(global, currentChatId);
        const topicLastMessages = topics ? Object.values(topics).map(({
          lastMessageId
        }) => currentChatMessages[lastMessageId]).filter(Boolean) : [];
        const resultMessageIds = result.messages.map(({
          id
        }) => id);
        const messagesThreadInfos = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pick)(global.messages.byChatId[currentChatId].threadsById, resultMessageIds);
        const isDiscussionStartLoaded = !result.messages.length || result.messages.some(({
          id
        }) => id === resultDiscussion?.firstMessageId);
        const threadStartMessages = isDiscussionStartLoaded && resultDiscussion?.topMessages || [];
        const allMessages = threadStartMessages.concat(result.messages, localMessages);
        const allMessagesWithTopicLastMessages = allMessages.concat(topicLastMessages);
        const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(allMessagesWithTopicLastMessages, 'id');
        const listedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(allMessages.map(({
          id
        }) => id));
        if (!wasReset) {
          global = {
            ...global,
            messages: {
              ...global.messages,
              byChatId: {}
            }
          };
          Object.values(global.byTabId).forEach(({
            id: otherTabId
          }) => {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
              tabThreads: {}
            }, otherTabId);
          });
          wasReset = true;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChatMessagesById)(global, currentChatId, byId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateListedIds)(global, currentChatId, activeThreadId, listedIds);
        Object.entries(messagesThreadInfos).forEach(([id, thread]) => {
          if (!thread?.threadInfo) return;
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, currentChatId, id, thread.threadInfo);
        });
        if (threadInfo && !threadInfo.isCommentsInfo && activeThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, currentChatId, activeThreadId, {
            ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pick)(threadInfo, ['fromChannelId', 'fromMessageId'])
          });
        }
        Object.values(global.byTabId).forEach(({
          id: otherTabId
        }) => {
          const {
            chatId: otherChatId,
            threadId: otherThreadId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, otherTabId) || {};
          if (otherChatId === currentChatId && otherThreadId === activeThreadId) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.safeReplaceViewportIds)(global, currentChatId, activeThreadId, listedIds, otherTabId);
          }
        });
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.chats, 'id'));
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
        areMessagesLoaded = true;
      }
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    if (currentChat?.isForum) {
      actions.loadTopics({
        chatId: currentChatId,
        force: true
      });
      if (currentThreadId && currentThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID) {
        actions.loadTopicById({
          chatId: currentChatId,
          topicId: Number(currentThreadId),
          shouldCloseChatOnError: true
        });
      }
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!areMessagesLoaded) {
    global = {
      ...global,
      messages: {
        ...global.messages,
        byChatId: {}
      }
    };
    Object.values(global.byTabId).forEach(({
      id: otherTabId
    }) => {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
        tabThreads: {}
      }, otherTabId);
    });
  }

  // Restore drafts

  Object.keys(draftsByChatId).forEach(chatId => {
    const threads = draftsByChatId[chatId];
    Object.keys(threads).forEach(threadId => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThread)(global, chatId, Number(threadId), draftsByChatId[chatId][Number(threadId)]);
    });
  });

  // Restore thread infos
  lastMessagesThreadInfos.forEach(({
    chatId,
    messageId,
    threadInfo
  }) => {
    const memoThreadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadInfo)(global, chatId, messageId);
    if (!memoThreadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, chatId, String(messageId), threadInfo);
    }
  });

  // Restore last messages
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addMessages)(global, lastMessages);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addMessages)(global, savedLastMessages);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  Object.values(global.byTabId).forEach(({
    id: tabId
  }) => {
    const {
      chatId: audioChatId,
      messageId: audioMessageId
    } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).audioPlayer;
    if (audioChatId && audioMessageId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, audioChatId, audioMessageId)) {
      actions.closeAudioPlayer({
        tabId
      });
    }
  });
}
function loadTopMessages(global, chatId, threadId) {
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, realChatId);
  return (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchMessages', {
    chat,
    threadId,
    offsetId: !isSavedDialog ? chat.lastReadInboxMessageId : undefined,
    addOffset: -(Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) + 1),
    limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE,
    isSavedDialog
  });
}
let previousGlobal;
// RAF can be unreliable when device goes into sleep mode, so sync logic is handled outside any component
(0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__.addCallback)(global => {
  const {
    connectionState,
    auth,
    isSynced
  } = global;
  const {
    isMasterTab
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global);
  if (!isMasterTab || isSynced || previousGlobal?.connectionState === connectionState && previousGlobal?.auth.state === auth.state) {
    previousGlobal = global;
    return;
  }
  if (connectionState === 'connectionStateReady' && auth.state === 'authorizationStateReady') {
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.getActions)().sync();
  }
  previousGlobal = global;
});

/***/ }),

/***/ "./src/global/actions/api/twoFaSettings.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/api/twoFaSettings.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadPasswordInfo', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('getPasswordInfo');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.replaceSettings)(global, {
    hasPassword: result.hasPassword
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    hint: result.hint
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('checkPassword', async (global, actions, payload) => {
  const {
    currentPassword,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('checkPassword', currentPassword);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('clearPassword', async (global, actions, payload) => {
  const {
    currentPassword,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('clearPassword', currentPassword);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updatePassword', async (global, actions, payload) => {
  const {
    currentPassword,
    password,
    hint,
    email,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('updatePassword', currentPassword, password, hint, email);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateRecoveryEmail', async (global, actions, payload) => {
  const {
    currentPassword,
    email,
    onSuccess,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    recoveryEmail: email
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('updateRecoveryEmail', currentPassword, email);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false,
    waitingEmailCodeLength: undefined
  });
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    recoveryEmail: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('provideTwoFaEmailCode', (global, actions, payload) => {
  const {
    code
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('provideRecoveryEmailCode', code);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('clearTwoFaError', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    errorKey: undefined
  });
});

/***/ }),

/***/ "./src/global/actions/api/users.ts":
/*!*****************************************!*\
  !*** ./src/global/actions/api/users.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");














const PROFILE_PHOTOS_FIRST_LOAD_LIMIT = 10;
const TOP_PEERS_REQUEST_COOLDOWN = 60; // 1 min
const runThrottledForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_6__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadFullUser', async (global, actions, payload) => {
  const {
    userId,
    withPhotos
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const {
    id,
    accessHash
  } = user;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchFullUser', {
    id,
    accessHash
  });
  if (!result?.user) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUserFullInfo)(global, userId);
  const {
    user: newUser,
    fullInfo: newFullInfo
  } = result;
  const profilePhotos = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPeerPhotos)(global, userId);
  const hasChangedAvatar = user.avatarPhotoId !== newUser.avatarPhotoId;
  const hasChangedProfilePhoto = fullInfo?.profilePhoto?.id !== newFullInfo?.profilePhoto?.id;
  const hasChangedFallbackPhoto = fullInfo?.fallbackPhoto?.id !== newFullInfo?.fallbackPhoto?.id;
  const hasChangedPersonalPhoto = fullInfo?.personalPhoto?.id !== newFullInfo?.personalPhoto?.id;
  const hasChangedPhoto = hasChangedAvatar || hasChangedProfilePhoto || hasChangedFallbackPhoto || hasChangedPersonalPhoto;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUser)(global, userId, result.user);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserFullInfo)(global, userId, result.fullInfo);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.chats, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.addUserStatuses)(global, result.userStatusesById);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  if (withPhotos || profilePhotos?.count && hasChangedPhoto) {
    actions.loadMoreProfilePhotos({
      peerId: userId,
      shouldInvalidateCache: true
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadUser', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchUsers', {
    users: [user]
  });
  if (!result) {
    return;
  }
  const {
    users,
    userStatusesById
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.replaceUserStatuses)(global, {
    ...global.users.statusesById,
    ...userStatusesById
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadTopUsers', async global => {
  const {
    topPeers: {
      lastRequestedAt
    }
  } = global;
  if (!(!lastRequestedAt || (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)() - lastRequestedAt > TOP_PEERS_REQUEST_COOLDOWN)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchTopUsers');
  if (!result) {
    return;
  }
  const {
    ids
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = {
    ...global,
    topPeers: {
      ...global.topPeers,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadContactList', async global => {
  const contactList = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchContactList');
  if (!contactList) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.addUserStatuses)(global, contactList.userStatusesById);

  // Sort contact list by Last Name (or First Name), with latin names being placed first
  const getCompareString = user => user.lastName || user.firstName || '';
  const collator = new Intl.Collator('en-US');
  const sortedUsers = contactList.users.sort((a, b) => collator.compare(getCompareString(a), getCompareString(b))).filter(user => !user.isSelf);
  global = {
    ...global,
    contactList: {
      userIds: sortedUsers.map(user => user.id)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadCurrentUser', () => {
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCurrentUser');
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadCommonChats', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) {
    return;
  }
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  const commonChats = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUserCommonChats)(global, userId);
  if (!user || (0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isUserBot)(user) || commonChats?.isFullyLoaded) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCommonChats', {
    user,
    maxId: commonChats?.maxId
  });
  if (!result) {
    return;
  }
  const {
    chatIds,
    count
  } = result;
  const ids = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)((commonChats?.ids || []).concat(chatIds));
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserCommonChats)(global, user.id, {
    maxId: chatIds.length ? chatIds[chatIds.length - 1] : undefined,
    ids,
    isFullyLoaded: ids.length >= count
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('toggleNoPaidMessagesException', async (global, actions, payload) => {
  const {
    userId,
    shouldRefundCharged
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('toggleNoPaidMessagesException', {
    user,
    shouldRefundCharged
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserFullInfo)(global, userId, {
    settings: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('openChatRefundModal', async (global, actions, payload) => {
  const {
    userId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const starsAmount = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPaidMessagesRevenue', {
    user
  });
  if (starsAmount === undefined) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    chatRefundModal: {
      userId,
      starsToRefund: starsAmount
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('updateContact', async (global, actions, payload) => {
  const {
    userId,
    firstName,
    lastName,
    shouldSharePhoneNumber,
    note,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  let result;
  if (!user.isContact && user.phoneNumber && !note) {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('importContact', {
      phone: user.phoneNumber,
      firstName,
      lastName
    });
  } else {
    const {
      id,
      accessHash
    } = user;
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('updateContact', {
      id,
      accessHash,
      phoneNumber: '',
      firstName,
      lastName,
      shouldSharePhoneNumber,
      note
    });
  }
  if (result) {
    actions.loadPeerSettings({
      peerId: userId
    });
    actions.loadPeerStories({
      peerId: userId
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUser)(global, user.id, {
      firstName,
      lastName
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.closeNewContactDialog)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('updateContactNote', async (global, actions, payload) => {
  const {
    userId,
    note,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('updateContactNote', user, note);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  if (result) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserFullInfo)(global, userId, {
    note
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('deleteContact', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const {
    id,
    accessHash
  } = user;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('deleteContact', {
    id,
    accessHash
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadMoreProfilePhotos', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId,
    shouldInvalidateCache,
    isPreload
  } = payload;
  const isPrivate = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId)(peerId);
  const user = isPrivate ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, peerId) : undefined;
  const chat = !isPrivate ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, peerId) : undefined;
  const peer = user || chat;
  if (chat && (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatRestricted)(global, peerId)) {
    return;
  }
  const profilePhotos = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPeerPhotos)(global, peerId);
  if (!peer?.avatarPhotoId) {
    return;
  }
  if (profilePhotos && !shouldInvalidateCache && (isPreload || !profilePhotos.nextOffset)) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updatePeerPhotosIsLoading)(global, peerId, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  let userFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUserFullInfo)(global, peerId);
  let chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatFullInfo)(global, peerId);
  if (user && !userFullInfo) {
    const {
      id,
      accessHash
    } = user;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchFullUser', {
      id,
      accessHash
    });
    if (!result?.user) {
      return;
    }
    userFullInfo = result.fullInfo;
  }
  if (chat && !chatFullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchFullChat', chat);
    if (!result?.fullInfo) {
      return;
    }
    chatFullInfo = result.fullInfo;
  }
  const peerFullInfo = userFullInfo || chatFullInfo;
  if (!peerFullInfo) return;
  const offset = profilePhotos?.nextOffset;
  const limit = !offset || isPreload || shouldInvalidateCache ? PROFILE_PHOTOS_FIRST_LOAD_LIMIT : undefined;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchProfilePhotos', {
    peer,
    offset,
    limit
  });
  if (!result || !result.photos) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  const {
    photos,
    count,
    nextOffsetId
  } = result;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updatePeerPhotos)(global, peerId, {
    newPhotos: photos,
    count,
    nextOffset: nextOffsetId,
    fullInfo: peerFullInfo,
    shouldInvalidateCache
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('setUserSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!query) return;
  void runThrottledForSearch(async () => {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('searchChats', {
      query
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
    const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).userSearch.query;
    if (!result || !currentSearchQuery || query !== currentSearchQuery) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserSearchFetchingStatus)(global, false, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
      return;
    }
    const {
      accountResultIds,
      globalResultIds
    } = result;
    const localUserIds = accountResultIds.filter(_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId);
    const globalUserIds = globalResultIds.filter(_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserSearchFetchingStatus)(global, false, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserSearch)(global, {
      localUserIds,
      globalUserIds
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('importContact', async (global, actions, payload) => {
  const {
    phoneNumber: phone,
    firstName,
    lastName,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('importContact', {
    phone,
    firstName,
    lastName
  });
  if (!result) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_5__.oldTranslate('Contacts.PhoneNumber.NotRegistred'),
      tabId
    });
    return;
  }
  actions.openChat({
    id: result,
    tabId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.closeNewContactDialog)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('reportSpam', (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPeer)(global, chatId);
  if (!peer) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('reportSpam', peer);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('setEmojiStatus', async (global, actions, payload) => {
  const {
    emojiStatus,
    referrerWebAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserPremium)(global);
  if (!isCurrentUserPremium) {
    if (referrerWebAppKey) {
      actions.sendWebAppEvent({
        webAppKey: referrerWebAppKey,
        event: {
          eventType: 'emoji_status_failed',
          eventData: {
            error: 'USER_DECLINED'
          }
        },
        tabId
      });
    }
    actions.openPremiumModal({
      initialSection: 'emoji_status',
      tabId
    });
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('updateEmojiStatus', emojiStatus);
  if (referrerWebAppKey) {
    if (!result) {
      actions.sendWebAppEvent({
        webAppKey: referrerWebAppKey,
        event: {
          eventType: 'emoji_status_failed',
          eventData: {
            error: 'SERVER_ERROR'
          }
        },
        tabId
      });
      return;
    }
    actions.sendWebAppEvent({
      webAppKey: referrerWebAppKey,
      event: {
        eventType: 'emoji_status_set'
      },
      tabId
    });
    actions.showNotification({
      message: {
        key: 'BotSuggestedStatusUpdated'
      },
      customEmojiIconId: emojiStatus.documentId,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('saveCloseFriends', async (global, actions, payload) => {
  const {
    userIds
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('saveCloseFriends', userIds);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global.contactList?.userIds.forEach(userId => {
    const {
      isCloseFriend
    } = global.users.byId[userId] || {};
    if (isCloseFriend && !userIds.includes(userId)) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUser)(global, userId, {
        isCloseFriend: undefined
      });
    }
  });
  userIds.forEach(userId => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUser)(global, userId, {
      isCloseFriend: true
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('openSuggestedStatusModal', async (global, actions, payload) => {
  const {
    customEmojiId,
    duration,
    botId,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const customEmoji = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCustomEmoji', {
    documentId: [customEmojiId]
  });
  if (!customEmoji?.[0]) {
    if (webAppKey) {
      actions.sendWebAppEvent({
        webAppKey,
        event: {
          eventType: 'emoji_status_failed',
          eventData: {
            error: 'SUGGESTED_EMOJI_INVALID'
          }
        },
        tabId
      });
    }
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    suggestedStatusModal: {
      customEmojiId,
      duration,
      webAppKey,
      botId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('loadPeerSettings', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) return;
  const userFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUserFullInfo)(global, peerId);
  if (!userFullInfo) {
    actions.loadFullUser({
      userId: peerId
    });
    return;
  }
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectUser)(global, peerId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPeerSettings', user);
  if (!result) return;
  const {
    settings
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_10__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_11__.updateUserFullInfo)(global, peerId, {
    settings
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_10__.addActionHandler)('markBotVerificationInfoShown', (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const currentPeerIds = global.settings.botVerificationShownPeerIds;
  const newPeerIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)([peerId, ...currentPeerIds]).slice(0, _config__WEBPACK_IMPORTED_MODULE_1__.BOT_VERIFICATION_PEERS_LIMIT);
  global = {
    ...global,
    settings: {
      ...global.settings,
      botVerificationShownPeerIds: newPeerIds
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_10__.setGlobal)(global);
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/calls.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/calls.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.tsx");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_calls__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/calls */ "./src/global/reducers/calls.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_calls__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors/calls */ "./src/global/selectors/calls.ts");
/* harmony import */ var _ui_calls__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/calls */ "./src/global/actions/ui/calls.ts");












(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateGroupCall':
      {
        if (update.call.connectionState === 'discarded') {
          if (global.groupCalls.activeGroupCallId) {
            if ('leaveGroupCall' in actions) actions.leaveGroupCall({
              shouldRemove: true,
              tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
            });
            return undefined;
          } else {
            return (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.removeGroupCall)(global, update.call.id);
          }
        }
        const groupCall = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectGroupCall)(global, update.call.id);
        const chatId = groupCall?.chatId;
        if (chatId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
            isCallNotEmpty: groupCall.participantsCount > 0 || Boolean(groupCall.participants?.length)
          });
        }
        return (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCall)(global, update.call.id, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(update.call, ['connectionState']), undefined, update.call.participantsCount);
      }
    case 'updateGroupCallChatId':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectChat)(global, update.chatId);
        if (chat) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChatFullInfo)(global, update.chatId, {
            groupCallId: update.call.id
          });
        }
        return global;
      }
    case 'updateGroupCallParticipants':
      {
        const {
          groupCallId,
          participants,
          nextOffset
        } = update;
        const {
          currentUserId
        } = global;

        // `secret-sauce` should disconnect if the participant is us but from another device
        global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
        participants.forEach(participant => {
          if (participant.id) {
            global = (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCallParticipant)(global, groupCallId, participant.id, participant, Boolean(nextOffset) || currentUserId === participant.id);
          }
        });
        if (nextOffset) {
          global = (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCall)(global, groupCallId, {
            nextOffset
          });
        }
        const groupCall = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectGroupCall)(global, groupCallId);
        const chatId = groupCall?.chatId;
        if (chatId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
            isCallNotEmpty: groupCall.participantsCount > 0 || Boolean(groupCall.participants?.length)
          });
        }
        return global;
      }
    case 'updatePhoneCall':
      {
        if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.ARE_CALLS_SUPPORTED) return undefined;
        const {
          phoneCall,
          currentUserId
        } = global;
        const {
          call
        } = update;
        if (phoneCall) {
          if (call.state === 'discarded') {
            actions.playGroupCallSound({
              sound: 'end'
            });
            if ('hangUp' in actions) actions.hangUp({
              tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
            });
            return {
              ...global,
              ...(call.needRating && {
                ratingPhoneCall: call
              })
            };
          }
          return undefined;
        }
        const isOutgoing = call?.adminId === currentUserId;
        if (!isOutgoing && call.state === 'requested') {
          (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.onTickEnd)(() => {
            global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
            const user = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectPhoneCallUser)(global);
            if (!user) return;
            (0,_util_notifications__WEBPACK_IMPORTED_MODULE_3__.notifyAboutCall)({
              call,
              user
            });
          });
          (0,_ui_calls__WEBPACK_IMPORTED_MODULE_11__.initializeSounds)();
          void (0,_ui_calls__WEBPACK_IMPORTED_MODULE_11__.checkNavigatorUserMediaPermissions)(global, actions, call.isVideo, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)());
          global = {
            ...global,
            phoneCall: call
          };
          return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
            isCallPanelVisible: false
          }, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)());
        }
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/chats.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/chats.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.tsx");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const TYPING_STATUS_CLEAR_DELAY = 6000; // 6 seconds
const INVALIDATE_FULL_CHAT_FIELDS = new Set(['boostLevel', 'isForum', 'isLinkedInDiscussion', 'fakeType', 'restrictionReasons', 'isJoinToSend', 'isJoinRequest', 'type']);
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateChat':
      {
        const localChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        const {
          isForum: prevIsForum,
          lastReadOutboxMessageId
        } = localChat || {};
        if (update.chat.lastReadOutboxMessageId && lastReadOutboxMessageId && update.chat.lastReadOutboxMessageId < lastReadOutboxMessageId) {
          update = {
            ...update,
            chat: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(update.chat, ['lastReadInboxMessageId'])
          };
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, update.chat);
        if (localChat?.areStoriesHidden !== update.chat.areStoriesHidden) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesHidden)(global, update.id, update.chat.areStoriesHidden || false);
        }
        const localAdminRights = localChat?.adminRights;
        const newAdminRights = update.chat.adminRights;
        if (localAdminRights && localAdminRights.manageDirectMessages && !update.chat.isMin && newAdminRights?.manageDirectMessages !== localAdminRights.manageDirectMessages && localChat.linkedMonoforumId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceChatMessages)(global, localChat.linkedMonoforumId, {});
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        const updatedChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        if (!update.noTopChatsRequest && !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsChatListed)(global, update.id) && !updatedChat?.isNotJoined) {
          // Reload top chats to update chat listing
          actions.loadTopChats();
        }
        if (update.chat.id) {
          (0,_util_notifications__WEBPACK_IMPORTED_MODULE_4__.closeMessageNotifications)({
            chatId: update.chat.id,
            lastReadInboxMessageId: update.chat.lastReadInboxMessageId
          });
        }
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const {
            chatId: currentChatId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
          const chatUpdate = update;
          // The property `isForum` was changed in another client
          if (currentChatId === chatUpdate.id && 'isForum' in chatUpdate.chat && prevIsForum !== chatUpdate.chat.isForum) {
            if (prevIsForum) {
              actions.closeForumPanel({
                tabId
              });
            }
            actions.openChat({
              id: currentChatId,
              tabId
            });
          }
        });
        if (localChat) {
          const chatUpdate = update.chat;
          const changedFields = Object.keys(chatUpdate).filter(key => localChat[key] !== chatUpdate[key]);
          if (changedFields.some(key => INVALIDATE_FULL_CHAT_FIELDS.has(key))) {
            actions.invalidateFullInfo({
              peerId: update.id
            });
          }
        }
        return undefined;
      }
    case 'updateChatJoin':
      {
        const listType = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatListType)(global, update.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, {
          isNotJoined: false
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        if (chat) {
          actions.requestChatUpdate({
            chatId: chat.id
          });
        }
        actions.loadFullChat({
          chatId: update.id,
          force: true
        });
        if (!listType) {
          return undefined;
        }
        global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChatListIds)(global, listType, [update.id]);
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        return undefined;
      }
    case 'updateChatLeave':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.leaveChat)(global, update.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        if (chat && (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat)) {
          const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessages)(global, update.id);
          if (chatMessages) {
            const localMessageIds = Object.keys(chatMessages).map(Number).filter(_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_3__.isLocalMessageId);
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.deleteChatMessages)(global, chat.id, localMessageIds);
          }
        }
        return global;
      }
    case 'updateChatInbox':
      {
        const {
          id,
          threadId,
          lastReadInboxMessageId,
          unreadCount
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, id);
        if (chat?.isBotForum && threadId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateTopic)(global, id, Number(threadId), {
            unreadCount
          });
          return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateThreadInfo)(global, id, threadId, {
            lastReadInboxMessageId
          });
        } else {
          return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, id, {
            lastReadInboxMessageId,
            unreadCount
          });
        }
      }
    case 'updateChatTypingStatus':
      {
        const {
          id,
          threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
          typingStatus
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceThreadParam)(global, id, threadId, 'typingStatus', typingStatus);
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        setTimeout(() => {
          global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
          const currentTypingStatus = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadParam)(global, id, threadId, 'typingStatus');
          if (typingStatus && currentTypingStatus && typingStatus.timestamp === currentTypingStatus.timestamp) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceThreadParam)(global, id, threadId, 'typingStatus', undefined);
            (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
          }
        }, TYPING_STATUS_CLEAR_DELAY);
        return undefined;
      }
    case 'newMessage':
      {
        const {
          message
        } = update;
        const isOur = message.senderId ? message.senderId === global.currentUserId : message.isOutgoing;
        if (isOur && !message.isFromScheduled) {
          return undefined;
        }
        const isLocal = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_3__.isLocalMessageId)(message.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.chatId);
        if (!chat) {
          return undefined;
        }
        const hasMention = Boolean(update.message.id && update.message.hasUnreadMention);
        if (!isLocal || chat.id === _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.chatId, {
            unreadCount: chat.unreadCount ? chat.unreadCount + 1 : 1
          });
          if (hasMention) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUnreadMentions)(global, update.chatId, chat, [update.message.id], true);
          }
          const topic = chat.isForum ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTopicFromMessage)(global, message) : undefined;
          if (topic) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateTopic)(global, update.chatId, topic.id, {
              unreadCount: topic.unreadCount ? topic.unreadCount + 1 : 1
            });
          }

          // TODO Replace draft with new message
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        (0,_util_notifications__WEBPACK_IMPORTED_MODULE_4__.notifyAboutMessage)({
          chat,
          message
        });
        return undefined;
      }
    case 'updateCommonBoxMessages':
    case 'updateChannelMessages':
      {
        const {
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          const chatId = 'channelId' in update ? update.channelId : (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCommonBoxChatId)(global, id);
          const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
          if (messageUpdate.reactions && chat?.unreadReactionsCount && !(0,_helpers__WEBPACK_IMPORTED_MODULE_5__.checkIfHasUnreadReactions)(global, messageUpdate.reactions)) {
            global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_8__.updateUnreadReactions)(global, chatId, {
              unreadReactionsCount: Math.max(chat.unreadReactionsCount - 1, 0) || undefined,
              unreadReactions: chat.unreadReactions?.filter(i => i !== id)
            });
          }
          if (!messageUpdate.hasUnreadMention && chat?.unreadMentionsCount) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.removeUnreadMentions)(global, chatId, chat, [id], true);
          }
        });
        return global;
      }
    case 'updateChatFullInfo':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, update.id, update.fullInfo);
      }
    case 'updatePinnedChatIds':
      {
        const {
          ids,
          folderId
        } = update;
        const listType = folderId === _config__WEBPACK_IMPORTED_MODULE_1__.ARCHIVED_FOLDER_ID ? 'archived' : 'active';
        if (!ids) {
          actions.loadPinnedDialogs({
            listType
          });
          return global;
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              [listType]: ids.length ? ids : undefined
            }
          }
        };
      }
    case 'updatePinnedSavedDialogIds':
      {
        const {
          ids
        } = update;
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              saved: ids.length ? ids : undefined
            }
          }
        };
      }
    case 'updateChatPinned':
      {
        const {
          id,
          isPinned
        } = update;
        const listType = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatListType)(global, id);
        if (!listType) {
          return undefined;
        }
        const {
          [listType]: orderedPinnedIds
        } = global.chats.orderedPinnedIds;
        let newOrderedPinnedIds = orderedPinnedIds || [];
        if (!isPinned) {
          newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => pinnedId !== id);
        } else if (!newOrderedPinnedIds.includes(id)) {
          // When moving pinned chats to archive, active ordered pinned ids don't get updated
          // (to preserve chat pinned state when it returns from archive)
          // If user already has max pinned chats, we should check for orderedIds
          // that don't point to listed chats
          if (listType === 'active' && newOrderedPinnedIds.length >= _config__WEBPACK_IMPORTED_MODULE_1__.MAX_ACTIVE_PINNED_CHATS) {
            const listIds = global.chats.listIds.active;
            newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => listIds && listIds.includes(pinnedId));
          }
          newOrderedPinnedIds = [id, ...newOrderedPinnedIds];
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              [listType]: newOrderedPinnedIds.length ? newOrderedPinnedIds : undefined
            }
          }
        };
      }
    case 'updateSavedDialogPinned':
      {
        const {
          id,
          isPinned
        } = update;
        const {
          saved: orderedPinnedIds
        } = global.chats.orderedPinnedIds;
        let newOrderedPinnedIds = orderedPinnedIds || [];
        if (!isPinned) {
          newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => pinnedId !== id);
        } else if (!newOrderedPinnedIds.includes(id)) {
          newOrderedPinnedIds = [id, ...newOrderedPinnedIds];
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              saved: newOrderedPinnedIds.length ? newOrderedPinnedIds : undefined
            }
          }
        };
      }
    case 'updateChatListType':
      {
        const {
          id,
          folderId
        } = update;
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatListType)(global, id, folderId);
      }
    case 'updateChatFolder':
      {
        const {
          id,
          folder
        } = update;
        const {
          byId: chatFoldersById,
          orderedIds
        } = global.chatFolders;
        const isDeleted = folder === undefined;
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
          const isFolderActive = Object.values(chatFoldersById)[tabState.activeChatFolder - 1]?.id === id;
          if (isFolderActive) {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
              activeChatFolder: 0
            }, tabId);
          }
        });
        const newChatFoldersById = !isDeleted ? {
          ...chatFoldersById,
          [id]: folder
        } : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(chatFoldersById, [id]);
        const newOrderedIds = !isDeleted ? orderedIds?.includes(id) ? orderedIds : [...(orderedIds || []), id] : orderedIds?.filter(orderedId => orderedId !== id);
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            byId: newChatFoldersById,
            orderedIds: newOrderedIds,
            invites: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(global.chatFolders.invites, [id])
          }
        };
      }
    case 'updateChatFoldersOrder':
      {
        const {
          orderedIds
        } = update;
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            orderedIds
          }
        };
      }
    case 'updateRecommendedChatFolders':
      {
        const {
          folders
        } = update;
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            recommended: folders
          }
        };
      }
    case 'updateChatMembers':
      {
        const targetChatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatFullInfo)(global, update.id);
        const {
          replacedMembers,
          addedMember,
          deletedMemberId
        } = update;
        if (!targetChatFullInfo) {
          return undefined;
        }
        let shouldUpdate = false;
        let members = targetChatFullInfo?.members ? [...targetChatFullInfo.members] : [];
        if (replacedMembers) {
          members = replacedMembers;
          shouldUpdate = true;
        } else if (addedMember) {
          if (!members.length || !members.some(m => m.userId === addedMember.userId)) {
            members.push(addedMember);
            shouldUpdate = true;
          }
        } else if (members.length && deletedMemberId) {
          const deleteIndex = members.findIndex(m => m.userId === deletedMemberId);
          if (deleteIndex > -1) {
            members.slice(deleteIndex, 1);
            shouldUpdate = true;
          }
        }
        if (shouldUpdate) {
          const adminMembers = members.filter(({
            isOwner,
            isAdmin
          }) => isOwner || isAdmin);
          // TODO Kicked members?

          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, {
            membersCount: members.length
          });
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, update.id, {
            members,
            adminMembersById: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(adminMembers, 'userId')
          });
          return global;
        }
        return undefined;
      }
    case 'draftMessage':
      {
        const {
          chatId,
          threadId,
          draft
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceThreadParam)(global, chatId, threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'draft', draft);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
          draftDate: draft?.date
        });
        return global;
      }
    case 'updatePendingJoinRequests':
      {
        const {
          chatId,
          requestsPending,
          recentRequesterIds
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, chatId, {
          requestsPending,
          recentRequesterIds
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        actions.loadChatJoinRequests({
          chatId
        });
        return undefined;
      }
    case 'updatePinnedTopic':
      {
        const {
          chatId,
          topicId,
          isPinned
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateTopic)(global, chatId, topicId, {
          isPinned
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        return undefined;
      }
    case 'updatePinnedTopicsOrder':
      {
        const {
          chatId,
          order
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) return undefined;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replacePinnedTopicIds)(global, chatId, order);
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        return undefined;
      }
    case 'updateTopic':
      {
        const {
          chatId,
          topicId
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        actions.loadTopicById({
          chatId,
          topicId
        });
        return undefined;
      }
    case 'updateTopics':
      {
        const {
          chatId
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        actions.loadTopics({
          chatId,
          force: true
        });
        return undefined;
      }
    case 'updateViewForumAsMessages':
      {
        const {
          chatId,
          isEnabled
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
          isForumAsMessages: isEnabled
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        break;
      }
    case 'updateNewProfilePhoto':
      {
        const {
          peerId,
          photo
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, peerId, {
          avatarPhotoId: photo.id
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        actions.loadMoreProfilePhotos({
          peerId,
          shouldInvalidateCache: true
        });
        break;
      }
    case 'updateDeleteProfilePhoto':
      {
        const {
          peerId,
          photoId
        } = update;
        const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId);
        if (!peer) {
          return undefined;
        }
        if (!photoId || peer.avatarPhotoId === photoId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, peerId, {
            avatarPhotoId: undefined
          });
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replacePeerPhotos)(global, peerId, undefined);
        } else {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.deletePeerPhoto)(global, peerId, photoId);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        actions.loadMoreProfilePhotos({
          peerId,
          shouldInvalidateCache: true
        });
        break;
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/messages.ts":
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/messages.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   deleteMessages: () => (/* binding */ deleteMessages),
/* harmony export */   deleteParticipantHistory: () => (/* binding */ deleteParticipantHistory),
/* harmony export */   deleteThread: () => (/* binding */ deleteThread),
/* harmony export */   updateWithLocalMedia: () => (/* binding */ updateWithLocalMedia)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_areDeepEqual__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/areDeepEqual */ "./src/util/areDeepEqual.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.tsx");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_replies__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");


















const ANIMATION_DELAY = 350;
const SNAP_ANIMATION_DELAY = 1000;
const VIDEO_PROCESSING_NOTIFICATION_DELAY = 1000;
let lastVideoProcessingNotificationTime = 0;
(0,_index__WEBPACK_IMPORTED_MODULE_13__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'newMessage':
      {
        const {
          chatId,
          id,
          message,
          shouldForceReply,
          wasDrafted,
          poll,
          webPage
        } = update;
        global = updateWithLocalMedia(global, chatId, id, true, message);
        global = updateListedAndViewportIds(global, actions, message);
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
        const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_12__.getMessageReplyInfo)(newMessage);
        const storyReplyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_12__.getStoryReplyInfo)(newMessage);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
        if (chat?.isForum && replyInfo?.isForumTopic && !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTopicFromMessage)(global, newMessage) && replyInfo.replyToMsgId) {
          actions.loadTopicById({
            chatId,
            topicId: replyInfo.replyToMsgId
          });
        }
        const isLocal = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.isMessageLocal)(message);
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          // Force update for last message on drafted messages to prevent flickering
          if (isLocal && wasDrafted) {
            global = updateChatLastMessage(global, chatId, newMessage);
          }
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, newMessage);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMediaLoadingState)(global, newMessage, chatId, threadId, tabId);
          if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsMessageInCurrentMessageList)(global, chatId, message, tabId)) {
            if (isLocal && message.isOutgoing && !message.content?.action && !storyReplyInfo?.storyId && !message.content?.storyData) {
              const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
              if (currentMessageList) {
                // We do not use `actions.focusLastMessage` as it may be set with a delay (see below)
                actions.focusMessage({
                  chatId,
                  threadId: currentMessageList.threadId,
                  messageId: message.id,
                  noHighlight: true,
                  isResizingContainer: true,
                  tabId
                });
              }
            }

            // @perf Wait until scroll animation finishes or simply rely on delivery status update
            // (which is itself delayed)
            if (!isLocal) {
              setTimeout(() => {
                global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
                if (shouldForceReply) {
                  actions.updateDraftReplyInfo({
                    replyToMsgId: id,
                    tabId
                  });
                }
                global = updateChatLastMessage(global, chatId, newMessage);
                (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
              }, ANIMATION_DELAY);
            }
          } else {
            global = updateChatLastMessage(global, chatId, newMessage);
          }
        });
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceWebPage)(global, webPage.id, webPage);
        }
        if (message.reportDeliveryUntilDate && message.reportDeliveryUntilDate > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_9__.getServerTime)()) {
          actions.reportMessageDelivery({
            chatId,
            messageId: id
          });
        }
        if (chat?.isBotForum && !newMessage.isOutgoing && !isLocal) {
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, newMessage);
          const typingDraftStore = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId');
          const localDraftIds = Object.values(typingDraftStore || {});
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, chatId, localDraftIds);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId', undefined);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);

        // Reload dialogs if chat is not present in the list
        if (!isLocal && !chat?.isNotJoined && !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatListed)(global, chatId)) {
          actions.loadTopChats();
        }
        if (!isLocal && (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatWithSelf)(global, chatId)) {
          const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSavedDialogIdFromMessage)(global, newMessage);
          if (savedDialogId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatListed)(global, savedDialogId, 'saved')) {
            actions.requestSavedDialogUpdate({
              chatId: savedDialogId
            });
          }
        }
        break;
      }
    case 'updateChatLastMessage':
      {
        const {
          id,
          lastMessage
        } = update;
        global = updateChatLastMessage(global, id, lastMessage, true);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.addMessages)(global, [lastMessage]);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateStartEmojiInteraction':
      {
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const {
            chatId: currentChatId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
          if (currentChatId !== update.id) return;
          const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, currentChatId, update.messageId);
          if (!message) return;

          // Workaround for a weird behavior when interaction is received after watching reaction
          if ((0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMessageText)(message)?.text !== update.emoji) return;
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
          global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
            activeEmojiInteractions: [...(tabState.activeEmojiInteractions || []), {
              id: Math.random(),
              animatedEffect: update.emoji,
              messageId: update.messageId
            }]
          }, tabId);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'newScheduledMessage':
      {
        const {
          chatId,
          id,
          message,
          poll,
          webPage
        } = update;
        global = updateWithLocalMedia(global, chatId, id, true, message, true);
        const scheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...scheduledIds, id]));
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...threadScheduledIds, id]));
        }
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceWebPage)(global, webPage.id, webPage);
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePeerFullInfo)(global, chatId, {
          hasScheduledMessages: true
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessage':
      {
        const {
          chatId,
          id,
          message,
          poll,
          webPage,
          isFromNew
        } = update;
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledMessage)(global, chatId, id);
        if (!currentMessage) {
          if (isFromNew) {
            actions.apiUpdate({
              '@type': 'newScheduledMessage',
              id: update.id,
              chatId: update.chatId,
              message: update.message,
              poll: update.poll,
              webPage: update.webPage
            });
          }
          return;
        }
        global = updateWithLocalMedia(global, chatId, id, false, message, true);
        const ids = Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatScheduledMessages)(global, chatId) || {}).map(Number).sort((a, b) => b - a);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', ids);
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, currentMessage);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', threadScheduledIds.sort((a, b) => b - a));
        }
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateMessage':
      {
        const {
          chatId,
          id,
          message,
          poll,
          webPage,
          isFromNew,
          shouldForceReply
        } = update;
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
        if (!currentMessage) {
          if (isFromNew) {
            actions.apiUpdate({
              '@type': 'newMessage',
              id: update.id,
              chatId: update.chatId,
              message: update.message,
              poll: update.poll,
              webPage: update.webPage,
              shouldForceReply
            });
          }
          return;
        }
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
        global = updateWithLocalMedia(global, chatId, id, false, message);
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
        if (message.reactions && chat) {
          global = updateReactions(global, actions, chatId, id, message.reactions, chat, newMessage.isOutgoing, currentMessage);
        }
        if (message.content?.text?.text !== currentMessage?.content?.text?.text) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.clearMessageTranslation)(global, chatId, id);
        }
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateQuickReplyMessage':
      {
        const {
          id,
          message,
          poll,
          webPage
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateQuickReplyMessage)(global, id, message);
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'deleteQuickReplyMessages':
      {
        const {
          messageIds
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteQuickReplyMessages)(global, messageIds);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateQuickReplies':
      {
        const {
          quickReplies
        } = update;
        const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.buildCollectionByKey)(quickReplies, 'id');
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateQuickReplies)(global, byId);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'deleteQuickReply':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteQuickReply)(global, update.quickReplyId);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateVideoProcessingPending':
      {
        const {
          chatId,
          localId,
          newScheduledMessageId
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, chatId, [localId]);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePeerFullInfo)(global, chatId, {
          hasScheduledMessages: true
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
          if (currentMessageList?.chatId !== chatId) return;
          const now = Date.now();
          if (now - lastVideoProcessingNotificationTime < VIDEO_PROCESSING_NOTIFICATION_DELAY) {
            return;
          }
          lastVideoProcessingNotificationTime = now;
          actions.showNotification({
            message: {
              key: 'VideoConversionText'
            },
            title: {
              key: 'VideoConversionTitle'
            },
            tabId
          });
          actions.focusMessage({
            chatId,
            messageId: newScheduledMessageId,
            messageListType: 'scheduled',
            tabId
          });
        });
        break;
      }
    case 'updateMessageSendSucceeded':
      {
        const {
          chatId,
          localId,
          message,
          poll
        } = update;
        global = updateListedAndViewportIds(global, actions, message);
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, localId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, chatId, [localId]);

        // Edge case for "Send When Online"
        if (message.isScheduled) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatScheduledMessages)(global, chatId, [localId]);
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, message.id, {
          ...currentMessage,
          ...message,
          previousLocalId: localId,
          isDeleting: undefined
        });
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        global = {
          ...global,
          fileUploads: {
            byMessageKey: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.omit)(global.fileUploads.byMessageKey, [(0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__.getMessageKey)(message)])
          }
        };
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, message.id);
        global = updateChatLastMessage(global, chatId, newMessage);
        const thread = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadByMessage)(global, message);
        // For some reason Telegram requires to manually mark outgoing thread messages read
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const {
            chatId: currentChatId,
            threadId: currentThreadId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
          if (currentChatId !== chatId || (thread?.threadInfo?.threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) !== currentThreadId) {
            return;
          }
          actions.markMessageListRead({
            maxId: message.id,
            tabId
          });
        });
        if (thread?.threadInfo?.threadId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, thread.threadInfo.threadId, 'threadInfo', {
            ...thread.threadInfo,
            lastMessageId: message.id,
            lastReadInboxMessageId: message.id
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChat)(global, chatId, {
          lastReadInboxMessageId: message.id
        });
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
        // Reload dialogs if chat is not present in the list
        if (!chat?.isNotJoined && !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatListed)(global, chatId)) {
          actions.loadTopChats();
        }
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatWithSelf)(global, chatId)) {
          const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSavedDialogIdFromMessage)(global, newMessage);
          if (savedDialogId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatListed)(global, savedDialogId, 'saved')) {
            actions.requestSavedDialogUpdate({
              chatId: savedDialogId
            });
          }
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessageSendSucceeded':
      {
        const {
          chatId,
          localId,
          message,
          poll
        } = update;
        const scheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', [...scheduledIds, message.id]);
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', [...threadScheduledIds, message.id]);
        }
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledMessage)(global, chatId, localId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatScheduledMessages)(global, chatId, [localId]);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateScheduledMessage)(global, chatId, message.id, {
          ...currentMessage,
          ...message,
          previousLocalId: localId,
          isDeleting: undefined
        });
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, poll.id, poll);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updatePinnedIds':
      {
        const {
          chatId,
          isPinned,
          messageIds
        } = update;
        const messages = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.pickTruthy)((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId), messageIds);
        const updatePerThread = {
          [_api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID]: messageIds
        };
        Object.values(messages).forEach(message => {
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, message.id, {
            isPinned
          });
          if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) return;
          const currentUpdatedInThread = updatePerThread[threadId] || [];
          currentUpdatedInThread.push(message.id);
          updatePerThread[threadId] = currentUpdatedInThread;
        });
        Object.entries(updatePerThread).forEach(([threadId, ids]) => {
          const pinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectPinnedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
          const newPinnedIds = isPinned ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)(pinnedIds.concat(ids)).sort((a, b) => b - a) : pinnedIds.filter(id => !ids.includes(id));
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, Number(threadId), 'pinnedIds', newPinnedIds);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateThreadInfo':
      {
        const {
          threadInfo
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateThreadInfos)(global, [threadInfo]);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
        const {
          chatId,
          threadId
        } = threadInfo;
        if (!chatId || !threadId) return;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
        const currentThreadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadInfo)(global, chatId, threadId);
        const topic = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTopic)(global, chatId, threadId);
        if (chat?.isForum) {
          if (!topic || topic.lastMessageId !== currentThreadInfo?.lastReadInboxMessageId) {
            actions.loadTopicById({
              chatId,
              topicId: Number(threadId)
            });
          } else {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateTopic)(global, chatId, Number(threadId), {
              unreadCount: 0
            });
          }
        }

        // Update reply thread last read message id if already read in main thread
        if (!chat?.isForum) {
          const lastReadInboxMessageId = chat?.lastReadInboxMessageId;
          const lastReadInboxMessageIdInThread = threadInfo.lastReadInboxMessageId || lastReadInboxMessageId;
          if (lastReadInboxMessageId && lastReadInboxMessageIdInThread) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateThreadInfo)(global, chatId, threadId, {
              lastReadInboxMessageId: Math.max(lastReadInboxMessageIdInThread, lastReadInboxMessageId)
            });
          }
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'resetMessages':
      {
        const {
          id: chatId
        } = update;
        const messagesById = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
        if (messagesById && !(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_3__.isUserId)(chatId)) {
          const tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)();
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, chatId, Object.keys(messagesById).map(Number));
          (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
          actions.loadFullChat({
            chatId,
            force: true
          });
          actions.loadViewportMessages({
            chatId,
            threadId: _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
            tabId
          });
        }
        break;
      }
    case 'deleteMessages':
      {
        const {
          ids,
          chatId
        } = update;
        deleteMessages(global, chatId, ids, actions);
        break;
      }
    case 'deleteScheduledMessages':
      {
        const {
          ids,
          newIds,
          chatId
        } = update;
        const hadVideoProcessing = ids?.some(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledMessage)(global, chatId, id)?.isVideoProcessingPending);
        const processedVideoId = newIds?.find(id => {
          const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
          return message?.content.video;
        });
        if (hadVideoProcessing && processedVideoId) {
          Object.values(global.byTabId).forEach(({
            id: tabId
          }) => {
            actions.showNotification({
              message: {
                key: 'VideoConversionDone'
              },
              actionText: {
                key: 'VideoConversionView'
              },
              action: {
                action: 'focusMessage',
                payload: {
                  chatId,
                  messageId: processedVideoId,
                  tabId
                }
              },
              tabId
            });
          });
        }
        deleteScheduledMessages(chatId, ids, actions, global);
        break;
      }
    case 'deleteHistory':
      {
        const {
          chatId
        } = update;
        const chatMessages = global.messages.byChatId[chatId];
        if (chatId === _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) {
          global = {
            ...global,
            serviceNotifications: global.serviceNotifications.map(notification => ({
              ...notification,
              isDeleted: true
            }))
          };
          (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        }
        if (chatMessages) {
          const ids = Object.keys(chatMessages.byId).map(Number);
          global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
          deleteMessages(global, chatId, ids, actions);
        } else {
          actions.requestChatUpdate({
            chatId
          });
        }
        global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.removeChatFromChatLists)(global, chatId);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'deleteSavedHistory':
      {
        const {
          chatId
        } = update;
        const currentUserId = global.currentUserId;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.removeChatFromChatLists)(global, chatId, 'saved');
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
        deleteThread(global, currentUserId, chatId, actions);
        break;
      }
    case 'deleteParticipantHistory':
      {
        const {
          chatId,
          peerId
        } = update;
        global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
        deleteParticipantHistory(global, chatId, peerId, actions);
        break;
      }
    case 'updateCommonBoxMessages':
      {
        const {
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          const chatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCommonBoxChatId)(global, id);
          if (chatId) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, messageUpdate);
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateChannelMessages':
      {
        const {
          channelId,
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, channelId, id, messageUpdate);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateMessagePoll':
      {
        const {
          pollId,
          pollUpdate
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePoll)(global, pollId, pollUpdate);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateMessagePollVote':
      {
        const {
          pollId,
          peerId,
          options
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updatePollVote)(global, pollId, peerId, options);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateServiceNotification':
      {
        const {
          message
        } = update;
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsServiceChatReady)(global)) {
          actions.createServiceNotification({
            message
          });
        }
        break;
      }
    case 'updateMessageReactions':
      {
        const {
          chatId,
          id,
          reactions
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, update.chatId);
        if (!chat || !message) return;
        global = updateReactions(global, actions, chatId, id, reactions, chat, message.isOutgoing, message);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateMessageExtendedMedia':
      {
        const {
          chatId,
          id,
          extendedMedia,
          isBought
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, update.chatId);
        if (!chat || !message) return;
        if (message.content.invoice) {
          const media = extendedMedia[0];
          if ('mediaType' in media && media.mediaType === 'extendedMediaPreview') {
            if (!message.content.invoice) return;
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, {
              content: {
                ...message.content,
                invoice: {
                  ...message.content.invoice,
                  extendedMedia: media
                }
              }
            });
            (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
          } else {
            const content = media;
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, {
              content: {
                ...content
              }
            });
            (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
          }
        }
        if (message.content.paidMedia) {
          const paidMediaUpdate = isBought ? {
            isBought,
            extendedMedia
          } : {
            extendedMedia: extendedMedia,
            isBought: undefined
          };
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, {
            content: {
              ...message.content,
              paidMedia: {
                ...message.content.paidMedia,
                ...paidMediaUpdate
              }
            }
          });
          (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        }
        break;
      }
    case 'updateTranscribedAudio':
      {
        const {
          transcriptionId,
          text,
          isPending
        } = update;
        global = {
          ...global,
          transcriptions: {
            ...global.transcriptions,
            [transcriptionId]: {
              ...(global.transcriptions[transcriptionId] || {}),
              transcriptionId,
              text,
              isPending
            }
          }
        };
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateMessageSendFailed':
      {
        const {
          chatId,
          localId,
          error
        } = update;
        if (error.match(/CHAT_SEND_.+?FORBIDDEN/)) {
          Object.values(global.byTabId).forEach(({
            id: tabId
          }) => {
            actions.showAllowedMessageTypesNotification({
              chatId,
              tabId
            });
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, localId, {
          sendingState: 'messageSendingStateFailed'
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessageSendFailed':
      {
        const {
          chatId,
          localId,
          error
        } = update;
        if (error.match(/CHAT_SEND_.+?FORBIDDEN/)) {
          Object.values(global.byTabId).forEach(({
            id: tabId
          }) => {
            actions.showAllowedMessageTypesNotification({
              chatId,
              tabId
            });
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateScheduledMessage)(global, chatId, localId, {
          sendingState: 'messageSendingStateFailed'
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateMessageTranslations':
      {
        const {
          chatId,
          messageIds,
          toLanguageCode,
          translations
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateMessageTranslations)(global, chatId, messageIds, toLanguageCode, translations);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'failedMessageTranslations':
      {
        const {
          chatId,
          messageIds,
          toLanguageCode
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateMessageTranslations)(global, chatId, messageIds, toLanguageCode, []);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
        break;
      }
    case 'updateChatTypingDraft':
      {
        const {
          id,
          chatId,
          threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
          text
        } = update;
        const thread = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThread)(global, chatId, threadId);
        if (!thread) return undefined;
        let typingDraftStore = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId');
        const messageId = typingDraftStore?.[id];
        const isUpdatingDraft = Boolean(messageId);
        const updatingMessage = isUpdatingDraft ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, messageId) : undefined;
        const rescheduleDraftRemoval = () => {
          // Clear typing draft after timeout
          setTimeout(() => {
            global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
            const currentTypingDraftStore = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId');
            if (currentTypingDraftStore?.[id]) {
              const currentMessageId = currentTypingDraftStore[id];
              const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, currentMessageId);
              // Already deleted or replaced with a new message
              if (!currentMessage || (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_9__.getServerTime)() - currentMessage.editDate < global.appConfig.typingDraftTtl) return;
              const newTypingDraftIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.omit)(currentTypingDraftStore, [id]);
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId', newTypingDraftIds);
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, chatId, [currentMessageId]);
              (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
            }
          }, global.appConfig.typingDraftTtl * 1000);
        };
        if (isUpdatingDraft && updatingMessage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, messageId, {
            content: {
              text
            },
            editDate: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_9__.getServerTime)()
          });
          rescheduleDraftRemoval();
          return global;
        }

        // Let worker know that we have new local message
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_10__.callApi)('incrementLocalMessagesCounter');
        const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, chatId);
        const newMessage = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.createApiMessageFromTypingDraft)({
          lastMessageId: lastMessageId || 0,
          chatId,
          threadId,
          text
        });
        actions.apiUpdate({
          '@type': 'newMessage',
          chatId,
          id: newMessage.id,
          message: newMessage
        });
        typingDraftStore = {
          ...typingDraftStore,
          [id]: newMessage.id
        };
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'typingDraftIdByRandomId', typingDraftStore);
        rescheduleDraftRemoval();
        return global;
      }
  }
});
function updateReactions(global, actions, chatId, id, reactions, chat, isOutgoing, message) {
  const currentReactions = message?.reactions;

  // `updateMessageReactions` happens with an interval, so we try to avoid redundant global state updates
  if (currentReactions && (0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_2__.areDeepEqual)(reactions, currentReactions)) {
    return global;
  }
  const localPaidReaction = currentReactions?.results.find(r => r.localAmount);
  // Save local count on update, but reset if we sent reaction
  if (localPaidReaction?.localAmount) {
    const {
      localIsPrivate: isPrivate,
      localAmount,
      localPeerId
    } = localPaidReaction;
    reactions.results = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.addPaidReaction)(reactions.results, localAmount, isPrivate, localPeerId);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, {
    reactions
  });
  if (!isOutgoing) {
    return global;
  }
  const {
    reaction,
    isOwn,
    isUnread
  } = reactions.recentReactions?.[0] ?? {};
  const reactionEffectsEnabled = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectPerformanceSettingsValue)(global, 'reactionEffects');
  if (reactionEffectsEnabled && message && reaction && isUnread && !isOwn) {
    const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__.getMessageKey)(message);
    // Start reaction only in master tab
    actions.startActiveReaction({
      containerId: messageKey,
      reaction,
      tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
    });
  }
  const hasUnreadReactionsForMessageInChat = chat.unreadReactions?.includes(id);
  const hasUnreadReactionsInNewReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.checkIfHasUnreadReactions)(global, reactions);

  // Only notify about added reactions, not removed ones
  if (hasUnreadReactionsInNewReactions && !hasUnreadReactionsForMessageInChat) {
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_15__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: (chat?.unreadReactionsCount || 0) + 1,
      unreadReactions: [...(chat?.unreadReactions || []), id].sort((a, b) => b - a)
    });
    const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
    if (!chat || !newMessage) return global;
    (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_8__.onTickEnd)(() => {
      (0,_util_notifications__WEBPACK_IMPORTED_MODULE_7__.notifyAboutMessage)({
        chat,
        message: newMessage,
        isReaction: true
      });
    });
  }
  if (!hasUnreadReactionsInNewReactions && hasUnreadReactionsForMessageInChat) {
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_15__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: (chat?.unreadReactionsCount || 1) - 1,
      unreadReactions: chat?.unreadReactions?.filter(i => i !== id)
    });
  }
  return global;
}
function updateWithLocalMedia(global, chatId, id, isNew, messageUpdate, isScheduled = false) {
  const currentMessage = isScheduled ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectScheduledMessage)(global, chatId, id) : (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
  if (!currentMessage && !isNew) return global;

  // Preserve locally uploaded media.
  if (currentMessage && messageUpdate.content && !(0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__.isLocalMessageId)(id)) {
    const {
      photo,
      video,
      sticker,
      document
    } = (0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getMessageContent)(currentMessage);
    if (photo && messageUpdate.content.photo) {
      messageUpdate.content.photo.blobUrl ??= photo.blobUrl;
      messageUpdate.content.photo.thumbnail ??= photo.thumbnail;
    } else if (video && messageUpdate.content.video) {
      messageUpdate.content.video.blobUrl ??= video.blobUrl;
    } else if (sticker && messageUpdate.content.sticker) {
      messageUpdate.content.sticker.isPreloadedGlobally ??= sticker.isPreloadedGlobally;
    } else if (document && messageUpdate.content.document) {
      messageUpdate.content.document.previewBlobUrl ??= document.previewBlobUrl;
    }
  }
  const newMessage = currentMessage ? {
    ...currentMessage,
    ...messageUpdate
  } : messageUpdate;
  return isScheduled ? (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateScheduledMessage)(global, chatId, id, newMessage) : (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, newMessage);
}
function updateThreadUnread(global, actions, message, isDeleting) {
  const {
    chatId
  } = message;
  const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_12__.getMessageReplyInfo)(message);
  const {
    threadInfo
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadByMessage)(global, message) || {};
  if (!threadInfo && replyInfo?.replyToMsgId) {
    const originMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, replyInfo.replyToMsgId);
    if (originMessage) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateThreadUnreadFromForwardedMessage)(global, originMessage, chatId, message.id, isDeleting);
    } else {
      actions.loadMessage({
        chatId,
        messageId: replyInfo.replyToMsgId,
        threadUpdate: {
          isDeleting,
          lastMessageId: message.id
        }
      });
    }
  }
  return global;
}
function updateListedAndViewportIds(global, actions, message) {
  const {
    id,
    chatId
  } = message;
  const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSavedDialogIdFromMessage)(global, message);
  const {
    threadInfo
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadByMessage)(global, message) || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  const isUnreadChatNotLoaded = chat?.unreadCount && !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectListedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
  global = updateThreadUnread(global, actions, message);
  const {
    threadId
  } = threadInfo ?? {
    threadId: savedDialogId
  };
  if (threadId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateListedIds)(global, chatId, threadId, [id]);
    Object.values(global.byTabId).forEach(({
      id: tabId
    }) => {
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsViewportNewest)(global, chatId, threadId, tabId)) {
        // Always keep the first unread message in the viewport list
        const firstUnreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectFirstUnreadId)(global, chatId, threadId);
        const candidateGlobal = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.addViewportId)(global, chatId, threadId, id, tabId);
        const newViewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(candidateGlobal, chatId, threadId, tabId);
        if (!firstUnreadId || newViewportIds.includes(firstUnreadId)) {
          global = candidateGlobal;
        }
      }
    });
    if (threadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, threadId, 'threadInfo', {
        ...threadInfo,
        lastMessageId: message.id
      });
      if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_11__.isMessageLocal)(message) && !(0,_helpers__WEBPACK_IMPORTED_MODULE_11__.isActionMessage)(message)) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateThreadInfo)(global, chatId, threadId, {
          messagesCount: (threadInfo.messagesCount || 0) + 1
        });
      }
    }
  }
  if (isUnreadChatNotLoaded) {
    return global;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateListedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, [id]);
  Object.values(global.byTabId).forEach(({
    id: tabId
  }) => {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsViewportNewest)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, tabId)) {
      // Always keep the first unread message in the viewport list
      const firstUnreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectFirstUnreadId)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
      const candidateGlobal = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.addViewportId)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, id, tabId);
      const newViewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectViewportIds)(candidateGlobal, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, tabId);
      if (!firstUnreadId || newViewportIds.includes(firstUnreadId)) {
        global = candidateGlobal;
      }
    }
  });
  return global;
}
function updateChatLastMessage(global, chatId, message, force = false) {
  const {
    chats
  } = global;
  const chat = chats.byId[chatId];
  const currentLastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatLastMessageId)(global, chatId);
  const topic = chat?.isForum ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTopicFromMessage)(global, message) : undefined;
  if (topic) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateTopic)(global, chatId, topic.id, {
      lastMessageId: message.id
    });
  }
  const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateThreadInfo)(global, chatId, threadId, {
    lastMessageId: message.id
  });
  const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSavedDialogIdFromMessage)(global, message);
  if (savedDialogId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatLastMessageId)(global, savedDialogId, message.id, 'saved');
  }
  if (currentLastMessageId && !force) {
    const isSameOrNewer = currentLastMessageId === message.id || currentLastMessageId === message.previousLocalId || message.id > currentLastMessageId;
    if (!isSameOrNewer) {
      return global;
    }
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatLastMessageId)(global, chatId, message.id);
  return global;
}
function findLastMessage(global, chatId, threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  const listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectListedIds)(global, chatId, threadId);
  if (!byId || !listedIds) {
    return undefined;
  }
  let i = listedIds.length;
  while (i--) {
    const message = byId[listedIds[i]];
    if (message && !message.isDeleting) {
      return message;
    }
  }
  return undefined;
}
function deleteParticipantHistory(global, chatId, peerId, actions) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  const messageIds = Object.values(byId).filter(message => {
    return message.senderId === peerId;
  }).map(message => message.id);
  if (!messageIds.length) {
    return;
  }
  deleteMessages(global, chatId, messageIds, actions);
}
function deleteThread(global, chatId, threadId, actions) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessages)(global, chatId);
  if (!byId) {
    return;
  }
  const messageIds = Object.values(byId).filter(message => {
    const messageThreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
    return messageThreadId === threadId;
  }).map(message => message.id);
  if (!messageIds.length) {
    return;
  }
  deleteMessages(global, chatId, messageIds, actions);
}
function deleteMessages(global, chatId, ids, actions) {
  // Channel update

  if (chatId) {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
    if (!chat) return;
    const threadIdsToUpdate = new Set();
    threadIdsToUpdate.add(_api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
    ids.forEach(id => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, chatId, id, {
        isDeleting: true
      });
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTopic)(global, chatId, id)) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteTopic)(global, chatId, id);
      }
      const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id);
      if (!message) {
        return;
      }
      if (message.content.action?.type === 'chatEditPhoto' && message.content.action.photo) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deletePeerPhoto)(global, chatId, message.content.action.photo.id, true);
      }
      global = updateThreadUnread(global, actions, message, true);
      const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
      if (threadId) {
        threadIdsToUpdate.add(threadId);
      }
    });
    actions.requestChatUpdate({
      chatId
    });
    const idsSet = new Set(ids);
    threadIdsToUpdate.forEach(threadId => {
      const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadInfo)(global, chatId, threadId);
      if (!threadInfo?.lastMessageId || !idsSet.has(threadInfo.lastMessageId)) return;
      const newLastMessage = findLastMessage(global, chatId, threadId);
      if (!newLastMessage) {
        if (chat.isForum && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          actions.loadTopicById({
            chatId,
            topicId: Number(threadId)
          });
        }
        return;
      }
      if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
        global = updateChatLastMessage(global, chatId, newLastMessage, true);
      }
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateThreadInfo)(global, chatId, threadId, {
        lastMessageId: newLastMessage.id
      });
      if (chat.isForum) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateTopic)(global, chatId, Number(threadId), {
          lastMessageId: newLastMessage.id
        });
      }
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
    const isAnimatingAsSnap = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCanAnimateSnapEffect)(global);
    setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
      // Prevent local deletion of sent messages in case of desync
      const stillDeletedIds = ids.filter(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, id)?.isDeleting);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, chatId, stillDeletedIds);
      (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
    }, isAnimatingAsSnap ? SNAP_ANIMATION_DELAY : ANIMATION_DELAY);
    return;
  }

  // Common box update

  const chatIdsToUpdate = [];
  ids.forEach(id => {
    const commonBoxChatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCommonBoxChatId)(global, id);
    if (commonBoxChatId) {
      chatIdsToUpdate.push(commonBoxChatId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatMessage)(global, commonBoxChatId, id, {
        isDeleting: true
      });
      const newLastMessage = findLastMessage(global, commonBoxChatId);
      if (newLastMessage) {
        global = updateChatLastMessage(global, commonBoxChatId, newLastMessage, true);
      }
      const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, commonBoxChatId, id);
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatWithSelf)(global, commonBoxChatId) && message) {
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectThreadIdFromMessage)(global, message);
        if ((0,_helpers__WEBPACK_IMPORTED_MODULE_11__.getIsSavedDialog)(commonBoxChatId, threadId, global.currentUserId)) {
          const newLastSavedDialogMessage = findLastMessage(global, commonBoxChatId, threadId);
          actions.requestSavedDialogUpdate({
            chatId: String(threadId)
          });
          if (newLastSavedDialogMessage) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateChatLastMessageId)(global, commonBoxChatId, newLastSavedDialogMessage.id, 'saved');
          }
        }
      }
      if (message?.content.action?.type === 'chatEditPhoto' && message.content.action.photo) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deletePeerPhoto)(global, commonBoxChatId, message.content.action.photo.id, true);
      }
      const isAnimatingAsSnap = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCanAnimateSnapEffect)(global);
      setTimeout(() => {
        global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatMessages)(global, commonBoxChatId, [id]);
        (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
      }, isAnimatingAsSnap ? SNAP_ANIMATION_DELAY : ANIMATION_DELAY);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
  (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)(chatIdsToUpdate).forEach(id => {
    actions.requestChatUpdate({
      chatId: id
    });
  });
}
function deleteScheduledMessages(chatId, ids, actions, global) {
  ids.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.updateScheduledMessage)(global, chatId, id, {
      isDeleting: true
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
  const isAnimatingAsSnap = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCanAnimateSnapEffect)(global);
  setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_13__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.deleteChatScheduledMessages)(global, chatId, ids);
    const scheduledMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatScheduledMessages)(global, chatId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_14__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', Object.keys(scheduledMessages || {}).map(Number));
    (0,_index__WEBPACK_IMPORTED_MODULE_13__.setGlobal)(global);
  }, isAnimatingAsSnap ? SNAP_ANIMATION_DELAY : ANIMATION_DELAY);
}

/***/ }),

/***/ "./src/global/actions/apiUpdaters/misc.ts":
/*!************************************************!*\
  !*** ./src/global/actions/apiUpdaters/misc.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");








(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateEntities':
      {
        const {
          users,
          chats,
          threadInfos,
          polls,
          webPages
        } = update;
        if (users) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addUsers)(global, users);
        if (chats) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addChats)(global, chats);
        if (threadInfos) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateThreadInfos)(global, threadInfos);
        if (polls) {
          polls.forEach(poll => {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updatePoll)(global, poll.id, poll);
          });
        }
        if (webPages) {
          webPages.forEach(webPage => {
            if (webPage.webpageType === 'full') {
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateFullWebPage)(global, webPage.id, webPage);
            } else {
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.replaceWebPage)(global, webPage.id, webPage);
            }
          });
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updatePeerBlocked':
      if (update.isBlocked) {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addBlockedUser)(global, update.id);
      } else if (update.isBlockedFromStories) {
        return global; // Unsupported
      } else {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.removeBlockedUser)(global, update.id);
      }
    case 'updateResetContactList':
      global = {
        ...global,
        contactList: {
          userIds: []
        }
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateConfig':
      actions.loadConfig();
      break;
    case 'updateNewAuthorization':
      {
        // Load more info about this session
        actions.loadAuthorizations();
        break;
      }
    case 'updateFavoriteStickers':
      actions.loadFavoriteStickers();
      break;
    case 'updateRecentStickers':
      actions.loadRecentStickers();
      break;
    case 'updateRecentReactions':
      actions.loadRecentReactions();
      break;
    case 'updateRecentEmojiStatuses':
      actions.loadRecentEmojiStatuses();
      break;
    case 'updateSavedReactionTags':
      actions.loadSavedReactionTags();
      break;
    case 'updateMoveStickerSetToTop':
      {
        const oldOrder = update.isCustomEmoji ? global.customEmojis.added.setIds : global.stickers.added.setIds;
        if (!oldOrder?.some(id => id === update.id)) return global;
        const newOrder = [update.id, ...oldOrder.filter(id => id !== update.id)];
        actions.reorderStickerSets({
          order: newOrder,
          isCustomEmoji: update.isCustomEmoji
        });
        break;
      }
    case 'updateStickerSets':
      actions.loadStickerSets();
      break;
    case 'updateStickerSetsOrder':
      {
        // Filter out invalid set IDs, which may be sent by the server
        const order = update.order.filter(setId => Boolean(global.stickers.setsById[setId]));
        actions.reorderStickerSets({
          order,
          isCustomEmoji: update.isCustomEmoji
        });
        break;
      }
    case 'updateSavedGifs':
      actions.loadSavedGifs();
      break;
    case 'updatePrivacy':
      global = {
        ...global,
        settings: {
          ...global.settings,
          privacy: {
            ...global.settings.privacy,
            [update.key]: update.rules
          }
        }
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updatePaymentVerificationNeeded':
      Object.values(global.byTabId).forEach(({
        id: tabId
      }) => {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.setConfirmPaymentUrl)(global, update.url, tabId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.ConfirmPayment, tabId);
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateWebViewResultSent':
      Object.values(global.byTabId).forEach(tabState => {
        Object.entries(tabState.webApps.openedWebApps).forEach(([webAppKey, webApp]) => {
          if (webApp.queryId === update.queryId) {
            actions.resetDraftReplyInfo({
              tabId: tabState.id
            });
            actions.closeWebApp({
              key: webAppKey,
              tabId: tabState.id
            });
          }
        });
      });
      break;
    case 'updateWebPage':
      {
        const {
          webPage
        } = update;
        if (webPage.webpageType === 'full') {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateFullWebPage)(global, webPage.id, webPage);
        } else {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updateStory':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addStoriesForPeer)(global, update.peerId, {
        [update.story.id]: update.story
      });
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updatePeersWithStories)(global, {
        [update.peerId]: (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStories)(global, update.peerId)
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'deleteStory':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.removePeerStory)(global, update.peerId, update.storyId);
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateReadStories':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateLastReadStoryForPeer)(global, update.peerId, update.lastReadId);
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateSentStoryReaction':
      {
        const {
          peerId,
          storyId,
          reaction
        } = update;
        const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStory)(global, peerId, storyId);
        if (!story) return global;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updatePeerStory)(global, peerId, storyId, {
          sentReaction: reaction
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updateStealthMode':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateStealthMode)(global, update.stealthMode);
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateAttachMenuBots':
      actions.loadAttachBots();
      break;
    case 'updatePremiumFloodWait':
      {
        actions.processPremiumFloodWait({
          isUpload: update.isUpload
        });
        break;
      }
    case 'updatePaidReactionPrivacy':
      {
        global = {
          ...global,
          settings: {
            ...global.settings,
            paidReactionPrivacy: update.private
          }
        };
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updateLangPackTooLong':
      {
        (0,_util_localization__WEBPACK_IMPORTED_MODULE_2__.requestLangPackDifference)(update.langCode);
        break;
      }
    case 'updateLangPack':
      {
        (0,_util_localization__WEBPACK_IMPORTED_MODULE_2__.applyLangPackDifference)(update.version, update.strings, update.keysToRemove);
        break;
      }
    case 'newMessage':
      {
        const action = update.message.content?.action;
        if (action?.type === 'starGift' && update.message.isOutgoing) {
          const {
            gift
          } = action;
          if (!gift.isAuction || update.message.chatId === _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) return undefined;
          const {
            chatId,
            id
          } = update.message;
          if (!chatId || !id) return;
          Object.values(global.byTabId).forEach(({
            id: tabId
          }) => {
            actions.focusMessage({
              chatId,
              messageId: id,
              tabId
            });
            actions.closeGiftAuctionBidModal({
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
            actions.showNotification({
              icon: 'auction-filled',
              message: {
                key: 'GiftAuctionWonNotification',
                variables: {
                  gift: gift.title
                }
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
          });
          return undefined;
        }
        if (!update.message.isOutgoing && update.message.chatId !== _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) return undefined;
        if (action?.type !== 'starGiftUnique') return undefined;
        const actionStarGift = action.gift;
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
          if (tabState.isWaitingForStarGiftUpgrade) {
            actions.openUniqueGiftBySlug({
              slug: actionStarGift.slug,
              tabId
            });
            actions.showNotification({
              title: {
                key: 'GiftUpgradedTitle'
              },
              message: {
                key: 'GiftUpgradedDescription'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
              isWaitingForStarGiftUpgrade: undefined
            }, tabId);
          }
          if (tabState.isWaitingForStarGiftTransfer) {
            const chatId = update.message.chatId;
            const receiver = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeer)(global, chatId) : undefined;
            if (receiver) {
              actions.focusMessage({
                chatId: receiver.id,
                messageId: update.message.id,
                tabId
              });
              actions.showNotification({
                message: {
                  key: 'GiftTransferSuccessMessage',
                  variables: {
                    gift: {
                      key: 'GiftUnique',
                      variables: {
                        title: actionStarGift.title,
                        number: actionStarGift.number
                      }
                    },
                    peer: (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)((0,_util_localization__WEBPACK_IMPORTED_MODULE_2__.getTranslationFn)(), receiver)
                  }
                },
                tabId
              });
            }
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
              isWaitingForStarGiftTransfer: undefined
            }, tabId);
            actions.reloadPeerSavedGifts({
              peerId: global.currentUserId
            });
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/payments.ts":
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/payments.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");







(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updatePaymentStateCompleted':
      {
        const {
          paymentState,
          tabId
        } = update;
        const form = paymentState.form;
        const {
          invoice
        } = form;
        const {
          totalAmount,
          currency
        } = invoice;
        const inputInvoice = paymentState.inputInvoice;
        if (inputInvoice?.type === 'stars') {
          actions.closeStarsBalanceModal({
            tabId
          });
          actions.showNotification({
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsAcquiredInfo', inputInvoice.stars),
            title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsAcquired'),
            icon: 'star',
            tabId
          });
          actions.requestConfetti({
            withStars: true,
            tabId
          });
        } else if (inputInvoice?.type === 'giftcode') {
          const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).giftModal;
          if (giftModalState && inputInvoice?.userIds[0] === giftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'GiftSent'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        } else {
          actions.showNotification({
            tabId,
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('PaymentInfoHint', [(0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_0__.formatCurrencyAsString)(totalAmount, currency, _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.getTranslationFn().code), form.title])
          });
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
        break;
      }
    case 'updateStarPaymentStateCompleted':
      {
        const {
          paymentState,
          tabId
        } = update;
        const {
          inputInvoice,
          subscriptionInfo,
          form
        } = paymentState;
        if (inputInvoice?.type === 'chatInviteSubscription' && subscriptionInfo) {
          const amount = subscriptionInfo.subscriptionPricing.amount;
          actions.showNotification({
            tabId,
            title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompleted'),
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompletedText', [amount, subscriptionInfo.title], undefined, amount),
            icon: 'star'
          });
        }
        if (form?.invoice.subscriptionPeriod) {
          const amount = form.invoice.totalAmount;
          actions.showNotification({
            tabId,
            title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompleted'),
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompletedText', [amount, form.title], undefined, amount),
            icon: 'star'
          });
        }
        if (inputInvoice?.type === 'giftcode') {
          if (!inputInvoice.userIds) {
            return;
          }
          const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).giftModal;
          if (giftModalState && inputInvoice.userIds[0] === giftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'StarsGiftCompleted'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'premiumGiftStars') {
          const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).giftModal;
          if (giftModalState && inputInvoice.userId === giftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'StarsGiftCompleted'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'starsgift') {
          if (!inputInvoice.userId) {
            return;
          }
          const starsModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).starsGiftModal;
          if (starsModalState?.isOpen && inputInvoice.userId === starsModalState.forUserId) {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
              starsGiftModal: {
                ...starsModalState,
                isCompleted: true
              }
            }, tabId);
          }
        }
        if (inputInvoice?.type === 'stargift') {
          if (!inputInvoice.peerId) {
            return;
          }
          const starGiftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).giftModal;
          if (starGiftModalState && inputInvoice.peerId === starGiftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'StarsGiftCompleted'
              },
              tabId
            });
            actions.reloadPeerSavedGifts({
              peerId: starGiftModalState.forPeerId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'stargiftResale') {
          const starGiftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).giftInfoModal;
          if (starGiftModalState) {
            actions.showNotification({
              message: {
                key: 'StarsGiftBought'
              },
              tabId
            });
            if (starGiftModalState.peerId) {
              actions.reloadPeerSavedGifts({
                peerId: starGiftModalState.peerId
              });
            }
            actions.reloadPeerSavedGifts({
              peerId: inputInvoice.peerId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftInfoModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'stargiftUpgrade' && global.currentUserId) {
          actions.reloadPeerSavedGifts({
            peerId: global.currentUserId
          });
        }
        if (inputInvoice?.type === 'stargiftDropOriginalDetails') {
          global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.removeGiftInfoOriginalDetails)(global, tabId);
          (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
          actions.closeGiftDescriptionRemoveModal({
            tabId
          });
          actions.showNotification({
            message: {
              key: 'RemoveGiftDescriptionSuccessMessage'
            },
            tabId
          });
          if (global.currentUserId) {
            actions.reloadPeerSavedGifts({
              peerId: global.currentUserId
            });
          }
        }
        if (inputInvoice?.type === 'stargiftPrepaidUpgrade') {
          actions.reloadPeerSavedGifts({
            peerId: inputInvoice.peerId
          });
          const lang = _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.getTranslationFn();
          const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, inputInvoice.peerId);
          const peerTitle = peer ? (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, peer) : undefined;
          actions.showNotification({
            icon: 'gift',
            title: {
              key: 'GiftUpgradeSentTitle'
            },
            message: {
              key: 'GiftUpgradeSentMessage',
              variables: {
                user: peerTitle
              }
            },
            tabId
          });
        }
        if (inputInvoice?.type === 'stargiftAuctionBid') {
          const giftAuction = global.giftAuctionByGiftId?.[inputInvoice.giftId];
          const giftsPerRound = giftAuction?.gift.giftsPerRound;
          actions.showNotification({
            icon: 'auction-filled',
            title: {
              key: inputInvoice.isUpdateBid ? 'GiftAuctionBidIncreasedTitle' : 'GiftAuctionBidPlacedTitle'
            },
            message: {
              key: 'GiftAuctionBidPlacedMessage',
              variables: {
                count: giftsPerRound
              }
            },
            tabId
          });
          if (giftAuction) {
            actions.loadGiftAuction({
              giftId: inputInvoice.giftId
            });
          }
        }
        break;
      }
    case 'updateStarsBalance':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateStarsBalance)(global, update.balance);
        (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
        actions.loadStarStatus();
        break;
      }
    case 'updateStarGiftAuctionState':
      {
        const {
          giftId,
          state
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateGiftAuctionState)(global, giftId, state);
        (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
        break;
      }
    case 'updateStarGiftAuctionUserState':
      {
        const {
          giftId,
          userState
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateGiftAuctionUserState)(global, giftId, userState);
        (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
        break;
      }
  }
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/settings.ts":
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/settings.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");


(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateDefaultNotifySettings':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateNotifyDefaults)(global, update.peerType, update.settings);
      }
    case 'updateChatNotifySettings':
      {
        const {
          chatId,
          settings
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.addNotifyException)(global, chatId, settings);
        (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        break;
      }
    case 'updateTopicNotifySettings':
      {
        const {
          chatId,
          topicId,
          settings
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateTopic)(global, chatId, topicId, {
          notifySettings: settings
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        break;
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/symbols.ts":
/*!***************************************************!*\
  !*** ./src/global/actions/apiUpdaters/symbols.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");


(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateStickerSet':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateStickerSet)(global, update.id, update.stickerSet);
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/twoFaSettings.ts":
/*!*********************************************************!*\
  !*** ./src/global/actions/apiUpdaters/twoFaSettings.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");

(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateTwoFaStateWaitCode':
      {
        return {
          ...global,
          twoFaSettings: {
            ...global.twoFaSettings,
            isLoading: false,
            waitingEmailCodeLength: update.length
          }
        };
      }
    case 'updateTwoFaError':
      {
        return {
          ...global,
          twoFaSettings: {
            ...global.twoFaSettings,
            errorKey: update.messageKey
          }
        };
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/apiUpdaters/users.ts":
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/users.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _lib_teact_heavyAnimation__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/heavyAnimation */ "./src/lib/teact/heavyAnimation.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




const updateStatusesOnFullyIdle = (0,_lib_teact_heavyAnimation__WEBPACK_IMPORTED_MODULE_0__.throttleWithFullyIdle)(flushStatusUpdates);
let pendingStatusUpdates = {};
function flushStatusUpdates() {
  let global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.replaceUserStatuses)(global, {
    ...global.users.statusesById,
    ...pendingStatusUpdates
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  pendingStatusUpdates = {};
}
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'deleteContact':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.deleteContact)(global, update.id);
      }
    case 'updateUser':
      {
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          if ((0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsChatWithSelf)(global, update.id) && update.user.isPremium !== (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global)) {
            if (update.user.isPremium && global.byTabId[tabId].premiumModal) {
              actions.openPremiumModal({
                isSuccess: true,
                tabId
              });
            }

            // Reset translation cache cause premium provides additional formatting
            global = {
              ...global,
              translations: {
                byChatId: {}
              }
            };
          }
        });
        const localUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, update.id);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUser)(global, update.id, update.user);
        if (update.fullInfo) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, update.id, update.fullInfo);
        }
        if (localUser?.areStoriesHidden !== update.user.areStoriesHidden) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updatePeerStoriesHidden)(global, update.id, update.user.areStoriesHidden || false);
        }
        return global;
      }
    case 'updateRequestUserUpdate':
      {
        actions.loadFullUser({
          userId: update.id
        });
        break;
      }
    case 'updateUserEmojiStatus':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUser)(global, update.userId, {
          emojiStatus: update.emojiStatus
        });
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateChat)(global, update.userId, {
          emojiStatus: update.emojiStatus
        });
        return global;
      }
    case 'updateUserStatus':
      {
        // Status updates come very often so we throttle them
        pendingStatusUpdates[update.userId] = update.status;
        updateStatusesOnFullyIdle();
        return undefined;
      }
    case 'updateUserFullInfo':
      {
        const {
          id,
          fullInfo
        } = update;
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, id, fullInfo);
      }
    case 'updateBotMenuButton':
      {
        const {
          botId,
          button
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, botId);
        if (!targetUserFullInfo?.botInfo) {
          return undefined;
        }
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, botId, {
          botInfo: {
            ...targetUserFullInfo.botInfo,
            menuButton: button
          }
        });
      }
    case 'updateBotCommands':
      {
        const {
          botId,
          commands
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, botId);
        if (!targetUserFullInfo?.botInfo) {
          return undefined;
        }
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, botId, {
          botInfo: {
            ...targetUserFullInfo.botInfo,
            commands
          }
        });
      }
    case 'updatePeerSettings':
      {
        const {
          id,
          settings
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, id);
        if (!targetUserFullInfo?.botInfo) {
          actions.loadFullUser({
            userId: id
          });
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, id, {
          settings
        });
        return global;
      }
  }
  return undefined;
});

/***/ }),

/***/ "./src/global/actions/ui/account.ts":
/*!******************************************!*\
  !*** ./src/global/actions/ui/account.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../.. */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openFrozenAccountModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isFrozenAccountModalOpen: true
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeFrozenAccountModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isFrozenAccountModalOpen: false
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openDeleteAccountModal', (global, actions, payload) => {
  const {
    days,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  if (!days) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global, tabId),
    deleteAccountModal: {
      selfDestructAccountDays: days
    }
  }, tabId);
  (0,___WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeDeleteAccountModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    deleteAccountModal: undefined
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openAgeVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isAgeVerificationModalOpen: true
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeAgeVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isAgeVerificationModalOpen: false
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/bots.ts":
/*!***************************************!*\
  !*** ./src/global/actions/ui/bots.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_bots__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/bots */ "./src/global/reducers/bots.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors/sharedState */ "./src/global/selectors/sharedState.ts");








(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openWebAppTab', (global, actions, payload) => {
  const {
    webApp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!webApp) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.addWebAppToOpenList)(global, webApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateWebApp', (global, actions, payload) => {
  const {
    key,
    update,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.updateWebApp)(global, key, update, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeActiveWebApp', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.removeActiveWebAppFromOpenList)(global, tabId);
  if (!(0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedWebApps)(global, tabId)) return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceIsWebAppModalOpen)(global, false, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMoreAppsTab', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    webApps: {
      ...tabState.webApps,
      activeWebAppKey: undefined,
      isMoreAppsTabActive: true
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeMoreAppsTab', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  const openedWebApps = tabState.webApps.openedWebApps;
  const openedWebAppsKeys = Object.keys(openedWebApps);
  const openedWebAppsCount = openedWebAppsKeys.length;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    webApps: {
      ...tabState.webApps,
      isMoreAppsTabActive: false,
      activeWebAppKey: openedWebAppsCount ? openedWebAppsKeys[openedWebAppsCount - 1] : undefined,
      isModalOpen: openedWebAppsCount > 0
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeWebApp', (global, actions, payload) => {
  const {
    key,
    skipClosingConfirmation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.removeWebAppFromOpenList)(global, key, skipClosingConfirmation, tabId);
  if (!(0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedWebApps)(global, tabId)) return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceIsWebAppModalOpen)(global, false, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeWebAppModal', (global, actions, payload) => {
  const {
    shouldSkipConfirmation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const shouldShowConfirmation = !shouldSkipConfirmation && !(0,_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__.selectSharedSettings)(global).shouldSkipWebAppCloseConfirmation && (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedMoreThanOneWebApps)(global, tabId);
  if (shouldShowConfirmation) {
    actions.openWebAppsCloseConfirmationModal({
      tabId
    });
    return global;
  }
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.clearOpenedWebApps)(global, tabId);
  if (!(0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedWebApps)(global, tabId)) return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceIsWebAppModalOpen)(global, false, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('changeWebAppModalState', (global, actions, payload) => {
  const {
    state,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceWebAppModalState)(global, state, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateMiniAppCachedPosition', (global, actions, payload) => {
  const {
    position
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateSharedSettings)(global, {
    miniAppsCachedPosition: position
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateMiniAppCachedSize', (global, actions, payload) => {
  const {
    size
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateSharedSettings)(global, {
    miniAppsCachedSize: size
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setWebAppPaymentSlug', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const activeWebApp = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectActiveWebApp)(global, tabId);
  if (!activeWebApp?.url) return undefined;
  const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(activeWebApp);
  return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.updateWebApp)(global, key, {
    slug: payload.slug
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('cancelBotTrustRequest', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    botTrustRequest: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('markBotTrusted', (global, actions, payload) => {
  const {
    botId,
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const {
    trustedBotIds
  } = global;
  const newTrustedBotIds = new Set(trustedBotIds);
  newTrustedBotIds.add(botId);
  global = {
    ...global,
    trustedBotIds: Array.from(newTrustedBotIds)
  };
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  if (tabState.botTrustRequest?.onConfirm) {
    const {
      action,
      payload: callbackPayload
    } = tabState.botTrustRequest.onConfirm;
    // @ts-expect-error -- No idea how to type this properly
    actions[action]({
      ...callbackPayload,
      isWriteAllowed
    });
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    botTrustRequest: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('sendWebAppEvent', (global, actions, payload) => {
  const {
    event,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const webApp = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectWebApp)(global, webAppKey, tabId);
  if (!webApp) return global;
  const newPlannedEvents = webApp.plannedEvents ? [...webApp.plannedEvents, event] : [event];
  actions.updateWebApp({
    key: webAppKey,
    update: {
      plannedEvents: newPlannedEvents
    },
    tabId
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('cancelAttachBotInstall', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedAttachBotInstall: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('requestAttachBotInChat', (global, actions, payload) => {
  const {
    bot,
    filter,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const currentChatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global, tabId)?.chatId;
  const supportedFilters = bot.attachMenuPeerTypes?.filter(type => type !== 'self' && filter.includes(type));
  if (!supportedFilters?.length) {
    actions.callAttachBot({
      chatId: currentChatId || bot.id,
      bot,
      startParam,
      tabId
    });
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedAttachBotInChat: {
      bot,
      filter: supportedFilters,
      startParam
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('cancelAttachBotInChat', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedAttachBotInChat: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openEmojiStatusAccessModal', (global, actions, payload) => {
  const {
    bot,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!bot || !webAppKey) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    emojiStatusAccessModal: {
      bot,
      webAppKey
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeEmojiStatusAccessModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    emojiStatusAccessModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openLocationAccessModal', (global, actions, payload) => {
  const {
    bot,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!bot || !webAppKey) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    locationAccessModal: {
      bot,
      webAppKey
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeLocationAccessModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    locationAccessModal: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/chats.ts":
/*!****************************************!*\
  !*** ./src/global/actions/ui/chats.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");







(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    type = 'thread',
    shouldReplaceHistory = false,
    shouldReplaceLast = false,
    noForumTopicPanel,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global, tabId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  if (tabState.premiumModal?.promo && tabState.premiumModal?.isOpen) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
      premiumModal: {
        ...tabState.premiumModal,
        isOpen: false
      }
    }, tabId);
  }
  actions.hideEffectInComposer({
    tabId
  });
  actions.closeStoryViewer({
    tabId
  });
  actions.closeStarsBalanceModal({
    tabId
  });
  actions.closeStarsTransactionModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  actions.closeGiftAuctionModal({
    tabId
  });
  if (!currentMessageList || currentMessageList.chatId !== chatId || currentMessageList.threadId !== threadId || currentMessageList.type !== type) {
    if (chatId) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [], tabId);
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
        activeReactions: {},
        shouldPreventComposerAnimation: true
      }, tabId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.closeMiddleSearch)(global, chatId, threadId, tabId);
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.exitMessageSelectMode)(global, tabId);
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
      isStatisticsShown: false,
      monetizationStatistics: undefined,
      boostStatistics: undefined,
      contentToBeScheduled: undefined,
      ...(chatId !== (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).forwardMessages.toChatId && {
        forwardMessages: {},
        isShareMessageModalShown: false
      }),
      // Reset chat info state for new chat
      chatInfo: {
        isOpen: tabState.chatInfo.isOpen
      }
    }, tabId);
  }
  if (chatId) {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
    if (chat?.isForum && !noForumTopicPanel) {
      actions.openForumPanel({
        chatId,
        tabId
      });
    } else if (chatId !== (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).forumPanelChatId) {
      actions.closeForumPanel({
        tabId
      });
    }
  }
  actions.updatePageTitle({
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateCurrentMessageList)(global, chatId, threadId, type, shouldReplaceHistory, shouldReplaceLast, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openChatInNewTab', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const hashUrl = (0,_util_routing__WEBPACK_IMPORTED_MODULE_2__.createMessageHashUrl)(chatId, 'thread', threadId);
  window.open(hashUrl, '_blank');
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openPreviousChat', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  actions.updatePageTitle({
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateCurrentMessageList)(global, undefined, undefined, undefined, undefined, undefined, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openChatWithInfo', (global, actions, payload) => {
  const {
    profileTab,
    forceScrollProfileTab,
    isOwnProfile,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)(),
    ...rest
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global, tabId);
  const isSameMessageList = currentMessageList?.chatId === rest.id && currentMessageList?.threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && currentMessageList?.type === (rest.type || 'thread');
  processChatInfoState({
    global,
    isSameMessageList,
    profileTab,
    forceScrollProfileTab,
    isOwnProfile,
    tabId
  });
  actions.openChat({
    ...rest,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openThreadWithInfo', (global, actions, payload) => {
  const {
    profileTab,
    forceScrollProfileTab,
    isOwnProfile,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)(),
    ...rest
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global, tabId);
  const isSameMessageList = currentMessageList?.chatId === rest.chatId && currentMessageList?.threadId === rest.threadId && currentMessageList?.type === (rest.type || 'thread');
  processChatInfoState({
    global,
    isSameMessageList,
    profileTab,
    forceScrollProfileTab,
    isOwnProfile,
    tabId
  });
  actions.openThread({
    ...rest,
    tabId
  });
});
function processChatInfoState({
  global,
  isSameMessageList,
  profileTab,
  forceScrollProfileTab,
  isOwnProfile,
  tabId
}) {
  const currentChatInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId).chatInfo;
  const newProfileTab = profileTab ?? (isSameMessageList ? currentChatInfo.profileTab : undefined);
  const newForceScrollProfileTab = forceScrollProfileTab ?? (isSameMessageList ? currentChatInfo.forceScrollProfileTab : undefined);
  const newIsOwnProfile = isOwnProfile ?? (isSameMessageList ? currentChatInfo.isOwnProfile : undefined);
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.execAfterActions)(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId),
      chatInfo: {
        isOpen: true,
        profileTab: newProfileTab,
        forceScrollProfileTab: newForceScrollProfileTab,
        isOwnProfile: newIsOwnProfile
      }
    }, tabId);
    global = {
      ...global,
      lastIsChatInfoShown: true
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openChatWithDraft', (global, actions, payload) => {
  const {
    chatId,
    text,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    files,
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (chatId) {
    actions.openThread({
      chatId,
      threadId,
      tabId
    });
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedDraft: {
      chatId,
      text,
      files,
      filter
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('resetChatCreation', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    chatCreation: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('setNewChatMembersDialogState', (global, actions, payload) => {
  const {
    newChatMembersProgress,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    newChatMembersProgress
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openNextChat', (global, actions, payload) => {
  const {
    targetIndexDelta,
    orderedIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    actions.openChat({
      id: orderedIds[0],
      tabId
    });
    return;
  }
  const position = orderedIds.indexOf(chatId);
  if (position === -1) {
    return;
  }
  const nextId = orderedIds[position + targetIndexDelta];
  actions.openChat({
    id: nextId,
    shouldReplaceHistory: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closeDeleteChatFolderModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    deleteFolderDialogModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closeChatlistModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    chatlistModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('requestChatTranslation', (global, actions, payload) => {
  const {
    chatId,
    toLanguageCode,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateRequestedChatTranslation)(global, chatId, toLanguageCode, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closeChatInviteModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    chatInviteModal: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/globalSearch.ts":
/*!***********************************************!*\
  !*** ./src/global/actions/ui/globalSearch.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





const MAX_RECENTLY_FOUND_IDS = 10;
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    currentContent
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).globalSearch;
  const fetchingStatus = query && currentContent !== _types__WEBPACK_IMPORTED_MODULE_0__.GlobalSearchContent.BotApps && currentContent !== _types__WEBPACK_IMPORTED_MODULE_0__.GlobalSearchContent.PublicPosts ? {
    chats: !chatId,
    messages: true
  } : undefined;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearch)(global, {
    globalResults: {},
    localResults: {},
    resultsByType: undefined,
    fetchingStatus,
    query
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchClosing', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)(),
    isClosing
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearch)(global, {
    isClosing
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('addRecentlyFoundChatId', (global, actions, payload) => {
  const {
    id
  } = payload;
  const {
    recentlyFoundChatIds
  } = global;
  if (!recentlyFoundChatIds) {
    return {
      ...global,
      recentlyFoundChatIds: [id]
    };
  }
  const newRecentIds = recentlyFoundChatIds.filter(chatId => chatId !== id);
  newRecentIds.unshift(id);
  if (newRecentIds.length > MAX_RECENTLY_FOUND_IDS) {
    newRecentIds.pop();
  }
  return {
    ...global,
    recentlyFoundChatIds: newRecentIds
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('clearRecentlyFoundChats', global => {
  return {
    ...global,
    recentlyFoundChatIds: undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchContent', (global, actions, payload) => {
  const {
    content,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearchContent)(global, content, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchChatId', (global, actions, payload) => {
  const {
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearch)(global, {
    chatId: id,
    query: undefined,
    resultsByType: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/mediaViewer.ts":
/*!**********************************************!*\
  !*** ./src/global/actions/ui/mediaViewer.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _helpers_replies__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_media__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors/media */ "./src/global/selectors/media.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openMediaViewer', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    messageId,
    timestamp,
    mediaIndex,
    isAvatarView,
    isSponsoredMessage,
    origin,
    withDynamicLoading,
    standaloneMedia,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...tabState.mediaViewer,
      chatId,
      threadId,
      messageId,
      mediaIndex: mediaIndex || 0,
      isAvatarView,
      isSponsoredMessage,
      origin,
      standaloneMedia,
      isHidden: false,
      withDynamicLoading,
      timestamp
    },
    forwardMessages: {},
    isShareMessageModalShown: false
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeMediaViewer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    volume,
    isMuted,
    playbackRate,
    isHidden
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      volume,
      isMuted,
      isHidden,
      playbackRate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openMediaFromTimestamp', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    threadId,
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_4__.getMessageReplyInfo)(message);
  const replyMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectReplyMessage)(global, message);
  const messageMedia = (0,_selectors_media__WEBPACK_IMPORTED_MODULE_8__.selectTimestampableMedia)(global, message);
  const maxMessageDuration = messageMedia?.duration;
  if (maxMessageDuration) {
    if (maxMessageDuration <= timestamp) return;
    if (messageMedia.mediaType === 'video') {
      actions.openMediaViewer({
        chatId,
        messageId,
        threadId,
        origin: _types__WEBPACK_IMPORTED_MODULE_1__.MediaViewerOrigin.Inline,
        timestamp,
        tabId
      });
      return;
    }
    actions.openAudioPlayer({
      chatId,
      messageId,
      threadId,
      origin: _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline,
      timestamp,
      tabId
    });
    return;
  }
  const replyMessageMedia = replyMessage ? (0,_selectors_media__WEBPACK_IMPORTED_MODULE_8__.selectTimestampableMedia)(global, replyMessage) : undefined;
  const maxReplyMessageDuration = replyMessageMedia?.duration;
  if (!maxReplyMessageDuration || maxReplyMessageDuration <= timestamp) return;
  if (replyMessageMedia.mediaType === 'video') {
    actions.openMediaViewer({
      chatId: replyMessage.chatId,
      messageId: replyMessage.id,
      threadId: replyInfo?.replyToTopId,
      origin: _types__WEBPACK_IMPORTED_MODULE_1__.MediaViewerOrigin.Inline,
      timestamp,
      tabId
    });
    return;
  }
  actions.openAudioPlayer({
    chatId: replyMessage.chatId,
    messageId: replyMessage.id,
    threadId: replyInfo?.replyToTopId,
    origin: _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline,
    timestamp,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updateLastPlaybackTimestamp', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    timestamp
  } = payload;
  const currentChatPlaybacks = global.messages.playbackByChatId[chatId]?.byId || {};
  if (!timestamp) {
    return {
      ...global,
      messages: {
        ...global.messages,
        playbackByChatId: {
          ...global.messages.playbackByChatId,
          [chatId]: {
            byId: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.omit)(currentChatPlaybacks, [messageId])
          }
        }
      }
    };
  }
  return {
    ...global,
    messages: {
      ...global.messages,
      playbackByChatId: {
        ...global.messages.playbackByChatId,
        [chatId]: {
          byId: {
            ...currentChatPlaybacks,
            [messageId]: timestamp
          }
        }
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerVolume', (global, actions, payload) => {
  const {
    volume,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      volume,
      isMuted: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerPlaybackRate', (global, actions, payload) => {
  const {
    playbackRate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = {
    ...global,
    mediaViewer: {
      ...global.mediaViewer,
      lastPlaybackRate: playbackRate
    }
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      playbackRate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerHidden', (global, actions, payload) => {
  const {
    isHidden,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      isHidden
    }
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/messages.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/ui/messages.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _versionNotification_txt__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../versionNotification.txt */ "./src/versionNotification.txt");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_messageSummary__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers/messageSummary */ "./src/global/helpers/messageSummary.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _helpers_renderMessageSummaryHtml__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../helpers/renderMessageSummaryHtml */ "./src/global/helpers/renderMessageSummaryHtml.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_media__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../api/messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
























const FOCUS_DURATION = 1500;
const FOCUS_NO_HIGHLIGHT_DURATION = _config__WEBPACK_IMPORTED_MODULE_2__.SCROLL_MAX_DURATION + _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_END_DELAY;
const POLL_RESULT_OPEN_DELAY_MS = 450;
const VERSION_NOTIFICATION_DURATION = 1000 * 60 * 60 * 24 * 7; // 7 days
const SERVICE_NOTIFICATIONS_MAX_AMOUNT = 1e3;
let blurTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setScrollOffset', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    scrollOffset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, 'lastScrollOffset', scrollOffset);
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'scrollOffset', scrollOffset, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setEditingId', (global, actions, payload) => {
  const {
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId,
    type
  } = currentMessageList;
  const paramName = type === 'scheduled' ? 'editingScheduledId' : 'editingId';
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, paramName, messageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setEditingDraft', (global, actions, payload) => {
  const {
    text,
    chatId,
    threadId,
    type
  } = payload;
  const paramName = type === 'scheduled' ? 'editingScheduledDraft' : 'editingDraft';
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, paramName, text);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('editLastMessage', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectViewportIds)(global, chatId, threadId, tabId);
  if (!chatMessages || !viewportIds) {
    return undefined;
  }
  const lastOwnEditableMessageId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.findLast)(viewportIds, id => {
    return Boolean(chatMessages[id] && (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectAllowedMessageActionsSlow)(global, chatMessages[id], threadId).canEdit);
  });
  if (!lastOwnEditableMessageId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, 'editingId', lastOwnEditableMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('replyToNextMessage', (global, actions, payload) => {
  const {
    targetIndexDelta,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return;
  }
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectViewportIds)(global, chatId, threadId, tabId);
  if (!chatMessages || !viewportIds) {
    return;
  }
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const isLatest = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsViewportNewest)(global, chatId, threadId, tabId);
  let messageId;
  if (!isLatest || !replyInfo?.replyToMsgId) {
    if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
      messageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, chatId);
    } else {
      const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectThreadInfo)(global, chatId, threadId);
      messageId = threadInfo?.lastMessageId;
    }
  } else {
    const chatMessageKeys = Object.keys(chatMessages);
    const indexOfCurrent = chatMessageKeys.indexOf(replyInfo.replyToMsgId.toString());
    const newIndex = indexOfCurrent + targetIndexDelta;
    messageId = newIndex <= chatMessageKeys.length + 1 && newIndex >= 0 ? Number(chatMessageKeys[newIndex]) : undefined;
  }
  actions.updateDraftReplyInfo({
    replyToMsgId: messageId,
    replyToPeerId: undefined,
    quoteText: undefined,
    tabId
  });
  actions.focusMessage({
    chatId,
    threadId,
    messageId: messageId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openAudioPlayer', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    messageId,
    origin,
    playbackRate,
    isMuted,
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      chatId,
      threadId,
      messageId,
      timestamp,
      origin: origin ?? tabState.audioPlayer.origin,
      playbackRate: playbackRate || tabState.audioPlayer.playbackRate || global.audioPlayer.lastPlaybackRate,
      isPlaybackRateActive: tabState.audioPlayer.isPlaybackRateActive === undefined ? global.audioPlayer.isLastPlaybackRateActive : tabState.audioPlayer.isPlaybackRateActive,
      isMuted: isMuted || tabState.audioPlayer.isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerVolume', (global, actions, payload) => {
  const {
    volume,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      isMuted: false
    }
  }, tabId);
  global = {
    ...global,
    audioPlayer: {
      ...global.audioPlayer,
      volume
    }
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerPlaybackRate', (global, actions, payload) => {
  const {
    playbackRate,
    isPlaybackRateActive,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = {
    ...global,
    audioPlayer: {
      ...global.audioPlayer,
      lastPlaybackRate: playbackRate,
      isLastPlaybackRateActive: isPlaybackRateActive
    }
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      playbackRate,
      isPlaybackRateActive
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerOrigin', (global, actions, payload) => {
  const {
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      origin
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeAudioPlayer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      playbackRate: tabState.audioPlayer.playbackRate,
      isPlaybackRateActive: tabState.audioPlayer.isPlaybackRateActive,
      isMuted: tabState.audioPlayer.isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPollResults', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const shouldOpenInstantly = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsRightColumnShown)(global, (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_23__.getIsMobile)(), tabId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!shouldOpenInstantly) {
    window.setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
        pollResults: {
          chatId,
          messageId,
          voters: {}
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    }, POLL_RESULT_OPEN_DELAY_MS);
  } else if (chatId !== tabState.pollResults.chatId || messageId !== tabState.pollResults.messageId) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      pollResults: {
        chatId,
        messageId,
        voters: {}
      }
    }, tabId);
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePollResults', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    pollResults: {}
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('focusNextReply', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const replyStack = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectReplyStack)(global, chatId, threadId, tabId);
  if (!replyStack || replyStack.length === 0) {
    actions.scrollMessageListToBottom({
      tabId
    });
  } else {
    const messageId = replyStack.pop();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [...replyStack], tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    actions.focusMessage({
      chatId,
      threadId,
      messageId: messageId,
      tabId,
      noForumTopicPanel: true
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('focusMessage', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    messageListType = 'thread',
    noHighlight,
    groupedId,
    groupedChatId,
    replyMessageId,
    isResizingContainer,
    shouldReplaceHistory,
    noForumTopicPanel,
    quote,
    quoteOffset,
    scrollTargetPosition,
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  let {
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  if (!chat) {
    actions.showNotification({
      message: {
        key: 'ErrorFocusInaccessibleMessage'
      },
      tabId
    });
    return undefined;
  }
  const onMessageReady = timestamp ? () => actions.openMediaFromTimestamp({
    chatId,
    threadId,
    messageId,
    timestamp,
    tabId
  }) : undefined;
  if (groupedId !== undefined) {
    const ids = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectForwardedMessageIdsByGroupId)(global, groupedChatId, groupedId);
    if (ids?.length) {
      [messageId] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.compact)(ids);
    }
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  const shouldSwitchChat = !currentMessageList || chatId !== currentMessageList.chatId || threadId !== currentMessageList.threadId || messageListType !== currentMessageList.type;
  if (blurTimeout) {
    clearTimeout(blurTimeout);
    blurTimeout = undefined;
  }
  blurTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)(global, undefined, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  }, noHighlight ? FOCUS_NO_HIGHLIGHT_DURATION : FOCUS_DURATION);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)(global, {
    chatId,
    messageId,
    threadId,
    noHighlight,
    isResizingContainer,
    quote,
    quoteOffset,
    scrollTargetPosition,
    direction: undefined
  }, tabId);
  if (replyMessageId) {
    const replyStack = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectReplyStack)(global, chatId, threadId, tabId) || [];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [...replyStack, replyMessageId], tabId);
  }
  if (shouldSwitchChat) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)(global, {
      direction: _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Static
    }, tabId);
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectViewportIds)(global, chatId, threadId, tabId);
  if (viewportIds && viewportIds.includes(messageId)) {
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global, {
      forceOnHeavyAnimation: true
    });
    actions.openThread({
      chatId,
      threadId,
      type: messageListType,
      shouldReplaceHistory,
      noForumTopicPanel,
      tabId
    });
    onMessageReady?.();
    return undefined;
  }
  if (shouldSwitchChat) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'viewportIds', undefined, tabId);
  }
  if (viewportIds && !shouldSwitchChat) {
    const direction = messageId > viewportIds[0] ? _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Down : _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Up;
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)(global, {
      direction
    }, tabId);
  }
  if ((0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_3__.isAnimatingScroll)()) {
    (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_3__.cancelScrollBlockingAnimation)();
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global, {
    forceOnHeavyAnimation: true
  });
  actions.openThread({
    chatId,
    threadId,
    type: messageListType,
    shouldReplaceHistory,
    noForumTopicPanel,
    tabId
  });
  actions.loadViewportMessages({
    chatId,
    threadId,
    tabId,
    shouldForceRender: true,
    onLoaded: onMessageReady
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('scrollMessageListToBottom', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)(global, {
    chatId,
    threadId,
    messageId: undefined,
    scrollTargetPosition: 'end',
    direction: _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Down,
    noHighlight: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global, {
    forceOnHeavyAnimation: true
  });

  // Reuse part of `focusMessage`
  if (blurTimeout) {
    clearTimeout(blurTimeout);
    blurTimeout = undefined;
  }
  blurTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)(global, undefined, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  }, FOCUS_NO_HIGHLIGHT_DURATION);
  if ((0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_3__.isAnimatingScroll)()) {
    (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_3__.cancelScrollBlockingAnimation)();
  }
  const isViewportNewest = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsViewportNewest)(global, chatId, threadId, tabId);
  if (isViewportNewest) {
    return;
  }
  actions.loadViewportMessages({
    chatId,
    threadId,
    tabId,
    shouldForceRender: true,
    forceLastSlice: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setShouldPreventComposerAnimation', (global, actions, payload) => {
  const {
    shouldPreventComposerAnimation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    shouldPreventComposerAnimation
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openReplyMenu', (global, actions, payload) => {
  const {
    fromChatId,
    messageId,
    quoteText,
    quoteOffset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    replyingMessage: {
      fromChatId,
      messageId,
      quoteText,
      quoteOffset
    },
    isShareMessageModalShown: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openForwardMenu', (global, actions, payload) => {
  const {
    fromChatId,
    messageIds,
    storyId,
    groupedId,
    withMyScore,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  let groupedMessageIds;
  if (groupedId) {
    groupedMessageIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectMessageIdsByGroupId)(global, fromChatId, groupedId);
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      fromChatId,
      messageIds: groupedMessageIds || messageIds,
      storyId,
      withMyScore
    },
    isShareMessageModalShown: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('changeRecipient', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).forwardMessages,
      toChatId: undefined,
      noAuthors: false,
      noCaptions: false
    },
    isShareMessageModalShown: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setForwardNoAuthors', (global, actions, payload) => {
  const {
    noAuthors,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...tabState.forwardMessages,
      noAuthors,
      // `noCaptions` cannot be true when `noAuthors` is false
      noCaptions: noAuthors && tabState.forwardMessages.noCaptions
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setForwardNoCaptions', (global, actions, payload) => {
  const {
    noCaptions,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).forwardMessages,
      noCaptions,
      noAuthors: noCaptions // On other clients `noAuthors` updates together with `noCaptions`
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('exitForwardMode', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    isShareMessageModalShown: false,
    forwardMessages: {},
    replyingMessage: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openForwardMenuForSelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId: fromChatId,
    messageIds
  } = tabState.selectedMessages;
  const forwardableMessageIds = messageIds.filter(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessage)(global, fromChatId, id);
    return message && (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCanForwardMessage)(global, message);
  });
  if (!forwardableMessageIds.length) {
    return;
  }
  actions.openForwardMenu({
    fromChatId,
    messageIds: forwardableMessageIds,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('cancelMediaDownload', (global, actions, payload) => {
  const {
    media,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const hash = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaHash)(media, 'download');
  if (!hash) return undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.cancelMessageMediaDownload)(global, [hash], tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('cancelMediaHashDownloads', (global, actions, payload) => {
  const {
    mediaHashes,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.cancelMessageMediaDownload)(global, mediaHashes, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('downloadMedia', (global, actions, payload) => {
  const {
    media,
    originMessage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const hash = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaHash)(media, 'download');
  if (!hash) return undefined;
  const size = 'size' in media ? media.size : 0;
  const metadata = {
    size,
    format: (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaFormat)(media, 'download'),
    filename: (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaFilename)(media),
    originChatId: originMessage?.chatId,
    originMessageId: originMessage?.id
  };
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.addActiveMediaDownload)(global, hash, metadata, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('downloadSelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId,
    messageIds
  } = tabState.selectedMessages;
  const {
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId) || {};
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  if (!chatMessages || !threadId) return;
  const messages = messageIds.map(id => chatMessages[id]).filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectAllowedMessageActionsSlow)(global, message, threadId).canDownload);
  messages.forEach(message => {
    const media = (0,_selectors_media__WEBPACK_IMPORTED_MODULE_21__.selectMessageDownloadableMedia)(global, message);
    if (!media) return;
    actions.downloadMedia({
      media,
      originMessage: message,
      tabId
    });
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('enterMessageSelectMode', (global, actions, payload) => {
  const {
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const openChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  if (!openChat) {
    return global;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.enterMessageSelectMode)(global, openChat.id, messageId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('toggleMessageSelection', (global, actions, payload) => {
  const {
    messageId,
    groupedId,
    childMessageIds,
    withShift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.toggleMessageSelection)(global, chatId, threadId, messageListType, messageId, groupedId, childMessageIds, withShift, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  if (global.shouldShowContextMenuHint) {
    actions.disableContextMenuHint();
    actions.showNotification({
      message: {
        key: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV ? 'ContextMenuHintTouch' : 'ContextMenuHintMouse'
      },
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('disableContextMenuHint', global => {
  if (!global.shouldShowContextMenuHint) {
    return undefined;
  }
  return {
    ...global,
    shouldShowContextMenuHint: false
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('exitMessageSelectMode', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.exitMessageSelectMode)(global, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPollModal', (global, actions, payload) => {
  const {
    isQuiz,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    pollModal: {
      isOpen: true,
      isQuiz
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePollModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    pollModal: {
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openTodoListModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    forNewTask,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    todoListModal: {
      chatId,
      messageId,
      forNewTask
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_14__.addTabStateResetterAction)('closeTodoListModal', 'todoListModal');
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('checkVersionNotification', (global, actions) => {
  if ( true && Date.now() > 1768300699000 + VERSION_NOTIFICATION_DURATION) {
    return;
  }
  const currentVersion = "12.0.16".split('.').slice(0, 2).join('.');
  const {
    serviceNotifications
  } = global;
  if (serviceNotifications.find(({
    version
  }) => version === currentVersion)) {
    return;
  }
  const message = {
    chatId: _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID,
    date: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_10__.getServerTime)(),
    content: {
      text: (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_9__["default"])(_versionNotification_txt__WEBPACK_IMPORTED_MODULE_11__, true)
    },
    isOutgoing: false
  };
  actions.createServiceNotification({
    message: message,
    version: currentVersion
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('createServiceNotification', (global, actions, payload) => {
  const {
    message,
    version
  } = payload;
  const {
    serviceNotifications
  } = global;
  const maxId = Math.max((0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID) || 0, ...serviceNotifications.map(({
    id
  }) => id));
  const fractionalPart = (serviceNotifications.length + 1) / SERVICE_NOTIFICATIONS_MAX_AMOUNT;
  // The fractional ID is made of the largest integer ID and an incremented fractional part
  const id = Math.floor(maxId) + fractionalPart;
  message.previousLocalId = message.id;
  message.id = id;
  const serviceNotification = {
    id,
    message,
    version,
    isUnread: true
  };
  global = {
    ...global,
    serviceNotifications: [...serviceNotifications.slice(-SERVICE_NOTIFICATIONS_MAX_AMOUNT), serviceNotification]
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'newMessage',
    id: message.id,
    chatId: message.chatId,
    message
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openReactorListModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reactorModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeReactorListModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reactorModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openSeenByModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    seenByModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSeenByModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    seenByModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPrivacySettingsNoticeModal', (global, actions, payload) => {
  const {
    chatId,
    isReadDate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    privacySettingsNoticeModal: {
      chatId,
      isReadDate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePrivacySettingsNoticeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    privacySettingsNoticeModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openChatLanguageModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const activeLanguage = messageId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectRequestedMessageTranslationLanguage)(global, chatId, messageId, tabId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectRequestedChatTranslationLanguage)(global, chatId, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    chatLanguageModal: {
      chatId,
      messageId,
      activeLanguage
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeChatLanguageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    chatLanguageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('copySelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId,
    messageIds
  } = tabState.selectedMessages;
  copyTextForMessages(global, chatId, messageIds);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('copyMessagesByIds', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  if (!messageIds || messageIds.length === 0 || !chat) {
    return;
  }
  copyTextForMessages(global, chat.id, messageIds);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openOneTimeMediaModal', (global, actions, payload) => {
  const {
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    oneTimeMediaModal: {
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeOneTimeMediaModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    oneTimeMediaModal: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeReportAdModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportAdModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeReportModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPreviousReportAdModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const reportAdModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).reportAdModal;
  if (!reportAdModal) {
    return undefined;
  }
  if (reportAdModal.sections.length === 1) {
    actions.closeReportAdModal({
      tabId
    });
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportAdModal: {
      ...reportAdModal,
      sections: reportAdModal.sections.slice(0, -1)
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPreviousReportModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const reportModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).reportModal;
  if (!reportModal) {
    return undefined;
  }
  if (reportModal.sections.length === 1) {
    actions.closeReportModal({
      tabId
    });
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportModal: {
      ...reportModal,
      sections: reportModal.sections.slice(0, -1)
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPaidReactionModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    paidReactionModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePaidReactionModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    paidReactionModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openSuggestMessageModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestMessageModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSuggestMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openSuggestedPostApprovalModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestedPostApprovalModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSuggestedPostApprovalModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestedPostApprovalModal: undefined
  }, tabId);
});
function copyTextForMessages(global, chatId, messageIds) {
  const {
    type: messageListType,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global) || {};
  const lang = (0,_util_localization__WEBPACK_IMPORTED_MODULE_8__.getTranslationFn)();
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  const chatMessages = messageListType === 'scheduled' ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatScheduledMessages)(global, chatId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  if (!chat || !chatMessages || !threadId) return;
  const messages = messageIds.map(id => chatMessages[id]).filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectAllowedMessageActionsSlow)(global, message, threadId).canCopy).sort((message1, message2) => message1.id - message2.id);
  const resultHtml = [];
  const resultText = [];
  messages.forEach(message => {
    const sender = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.isChatChannel)(chat) ? chat : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSender)(global, message);
    const senderTitle = `> ${sender ? (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_15__.getPeerTitle)(lang, sender) : message.forwardInfo?.hiddenUserName || ''}:`;
    const statefulContent = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMessageStatefulContent)(global, message);
    resultHtml.push(senderTitle);
    resultHtml.push(`${(0,_helpers_renderMessageSummaryHtml__WEBPACK_IMPORTED_MODULE_16__.renderMessageSummaryHtml)(lang, message)}\n`);
    resultText.push(senderTitle);
    resultText.push(`${(0,_helpers_messageSummary__WEBPACK_IMPORTED_MODULE_13__.getMessageSummaryText)(lang, message, statefulContent, false, 0, true)}\n`);
  });
  (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_5__.copyHtmlToClipboard)(resultHtml.join('\n'), resultText.join('\n'));
}
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openDeleteMessageModal', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    isSchedule,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    deleteMessageModal: {
      chatId,
      messageIds,
      isSchedule
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeDeleteMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    deleteMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openAboutAdsModal', (global, actions, payload) => {
  const {
    randomId,
    additionalInfo,
    canReport,
    sponsorInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    aboutAdsModal: {
      randomId,
      canReport,
      additionalInfo,
      sponsorInfo
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeAboutAdsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    aboutAdsModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePreparedInlineMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    preparedMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSharePreparedMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    sharePreparedMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('updateSharePreparedMessageModalSendArgs', async (global, actions, payload) => {
  const {
    args,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.sharePreparedMessageModal) {
    return;
  }
  if (!args) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      sharePreparedMessageModal: {
        ...tabState.sharePreparedMessageModal,
        pendingSendArgs: undefined
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const starsForSendMessage = await (0,_api_messages__WEBPACK_IMPORTED_MODULE_22__.getPeerStarsForMessage)(global, args.peerId);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    sharePreparedMessageModal: {
      ...tabState.sharePreparedMessageModal,
      pendingSendArgs: {
        peerId: args.peerId,
        threadId: args.threadId,
        starsForSendMessage
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openQuickPreview', (global, actions, payload) => {
  const {
    id: chatId,
    threadId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    quickPreview: {
      chatId,
      threadId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeQuickPreview', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    quickPreview: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/middleSearch.ts":
/*!***********************************************!*\
  !*** ./src/global/actions/ui/middleSearch.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMiddleSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMiddleSearch)(global, chatId, threadId, {}, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeMiddleSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.closeMiddleSearch)(global, chatId, threadId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateMiddleSearch', (global, actions, payload) => {
  const {
    update,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  let chatId;
  let threadId;
  if (payload.chatId) {
    chatId = payload.chatId;
    threadId = payload.threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  } else {
    const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId);
    if (!currentMessageList) {
      return undefined;
    }
    chatId = currentMessageList.chatId;
    threadId = currentMessageList.threadId;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMiddleSearch)(global, chatId, threadId, update, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('resetMiddleSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.resetMiddleSearch)(global, chatId, threadId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setSharedMediaSearchType', (global, actions, payload) => {
  const {
    mediaType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateSharedMediaSearchType)(global, chatId, threadId, mediaType, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/misc.ts":
/*!***************************************!*\
  !*** ./src/global/actions/ui/misc.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   APP_VERSION_URL: () => (/* binding */ APP_VERSION_URL)
/* harmony export */ });
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_getIsAppUpdateNeeded__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/getIsAppUpdateNeeded */ "./src/util/getIsAppUpdateNeeded.ts");
/* harmony import */ var _util_getReadableErrorText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/getReadableErrorText */ "./src/util/getReadableErrorText.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_updateIcon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/updateIcon */ "./src/util/updateIcon.ts");
/* harmony import */ var _util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/updatePageTitle */ "./src/util/updatePageTitle.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_sharedState__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");




















const APP_VERSION_URL = 'version.txt';
const FLOOD_PREMIUM_WAIT_NOTIFICATION_DURATION = 6000;
const MAX_STORED_EMOJIS = 8 * 4; // Represents four rows of recent emojis

(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleChatInfo', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const chatInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).chatInfo;
  const willChatInfoBeShown = force !== undefined ? force : !chatInfo.isOpen;
  if (willChatInfoBeShown !== chatInfo.isOpen) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
      chatInfo: {
        ...chatInfo,
        isOpen: willChatInfoBeShown
      }
    }, tabId);
  }
  global = {
    ...global,
    lastIsChatInfoShown: willChatInfoBeShown
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('setLeftColumnWidth', (global, actions, payload) => {
  const {
    leftColumnWidth
  } = payload;
  return {
    ...global,
    leftColumnWidth
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('resetLeftColumnWidth', global => {
  return {
    ...global,
    leftColumnWidth: undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleManagement', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: force !== undefined ? force : !(tabState.management.byChatId[chatId] || {}).isActive
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('requestNextManagementScreen', (global, actions, payload) => {
  const {
    screen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: true,
          nextScreen: screen
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeManagement', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: false
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  if (!(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_19__.getIsMobile)() && !(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_19__.getIsTablet)()) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    isLeftColumnShown: (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).messageLists.length === 0
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('changeProfileTab', (global, actions, payload) => {
  const {
    profileTab,
    shouldScrollTo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const chatInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).chatInfo;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    chatInfo: {
      ...chatInfo,
      isOpen: true,
      profileTab,
      forceScrollProfileTab: shouldScrollTo
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    isStatisticsShown: !tabState.isStatisticsShown,
    statistics: {
      ...tabState.statistics,
      currentMessageId: undefined,
      currentStoryId: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleMessageStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)(),
    messageId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    statistics: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).statistics,
      currentMessageId: messageId,
      currentMessage: undefined,
      currentStoryId: undefined,
      currentStory: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleStoryStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)(),
    storyId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    statistics: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).statistics,
      currentStoryId: storyId,
      currentMessageId: undefined,
      currentMessage: undefined,
      currentStory: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleLeftColumn', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    isLeftColumnShown: !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).isLeftColumnShown
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('addRecentEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  const {
    recentEmojis
  } = global;
  if (!recentEmojis) {
    return {
      ...global,
      recentEmojis: [emoji]
    };
  }
  const newEmojis = recentEmojis.filter(e => e !== emoji);
  newEmojis.unshift(emoji);
  if (newEmojis.length > MAX_STORED_EMOJIS) {
    newEmojis.pop();
  }
  return {
    ...global,
    recentEmojis: newEmojis
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('addRecentSticker', (global, actions, payload) => {
  const {
    sticker
  } = payload;
  const {
    recent
  } = global.stickers;
  if (!recent) {
    return {
      ...global,
      stickers: {
        ...global.stickers,
        recent: {
          hash: '0',
          stickers: [sticker]
        }
      }
    };
  }
  const newStickers = recent.stickers.filter(s => s.id !== sticker.id);
  newStickers.unshift(sticker);
  return {
    ...global,
    stickers: {
      ...global.stickers,
      recent: {
        ...recent,
        stickers: newStickers
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('addRecentCustomEmoji', (global, actions, payload) => {
  const {
    documentId
  } = payload;
  const {
    recentCustomEmojis
  } = global;
  if (!recentCustomEmojis) {
    return {
      ...global,
      recentCustomEmojis: [documentId]
    };
  }
  const newEmojis = recentCustomEmojis.filter(id => id !== documentId);
  newEmojis.unshift(documentId);
  if (newEmojis.length > MAX_STORED_EMOJIS) {
    newEmojis.pop();
  }
  return {
    ...global,
    recentCustomEmojis: newEmojis
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('clearRecentCustomEmoji', global => {
  return {
    ...global,
    recentCustomEmojis: []
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('reorderStickerSets', (global, actions, payload) => {
  const {
    order,
    isCustomEmoji
  } = payload;
  return {
    ...global,
    stickers: {
      ...global.stickers,
      added: {
        setIds: !isCustomEmoji ? order : global.stickers.added.setIds
      }
    },
    customEmojis: {
      ...global.customEmojis,
      added: {
        setIds: isCustomEmoji ? order : global.customEmojis.added.setIds
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('showAllowedMessageTypesNotification', (global, actions, payload) => {
  const {
    chatId,
    messageListType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const paidMessagesStars = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectPeerPaidMessagesStars)(global, chatId);
  if (paidMessagesStars && messageListType === 'scheduled') {
    actions.showNotification({
      message: {
        key: 'DescriptionScheduledPaidMessagesNotAllowed'
      },
      tabId
    });
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
  if (!chat) return;
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatFullInfo)(global, chatId);
  const isSavedMessages = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatWithSelf)(global, chatId) : undefined;
  const isChatWithBot = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsChatWithBot)(global, chat) : undefined;
  const {
    canSendPlainText,
    canSendPhotos,
    canSendVideos,
    canSendDocuments,
    canSendAudios,
    canSendStickers,
    canSendRoundVideos,
    canSendVoices
  } = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getAllowedAttachmentOptions)(chat, chatFullInfo, isChatWithBot, isSavedMessages);
  const allowedContent = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.compact)([canSendPlainText ? 'Chat.SendAllowedContentTypeText' : undefined, canSendPhotos ? 'Chat.SendAllowedContentTypePhoto' : undefined, canSendVideos ? 'Chat.SendAllowedContentTypeVideo' : undefined, canSendVoices ? 'Chat.SendAllowedContentTypeVoiceMessage' : undefined, canSendRoundVideos ? 'Chat.SendAllowedContentTypeVideoMessage' : undefined, canSendDocuments ? 'Chat.SendAllowedContentTypeFile' : undefined, canSendAudios ? 'Chat.SendAllowedContentTypeMusic' : undefined, canSendStickers ? 'Chat.SendAllowedContentTypeSticker' : undefined]).map(l => _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate(l));
  if (!allowedContent.length) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate('Chat.SendNotAllowedText'),
      tabId
    });
    return;
  }
  const lastDelimiter = _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate('AutoDownloadSettings.LastDelimeter');
  const allowedContentString = allowedContent.join(', ').replace(/,([^,]*)$/, `${lastDelimiter}$1`);
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate('Chat.SendAllowedContentText', allowedContentString),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('showDialog', (global, actions, payload) => {
  const {
    data,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;

  // Filter out errors that we don't want to show to the user
  if ('message' in data && data.hasErrorKey && !(0,_util_getReadableErrorText__WEBPACK_IMPORTED_MODULE_7__["default"])(data)) {
    return global;
  }
  const newDialogs = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).dialogs];
  if ('message' in data) {
    const existingErrorIndex = newDialogs.findIndex(err => err.message === data.message);
    if (existingErrorIndex !== -1) {
      newDialogs.splice(existingErrorIndex, 1);
    }
  }
  newDialogs.push(data);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    dialogs: newDialogs
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('dismissDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const newDialogs = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId).dialogs];
  newDialogs.pop();
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    dialogs: newDialogs
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('toggleSafeLinkModal', (global, actions, payload) => {
  const {
    url: safeLinkModalUrl,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    safeLinkModalUrl
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openHistoryCalendar', (global, actions, payload) => {
  const {
    selectedAt,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    historyCalendarSelectedAt: selectedAt
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeHistoryCalendar', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    historyCalendarSelectedAt: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openGame', (global, actions, payload) => {
  const {
    url,
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const botId = message.viaBotId || (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectSender)(global, message)?.id;
  if (!botId) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'game',
        onConfirm: {
          action: 'openGame',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_15__.setGlobal)(global);
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    openedGame: {
      url,
      chatId,
      messageId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_15__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeGame', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    openedGame: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('requestConfetti', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)(),
    ...rest
  } = payload;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCanAnimateInterface)(global)) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    confetti: {
      lastConfettiTime: Date.now(),
      ...rest
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('requestWave', (global, actions, payload) => {
  const {
    startX,
    startY,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_WAVE_TRANSFORM_SUPPORTED || !(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCanAnimateInterface)(global)) return undefined;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, tabId);
  const currentLastTime = tabState.wave?.lastWaveTime || 0;
  if (Date.now() - currentLastTime < _config__WEBPACK_IMPORTED_MODULE_1__.ANIMATION_WAVE_MIN_INTERVAL) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    wave: {
      lastWaveTime: Date.now(),
      startX,
      startY
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('updateAttachmentSettings', (global, actions, payload) => {
  return {
    ...global,
    attachmentSettings: {
      ...global.attachmentSettings,
      ...payload
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('updateShouldSaveAttachmentsCompression', (global, actions, payload) => {
  const {
    shouldSave,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    shouldSaveAttachmentsCompression: shouldSave
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('applyDefaultAttachmentsCompression', global => {
  const {
    defaultAttachmentCompression
  } = global.attachmentSettings;
  const shouldCompress = defaultAttachmentCompression === 'compress';
  return {
    ...global,
    attachmentSettings: {
      ...global.attachmentSettings,
      shouldCompress
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('requestEffectInComposer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    shouldPlayEffectInComposer: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('hideEffectInComposer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    shouldPlayEffectInComposer: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('setPaidMessageAutoApprove', global => {
  global = {
    ...global,
    settings: {
      ...global.settings,
      byKey: {
        ...global.settings.byKey,
        shouldPaidMessageAutoApprove: true
      }
    }
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('setReactionEffect', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const emoticon = reaction?.type === 'emoji' && reaction.emoticon;
  if (!emoticon) return;
  const effect = Object.values(global.availableEffectById).find(currentEffect => currentEffect.effectAnimationId && currentEffect.emoticon === emoticon);
  const effectId = effect?.id;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectIsCurrentUserPremium)(global);
  if (effect?.isPremium && !isCurrentUserPremium) {
    actions.openPremiumModal({
      initialSection: 'effects',
      tabId
    });
    return;
  }
  if (!effectId) return;
  actions.requestEffectInComposer({
    tabId
  });
  actions.saveEffectInDraft({
    chatId,
    threadId,
    effectId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openLimitReachedModal', (global, actions, payload) => {
  const {
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    limitReachedModal: {
      limit
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeLimitReachedModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    limitReachedModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeStickerSetModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    openedStickerSetShortName: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openCustomEmojiSets', (global, actions, payload) => {
  const {
    setIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    openedCustomEmojiSetIds: setIds
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeCustomEmojiSets', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    openedCustomEmojiSetIds: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('updateLastRenderedCustomEmojis', (global, actions, payload) => {
  const {
    ids
  } = payload;
  const {
    lastRendered
  } = global.customEmojis;
  return {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      lastRendered: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.unique)([...lastRendered, ...ids]).slice(0, _config__WEBPACK_IMPORTED_MODULE_1__.GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT)
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openCreateTopicPanel', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;

  // Topic panel can be opened only if there is a selected chat
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!currentChat) actions.openChat({
    id: chatId,
    tabId
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    createTopicPanel: {
      chatId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeCreateTopicPanel', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    createTopicPanel: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openEditTopicPanel', (global, actions, payload) => {
  const {
    chatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;

  // Topic panel can be opened only if there is a selected chat
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentChat)(global, tabId);
  if (!currentChat) actions.openChat({
    id: chatId,
    tabId
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    editTopicPanel: {
      chatId,
      topicId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeEditTopicPanel', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    editTopicPanel: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('updateArchiveSettings', (global, actions, payload) => {
  const {
    archiveSettings
  } = global;
  const {
    isHidden = archiveSettings.isHidden,
    isMinimized = archiveSettings.isMinimized
  } = payload;
  return {
    ...global,
    archiveSettings: {
      isHidden,
      isMinimized
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openMapModal', (global, actions, payload) => {
  const {
    geoPoint,
    zoom,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    mapModal: {
      point: geoPoint,
      zoom
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeMapModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    mapModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('checkAppVersion', global => {
  fetch(`${APP_VERSION_URL}?${Date.now()}`).then(response => response.text()).then(version => {
    version = version.trim();
    if ((0,_util_getIsAppUpdateNeeded__WEBPACK_IMPORTED_MODULE_6__["default"])(version, "12.0.16")) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_15__.getGlobal)();
      global = {
        ...global,
        isAppUpdateAvailable: true
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_15__.setGlobal)(global);
    }
  }).catch(err => {
    if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
      // eslint-disable-next-line no-console
      console.error('[checkAppVersion failed] ', err);
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('afterHangUp', global => {
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()).multitabNextAction) return;
  (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.reestablishMasterToSelf)();
});
let notificationInterval;
const NOTIFICATION_INTERVAL = 500;
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('onTabFocusChange', (global, actions, payload) => {
  const {
    isBlurred,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  if (isBlurred) {
    if (notificationInterval) clearInterval(notificationInterval);
    notificationInterval = window.setInterval(() => {
      actions.updatePageTitle({
        tabId
      });
    }, NOTIFICATION_INTERVAL);
  } else {
    clearInterval(notificationInterval);
    notificationInterval = undefined;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    isBlurred
  }, tabId);
  return {
    ...global,
    initialUnreadNotifications: isBlurred ? (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_5__.getAllNotificationsCount)() : undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('updatePageTitle', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const {
    canDisplayChatInTitle
  } = (0,_selectors_sharedState__WEBPACK_IMPORTED_MODULE_18__.selectSharedSettings)(global);
  const currentUserId = global.currentUserId;
  const isTestServer = global.config?.isTestServer;
  const prefix = isTestServer ? '[T] ' : '';
  const defaultTitle = _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_TAURI ? _config__WEBPACK_IMPORTED_MODULE_1__.PAGE_TITLE_TAURI : _config__WEBPACK_IMPORTED_MODULE_1__.PAGE_TITLE;
  if (document.title.includes(_config__WEBPACK_IMPORTED_MODULE_1__.INACTIVE_MARKER)) {
    (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_11__["default"])(false);
    (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitleInstant)(`${prefix}${defaultTitle} ${_config__WEBPACK_IMPORTED_MODULE_1__.INACTIVE_MARKER}`);
    return;
  }

  // Show blinking title in browser tab
  if (!_util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_TAURI && global.initialUnreadNotifications && Math.round(Date.now() / 1000) % 2 === 0) {
    const notificationCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_5__.getAllNotificationsCount)();
    const newUnread = notificationCount - global.initialUnreadNotifications;
    if (newUnread > 0) {
      (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitleInstant)(`${prefix}${newUnread} notification${newUnread > 1 ? 's' : ''}`);
      (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_11__["default"])(true);
      return;
    }
  }
  (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_11__["default"])(false);
  const messageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectCurrentMessageList)(global, tabId);
  if (messageList && canDisplayChatInTitle && !global.passcode.isScreenLocked) {
    const {
      chatId,
      threadId
    } = messageList;
    const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectChat)(global, chatId);
    if (currentChat) {
      const title = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getChatTitle)(_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate, currentChat, chatId === currentUserId);
      const topic = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTopic)(global, chatId, threadId);
      if (currentChat.isForum && topic) {
        (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitle)(`${prefix}${title}  ${topic.title}`);
        return;
      }
      (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitle)(`${prefix}${title}`);
      return;
    }
  }
  (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitleInstant)(`${prefix}${defaultTitle}`);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeInviteViaLinkModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload ?? {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    inviteViaLinkModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('closeCollectibleInfoModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload ?? {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    collectibleInfoModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('openBirthdaySetupModal', (global, actions, payload) => {
  const {
    currentBirthday,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    birthdaySetupModal: {
      currentBirthday
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_14__.addTabStateResetterAction)('closeBirthdaySetupModal', 'birthdaySetupModal');
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('setShouldCloseRightColumn', (global, actions, payload) => {
  const {
    value,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_16__.updateTabState)(global, {
    shouldCloseRightColumn: value
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('refreshLangPackFromCache', (global, actions, payload) => {
  (0,_util_localization__WEBPACK_IMPORTED_MODULE_9__.refreshFromCache)(payload.langCode);
});
(0,_index__WEBPACK_IMPORTED_MODULE_15__.addActionHandler)('processPremiumFloodWait', (global, actions, payload) => {
  const {
    isUpload
  } = payload;
  const {
    bandwidthPremiumDownloadSpeedup,
    bandwidthPremiumUploadSpeedup,
    bandwidthPremiumNotifyPeriod
  } = global.appConfig;
  const {
    lastPremiumBandwithNotificationDate: lastNotifiedAt
  } = global.settings;
  if (!bandwidthPremiumDownloadSpeedup || !bandwidthPremiumUploadSpeedup || !bandwidthPremiumNotifyPeriod) {
    return undefined;
  }
  if (lastNotifiedAt && Date.now() < lastNotifiedAt + bandwidthPremiumNotifyPeriod * 1000) return undefined;
  const unblurredTabIds = Object.values(global.byTabId).filter(l => !l.isBlurred).map(l => l.id);
  unblurredTabIds.forEach(tabId => {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate(isUpload ? 'UploadSpeedLimited' : 'DownloadSpeedLimited'),
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate(isUpload ? 'UploadSpeedLimitedMessage' : 'DownloadSpeedLimitedMessage', isUpload ? bandwidthPremiumUploadSpeedup : bandwidthPremiumDownloadSpeedup),
      duration: FLOOD_PREMIUM_WAIT_NOTIFICATION_DURATION,
      tabId
    });
  });
  return {
    ...global,
    settings: {
      ...global.settings,
      lastPremiumBandwithNotificationDate: Date.now()
    }
  };
});
let prevIsScreenLocked;
let prevBlurredTabsCount = 0;
let onlineTimeout;
const ONLINE_TIMEOUT = 100;
(0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__.addCallback)(global => {
  const {
    updatePageTitle,
    updateIsOnline
  } = (0,_index__WEBPACK_IMPORTED_MODULE_15__.getActions)();
  const isLockedUpdated = global.passcode.isScreenLocked !== prevIsScreenLocked;
  const blurredTabsCount = Object.values(global.byTabId).filter(l => l.isBlurred).length;
  const isMasterTab = (0,_selectors__WEBPACK_IMPORTED_MODULE_17__.selectTabState)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()).isMasterTab;
  if (isLockedUpdated) {
    updatePageTitle();
  }
  if (blurredTabsCount !== prevBlurredTabsCount && isMasterTab) {
    if (onlineTimeout) clearTimeout(onlineTimeout);
    onlineTimeout = window.setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_15__.getGlobal)();
      const newBlurredTabsCount = Object.values(global.byTabId).filter(l => l.isBlurred).length;
      updateIsOnline({
        isOnline: newBlurredTabsCount !== (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getAllMultitabTokens)().length
      });
    }, ONLINE_TIMEOUT);
  }
  prevIsScreenLocked = global.passcode.isScreenLocked;
  prevBlurredTabsCount = blurredTabsCount;
});

/***/ }),

/***/ "./src/global/actions/ui/passcode.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/ui/passcode.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_passcode__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/passcode */ "./src/util/passcode.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_sessions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/sessions */ "./src/util/sessions.ts");
/* harmony import */ var _cache__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../cache */ "./src/global/cache.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _initialState__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../initialState */ "./src/global/initialState.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");











let noLockOnUnload = false;
(0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.onBeforeUnload)(() => {
  const global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  if (!global.isInited) return;
  if (global.passcode.hasPasscode && !noLockOnUnload && Object.keys(global.byTabId).length === 1) {
    (0,_util_sessions__WEBPACK_IMPORTED_MODULE_6__.clearStoredSession)();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setPasscode', async (global, actions, payload) => {
  const {
    passcode,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    isLoading: true
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  await (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.setupPasscode)(passcode);
  const sessionJson = JSON.stringify({
    ...(0,_util_sessions__WEBPACK_IMPORTED_MODULE_6__.loadStoredSession)(),
    userId: global.currentUserId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const globalJson = (0,_cache__WEBPACK_IMPORTED_MODULE_7__.serializeGlobal)((0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    hasPasscode: true,
    error: undefined,
    isLoading: false
  }));
  try {
    await (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.encryptSession)(sessionJson, globalJson);
    (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.signalPasscodeHash)();
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
      hasPasscode: true,
      error: undefined,
      isLoading: false
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    (0,_cache__WEBPACK_IMPORTED_MODULE_7__.forceUpdateCache)(true);
  } catch (err) {
    (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.forgetPasscode)();
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
      isLoading: false
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    actions.showNotification({
      message: 'Failed to set passcode',
      tabId
    });
    actions.openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_0__.SettingsScreens.PasscodeDisabled,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('clearPasscode', global => {
  void (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.clearEncryptedSession)();
  localStorage.removeItem(_config__WEBPACK_IMPORTED_MODULE_1__.IS_SCREEN_LOCKED_CACHE_KEY);
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.clearPasscodeSettings)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('unlockScreen', (global, actions, payload) => {
  const beforeTabStates = Object.values(global.byTabId);
  const {
    sessionJson,
    globalJson
  } = payload;
  const session = JSON.parse(sessionJson);
  (0,_util_sessions__WEBPACK_IMPORTED_MODULE_6__.storeSession)(session);
  const previousGlobal = global;
  global = JSON.parse(globalJson);
  global.byTabId = previousGlobal.byTabId;
  (0,_cache__WEBPACK_IMPORTED_MODULE_7__.migrateCache)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.cloneDeep)(_initialState__WEBPACK_IMPORTED_MODULE_9__.INITIAL_GLOBAL_STATE));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    isScreenLocked: false,
    error: undefined,
    invalidAttemptsCount: 0
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.signalPasscodeHash)();
  beforeTabStates.forEach(({
    id: tabId,
    isMasterTab
  }) => actions.init({
    tabId,
    isMasterTab
  }));
  actions.initApi();
});
const MAX_INVALID_ATTEMPTS = 5;
const TIMEOUT_RESET_INVALID_ATTEMPTS_MS = 1000 * 15; // 180000; // 3 minutes

(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('logInvalidUnlockAttempt', global => {
  const invalidAttemptsCount = (global.passcode?.invalidAttemptsCount ?? 0) + 1;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    invalidAttemptsCount,
    timeoutUntil: invalidAttemptsCount >= MAX_INVALID_ATTEMPTS ? Date.now() + TIMEOUT_RESET_INVALID_ATTEMPTS_MS : undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('resetInvalidUnlockAttempts', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    invalidAttemptsCount: 0,
    timeoutUntil: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setPasscodeError', (global, actions, payload) => {
  const {
    error
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    error
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('clearPasscodeError', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    error: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('skipLockOnUnload', () => {
  noLockOnUnload = true;
});

/***/ }),

/***/ "./src/global/actions/ui/payments.ts":
/*!*******************************************!*\
  !*** ./src/global/actions/ui/payments.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");







(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closePaymentModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const payment = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId).payment;
  const status = payment.status || 'cancelled';
  const starsBalanceModal = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId).starsBalanceModal;
  actions.processOriginStarsPayment({
    originData: starsBalanceModal,
    status,
    tabId
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.clearPayment)(global, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updatePayment)(global, {
    status
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('resetPaymentStatus', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updatePayment)(global, {
    status: undefined
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_4__.updateStarsPayment)(global, {
    status: undefined
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('addPaymentError', (global, actions, payload) => {
  const {
    error,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    payment: {
      ...(0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId).payment,
      status: 'failed',
      error
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closeGiveawayModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    giveawayModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closeGiftCodeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    giftCodeModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('updateGiftProfileFilter', (global, actions, payload) => {
  const {
    filter,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId);
  const prevFilter = tabState.savedGifts.filter;
  let updatedFilter = {
    ...prevFilter,
    ...filter
  };
  if (!updatedFilter.shouldIncludeUnlimited && !updatedFilter.shouldIncludeLimited && !updatedFilter.shouldIncludeUnique && !updatedFilter.shouldIncludeUpgradable) {
    updatedFilter = {
      ...prevFilter,
      shouldIncludeUnlimited: true,
      shouldIncludeLimited: true,
      shouldIncludeUnique: true,
      shouldIncludeUpgradable: true,
      ...filter
    };
  }
  if (!updatedFilter.shouldIncludeDisplayed && !updatedFilter.shouldIncludeHidden) {
    updatedFilter = {
      ...prevFilter,
      shouldIncludeDisplayed: true,
      shouldIncludeHidden: true,
      ...filter
    };
  }
  const activeCollectionId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectActiveGiftsCollectionId)(global, peerId, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    savedGifts: {
      ...tabState.savedGifts,
      collectionsByPeerId: {
        [peerId]: {
          [activeCollectionId]: tabState.savedGifts.collectionsByPeerId[peerId]?.[activeCollectionId]
        }
      },
      filter: updatedFilter
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
  actions.loadPeerSavedGifts({
    peerId,
    shouldRefresh: true,
    tabId: tabState.id
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('resetGiftProfileFilter', (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectTabState)(global, tabId);
  const activeCollectionId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectActiveGiftsCollectionId)(global, peerId, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    savedGifts: {
      ...tabState.savedGifts,
      collectionsByPeerId: {
        [peerId]: {
          [activeCollectionId]: tabState.savedGifts.collectionsByPeerId[peerId]?.[activeCollectionId]
        }
      },
      filter: {
        ..._config__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_GIFT_PROFILE_FILTER_OPTIONS
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
  actions.loadPeerSavedGifts({
    peerId,
    shouldRefresh: true,
    tabId: tabState.id
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openPaymentMessageConfirmDialogOpen', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    isPaymentMessageConfirmDialogOpen: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closePaymentMessageConfirmDialogOpen', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    isPaymentMessageConfirmDialogOpen: false
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('openPriceConfirmModal', (global, actions, payload) => {
  const {
    originalAmount,
    newAmount,
    currency,
    directInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    priceConfirmModal: {
      originalAmount,
      newAmount,
      currency,
      directInfo
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('closePriceConfirmModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    priceConfirmModal: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/reactions.ts":
/*!********************************************!*\
  !*** ./src/global/actions/ui/reactions.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (chatId) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
      reactionPicker: {
        chatId,
        messageId: undefined,
        position: undefined
      }
    }, tabId);
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMessageReactionPicker', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    position,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      chatId,
      messageId,
      position
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openStoryReactionPicker', (global, actions, payload) => {
  const {
    peerId,
    storyId,
    position,
    sendAsMessage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      storyPeerId: peerId,
      storyId,
      sendAsMessage,
      position
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openEffectPicker', (global, actions, payload) => {
  const {
    position,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      position,
      chatId,
      isForEffects: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeReactionPicker', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      ...tabState.reactionPicker,
      messageId: undefined,
      position: undefined,
      storyId: undefined,
      storyPeerId: undefined,
      isForEffects: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('resetLocalPaidReactions', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessage)(global, chatId, messageId);
  if (!message) {
    return undefined;
  }
  const {
    reactions
  } = message;
  if (!reactions) {
    return undefined;
  }
  const updatedResults = reactions.results.map(reaction => {
    if (reaction.localAmount) {
      if (!reaction.count) return undefined;
      return {
        ...reaction,
        localAmount: undefined,
        localPreviousChosenOrder: undefined,
        chosenOrder: reaction.localPreviousChosenOrder
      };
    }
    return reaction;
  }).filter(Boolean);
  Object.values(global.byTabId).forEach(({
    id: tabId
  }) => {
    actions.dismissNotification({
      localId: (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_1__.getMessageKey)(message),
      tabId
    });
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateChatMessage)(global, chatId, messageId, {
    reactions: {
      ...reactions,
      results: updatedResults
    }
  });
});

/***/ }),

/***/ "./src/global/actions/ui/stars.ts":
/*!****************************************!*\
  !*** ./src/global/actions/ui/stars.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_gifts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/gifts */ "./src/global/reducers/gifts.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");













(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('processOriginStarsPayment', (global, actions, payload) => {
  const {
    originData,
    status,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    originStarsPayment,
    originReaction,
    originGift,
    topup
  } = originData || {};
  if (!originStarsPayment && !originReaction && !originGift && !topup) {
    return undefined;
  }
  actions.closeStarsBalanceModal({
    tabId
  });
  if (status !== 'paid') {
    return undefined;
  }

  // Re-open previous payment modal
  if (originStarsPayment) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
      starsPayment: originStarsPayment
    }, tabId);
  }
  if (originReaction) {
    actions.sendPaidReaction({
      chatId: originReaction.chatId,
      messageId: originReaction.messageId,
      forcedAmount: originReaction.amount,
      tabId
    });
  }
  if (originGift) {
    actions.sendStarGift({
      ...originGift,
      tabId
    });
  }
  return global;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftRecipientPicker', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  if ((0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    isGiftRecipientPickerOpen: true
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftRecipientPicker', 'isGiftRecipientPickerOpen');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openStarsGiftingPickerModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    starsGiftingPickerModal: {
      isOpen: true
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeStarsGiftingPickerModal', 'starsGiftingPickerModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openPrizeStarsTransactionFromGiveaway', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatMessage)(global, chatId, messageId);
  if (!message) return undefined;
  const transaction = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_7__.getPrizeStarsTransactionFromGiveaway)(message);
  if (!transaction) return undefined;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.openStarsTransactionModal)(global, transaction, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openStarsBalanceModal', (global, actions, payload) => {
  const {
    originStarsPayment,
    originReaction,
    originGift,
    topup,
    shouldIgnoreBalance,
    currency = _config__WEBPACK_IMPORTED_MODULE_1__.STARS_CURRENCY_CODE,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const starBalance = global.stars?.balance;
  if (!shouldIgnoreBalance && starBalance && topup && topup.balanceNeeded <= starBalance.amount) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_4__.oldTranslate('StarsTopupLinkEnough'),
      actionText: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_4__.oldTranslate('StarsTopupLinkTopupAnyway'),
      action: {
        action: 'openStarsBalanceModal',
        payload: {
          topup,
          shouldIgnoreBalance: true,
          tabId
        }
      },
      icon: 'star',
      tabId
    });
    return undefined;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.clearStarPayment)(global, tabId);

  // Always refresh status on opening
  actions.loadStarStatus();
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    starsBalanceModal: {
      originStarsPayment,
      originReaction,
      originGift,
      topup,
      currency
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeStarsBalanceModal', 'starsBalanceModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeStarsPaymentModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const starsPayment = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectStarsPayment)(global, tabId);
  let status = starsPayment?.status;
  if (!status || status === 'pending') {
    status = 'cancelled';
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    starsPayment: {
      status
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openStarsTransactionModal', (global, actions, payload) => {
  const {
    transaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.openStarsTransactionModal)(global, transaction, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openStarsTransactionFromGift', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatMessage)(global, chatId, messageId);
  if (!message) return undefined;
  const transaction = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_7__.getStarsTransactionFromGift)(message);
  if (!transaction) return undefined;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.openStarsTransactionModal)(global, transaction, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeStarsTransactionModal', 'starsTransactionModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openStarsSubscriptionModal', (global, actions, payload) => {
  const {
    subscription,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    starsSubscriptionModal: {
      subscription
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeStarsSubscriptionModal', 'starsSubscriptionModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftModal', 'giftModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('setGiftModalSelectedGift', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const giftModal = tabState?.giftModal;
  if (!gift) {
    const previousGift = giftModal?.selectedGift;
    const auctionGiftId = previousGift && 'id' in previousGift && previousGift.type === 'starGift' && previousGift.isAuction ? previousGift.id : undefined;
    if (auctionGiftId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectShouldRemoveGiftAuction)(global, auctionGiftId)) {
      global = (0,_reducers_gifts__WEBPACK_IMPORTED_MODULE_9__.removeGiftAuction)(global, auctionGiftId);
    }
  }
  if (giftModal) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
      giftModal: {
        ...giftModal,
        selectedGift: gift
      }
    }, tabId);
  }
  if (gift && 'id' in gift) {
    actions.openGiftModal({
      forUserId: global.currentUserId,
      selectedGift: gift,
      tabId
    });
  }
  return undefined;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeStarsGiftModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    starsGiftModal: {
      isOpen: false
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftInfoModalFromMessage', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  if (!chat) return;
  await (0,_global__WEBPACK_IMPORTED_MODULE_0__.getPromiseActions)().loadMessage({
    chatId,
    messageId
  });
  global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatMessage)(global, chatId, messageId);
  if (!message || !message.content.action) return;
  const action = message.content.action;
  if (action.type !== 'starGift' && action.type !== 'starGiftUnique') return;
  const starGift = action.type === 'starGift' ? action : undefined;
  const uniqueGift = action.type === 'starGiftUnique' ? action : undefined;
  const giftMsgId = starGift?.giftMsgId;
  const giftReceiverId = action.peerId || (message.isOutgoing ? message.chatId : global.currentUserId);
  const inputGift = (() => {
    if (giftMsgId) {
      return {
        type: 'user',
        messageId: giftMsgId
      };
    }
    if (action.savedId) {
      return {
        type: 'chat',
        chatId,
        savedId: action.savedId
      };
    }
    return {
      type: 'user',
      messageId
    };
  })();
  const fromId = action.fromId || (message.isOutgoing ? global.currentUserId : message.chatId);
  const gift = {
    date: message.date,
    gift: action.gift,
    message: starGift?.message,
    starsToConvert: starGift?.starsToConvert,
    isNameHidden: starGift?.isNameHidden,
    isUnsaved: !action.isSaved,
    fromId,
    messageId: message.id,
    isConverted: starGift?.isConverted,
    upgradeMsgId: starGift?.upgradeMsgId,
    canUpgrade: starGift?.canUpgrade,
    alreadyPaidUpgradeStars: starGift?.alreadyPaidUpgradeStars,
    inputGift,
    canExportAt: uniqueGift?.canExportAt,
    savedId: action.savedId,
    transferStars: uniqueGift?.transferStars,
    dropOriginalDetailsStars: uniqueGift?.dropOriginalDetailsStars,
    prepaidUpgradeHash: starGift?.prepaidUpgradeHash
  };
  actions.openGiftInfoModal({
    peerId: giftReceiverId,
    gift,
    tabId
  });
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftInfoModal', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const peerId = 'peerId' in payload ? payload.peerId : undefined;
  const recipientId = 'recipientId' in payload ? payload.recipientId : undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftInfoModal: {
      peerId,
      gift,
      recipientId
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openLockedGiftModalInfo', (global, actions, payload) => {
  const {
    untilDate,
    reason,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    lockedGiftModal: {
      untilDate,
      reason
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeLockedGiftModal', 'lockedGiftModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftResalePriceComposerModal', (global, actions, payload) => {
  const {
    gift,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftResalePriceComposerModal: {
      peerId,
      gift
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftInMarket', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const giftModal = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).giftModal;
  actions.closeGiftInfoValueModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  if (giftModal) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
      giftModal: {
        ...giftModal,
        selectedResaleGift: gift
      }
    }, tabId);
  }
  actions.openGiftModal({
    forUserId: global.currentUserId,
    selectedResaleGift: gift,
    tabId
  });
  return global;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeResaleGiftsMarket', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  actions.resetResaleGifts({
    tabId
  });
  const giftModal = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).giftModal;
  if (giftModal) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
      giftModal: {
        ...giftModal,
        selectedResaleGift: undefined
      }
    }, tabId);
  }
  return global;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftInfoValueModal', async (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchUniqueStarGiftValueInfo', {
    slug: gift.slug
  });
  if (!result) return;
  global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftInfoValueModal: {
      valueInfo: result,
      gift
    }
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftInfoModal', 'giftInfoModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftInfoValueModal', 'giftInfoValueModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftResalePriceComposerModal', 'giftResalePriceComposerModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftUpgradeModal', 'giftUpgradeModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeGiftAuctionModal', (global, _actions, payload) => {
  const {
    shouldKeepAuction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const giftId = tabState.giftAuctionModal?.auctionGiftId;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftAuctionModal: undefined
  }, tabId);
  if (!shouldKeepAuction && giftId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectShouldRemoveGiftAuction)(global, giftId)) {
    global = (0,_reducers_gifts__WEBPACK_IMPORTED_MODULE_9__.removeGiftAuction)(global, giftId);
  }
  return global;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftAuctionBidModal', (global, _actions, payload) => {
  const {
    auctionGiftId,
    peerId,
    message,
    shouldHideName,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftAuctionBidModal: {
      auctionGiftId,
      peerId,
      message,
      shouldHideName
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeGiftAuctionBidModal', (global, _actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftAuctionBidModal: undefined
  }, tabId);
  return global;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftAuctionInfoModal', (global, _actions, payload) => {
  const {
    auctionGiftId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftAuctionInfoModal: {
      auctionGiftId
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeGiftAuctionInfoModal', (global, _actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftAuctionInfoModal: undefined
  }, tabId);
  return global;
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openAboutStarGiftModal', async (global, _actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchPremiumPromo');
  let videoId;
  let videoThumbnail;
  if (result?.promo) {
    const giftsIndex = result.promo.videoSections.indexOf('gifts');
    if (giftsIndex !== -1 && giftsIndex < result.promo.videos.length) {
      const video = result.promo.videos[giftsIndex];
      videoId = video.id;
      videoThumbnail = video.thumbnail;
    }
  }
  global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    aboutStarGiftModal: {
      videoId,
      videoThumbnail
    }
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeAboutStarGiftModal', 'aboutStarGiftModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftAuctionChangeRecipientModal', (global, _actions, payload) => {
  const {
    auctionGiftId,
    oldPeerId,
    newPeerId,
    message,
    shouldHideName,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftAuctionChangeRecipientModal: {
      auctionGiftId,
      oldPeerId,
      newPeerId,
      message,
      shouldHideName
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftAuctionChangeRecipientModal', 'giftAuctionChangeRecipientModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftAuctionAcquiredModal', 'giftAuctionAcquiredModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openStarGiftPriceDecreaseInfoModal', (global, actions, payload) => {
  const {
    prices,
    currentPrice,
    minPrice,
    maxPrice,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    starGiftPriceDecreaseInfoModal: {
      prices,
      currentPrice,
      minPrice,
      maxPrice
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeStarGiftPriceDecreaseInfoModal', 'starGiftPriceDecreaseInfoModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftWithdrawModal', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftWithdrawModal: {
      gift
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftWithdrawModal', 'giftWithdrawModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftStatusInfoModal', (global, actions, payload) => {
  const {
    emojiStatus,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftStatusInfoModal: {
      emojiStatus
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('closeGiftStatusInfoModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftStatusInfoModal: undefined
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('clearGiftWithdrawError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const giftWithdrawModal = tabState?.giftWithdrawModal;
  if (!giftWithdrawModal) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftWithdrawModal: {
      ...giftWithdrawModal,
      errorKey: undefined
    }
  }, tabId);
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftTransferModal', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftTransferModal: {
      gift
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftTransferModal', 'giftTransferModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftTransferConfirmModal', (global, actions, payload) => {
  const {
    gift,
    recipientId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftTransferConfirmModal: {
      gift,
      recipientId
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftTransferConfirmModal', 'giftTransferConfirmModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('openGiftDescriptionRemoveModal', (global, actions, payload) => {
  const {
    gift,
    price,
    details,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    giftDescriptionRemoveModal: {
      gift,
      price,
      details
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_6__.addTabStateResetterAction)('closeGiftDescriptionRemoveModal', 'giftDescriptionRemoveModal');
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('updateSelectedGiftCollection', (global, actions, payload) => {
  const {
    peerId,
    collectionId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    savedGifts: {
      ...tabState.savedGifts,
      activeCollectionByPeerId: {
        ...tabState.savedGifts.activeCollectionByPeerId,
        [peerId]: collectionId
      }
    }
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  actions.loadPeerSavedGifts({
    peerId,
    shouldRefresh: true,
    tabId: tabState.id
  });
});
(0,_global__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('resetSelectedGiftCollection', (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_10__.updateTabState)(global, {
    savedGifts: {
      ...tabState.savedGifts,
      activeCollectionByPeerId: {
        ...tabState.savedGifts.activeCollectionByPeerId,
        [peerId]: undefined
      }
    }
  }, tabId);
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  actions.loadPeerSavedGifts({
    peerId,
    shouldRefresh: true,
    tabId: tabState.id
  });
});

/***/ }),

/***/ "./src/global/actions/ui/statistics.ts":
/*!*********************************************!*\
  !*** ./src/global/actions/ui/statistics.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../.. */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");




(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openMonetizationVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)(),
    chatId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    monetizationVerificationModal: {
      chatId
    }
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeMonetizationVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    monetizationVerificationModal: undefined
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('clearMonetizationVerificationError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateVerifyMonetizationModal)(global, {
    errorKey: undefined
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeMonetizationStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    monetizationStatistics: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/stickerSearch.ts":
/*!************************************************!*\
  !*** ./src/global/actions/ui/stickerSearch.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");



(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setStickerSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    stickerSearch: {
      query,
      resultIds: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGifSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    gifSearch: {
      query,
      offset: undefined,
      // offsetId: undefined,
      results: undefined
    }
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/stories.ts":
/*!******************************************!*\
  !*** ./src/global/actions/ui/stories.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _api_chats__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../api/chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../api/messages */ "./src/global/actions/api/messages.ts");












(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openStoryViewer', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    isPrivate,
    isArchive,
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (storyId && (!peerStories || !peerStories.byId[storyId])) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
      peer,
      ids: [storyId]
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories);
  }
  const storyList = tabState.storyViewer.storyList || (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectStoryListForViewer)(global, peerId, storyId, isSingleStory, isSinglePeer, isPrivate, isArchive);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId,
      storyId: storyId || (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerFirstUnreadStoryId)(global, peerId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerFirstStoryId)(global, peerId),
      isSinglePeer,
      isPrivate,
      isArchive,
      isSingleStory,
      viewModal: undefined,
      origin,
      storyList
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openStoryViewerByUsername', async (global, actions, payload) => {
  const {
    username,
    storyId,
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = await (0,_api_chats__WEBPACK_IMPORTED_MODULE_10__.fetchChatByUsername)(global, username);
  if (!chat) {
    return;
  }
  actions.openStoryViewer({
    peerId: chat.id,
    storyId,
    isSinglePeer: true,
    isSingleStory: true,
    origin,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('closeStoryViewer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    isMuted,
    isRibbonShown,
    isArchivedRibbonShown,
    storyId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).storyViewer;
  if (!storyId) return global;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      isMuted,
      isRibbonShown,
      isArchivedRibbonShown,
      lastViewedByPeerId: undefined,
      storyList: undefined
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('setStoryViewerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).storyViewer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoryRibbon', (global, actions, payload) => {
  const {
    isShown,
    isArchived,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const orderedIds = global.stories.orderedPeerIds[isArchived ? 'archived' : 'active'];
  if (!orderedIds?.length) {
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).storyViewer,
      [isArchived ? 'isArchivedRibbonShown' : 'isRibbonShown']: isShown
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openPreviousStory', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    storyList
  } = tabState.storyViewer;
  if (isSingleStory || !storyList) {
    actions.closeStoryViewer({
      tabId
    });
    return undefined;
  }
  if (!peerId || !storyId) {
    return undefined;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peerStories || !peer) {
    return undefined;
  }
  const {
    peerIds: orderedPeerIds,
    storyIdsByPeerId
  } = storyList;
  const peerStoryIds = storyIdsByPeerId[peerId] ?? [];
  const currentStoryIndex = peerStoryIds.indexOf(storyId);
  let previousStoryIndex;
  let previousPeerId;
  if (currentStoryIndex > 0) {
    previousStoryIndex = currentStoryIndex - 1;
    previousPeerId = peerId;
  } else {
    const previousPeerIdIndex = orderedPeerIds.indexOf(peerId) - 1;
    if (isSinglePeer || previousPeerIdIndex < 0) {
      return undefined;
    }
    previousPeerId = orderedPeerIds[previousPeerIdIndex];
    previousStoryIndex = (storyIdsByPeerId?.[previousPeerId]?.length || 1) - 1;
  }
  const previousStoryId = storyIdsByPeerId?.[previousPeerId]?.[previousStoryIndex];
  if (!previousStoryId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId: previousPeerId,
      storyId: previousStoryId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openNextStory', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    storyList
  } = tabState.storyViewer;
  if (isSingleStory || !storyList) {
    actions.closeStoryViewer({
      tabId
    });
    return undefined;
  }
  if (!peerId || !storyId) {
    return undefined;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peerStories || !peer) {
    return undefined;
  }
  const {
    peerIds: orderedPeerIds,
    storyIdsByPeerId
  } = storyList;
  const peerStoryIds = storyIdsByPeerId[peerId] ?? [];
  const currentStoryIndex = peerStoryIds.indexOf(storyId);
  let nextStoryIndex;
  let nextPeerId;
  if (currentStoryIndex < peerStoryIds.length - 1) {
    nextStoryIndex = currentStoryIndex + 1;
    nextPeerId = peerId;
  } else {
    const nextPeerIdIndex = orderedPeerIds.indexOf(peerId) + 1;
    if (isSinglePeer || nextPeerIdIndex > orderedPeerIds.length - 1) {
      actions.closeStoryViewer({
        tabId
      });
      return undefined;
    }
    nextPeerId = orderedPeerIds[nextPeerIdIndex];
    nextStoryIndex = 0;
  }
  const nextStoryId = storyIdsByPeerId?.[nextPeerId]?.[nextStoryIndex];
  if (!nextStoryId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId: nextPeerId,
      storyId: nextStoryId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openStoryViewModal', (global, actions, payload) => {
  const {
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        storyId,
        nextOffset: '',
        isLoading: true
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('closeStoryViewModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(tabState.storyViewer, ['viewModal'])
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('copyStoryLink', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const link = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoryLink', {
    peer,
    storyId
  });
  if (!link) {
    return;
  }
  (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_0__.copyTextToClipboard)(link);
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LinkCopied'),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('sendMessage', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    storyId,
    peerId: storyPeerId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectCurrentViewedStory)(global, tabId);
  const isStoryReply = Boolean(storyId && storyPeerId);
  if (!isStoryReply) {
    return;
  }
  const messagePriceInStars = await (0,_api_messages__WEBPACK_IMPORTED_MODULE_11__.getPeerStarsForMessage)(global, storyPeerId);
  if (messagePriceInStars === undefined) return;
  const {
    gif,
    sticker,
    isReaction
  } = payload;
  let message;
  if (gif) {
    message = 'Story.Tooltip.GifSent';
  } else if (sticker) {
    message = 'Story.Tooltip.StickerSent';
  } else if (isReaction) {
    message = 'Story.Tooltip.ReactionSent';
  } else {
    message = 'Story.Tooltip.MessageSent';
  }
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate(message),
    actionText: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('Story.ToastViewInChat'),
    action: [{
      action: 'closeStoryViewer',
      payload: undefined
    }, {
      action: 'openChat',
      payload: {
        id: storyPeerId
      }
    }],
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openStoryPrivacyEditor', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isPrivacyModalOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('closeStoryPrivacyEditor', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isPrivacyModalOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('openStealthModal', (global, actions, payload) => {
  const {
    targetPeerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyStealthModal: {
      targetPeerId
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_5__.addTabStateResetterAction)('closeStealthModal', 'storyStealthModal');
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('clearStoryViews', (global, actions, payload) => {
  const {
    isLoading,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  if (!tabState.storyViewer.viewModal) return global;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        ...tabState.storyViewer.viewModal,
        views: undefined,
        isLoading,
        nextOffset: ''
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('updateStoryView', (global, actions, payload) => {
  const {
    userId,
    isUserBlocked,
    areStoriesBlocked,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId);
  const {
    viewModal
  } = tabState.storyViewer;
  if (!viewModal?.storyId) return undefined;
  const updatedViews = viewModal?.views?.map(view => {
    if (view.peerId === userId) {
      return {
        ...view,
        isUserBlocked: isUserBlocked || undefined,
        areStoriesBlocked: areStoriesBlocked || undefined
      };
    }
    return view;
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        ...viewModal,
        views: updatedViews
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('closeBoostModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    boostModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('closeBoostStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
    boostStatistics: undefined
  }, tabId);
});

/***/ }),

/***/ "./src/global/actions/ui/users.ts":
/*!****************************************!*\
  !*** ./src/global/actions/ui/users.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setUserSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateUserSearch)(global, {
    globalUserIds: undefined,
    localUserIds: undefined,
    fetchingStatus: Boolean(query),
    query
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openAddContactDialog', (global, actions, payload) => {
  const {
    userId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    newContact: {
      userId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openNewContactDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    newContact: {
      isByPhoneNumber: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeNewContactDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.closeNewContactDialog)(global, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeSuggestedStatusModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    suggestedStatusModal: undefined
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_1__.addTabStateResetterAction)('closeChatRefundModal', 'chatRefundModal');
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openProfileRatingModal', (global, actions, payload) => {
  const {
    userId,
    level,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    profileRatingModal: {
      userId,
      level
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_1__.addTabStateResetterAction)('closeProfileRatingModal', 'profileRatingModal');

/***/ }),

/***/ "./src/global/helpers/renderMessageSummaryHtml.ts":
/*!********************************************************!*\
  !*** ./src/global/helpers/renderMessageSummaryHtml.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   renderMessageSummaryHtml: () => (/* binding */ renderMessageSummaryHtml)
/* harmony export */ });
/* harmony import */ var _components_common_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../components/common/helpers/renderMessageText */ "./src/components/common/helpers/renderMessageText.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! .. */ "./src/global/index.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./messages */ "./src/global/helpers/messages.ts");
/* harmony import */ var _messageSummary__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./messageSummary */ "./src/global/helpers/messageSummary.ts");




function renderMessageSummaryHtml(lang, message) {
  const global = (0,___WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const emoji = (0,_messageSummary__WEBPACK_IMPORTED_MODULE_3__.getMessageSummaryEmoji)(message);
  const emojiWithSpace = emoji ? `${emoji} ` : '';
  const text = (0,_components_common_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_0__.renderMessageText)({
    message,
    shouldRenderAsHtml: true
  })?.join('');
  const statefulContent = (0,_messages__WEBPACK_IMPORTED_MODULE_2__.getMessageStatefulContent)(global, message);
  const description = (0,_messageSummary__WEBPACK_IMPORTED_MODULE_3__.getMessageSummaryDescription)(lang, message, statefulContent, text, true);
  return `${emojiWithSpace}${description}`;
}

/***/ }),

/***/ "./src/global/reducers/bots.ts":
/*!*************************************!*\
  !*** ./src/global/reducers/bots.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   activateWebAppIfOpen: () => (/* binding */ activateWebAppIfOpen),
/* harmony export */   addWebAppToOpenList: () => (/* binding */ addWebAppToOpenList),
/* harmony export */   clearOpenedWebApps: () => (/* binding */ clearOpenedWebApps),
/* harmony export */   hasOpenedMoreThanOneWebApps: () => (/* binding */ hasOpenedMoreThanOneWebApps),
/* harmony export */   hasOpenedWebApps: () => (/* binding */ hasOpenedWebApps),
/* harmony export */   removeActiveWebAppFromOpenList: () => (/* binding */ removeActiveWebAppFromOpenList),
/* harmony export */   removeWebAppFromOpenList: () => (/* binding */ removeWebAppFromOpenList),
/* harmony export */   replaceInlineBotSettings: () => (/* binding */ replaceInlineBotSettings),
/* harmony export */   replaceInlineBotsIsLoading: () => (/* binding */ replaceInlineBotsIsLoading),
/* harmony export */   replaceIsWebAppModalOpen: () => (/* binding */ replaceIsWebAppModalOpen),
/* harmony export */   replaceWebAppModalState: () => (/* binding */ replaceWebAppModalState),
/* harmony export */   updateWebApp: () => (/* binding */ updateWebApp)
/* harmony export */ });
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _helpers_bots__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../helpers/bots */ "./src/global/helpers/bots.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./tabs */ "./src/global/reducers/tabs.ts");




function replaceInlineBotSettings(global, username, inlineBotSettings, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    inlineBots: {
      ...tabState.inlineBots,
      byUsername: {
        ...tabState.inlineBots.byUsername,
        [username]: inlineBotSettings
      }
    }
  }, tabId);
}
function replaceInlineBotsIsLoading(global, isLoading, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    inlineBots: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).inlineBots,
      isLoading
    }
  }, tabId);
}
function updateWebApp(global, key, webAppUpdate, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  const originalWebApp = openedWebApps[key];
  if (!originalWebApp) return global;
  const updatedValue = {
    ...originalWebApp,
    ...webAppUpdate
  };
  const updatedWebAppKey = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(updatedValue);
  if (!updatedWebAppKey) return global;
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      openedWebApps: {
        ...openedWebApps,
        [updatedWebAppKey]: updatedValue
      }
    }
  }, tabId);
  return global;
}
function activateWebAppIfOpen(global, webAppKey, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  if (!openedWebApps[webAppKey]) {
    return global;
  }
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      isMoreAppsTabActive: false,
      activeWebAppKey: webAppKey,
      modalState: 'maximized'
    }
  }, tabId);
  return global;
}
function addWebAppToOpenList(global, webApp, makeActive = true, openModalIfNotOpen = true, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const key = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(webApp);
  if (!key) return global;
  const newOpenedKeys = [...currentTabState.webApps.openedOrderedKeys];
  if (!newOpenedKeys.includes(key)) newOpenedKeys.push(key);
  const newSessionKeys = [...currentTabState.webApps.sessionKeys];
  if (!newSessionKeys.includes(key)) newSessionKeys.push(key);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      ...(makeActive && {
        activeWebAppKey: key
      }),
      isMoreAppsTabActive: false,
      isModalOpen: openModalIfNotOpen,
      modalState: 'maximized',
      openedWebApps: {
        ...openedWebApps,
        [key]: webApp
      },
      openedOrderedKeys: newOpenedKeys,
      sessionKeys: newSessionKeys
    }
  }, tabId);
  return global;
}
function removeActiveWebAppFromOpenList(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const activeWebAppKey = currentTabState.webApps.activeWebAppKey;
  if (!activeWebAppKey) return global;
  return removeWebAppFromOpenList(global, activeWebAppKey, false, tabId);
}
function removeWebAppFromOpenList(global, key, skipClosingConfirmation, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const {
    openedWebApps,
    openedOrderedKeys,
    activeWebAppKey
  } = currentTabState.webApps;
  const webApp = openedWebApps[key];
  if (!webApp) return global;
  if (!skipClosingConfirmation && webApp.shouldConfirmClosing) {
    return updateWebApp(global, key, {
      isCloseModalOpen: true
    }, tabId);
  }
  const updatedOpenedWebApps = {
    ...openedWebApps
  };
  const removingWebAppKey = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(webApp);
  let newOpenedKeys = openedOrderedKeys;
  if (removingWebAppKey) {
    delete updatedOpenedWebApps[removingWebAppKey];
    newOpenedKeys = openedOrderedKeys.filter(k => k !== removingWebAppKey);
  }
  const isRemovedAppActive = activeWebAppKey === (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(webApp);
  const openedWebAppsKeys = Object.keys(updatedOpenedWebApps);
  const openedWebAppsCount = openedWebAppsKeys.length;
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      ...(isRemovedAppActive && {
        activeWebAppKey: openedWebAppsCount ? openedWebAppsKeys[openedWebAppsCount - 1] : undefined
      }),
      openedWebApps: updatedOpenedWebApps,
      openedOrderedKeys: newOpenedKeys,
      ...(!openedWebAppsCount && {
        sessionKeys: []
      })
    }
  }, tabId);
  return global;
}
function clearOpenedWebApps(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const webAppsNotAllowedToClose = Object.fromEntries(Object.entries(currentTabState.webApps.openedWebApps).filter(([, webApp]) => webApp.shouldConfirmClosing));
  const webAppsNotAllowedToCloseValues = Object.values(webAppsNotAllowedToClose);
  const hasNotAllowedToCloseApps = webAppsNotAllowedToCloseValues.length > 0;
  if (!hasNotAllowedToCloseApps) {
    return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
      webApps: {
        ...currentTabState.webApps,
        activeWebAppKey: undefined,
        openedWebApps: {},
        openedOrderedKeys: [],
        sessionKeys: []
      }
    }, tabId);
  }
  const currentActiveWebApp = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectActiveWebApp)(global, tabId);
  const newActiveWebApp = currentActiveWebApp?.shouldConfirmClosing ? currentActiveWebApp : webAppsNotAllowedToCloseValues[0];
  const newActiveWebAppKey = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(newActiveWebApp);
  if (newActiveWebAppKey) {
    webAppsNotAllowedToClose[newActiveWebAppKey] = {
      ...newActiveWebApp,
      isCloseModalOpen: true
    };
  }
  const newOpenedKeys = currentTabState.webApps.openedOrderedKeys.filter(k => webAppsNotAllowedToClose[k]);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      activeWebAppKey: newActiveWebAppKey,
      isMoreAppsTabActive: false,
      openedWebApps: webAppsNotAllowedToClose,
      openedOrderedKeys: newOpenedKeys
    }
  }, tabId);
}
function hasOpenedWebApps(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  return Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).webApps.openedWebApps).length > 0;
}
function hasOpenedMoreThanOneWebApps(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  return Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).webApps.openedWebApps).length > 1;
}
function replaceWebAppModalState(global, modalState, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      modalState
    }
  }, tabId);
}
function replaceIsWebAppModalOpen(global, value, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      isModalOpen: value
    }
  }, tabId);
}

/***/ }),

/***/ "./src/global/reducers/reactions.ts":
/*!******************************************!*\
  !*** ./src/global/reducers/reactions.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addMessageReaction: () => (/* binding */ addMessageReaction),
/* harmony export */   subtractXForEmojiInteraction: () => (/* binding */ subtractXForEmojiInteraction),
/* harmony export */   updateUnreadReactions: () => (/* binding */ updateUnreadReactions)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../components/middle/helpers/calculateMiddleFooterTransforms */ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./chats */ "./src/global/reducers/chats.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./messages */ "./src/global/reducers/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");








function getLeftColumnWidth(windowWidth) {
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN) {
    return Math.min(Math.max(windowWidth * 0.25, _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.MIN_LEFT_COLUMN_WIDTH), windowWidth * 0.33);
  }
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN) {
    return Math.min(Math.max(windowWidth * 0.33, _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.MIN_LEFT_COLUMN_WIDTH), windowWidth * 0.4);
  }
  return _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.SIDE_COLUMN_MAX_WIDTH;
}
function subtractXForEmojiInteraction(global, x) {
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  return x - (tabState.isLeftColumnShown && !(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__.getIsMobile)() ? global.leftColumnWidth || getLeftColumnWidth(_util_windowSize__WEBPACK_IMPORTED_MODULE_1__["default"].get().width) : 0);
}
function addMessageReaction(global, message, userReactions) {
  const isInSavedMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsChatWithSelf)(global, message.chatId);
  const currentReactions = message.reactions || {
    results: [],
    areTags: isInSavedMessages
  };
  const currentSendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectSendAs)(global, message.chatId);

  // Update UI without waiting for server response
  const results = (0,_helpers__WEBPACK_IMPORTED_MODULE_3__.updateReactionCount)(currentReactions.results, userReactions);
  let {
    recentReactions = []
  } = currentReactions;
  if (recentReactions.length) {
    recentReactions = recentReactions.filter(({
      isOwn,
      peerId
    }) => !isOwn && peerId !== global.currentUserId);
  }
  userReactions.forEach(reaction => {
    const {
      currentUserId
    } = global;
    if (reaction.type === 'paid') return;
    recentReactions.unshift({
      peerId: currentSendAs?.id || currentUserId,
      reaction,
      addedDate: Math.floor(Date.now() / 1000),
      isOwn: true
    });
  });
  return (0,_messages__WEBPACK_IMPORTED_MODULE_6__.updateChatMessage)(global, message.chatId, message.id, {
    reactions: {
      ...currentReactions,
      results,
      recentReactions
    }
  });
}
function updateUnreadReactions(global, chatId, update) {
  return (0,_chats__WEBPACK_IMPORTED_MODULE_5__.updateChat)(global, chatId, update, true);
}

/***/ }),

/***/ "./src/hooks/tauri/useTauriEvent.ts":
/*!******************************************!*\
  !*** ./src/hooks/tauri/useTauriEvent.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTauriEvent)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");


function useTauriEvent(name, callback) {
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_TAURI) {
      return undefined;
    }
    let removeListener;
    const setUpListener = async () => {
      const {
        listen
      } = await __webpack_require__.e(/*! import() */ "node_modules_tauri-apps_api_event_js").then(__webpack_require__.bind(__webpack_require__, /*! @tauri-apps/api/event */ "./node_modules/@tauri-apps/api/event.js"));
      removeListener = await listen(name, event => {
        callback(event);
      });
    };
    setUpListener().catch(error => {
      // eslint-disable-next-line no-console
      console.error(`Could not set up window event listener. ${error}`);
    });
    return () => {
      removeListener?.();
    };
  }, [name, callback]);
}

/***/ }),

/***/ "./src/hooks/useCacheBuster.ts":
/*!*************************************!*\
  !*** ./src/hooks/useCacheBuster.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");

const useCacheBuster = () => {
  const [cacheBuster, setCacheBuster] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const updateCacheBuster = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setCacheBuster(current => current + 1);
  }, []);
  return [cacheBuster, updateCacheBuster];
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useCacheBuster);

/***/ }),

/***/ "./src/hooks/useMessageMediaMetadata.ts":
/*!**********************************************!*\
  !*** ./src/hooks/useMessageMediaMetadata.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_imageResize__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/imageResize */ "./src/util/imageResize.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _components_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../components/common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _useAsync__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./useAsync */ "./src/hooks/useAsync.ts");
/* harmony import */ var _useMedia__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/telegram-logo-filled.svg */ "./src/assets/telegram-logo-filled.svg");










const LOGO_DIMENSIONS = {
  width: 200,
  height: 200
};
const MINIMAL_SIZE = 115; // spec says 100, but on Chrome 93 it's not showing

// TODO Add support for video in future
const useMessageMediaMetadata = (message, sender, chat) => {
  const lang = (0,_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    audio,
    voice
  } = message ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message) : {};
  const title = audio ? audio.title || audio.fileName : voice ? 'Voice message' : '';
  const artist = audio?.performer || sender && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, sender);
  const album = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatTitle)(lang, chat) || 'Telegram';
  const audioCoverHash = audio && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getAudioHasCover)(audio) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaHash)(audio, 'pictogram');
  const avatarHash = sender && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatAvatarHash)(sender, 'big');
  const hash = audio && audioCoverHash || voice && avatarHash;
  const media = (0,_useMedia__WEBPACK_IMPORTED_MODULE_7__["default"])(hash);
  const size = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return getCoverSize(audio, voice, media);
  }, [audio, media, voice]);
  const {
    result: url
  } = (0,_useAsync__WEBPACK_IMPORTED_MODULE_6__["default"])(() => makeGoodArtwork(media, size), [media, size], _assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_9__);
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_4__.buildMediaMetadata)({
      title,
      artist,
      album,
      artwork: [{
        src: url
      }]
    });
  }, [album, artist, title, url]);
};
function makeGoodArtwork(url, size) {
  if (!url) return Promise.resolve(_assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_9__);
  if (!size) return (0,_util_imageResize__WEBPACK_IMPORTED_MODULE_3__.resizeImage)(url, MINIMAL_SIZE, MINIMAL_SIZE);
  const min = Math.min(size.width, size.height);
  if (min < MINIMAL_SIZE) {
    const ratio = MINIMAL_SIZE / min;
    return (0,_util_imageResize__WEBPACK_IMPORTED_MODULE_3__.scaleImage)(url, ratio);
  }
  return Promise.resolve(url);
}
function getCoverSize(audio, voice, url) {
  if (!url) return LOGO_DIMENSIONS;
  if (audio) {
    if (!audio.thumbnailSizes?.length) return undefined;
    const preferred = audio.thumbnailSizes.find(size => size.type === 'm');
    return preferred || audio.thumbnailSizes[0]; // Sometimes `m` is not present
  }
  if (voice) {
    return _components_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.AVATAR_FULL_DIMENSIONS;
  }
  return undefined;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useMessageMediaMetadata);

/***/ }),

/***/ "./src/hooks/usePreventPinchZoomGesture.ts":
/*!*************************************************!*\
  !*** ./src/hooks/usePreventPinchZoomGesture.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePreventPinchZoomGesture)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");


const metaViewport = document.querySelector('meta[name="viewport"]');
const defaultViewportContent = metaViewport?.getAttribute('content') || '';
const allowedZoomViewportContent = 'width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover';
function usePreventPinchZoomGesture(isDisabled = false) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_TOUCH_ENV) {
      return undefined;
    }
    if (isDisabled) {
      // Clean viewport content from values values that disable the ability to zoom a webpage
      // https://web.dev/meta-viewport/
      metaViewport?.setAttribute('content', allowedZoomViewportContent);
      return undefined;
    }
    metaViewport?.setAttribute('content', defaultViewportContent);

    // Since iOS 10 `user-scaleable=no` is disabled in Safari for iOS,
    // this is only applicable for the browser and does not apply to the PWA mode.
    // https://newbedev.com/how-do-you-disable-viewport-zooming-on-mobile-safari
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_IOS && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_PWA) {
      document.addEventListener('gesturestart', preventEvent);
    }
    return () => {
      metaViewport?.setAttribute('content', 'width=device-width, initial-scale=1, shrink-to-fit=no');
      if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_IOS && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_PWA) {
        document.removeEventListener('gesturestart', preventEvent);
      }
    };
  }, [isDisabled]);
}
function preventEvent(e) {
  e.preventDefault();
}

/***/ }),

/***/ "./src/hooks/useResize.ts":
/*!********************************!*\
  !*** ./src/hooks/useResize.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useResize: () => (/* binding */ useResize)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _useFlag__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");




function useResize(elementRef, onResize, onReset, initialWidth, cssPropertyName) {
  const [isActive, markIsActive, unmarkIsActive] = (0,_useFlag__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const [initialMouseX, setInitialMouseX] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [initialElementWidth, setInitialElementWidth] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const setElementStyle = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(width => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      if (!elementRef.current) {
        return;
      }
      const widthPx = width ? `${width}px` : '';
      elementRef.current.style.width = widthPx;
      if (cssPropertyName) {
        elementRef.current.style.setProperty(cssPropertyName, widthPx);
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!elementRef.current || !initialWidth) {
      return;
    }
    setElementStyle(initialWidth);
  }, [cssPropertyName, elementRef, initialWidth, setElementStyle]);
  function handleMouseUp() {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      document.body.classList.remove('cursor-ew-resize');
    });
  }
  function initResize(e) {
    e.preventDefault();
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      document.body.classList.add('cursor-ew-resize');
    });
    setInitialMouseX(e.clientX);
    setInitialElementWidth(elementRef.current.offsetWidth);
    markIsActive();
  }
  function resetResize(e) {
    e.preventDefault();
    setElementStyle(undefined);
    onReset();
  }
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActive) return undefined;
    const handleMouseMove = e => {
      const newWidth = Math.ceil(initialElementWidth + e.clientX - initialMouseX);
      setElementStyle(newWidth);
    };
    function stopDrag() {
      cleanup();
      onResize(elementRef.current.offsetWidth);
    }
    function cleanup() {
      handleMouseUp();
      document.removeEventListener('mousemove', handleMouseMove, false);
      document.removeEventListener('mouseup', stopDrag, false);
      document.removeEventListener('blur', stopDrag, false);
      unmarkIsActive();
    }
    document.addEventListener('mousemove', handleMouseMove, false);
    document.addEventListener('mouseup', stopDrag, false);
    document.addEventListener('blur', stopDrag, false);
    return cleanup;
  }, [initialElementWidth, initialMouseX, elementRef, onResize, isActive, unmarkIsActive, setElementStyle]);
  return {
    initResize,
    resetResize,
    handleMouseUp
  };
}

/***/ }),

/***/ "./src/util/getIsAppUpdateNeeded.ts":
/*!******************************************!*\
  !*** ./src/util/getIsAppUpdateNeeded.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getIsAppUpdateNeeded)
/* harmony export */ });
const APP_VERSION_REGEX = /^\d+\.\d+(\.\d+)?$/;
function getIsAppUpdateNeeded(remoteVersion, appVersion, isStrict) {
  const sanitizedRemoteVersion = remoteVersion.trim();
  if (!APP_VERSION_REGEX.test(sanitizedRemoteVersion)) {
    return false;
  }
  if (isStrict) {
    return sanitizedRemoteVersion.localeCompare(appVersion, undefined, {
      numeric: true,
      sensitivity: 'base'
    }) === 1;
  }
  return sanitizedRemoteVersion !== appVersion;
}

/***/ }),

/***/ "./src/util/payments/stripe.ts":
/*!*************************************!*\
  !*** ./src/util/payments/stripe.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getStripeError: () => (/* binding */ getStripeError)
/* harmony export */ });
const STRIPE_ERRORS = {
  missing_payment_information: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  invalid_number: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  number: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  exp_year: {
    field: 'expiry',
    message: 'Incorrect year'
  },
  exp_month: {
    field: 'expiry',
    message: 'Incorrect month'
  },
  invalid_expiry_year: {
    field: 'expiry',
    message: 'Incorrect year'
  },
  invalid_expiry_month: {
    field: 'expiry',
    message: 'Incorrect month'
  },
  cvc: {
    field: 'cvv',
    message: 'Incorrect CVV'
  },
  invalid_cvc: {
    field: 'cvv',
    message: 'Incorrect CVV'
  }
};
function getStripeError(error) {
  const {
    message: description,
    code,
    param
  } = error;
  const {
    field,
    message
  } = param ? STRIPE_ERRORS[param] : STRIPE_ERRORS[code];
  return {
    field,
    message,
    description
  };
}

/***/ }),

/***/ "./src/util/requestQuery.ts":
/*!**********************************!*\
  !*** ./src/util/requestQuery.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   buildQueryString: () => (/* binding */ buildQueryString)
/* harmony export */ });
function buildQueryString(data) {
  const query = Object.keys(data).map(k => `${k}=${data[k]}`).join('&');
  return query.length > 0 ? `?${query}` : '';
}

/***/ }),

/***/ "./src/util/updateIcon.ts":
/*!********************************!*\
  !*** ./src/util/updateIcon.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ updateIcon)
/* harmony export */ });
function updateIcon(asUnread) {
  document.querySelectorAll('link[rel="icon"], link[rel="alternate icon"]').forEach(link => {
    if (asUnread) {
      if (!link.href.includes('favicon-unread')) {
        link.href = link.href.replace('favicon', 'favicon-unread');
      }
    } else {
      link.href = link.href.replace('favicon-unread', 'favicon');
    }
  });
}

/***/ }),

/***/ "./src/util/updatePageTitle.ts":
/*!*************************************!*\
  !*** ./src/util/updatePageTitle.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   setPageTitle: () => (/* binding */ setPageTitle),
/* harmony export */   setPageTitleInstant: () => (/* binding */ setPageTitleInstant)
/* harmony export */ });
/* harmony import */ var _browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _schedulers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./schedulers */ "./src/util/schedulers.ts");


const UPDATE_DEBOUNCE_MS = 200;

// For some reason setting `document.title` to the same value
// causes increment of Chrome Dev Tools > Performance Monitor > DOM Nodes counter
async function setPageTitleInstant(nextTitle) {
  if (_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_TAURI) {
    await window.tauri?.setWindowTitle(nextTitle);
    return;
  }
  if (document.title !== nextTitle) {
    document.title = nextTitle;
  }
}

// Synchronous page title update has conflicts with History API in Chrome
const setPageTitle = (0,_schedulers__WEBPACK_IMPORTED_MODULE_1__.debounce)(setPageTitleInstant, UPDATE_DEBOUNCE_MS, false);

/***/ }),

/***/ "./src/versionNotification.txt":
/*!*************************************!*\
  !*** ./src/versionNotification.txt ***!
  \*************************************/
/***/ ((module) => {

module.exports = "**Telegram Web A Digest**\n\nOver the past year, many new features and useful optimisations have been added. Here is a brief overview of the developments that have taken place in Web A during those busy months.\n\n __General__\n A huge number of design fixes across the app.\n Preview chats and mark them as read.\n Video messages can now be transcribed.\n Track your tasks with the help of [checklists](https://telegram.org/blog/checklists-suggested-posts/#checklists).\n Folder tags are now supported with the help of GitHub contributors.\n [Send photos in HD quality](https://telegram.org/blog/direct-to-channel-trim-voice-and-more#send-photos-in-higher-quality).\n [Global search of public posts](https://telegram.org/blog/post-search-story-albums-and-more#public-post-search).\n Support for channels with enabled auto-translate has been added.\n\n __Gifts__\n Added interactions on hover.\n Support for [Gift Marketplace](https://telegram.org/blog/gift-marketplace-and-more).\n Pinned gifts are now displayed in the profile.\n\n __Channels__\n Accept and send direct messages to channels.\n [Suggest your posts to be published by your favourite channels](https://telegram.org/blog/checklists-suggested-posts#suggest-posts-in-channels).\n\n __Profile__\n Full redesign of the profile page.\n [Explore other people's gift collections and story albums](https://telegram.org/blog/post-search-story-albums-and-more#story-albums).\n Keep an eye on all your accounts, just like on mobile and desktop clients, with the multi-account feature.\n\nThere are so many other bugfixes and improvements that it would take forever to describe them all! We're continually working on adding new features and improving the user experience.\n";

/***/ })

}]);
//# sourceMappingURL=BundleMain.34929f9b439c616d77fd.js.map